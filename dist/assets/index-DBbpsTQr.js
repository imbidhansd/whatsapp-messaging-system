var GF=r=>{throw TypeError(r)};var HF=(r,s,a)=>s.has(r)||GF("Cannot "+a);var wc=(r,s,a)=>(HF(r,s,"read from private field"),a?a.call(r):s.get(r)),lw=(r,s,a)=>s.has(r)?GF("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,a),wE=(r,s,a,d)=>(HF(r,s,"write to private field"),d?d.call(r,a):s.set(r,a),a);function Zre(r,s){for(var a=0;a<s.length;a++){const d=s[a];if(typeof d!="string"&&!Array.isArray(d)){for(const p in d)if(p!=="default"&&!(p in r)){const _=Object.getOwnPropertyDescriptor(d,p);_&&Object.defineProperty(r,p,_.get?_:{enumerable:!0,get:()=>d[p]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const v of _.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&d(v)}).observe(document,{childList:!0,subtree:!0});function a(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerPolicy&&(_.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?_.credentials="include":p.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function d(p){if(p.ep)return;p.ep=!0;const _=a(p);fetch(p.href,_)}})();var bE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _4(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var g4={exports:{}},ly={},E4={exports:{}},Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var am=Symbol.for("react.element"),eie=Symbol.for("react.portal"),tie=Symbol.for("react.fragment"),nie=Symbol.for("react.strict_mode"),rie=Symbol.for("react.profiler"),iie=Symbol.for("react.provider"),sie=Symbol.for("react.context"),oie=Symbol.for("react.forward_ref"),aie=Symbol.for("react.suspense"),cie=Symbol.for("react.memo"),lie=Symbol.for("react.lazy"),KF=Symbol.iterator;function die(r){return r===null||typeof r!="object"?null:(r=KF&&r[KF]||r["@@iterator"],typeof r=="function"?r:null)}var v4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y4=Object.assign,S4={};function mh(r,s,a){this.props=r,this.context=s,this.refs=S4,this.updater=a||v4}mh.prototype.isReactComponent={};mh.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};mh.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function T4(){}T4.prototype=mh.prototype;function RI(r,s,a){this.props=r,this.context=s,this.refs=S4,this.updater=a||v4}var CI=RI.prototype=new T4;CI.constructor=RI;y4(CI,mh.prototype);CI.isPureReactComponent=!0;var zF=Array.isArray,R4=Object.prototype.hasOwnProperty,wI={current:null},C4={key:!0,ref:!0,__self:!0,__source:!0};function w4(r,s,a){var d,p={},_=null,v=null;if(s!=null)for(d in s.ref!==void 0&&(v=s.ref),s.key!==void 0&&(_=""+s.key),s)R4.call(s,d)&&!C4.hasOwnProperty(d)&&(p[d]=s[d]);var T=arguments.length-2;if(T===1)p.children=a;else if(1<T){for(var b=Array(T),N=0;N<T;N++)b[N]=arguments[N+2];p.children=b}if(r&&r.defaultProps)for(d in T=r.defaultProps,T)p[d]===void 0&&(p[d]=T[d]);return{$$typeof:am,type:r,key:_,ref:v,props:p,_owner:wI.current}}function uie(r,s){return{$$typeof:am,type:r.type,key:s,ref:r.ref,props:r.props,_owner:r._owner}}function bI(r){return typeof r=="object"&&r!==null&&r.$$typeof===am}function hie(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(a){return s[a]})}var YF=/\/+/g;function dw(r,s){return typeof r=="object"&&r!==null&&r.key!=null?hie(""+r.key):s.toString(36)}function qE(r,s,a,d,p){var _=typeof r;(_==="undefined"||_==="boolean")&&(r=null);var v=!1;if(r===null)v=!0;else switch(_){case"string":case"number":v=!0;break;case"object":switch(r.$$typeof){case am:case eie:v=!0}}if(v)return v=r,p=p(v),r=d===""?"."+dw(v,0):d,zF(p)?(a="",r!=null&&(a=r.replace(YF,"$&/")+"/"),qE(p,s,a,"",function(N){return N})):p!=null&&(bI(p)&&(p=uie(p,a+(!p.key||v&&v.key===p.key?"":(""+p.key).replace(YF,"$&/")+"/")+r)),s.push(p)),1;if(v=0,d=d===""?".":d+":",zF(r))for(var T=0;T<r.length;T++){_=r[T];var b=d+dw(_,T);v+=qE(_,s,a,b,p)}else if(b=die(r),typeof b=="function")for(r=b.call(r),T=0;!(_=r.next()).done;)_=_.value,b=d+dw(_,T++),v+=qE(_,s,a,b,p);else if(_==="object")throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return v}function IE(r,s,a){if(r==null)return r;var d=[],p=0;return qE(r,d,"","",function(_){return s.call(a,_,p++)}),d}function pie(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(a){(r._status===0||r._status===-1)&&(r._status=1,r._result=a)},function(a){(r._status===0||r._status===-1)&&(r._status=2,r._result=a)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var wi={current:null},XE={transition:null},fie={ReactCurrentDispatcher:wi,ReactCurrentBatchConfig:XE,ReactCurrentOwner:wI};function b4(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:IE,forEach:function(r,s,a){IE(r,function(){s.apply(this,arguments)},a)},count:function(r){var s=0;return IE(r,function(){s++}),s},toArray:function(r){return IE(r,function(s){return s})||[]},only:function(r){if(!bI(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Yt.Component=mh;Yt.Fragment=tie;Yt.Profiler=rie;Yt.PureComponent=RI;Yt.StrictMode=nie;Yt.Suspense=aie;Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fie;Yt.act=b4;Yt.cloneElement=function(r,s,a){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var d=y4({},r.props),p=r.key,_=r.ref,v=r._owner;if(s!=null){if(s.ref!==void 0&&(_=s.ref,v=wI.current),s.key!==void 0&&(p=""+s.key),r.type&&r.type.defaultProps)var T=r.type.defaultProps;for(b in s)R4.call(s,b)&&!C4.hasOwnProperty(b)&&(d[b]=s[b]===void 0&&T!==void 0?T[b]:s[b])}var b=arguments.length-2;if(b===1)d.children=a;else if(1<b){T=Array(b);for(var N=0;N<b;N++)T[N]=arguments[N+2];d.children=T}return{$$typeof:am,type:r.type,key:p,ref:_,props:d,_owner:v}};Yt.createContext=function(r){return r={$$typeof:sie,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:iie,_context:r},r.Consumer=r};Yt.createElement=w4;Yt.createFactory=function(r){var s=w4.bind(null,r);return s.type=r,s};Yt.createRef=function(){return{current:null}};Yt.forwardRef=function(r){return{$$typeof:oie,render:r}};Yt.isValidElement=bI;Yt.lazy=function(r){return{$$typeof:lie,_payload:{_status:-1,_result:r},_init:pie}};Yt.memo=function(r,s){return{$$typeof:cie,type:r,compare:s===void 0?null:s}};Yt.startTransition=function(r){var s=XE.transition;XE.transition={};try{r()}finally{XE.transition=s}};Yt.unstable_act=b4;Yt.useCallback=function(r,s){return wi.current.useCallback(r,s)};Yt.useContext=function(r){return wi.current.useContext(r)};Yt.useDebugValue=function(){};Yt.useDeferredValue=function(r){return wi.current.useDeferredValue(r)};Yt.useEffect=function(r,s){return wi.current.useEffect(r,s)};Yt.useId=function(){return wi.current.useId()};Yt.useImperativeHandle=function(r,s,a){return wi.current.useImperativeHandle(r,s,a)};Yt.useInsertionEffect=function(r,s){return wi.current.useInsertionEffect(r,s)};Yt.useLayoutEffect=function(r,s){return wi.current.useLayoutEffect(r,s)};Yt.useMemo=function(r,s){return wi.current.useMemo(r,s)};Yt.useReducer=function(r,s,a){return wi.current.useReducer(r,s,a)};Yt.useRef=function(r){return wi.current.useRef(r)};Yt.useState=function(r){return wi.current.useState(r)};Yt.useSyncExternalStore=function(r,s,a){return wi.current.useSyncExternalStore(r,s,a)};Yt.useTransition=function(){return wi.current.useTransition()};Yt.version="18.3.1";E4.exports=Yt;var ee=E4.exports;const mie=_4(ee),_ie=Zre({__proto__:null,default:mie},[ee]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gie=ee,Eie=Symbol.for("react.element"),vie=Symbol.for("react.fragment"),yie=Object.prototype.hasOwnProperty,Sie=gie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Tie={key:!0,ref:!0,__self:!0,__source:!0};function I4(r,s,a){var d,p={},_=null,v=null;a!==void 0&&(_=""+a),s.key!==void 0&&(_=""+s.key),s.ref!==void 0&&(v=s.ref);for(d in s)yie.call(s,d)&&!Tie.hasOwnProperty(d)&&(p[d]=s[d]);if(r&&r.defaultProps)for(d in s=r.defaultProps,s)p[d]===void 0&&(p[d]=s[d]);return{$$typeof:Eie,type:r,key:_,ref:v,props:p,_owner:Sie.current}}ly.Fragment=vie;ly.jsx=I4;ly.jsxs=I4;g4.exports=ly;var A=g4.exports,A4={exports:{}},_s={},O4={exports:{}},N4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(fe,ce){var me=fe.length;fe.push(ce);e:for(;0<me;){var ke=me-1>>>1,qe=fe[ke];if(0<p(qe,ce))fe[ke]=ce,fe[me]=qe,me=ke;else break e}}function a(fe){return fe.length===0?null:fe[0]}function d(fe){if(fe.length===0)return null;var ce=fe[0],me=fe.pop();if(me!==ce){fe[0]=me;e:for(var ke=0,qe=fe.length,Ie=qe>>>1;ke<Ie;){var Et=2*(ke+1)-1,vt=fe[Et],tn=Et+1,zt=fe[tn];if(0>p(vt,me))tn<qe&&0>p(zt,vt)?(fe[ke]=zt,fe[tn]=me,ke=tn):(fe[ke]=vt,fe[Et]=me,ke=Et);else if(tn<qe&&0>p(zt,me))fe[ke]=zt,fe[tn]=me,ke=tn;else break e}}return ce}function p(fe,ce){var me=fe.sortIndex-ce.sortIndex;return me!==0?me:fe.id-ce.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;r.unstable_now=function(){return _.now()}}else{var v=Date,T=v.now();r.unstable_now=function(){return v.now()-T}}var b=[],N=[],L=1,U=null,B=3,Y=!1,F=!1,X=!1,te=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function W(fe){for(var ce=a(N);ce!==null;){if(ce.callback===null)d(N);else if(ce.startTime<=fe)d(N),ce.sortIndex=ce.expirationTime,s(b,ce);else break;ce=a(N)}}function Z(fe){if(X=!1,W(fe),!F)if(a(b)!==null)F=!0,en(Ee);else{var ce=a(N);ce!==null&&Ae(Z,ce.startTime-fe)}}function Ee(fe,ce){F=!1,X&&(X=!1,q(Ne),Ne=-1),Y=!0;var me=B;try{for(W(ce),U=a(b);U!==null&&(!(U.expirationTime>ce)||fe&&!ct());){var ke=U.callback;if(typeof ke=="function"){U.callback=null,B=U.priorityLevel;var qe=ke(U.expirationTime<=ce);ce=r.unstable_now(),typeof qe=="function"?U.callback=qe:U===a(b)&&d(b),W(ce)}else d(b);U=a(b)}if(U!==null)var Ie=!0;else{var Et=a(N);Et!==null&&Ae(Z,Et.startTime-ce),Ie=!1}return Ie}finally{U=null,B=me,Y=!1}}var Oe=!1,we=null,Ne=-1,at=5,Ue=-1;function ct(){return!(r.unstable_now()-Ue<at)}function Ze(){if(we!==null){var fe=r.unstable_now();Ue=fe;var ce=!0;try{ce=we(!0,fe)}finally{ce?Kt():(Oe=!1,we=null)}}else Oe=!1}var Kt;if(typeof z=="function")Kt=function(){z(Ze)};else if(typeof MessageChannel<"u"){var Mt=new MessageChannel,dr=Mt.port2;Mt.port1.onmessage=Ze,Kt=function(){dr.postMessage(null)}}else Kt=function(){te(Ze,0)};function en(fe){we=fe,Oe||(Oe=!0,Kt())}function Ae(fe,ce){Ne=te(function(){fe(r.unstable_now())},ce)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(fe){fe.callback=null},r.unstable_continueExecution=function(){F||Y||(F=!0,en(Ee))},r.unstable_forceFrameRate=function(fe){0>fe||125<fe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):at=0<fe?Math.floor(1e3/fe):5},r.unstable_getCurrentPriorityLevel=function(){return B},r.unstable_getFirstCallbackNode=function(){return a(b)},r.unstable_next=function(fe){switch(B){case 1:case 2:case 3:var ce=3;break;default:ce=B}var me=B;B=ce;try{return fe()}finally{B=me}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(fe,ce){switch(fe){case 1:case 2:case 3:case 4:case 5:break;default:fe=3}var me=B;B=fe;try{return ce()}finally{B=me}},r.unstable_scheduleCallback=function(fe,ce,me){var ke=r.unstable_now();switch(typeof me=="object"&&me!==null?(me=me.delay,me=typeof me=="number"&&0<me?ke+me:ke):me=ke,fe){case 1:var qe=-1;break;case 2:qe=250;break;case 5:qe=1073741823;break;case 4:qe=1e4;break;default:qe=5e3}return qe=me+qe,fe={id:L++,callback:ce,priorityLevel:fe,startTime:me,expirationTime:qe,sortIndex:-1},me>ke?(fe.sortIndex=me,s(N,fe),a(b)===null&&fe===a(N)&&(X?(q(Ne),Ne=-1):X=!0,Ae(Z,me-ke))):(fe.sortIndex=qe,s(b,fe),F||Y||(F=!0,en(Ee))),fe},r.unstable_shouldYield=ct,r.unstable_wrapCallback=function(fe){var ce=B;return function(){var me=B;B=ce;try{return fe.apply(this,arguments)}finally{B=me}}}})(N4);O4.exports=N4;var Rie=O4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cie=ee,fs=Rie;function De(r){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+r,a=1;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var P4=new Set,Ff={};function hd(r,s){sh(r,s),sh(r+"Capture",s)}function sh(r,s){for(Ff[r]=s,r=0;r<s.length;r++)P4.add(s[r])}var xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ib=Object.prototype.hasOwnProperty,wie=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qF={},XF={};function bie(r){return ib.call(XF,r)?!0:ib.call(qF,r)?!1:wie.test(r)?XF[r]=!0:(qF[r]=!0,!1)}function Iie(r,s,a,d){if(a!==null&&a.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return d?!1:a!==null?!a.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Aie(r,s,a,d){if(s===null||typeof s>"u"||Iie(r,s,a,d))return!0;if(d)return!1;if(a!==null)switch(a.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function bi(r,s,a,d,p,_,v){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=d,this.attributeNamespace=p,this.mustUseProperty=a,this.propertyName=r,this.type=s,this.sanitizeURL=_,this.removeEmptyString=v}var ti={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){ti[r]=new bi(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var s=r[0];ti[s]=new bi(s,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){ti[r]=new bi(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){ti[r]=new bi(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){ti[r]=new bi(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){ti[r]=new bi(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){ti[r]=new bi(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){ti[r]=new bi(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){ti[r]=new bi(r,5,!1,r.toLowerCase(),null,!1,!1)});var II=/[\-:]([a-z])/g;function AI(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var s=r.replace(II,AI);ti[s]=new bi(s,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var s=r.replace(II,AI);ti[s]=new bi(s,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var s=r.replace(II,AI);ti[s]=new bi(s,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){ti[r]=new bi(r,1,!1,r.toLowerCase(),null,!1,!1)});ti.xlinkHref=new bi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){ti[r]=new bi(r,1,!1,r.toLowerCase(),null,!0,!0)});function OI(r,s,a,d){var p=ti.hasOwnProperty(s)?ti[s]:null;(p!==null?p.type!==0:d||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(Aie(s,a,p,d)&&(a=null),d||p===null?bie(s)&&(a===null?r.removeAttribute(s):r.setAttribute(s,""+a)):p.mustUseProperty?r[p.propertyName]=a===null?p.type===3?!1:"":a:(s=p.attributeName,d=p.attributeNamespace,a===null?r.removeAttribute(s):(p=p.type,a=p===3||p===4&&a===!0?"":""+a,d?r.setAttributeNS(d,s,a):r.setAttribute(s,a))))}var Ga=Cie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,AE=Symbol.for("react.element"),Vu=Symbol.for("react.portal"),ju=Symbol.for("react.fragment"),NI=Symbol.for("react.strict_mode"),sb=Symbol.for("react.profiler"),D4=Symbol.for("react.provider"),k4=Symbol.for("react.context"),PI=Symbol.for("react.forward_ref"),ob=Symbol.for("react.suspense"),ab=Symbol.for("react.suspense_list"),DI=Symbol.for("react.memo"),Ac=Symbol.for("react.lazy"),L4=Symbol.for("react.offscreen"),JF=Symbol.iterator;function of(r){return r===null||typeof r!="object"?null:(r=JF&&r[JF]||r["@@iterator"],typeof r=="function"?r:null)}var tr=Object.assign,uw;function yf(r){if(uw===void 0)try{throw Error()}catch(a){var s=a.stack.trim().match(/\n( *(at )?)/);uw=s&&s[1]||""}return`
`+uw+r}var hw=!1;function pw(r,s){if(!r||hw)return"";hw=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(N){var d=N}Reflect.construct(r,[],s)}else{try{s.call()}catch(N){d=N}r.call(s.prototype)}else{try{throw Error()}catch(N){d=N}r()}}catch(N){if(N&&d&&typeof N.stack=="string"){for(var p=N.stack.split(`
`),_=d.stack.split(`
`),v=p.length-1,T=_.length-1;1<=v&&0<=T&&p[v]!==_[T];)T--;for(;1<=v&&0<=T;v--,T--)if(p[v]!==_[T]){if(v!==1||T!==1)do if(v--,T--,0>T||p[v]!==_[T]){var b=`
`+p[v].replace(" at new "," at ");return r.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",r.displayName)),b}while(1<=v&&0<=T);break}}}finally{hw=!1,Error.prepareStackTrace=a}return(r=r?r.displayName||r.name:"")?yf(r):""}function Oie(r){switch(r.tag){case 5:return yf(r.type);case 16:return yf("Lazy");case 13:return yf("Suspense");case 19:return yf("SuspenseList");case 0:case 2:case 15:return r=pw(r.type,!1),r;case 11:return r=pw(r.type.render,!1),r;case 1:return r=pw(r.type,!0),r;default:return""}}function cb(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case ju:return"Fragment";case Vu:return"Portal";case sb:return"Profiler";case NI:return"StrictMode";case ob:return"Suspense";case ab:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case k4:return(r.displayName||"Context")+".Consumer";case D4:return(r._context.displayName||"Context")+".Provider";case PI:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case DI:return s=r.displayName||null,s!==null?s:cb(r.type)||"Memo";case Ac:s=r._payload,r=r._init;try{return cb(r(s))}catch{}}return null}function Nie(r){var s=r.type;switch(r.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=s.render,r=r.displayName||r.name||"",s.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cb(s);case 8:return s===NI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Xc(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function M4(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Pie(r){var s=M4(r)?"checked":"value",a=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),d=""+r[s];if(!r.hasOwnProperty(s)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var p=a.get,_=a.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return p.call(this)},set:function(v){d=""+v,_.call(this,v)}}),Object.defineProperty(r,s,{enumerable:a.enumerable}),{getValue:function(){return d},setValue:function(v){d=""+v},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function OE(r){r._valueTracker||(r._valueTracker=Pie(r))}function x4(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var a=s.getValue(),d="";return r&&(d=M4(r)?r.checked?"true":"false":r.value),r=d,r!==a?(s.setValue(r),!0):!1}function bv(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function lb(r,s){var a=s.checked;return tr({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??r._wrapperState.initialChecked})}function $F(r,s){var a=s.defaultValue==null?"":s.defaultValue,d=s.checked!=null?s.checked:s.defaultChecked;a=Xc(s.value!=null?s.value:a),r._wrapperState={initialChecked:d,initialValue:a,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function U4(r,s){s=s.checked,s!=null&&OI(r,"checked",s,!1)}function db(r,s){U4(r,s);var a=Xc(s.value),d=s.type;if(a!=null)d==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+a):r.value!==""+a&&(r.value=""+a);else if(d==="submit"||d==="reset"){r.removeAttribute("value");return}s.hasOwnProperty("value")?ub(r,s.type,a):s.hasOwnProperty("defaultValue")&&ub(r,s.type,Xc(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(r.defaultChecked=!!s.defaultChecked)}function QF(r,s,a){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var d=s.type;if(!(d!=="submit"&&d!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+r._wrapperState.initialValue,a||s===r.value||(r.value=s),r.defaultValue=s}a=r.name,a!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,a!==""&&(r.name=a)}function ub(r,s,a){(s!=="number"||bv(r.ownerDocument)!==r)&&(a==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+a&&(r.defaultValue=""+a))}var Sf=Array.isArray;function Ju(r,s,a,d){if(r=r.options,s){s={};for(var p=0;p<a.length;p++)s["$"+a[p]]=!0;for(a=0;a<r.length;a++)p=s.hasOwnProperty("$"+r[a].value),r[a].selected!==p&&(r[a].selected=p),p&&d&&(r[a].defaultSelected=!0)}else{for(a=""+Xc(a),s=null,p=0;p<r.length;p++){if(r[p].value===a){r[p].selected=!0,d&&(r[p].defaultSelected=!0);return}s!==null||r[p].disabled||(s=r[p])}s!==null&&(s.selected=!0)}}function hb(r,s){if(s.dangerouslySetInnerHTML!=null)throw Error(De(91));return tr({},s,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function ZF(r,s){var a=s.value;if(a==null){if(a=s.children,s=s.defaultValue,a!=null){if(s!=null)throw Error(De(92));if(Sf(a)){if(1<a.length)throw Error(De(93));a=a[0]}s=a}s==null&&(s=""),a=s}r._wrapperState={initialValue:Xc(a)}}function V4(r,s){var a=Xc(s.value),d=Xc(s.defaultValue);a!=null&&(a=""+a,a!==r.value&&(r.value=a),s.defaultValue==null&&r.defaultValue!==a&&(r.defaultValue=a)),d!=null&&(r.defaultValue=""+d)}function eB(r){var s=r.textContent;s===r._wrapperState.initialValue&&s!==""&&s!==null&&(r.value=s)}function j4(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pb(r,s){return r==null||r==="http://www.w3.org/1999/xhtml"?j4(s):r==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var NE,F4=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,a,d,p){MSApp.execUnsafeLocalFunction(function(){return r(s,a,d,p)})}:r}(function(r,s){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=s;else{for(NE=NE||document.createElement("div"),NE.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=NE.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;s.firstChild;)r.appendChild(s.firstChild)}});function Bf(r,s){if(s){var a=r.firstChild;if(a&&a===r.lastChild&&a.nodeType===3){a.nodeValue=s;return}}r.textContent=s}var If={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Die=["Webkit","ms","Moz","O"];Object.keys(If).forEach(function(r){Die.forEach(function(s){s=s+r.charAt(0).toUpperCase()+r.substring(1),If[s]=If[r]})});function B4(r,s,a){return s==null||typeof s=="boolean"||s===""?"":a||typeof s!="number"||s===0||If.hasOwnProperty(r)&&If[r]?(""+s).trim():s+"px"}function W4(r,s){r=r.style;for(var a in s)if(s.hasOwnProperty(a)){var d=a.indexOf("--")===0,p=B4(a,s[a],d);a==="float"&&(a="cssFloat"),d?r.setProperty(a,p):r[a]=p}}var kie=tr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fb(r,s){if(s){if(kie[r]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(De(137,r));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(De(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(De(61))}if(s.style!=null&&typeof s.style!="object")throw Error(De(62))}}function mb(r,s){if(r.indexOf("-")===-1)return typeof s.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _b=null;function kI(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var gb=null,$u=null,Qu=null;function tB(r){if(r=dm(r)){if(typeof gb!="function")throw Error(De(280));var s=r.stateNode;s&&(s=fy(s),gb(r.stateNode,r.type,s))}}function G4(r){$u?Qu?Qu.push(r):Qu=[r]:$u=r}function H4(){if($u){var r=$u,s=Qu;if(Qu=$u=null,tB(r),s)for(r=0;r<s.length;r++)tB(s[r])}}function K4(r,s){return r(s)}function z4(){}var fw=!1;function Y4(r,s,a){if(fw)return r(s,a);fw=!0;try{return K4(r,s,a)}finally{fw=!1,($u!==null||Qu!==null)&&(z4(),H4())}}function Wf(r,s){var a=r.stateNode;if(a===null)return null;var d=fy(a);if(d===null)return null;a=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(a&&typeof a!="function")throw Error(De(231,s,typeof a));return a}var Eb=!1;if(xa)try{var af={};Object.defineProperty(af,"passive",{get:function(){Eb=!0}}),window.addEventListener("test",af,af),window.removeEventListener("test",af,af)}catch{Eb=!1}function Lie(r,s,a,d,p,_,v,T,b){var N=Array.prototype.slice.call(arguments,3);try{s.apply(a,N)}catch(L){this.onError(L)}}var Af=!1,Iv=null,Av=!1,vb=null,Mie={onError:function(r){Af=!0,Iv=r}};function xie(r,s,a,d,p,_,v,T,b){Af=!1,Iv=null,Lie.apply(Mie,arguments)}function Uie(r,s,a,d,p,_,v,T,b){if(xie.apply(this,arguments),Af){if(Af){var N=Iv;Af=!1,Iv=null}else throw Error(De(198));Av||(Av=!0,vb=N)}}function pd(r){var s=r,a=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(a=s.return),r=s.return;while(r)}return s.tag===3?a:null}function q4(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function nB(r){if(pd(r)!==r)throw Error(De(188))}function Vie(r){var s=r.alternate;if(!s){if(s=pd(r),s===null)throw Error(De(188));return s!==r?null:r}for(var a=r,d=s;;){var p=a.return;if(p===null)break;var _=p.alternate;if(_===null){if(d=p.return,d!==null){a=d;continue}break}if(p.child===_.child){for(_=p.child;_;){if(_===a)return nB(p),r;if(_===d)return nB(p),s;_=_.sibling}throw Error(De(188))}if(a.return!==d.return)a=p,d=_;else{for(var v=!1,T=p.child;T;){if(T===a){v=!0,a=p,d=_;break}if(T===d){v=!0,d=p,a=_;break}T=T.sibling}if(!v){for(T=_.child;T;){if(T===a){v=!0,a=_,d=p;break}if(T===d){v=!0,d=_,a=p;break}T=T.sibling}if(!v)throw Error(De(189))}}if(a.alternate!==d)throw Error(De(190))}if(a.tag!==3)throw Error(De(188));return a.stateNode.current===a?r:s}function X4(r){return r=Vie(r),r!==null?J4(r):null}function J4(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var s=J4(r);if(s!==null)return s;r=r.sibling}return null}var $4=fs.unstable_scheduleCallback,rB=fs.unstable_cancelCallback,jie=fs.unstable_shouldYield,Fie=fs.unstable_requestPaint,gr=fs.unstable_now,Bie=fs.unstable_getCurrentPriorityLevel,LI=fs.unstable_ImmediatePriority,Q4=fs.unstable_UserBlockingPriority,Ov=fs.unstable_NormalPriority,Wie=fs.unstable_LowPriority,Z4=fs.unstable_IdlePriority,dy=null,aa=null;function Gie(r){if(aa&&typeof aa.onCommitFiberRoot=="function")try{aa.onCommitFiberRoot(dy,r,void 0,(r.current.flags&128)===128)}catch{}}var Io=Math.clz32?Math.clz32:zie,Hie=Math.log,Kie=Math.LN2;function zie(r){return r>>>=0,r===0?32:31-(Hie(r)/Kie|0)|0}var PE=64,DE=4194304;function Tf(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Nv(r,s){var a=r.pendingLanes;if(a===0)return 0;var d=0,p=r.suspendedLanes,_=r.pingedLanes,v=a&268435455;if(v!==0){var T=v&~p;T!==0?d=Tf(T):(_&=v,_!==0&&(d=Tf(_)))}else v=a&~p,v!==0?d=Tf(v):_!==0&&(d=Tf(_));if(d===0)return 0;if(s!==0&&s!==d&&!(s&p)&&(p=d&-d,_=s&-s,p>=_||p===16&&(_&4194240)!==0))return s;if(d&4&&(d|=a&16),s=r.entangledLanes,s!==0)for(r=r.entanglements,s&=d;0<s;)a=31-Io(s),p=1<<a,d|=r[a],s&=~p;return d}function Yie(r,s){switch(r){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qie(r,s){for(var a=r.suspendedLanes,d=r.pingedLanes,p=r.expirationTimes,_=r.pendingLanes;0<_;){var v=31-Io(_),T=1<<v,b=p[v];b===-1?(!(T&a)||T&d)&&(p[v]=Yie(T,s)):b<=s&&(r.expiredLanes|=T),_&=~T}}function yb(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function e5(){var r=PE;return PE<<=1,!(PE&4194240)&&(PE=64),r}function mw(r){for(var s=[],a=0;31>a;a++)s.push(r);return s}function cm(r,s,a){r.pendingLanes|=s,s!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,s=31-Io(s),r[s]=a}function Xie(r,s){var a=r.pendingLanes&~s;r.pendingLanes=s,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=s,r.mutableReadLanes&=s,r.entangledLanes&=s,s=r.entanglements;var d=r.eventTimes;for(r=r.expirationTimes;0<a;){var p=31-Io(a),_=1<<p;s[p]=0,d[p]=-1,r[p]=-1,a&=~_}}function MI(r,s){var a=r.entangledLanes|=s;for(r=r.entanglements;a;){var d=31-Io(a),p=1<<d;p&s|r[d]&s&&(r[d]|=s),a&=~p}}var Sn=0;function t5(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var n5,xI,r5,i5,s5,Sb=!1,kE=[],Uc=null,Vc=null,jc=null,Gf=new Map,Hf=new Map,Nc=[],Jie="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function iB(r,s){switch(r){case"focusin":case"focusout":Uc=null;break;case"dragenter":case"dragleave":Vc=null;break;case"mouseover":case"mouseout":jc=null;break;case"pointerover":case"pointerout":Gf.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hf.delete(s.pointerId)}}function cf(r,s,a,d,p,_){return r===null||r.nativeEvent!==_?(r={blockedOn:s,domEventName:a,eventSystemFlags:d,nativeEvent:_,targetContainers:[p]},s!==null&&(s=dm(s),s!==null&&xI(s)),r):(r.eventSystemFlags|=d,s=r.targetContainers,p!==null&&s.indexOf(p)===-1&&s.push(p),r)}function $ie(r,s,a,d,p){switch(s){case"focusin":return Uc=cf(Uc,r,s,a,d,p),!0;case"dragenter":return Vc=cf(Vc,r,s,a,d,p),!0;case"mouseover":return jc=cf(jc,r,s,a,d,p),!0;case"pointerover":var _=p.pointerId;return Gf.set(_,cf(Gf.get(_)||null,r,s,a,d,p)),!0;case"gotpointercapture":return _=p.pointerId,Hf.set(_,cf(Hf.get(_)||null,r,s,a,d,p)),!0}return!1}function o5(r){var s=Yl(r.target);if(s!==null){var a=pd(s);if(a!==null){if(s=a.tag,s===13){if(s=q4(a),s!==null){r.blockedOn=s,s5(r.priority,function(){r5(a)});return}}else if(s===3&&a.stateNode.current.memoizedState.isDehydrated){r.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}r.blockedOn=null}function JE(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var a=Tb(r.domEventName,r.eventSystemFlags,s[0],r.nativeEvent);if(a===null){a=r.nativeEvent;var d=new a.constructor(a.type,a);_b=d,a.target.dispatchEvent(d),_b=null}else return s=dm(a),s!==null&&xI(s),r.blockedOn=a,!1;s.shift()}return!0}function sB(r,s,a){JE(r)&&a.delete(s)}function Qie(){Sb=!1,Uc!==null&&JE(Uc)&&(Uc=null),Vc!==null&&JE(Vc)&&(Vc=null),jc!==null&&JE(jc)&&(jc=null),Gf.forEach(sB),Hf.forEach(sB)}function lf(r,s){r.blockedOn===s&&(r.blockedOn=null,Sb||(Sb=!0,fs.unstable_scheduleCallback(fs.unstable_NormalPriority,Qie)))}function Kf(r){function s(p){return lf(p,r)}if(0<kE.length){lf(kE[0],r);for(var a=1;a<kE.length;a++){var d=kE[a];d.blockedOn===r&&(d.blockedOn=null)}}for(Uc!==null&&lf(Uc,r),Vc!==null&&lf(Vc,r),jc!==null&&lf(jc,r),Gf.forEach(s),Hf.forEach(s),a=0;a<Nc.length;a++)d=Nc[a],d.blockedOn===r&&(d.blockedOn=null);for(;0<Nc.length&&(a=Nc[0],a.blockedOn===null);)o5(a),a.blockedOn===null&&Nc.shift()}var Zu=Ga.ReactCurrentBatchConfig,Pv=!0;function Zie(r,s,a,d){var p=Sn,_=Zu.transition;Zu.transition=null;try{Sn=1,UI(r,s,a,d)}finally{Sn=p,Zu.transition=_}}function ese(r,s,a,d){var p=Sn,_=Zu.transition;Zu.transition=null;try{Sn=4,UI(r,s,a,d)}finally{Sn=p,Zu.transition=_}}function UI(r,s,a,d){if(Pv){var p=Tb(r,s,a,d);if(p===null)ww(r,s,d,Dv,a),iB(r,d);else if($ie(p,r,s,a,d))d.stopPropagation();else if(iB(r,d),s&4&&-1<Jie.indexOf(r)){for(;p!==null;){var _=dm(p);if(_!==null&&n5(_),_=Tb(r,s,a,d),_===null&&ww(r,s,d,Dv,a),_===p)break;p=_}p!==null&&d.stopPropagation()}else ww(r,s,d,null,a)}}var Dv=null;function Tb(r,s,a,d){if(Dv=null,r=kI(d),r=Yl(r),r!==null)if(s=pd(r),s===null)r=null;else if(a=s.tag,a===13){if(r=q4(s),r!==null)return r;r=null}else if(a===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null);return Dv=r,null}function a5(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Bie()){case LI:return 1;case Q4:return 4;case Ov:case Wie:return 16;case Z4:return 536870912;default:return 16}default:return 16}}var Lc=null,VI=null,$E=null;function c5(){if($E)return $E;var r,s=VI,a=s.length,d,p="value"in Lc?Lc.value:Lc.textContent,_=p.length;for(r=0;r<a&&s[r]===p[r];r++);var v=a-r;for(d=1;d<=v&&s[a-d]===p[_-d];d++);return $E=p.slice(r,1<d?1-d:void 0)}function QE(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function LE(){return!0}function oB(){return!1}function gs(r){function s(a,d,p,_,v){this._reactName=a,this._targetInst=p,this.type=d,this.nativeEvent=_,this.target=v,this.currentTarget=null;for(var T in r)r.hasOwnProperty(T)&&(a=r[T],this[T]=a?a(_):_[T]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?LE:oB,this.isPropagationStopped=oB,this}return tr(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=LE)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=LE)},persist:function(){},isPersistent:LE}),s}var _h={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jI=gs(_h),lm=tr({},_h,{view:0,detail:0}),tse=gs(lm),_w,gw,df,uy=tr({},lm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:FI,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==df&&(df&&r.type==="mousemove"?(_w=r.screenX-df.screenX,gw=r.screenY-df.screenY):gw=_w=0,df=r),_w)},movementY:function(r){return"movementY"in r?r.movementY:gw}}),aB=gs(uy),nse=tr({},uy,{dataTransfer:0}),rse=gs(nse),ise=tr({},lm,{relatedTarget:0}),Ew=gs(ise),sse=tr({},_h,{animationName:0,elapsedTime:0,pseudoElement:0}),ose=gs(sse),ase=tr({},_h,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),cse=gs(ase),lse=tr({},_h,{data:0}),cB=gs(lse),dse={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},use={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hse={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pse(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=hse[r])?!!s[r]:!1}function FI(){return pse}var fse=tr({},lm,{key:function(r){if(r.key){var s=dse[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=QE(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?use[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:FI,charCode:function(r){return r.type==="keypress"?QE(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?QE(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),mse=gs(fse),_se=tr({},uy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lB=gs(_se),gse=tr({},lm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:FI}),Ese=gs(gse),vse=tr({},_h,{propertyName:0,elapsedTime:0,pseudoElement:0}),yse=gs(vse),Sse=tr({},uy,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Tse=gs(Sse),Rse=[9,13,27,32],BI=xa&&"CompositionEvent"in window,Of=null;xa&&"documentMode"in document&&(Of=document.documentMode);var Cse=xa&&"TextEvent"in window&&!Of,l5=xa&&(!BI||Of&&8<Of&&11>=Of),dB=" ",uB=!1;function d5(r,s){switch(r){case"keyup":return Rse.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function u5(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Fu=!1;function wse(r,s){switch(r){case"compositionend":return u5(s);case"keypress":return s.which!==32?null:(uB=!0,dB);case"textInput":return r=s.data,r===dB&&uB?null:r;default:return null}}function bse(r,s){if(Fu)return r==="compositionend"||!BI&&d5(r,s)?(r=c5(),$E=VI=Lc=null,Fu=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return l5&&s.locale!=="ko"?null:s.data;default:return null}}var Ise={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hB(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Ise[r.type]:s==="textarea"}function h5(r,s,a,d){G4(d),s=kv(s,"onChange"),0<s.length&&(a=new jI("onChange","change",null,a,d),r.push({event:a,listeners:s}))}var Nf=null,zf=null;function Ase(r){R5(r,0)}function hy(r){var s=Gu(r);if(x4(s))return r}function Ose(r,s){if(r==="change")return s}var p5=!1;if(xa){var vw;if(xa){var yw="oninput"in document;if(!yw){var pB=document.createElement("div");pB.setAttribute("oninput","return;"),yw=typeof pB.oninput=="function"}vw=yw}else vw=!1;p5=vw&&(!document.documentMode||9<document.documentMode)}function fB(){Nf&&(Nf.detachEvent("onpropertychange",f5),zf=Nf=null)}function f5(r){if(r.propertyName==="value"&&hy(zf)){var s=[];h5(s,zf,r,kI(r)),Y4(Ase,s)}}function Nse(r,s,a){r==="focusin"?(fB(),Nf=s,zf=a,Nf.attachEvent("onpropertychange",f5)):r==="focusout"&&fB()}function Pse(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return hy(zf)}function Dse(r,s){if(r==="click")return hy(s)}function kse(r,s){if(r==="input"||r==="change")return hy(s)}function Lse(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Oo=typeof Object.is=="function"?Object.is:Lse;function Yf(r,s){if(Oo(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var a=Object.keys(r),d=Object.keys(s);if(a.length!==d.length)return!1;for(d=0;d<a.length;d++){var p=a[d];if(!ib.call(s,p)||!Oo(r[p],s[p]))return!1}return!0}function mB(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function _B(r,s){var a=mB(r);r=0;for(var d;a;){if(a.nodeType===3){if(d=r+a.textContent.length,r<=s&&d>=s)return{node:a,offset:s-r};r=d}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=mB(a)}}function m5(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?m5(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function _5(){for(var r=window,s=bv();s instanceof r.HTMLIFrameElement;){try{var a=typeof s.contentWindow.location.href=="string"}catch{a=!1}if(a)r=s.contentWindow;else break;s=bv(r.document)}return s}function WI(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}function Mse(r){var s=_5(),a=r.focusedElem,d=r.selectionRange;if(s!==a&&a&&a.ownerDocument&&m5(a.ownerDocument.documentElement,a)){if(d!==null&&WI(a)){if(s=d.start,r=d.end,r===void 0&&(r=s),"selectionStart"in a)a.selectionStart=s,a.selectionEnd=Math.min(r,a.value.length);else if(r=(s=a.ownerDocument||document)&&s.defaultView||window,r.getSelection){r=r.getSelection();var p=a.textContent.length,_=Math.min(d.start,p);d=d.end===void 0?_:Math.min(d.end,p),!r.extend&&_>d&&(p=d,d=_,_=p),p=_B(a,_);var v=_B(a,d);p&&v&&(r.rangeCount!==1||r.anchorNode!==p.node||r.anchorOffset!==p.offset||r.focusNode!==v.node||r.focusOffset!==v.offset)&&(s=s.createRange(),s.setStart(p.node,p.offset),r.removeAllRanges(),_>d?(r.addRange(s),r.extend(v.node,v.offset)):(s.setEnd(v.node,v.offset),r.addRange(s)))}}for(s=[],r=a;r=r.parentNode;)r.nodeType===1&&s.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<s.length;a++)r=s[a],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var xse=xa&&"documentMode"in document&&11>=document.documentMode,Bu=null,Rb=null,Pf=null,Cb=!1;function gB(r,s,a){var d=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Cb||Bu==null||Bu!==bv(d)||(d=Bu,"selectionStart"in d&&WI(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Pf&&Yf(Pf,d)||(Pf=d,d=kv(Rb,"onSelect"),0<d.length&&(s=new jI("onSelect","select",null,s,a),r.push({event:s,listeners:d}),s.target=Bu)))}function ME(r,s){var a={};return a[r.toLowerCase()]=s.toLowerCase(),a["Webkit"+r]="webkit"+s,a["Moz"+r]="moz"+s,a}var Wu={animationend:ME("Animation","AnimationEnd"),animationiteration:ME("Animation","AnimationIteration"),animationstart:ME("Animation","AnimationStart"),transitionend:ME("Transition","TransitionEnd")},Sw={},g5={};xa&&(g5=document.createElement("div").style,"AnimationEvent"in window||(delete Wu.animationend.animation,delete Wu.animationiteration.animation,delete Wu.animationstart.animation),"TransitionEvent"in window||delete Wu.transitionend.transition);function py(r){if(Sw[r])return Sw[r];if(!Wu[r])return r;var s=Wu[r],a;for(a in s)if(s.hasOwnProperty(a)&&a in g5)return Sw[r]=s[a];return r}var E5=py("animationend"),v5=py("animationiteration"),y5=py("animationstart"),S5=py("transitionend"),T5=new Map,EB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zc(r,s){T5.set(r,s),hd(s,[r])}for(var Tw=0;Tw<EB.length;Tw++){var Rw=EB[Tw],Use=Rw.toLowerCase(),Vse=Rw[0].toUpperCase()+Rw.slice(1);Zc(Use,"on"+Vse)}Zc(E5,"onAnimationEnd");Zc(v5,"onAnimationIteration");Zc(y5,"onAnimationStart");Zc("dblclick","onDoubleClick");Zc("focusin","onFocus");Zc("focusout","onBlur");Zc(S5,"onTransitionEnd");sh("onMouseEnter",["mouseout","mouseover"]);sh("onMouseLeave",["mouseout","mouseover"]);sh("onPointerEnter",["pointerout","pointerover"]);sh("onPointerLeave",["pointerout","pointerover"]);hd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hd("onBeforeInput",["compositionend","keypress","textInput","paste"]);hd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jse=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rf));function vB(r,s,a){var d=r.type||"unknown-event";r.currentTarget=a,Uie(d,s,void 0,r),r.currentTarget=null}function R5(r,s){s=(s&4)!==0;for(var a=0;a<r.length;a++){var d=r[a],p=d.event;d=d.listeners;e:{var _=void 0;if(s)for(var v=d.length-1;0<=v;v--){var T=d[v],b=T.instance,N=T.currentTarget;if(T=T.listener,b!==_&&p.isPropagationStopped())break e;vB(p,T,N),_=b}else for(v=0;v<d.length;v++){if(T=d[v],b=T.instance,N=T.currentTarget,T=T.listener,b!==_&&p.isPropagationStopped())break e;vB(p,T,N),_=b}}}if(Av)throw r=vb,Av=!1,vb=null,r}function Vn(r,s){var a=s[Ob];a===void 0&&(a=s[Ob]=new Set);var d=r+"__bubble";a.has(d)||(C5(s,r,2,!1),a.add(d))}function Cw(r,s,a){var d=0;s&&(d|=4),C5(a,r,d,s)}var xE="_reactListening"+Math.random().toString(36).slice(2);function qf(r){if(!r[xE]){r[xE]=!0,P4.forEach(function(a){a!=="selectionchange"&&(jse.has(a)||Cw(a,!1,r),Cw(a,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[xE]||(s[xE]=!0,Cw("selectionchange",!1,s))}}function C5(r,s,a,d){switch(a5(s)){case 1:var p=Zie;break;case 4:p=ese;break;default:p=UI}a=p.bind(null,s,a,r),p=void 0,!Eb||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(p=!0),d?p!==void 0?r.addEventListener(s,a,{capture:!0,passive:p}):r.addEventListener(s,a,!0):p!==void 0?r.addEventListener(s,a,{passive:p}):r.addEventListener(s,a,!1)}function ww(r,s,a,d,p){var _=d;if(!(s&1)&&!(s&2)&&d!==null)e:for(;;){if(d===null)return;var v=d.tag;if(v===3||v===4){var T=d.stateNode.containerInfo;if(T===p||T.nodeType===8&&T.parentNode===p)break;if(v===4)for(v=d.return;v!==null;){var b=v.tag;if((b===3||b===4)&&(b=v.stateNode.containerInfo,b===p||b.nodeType===8&&b.parentNode===p))return;v=v.return}for(;T!==null;){if(v=Yl(T),v===null)return;if(b=v.tag,b===5||b===6){d=_=v;continue e}T=T.parentNode}}d=d.return}Y4(function(){var N=_,L=kI(a),U=[];e:{var B=T5.get(r);if(B!==void 0){var Y=jI,F=r;switch(r){case"keypress":if(QE(a)===0)break e;case"keydown":case"keyup":Y=mse;break;case"focusin":F="focus",Y=Ew;break;case"focusout":F="blur",Y=Ew;break;case"beforeblur":case"afterblur":Y=Ew;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=aB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=rse;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=Ese;break;case E5:case v5:case y5:Y=ose;break;case S5:Y=yse;break;case"scroll":Y=tse;break;case"wheel":Y=Tse;break;case"copy":case"cut":case"paste":Y=cse;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=lB}var X=(s&4)!==0,te=!X&&r==="scroll",q=X?B!==null?B+"Capture":null:B;X=[];for(var z=N,W;z!==null;){W=z;var Z=W.stateNode;if(W.tag===5&&Z!==null&&(W=Z,q!==null&&(Z=Wf(z,q),Z!=null&&X.push(Xf(z,Z,W)))),te)break;z=z.return}0<X.length&&(B=new Y(B,F,null,a,L),U.push({event:B,listeners:X}))}}if(!(s&7)){e:{if(B=r==="mouseover"||r==="pointerover",Y=r==="mouseout"||r==="pointerout",B&&a!==_b&&(F=a.relatedTarget||a.fromElement)&&(Yl(F)||F[Ua]))break e;if((Y||B)&&(B=L.window===L?L:(B=L.ownerDocument)?B.defaultView||B.parentWindow:window,Y?(F=a.relatedTarget||a.toElement,Y=N,F=F?Yl(F):null,F!==null&&(te=pd(F),F!==te||F.tag!==5&&F.tag!==6)&&(F=null)):(Y=null,F=N),Y!==F)){if(X=aB,Z="onMouseLeave",q="onMouseEnter",z="mouse",(r==="pointerout"||r==="pointerover")&&(X=lB,Z="onPointerLeave",q="onPointerEnter",z="pointer"),te=Y==null?B:Gu(Y),W=F==null?B:Gu(F),B=new X(Z,z+"leave",Y,a,L),B.target=te,B.relatedTarget=W,Z=null,Yl(L)===N&&(X=new X(q,z+"enter",F,a,L),X.target=W,X.relatedTarget=te,Z=X),te=Z,Y&&F)t:{for(X=Y,q=F,z=0,W=X;W;W=Lu(W))z++;for(W=0,Z=q;Z;Z=Lu(Z))W++;for(;0<z-W;)X=Lu(X),z--;for(;0<W-z;)q=Lu(q),W--;for(;z--;){if(X===q||q!==null&&X===q.alternate)break t;X=Lu(X),q=Lu(q)}X=null}else X=null;Y!==null&&yB(U,B,Y,X,!1),F!==null&&te!==null&&yB(U,te,F,X,!0)}}e:{if(B=N?Gu(N):window,Y=B.nodeName&&B.nodeName.toLowerCase(),Y==="select"||Y==="input"&&B.type==="file")var Ee=Ose;else if(hB(B))if(p5)Ee=kse;else{Ee=Pse;var Oe=Nse}else(Y=B.nodeName)&&Y.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(Ee=Dse);if(Ee&&(Ee=Ee(r,N))){h5(U,Ee,a,L);break e}Oe&&Oe(r,B,N),r==="focusout"&&(Oe=B._wrapperState)&&Oe.controlled&&B.type==="number"&&ub(B,"number",B.value)}switch(Oe=N?Gu(N):window,r){case"focusin":(hB(Oe)||Oe.contentEditable==="true")&&(Bu=Oe,Rb=N,Pf=null);break;case"focusout":Pf=Rb=Bu=null;break;case"mousedown":Cb=!0;break;case"contextmenu":case"mouseup":case"dragend":Cb=!1,gB(U,a,L);break;case"selectionchange":if(xse)break;case"keydown":case"keyup":gB(U,a,L)}var we;if(BI)e:{switch(r){case"compositionstart":var Ne="onCompositionStart";break e;case"compositionend":Ne="onCompositionEnd";break e;case"compositionupdate":Ne="onCompositionUpdate";break e}Ne=void 0}else Fu?d5(r,a)&&(Ne="onCompositionEnd"):r==="keydown"&&a.keyCode===229&&(Ne="onCompositionStart");Ne&&(l5&&a.locale!=="ko"&&(Fu||Ne!=="onCompositionStart"?Ne==="onCompositionEnd"&&Fu&&(we=c5()):(Lc=L,VI="value"in Lc?Lc.value:Lc.textContent,Fu=!0)),Oe=kv(N,Ne),0<Oe.length&&(Ne=new cB(Ne,r,null,a,L),U.push({event:Ne,listeners:Oe}),we?Ne.data=we:(we=u5(a),we!==null&&(Ne.data=we)))),(we=Cse?wse(r,a):bse(r,a))&&(N=kv(N,"onBeforeInput"),0<N.length&&(L=new cB("onBeforeInput","beforeinput",null,a,L),U.push({event:L,listeners:N}),L.data=we))}R5(U,s)})}function Xf(r,s,a){return{instance:r,listener:s,currentTarget:a}}function kv(r,s){for(var a=s+"Capture",d=[];r!==null;){var p=r,_=p.stateNode;p.tag===5&&_!==null&&(p=_,_=Wf(r,a),_!=null&&d.unshift(Xf(r,_,p)),_=Wf(r,s),_!=null&&d.push(Xf(r,_,p))),r=r.return}return d}function Lu(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function yB(r,s,a,d,p){for(var _=s._reactName,v=[];a!==null&&a!==d;){var T=a,b=T.alternate,N=T.stateNode;if(b!==null&&b===d)break;T.tag===5&&N!==null&&(T=N,p?(b=Wf(a,_),b!=null&&v.unshift(Xf(a,b,T))):p||(b=Wf(a,_),b!=null&&v.push(Xf(a,b,T)))),a=a.return}v.length!==0&&r.push({event:s,listeners:v})}var Fse=/\r\n?/g,Bse=/\u0000|\uFFFD/g;function SB(r){return(typeof r=="string"?r:""+r).replace(Fse,`
`).replace(Bse,"")}function UE(r,s,a){if(s=SB(s),SB(r)!==s&&a)throw Error(De(425))}function Lv(){}var wb=null,bb=null;function Ib(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Ab=typeof setTimeout=="function"?setTimeout:void 0,Wse=typeof clearTimeout=="function"?clearTimeout:void 0,TB=typeof Promise=="function"?Promise:void 0,Gse=typeof queueMicrotask=="function"?queueMicrotask:typeof TB<"u"?function(r){return TB.resolve(null).then(r).catch(Hse)}:Ab;function Hse(r){setTimeout(function(){throw r})}function bw(r,s){var a=s,d=0;do{var p=a.nextSibling;if(r.removeChild(a),p&&p.nodeType===8)if(a=p.data,a==="/$"){if(d===0){r.removeChild(p),Kf(s);return}d--}else a!=="$"&&a!=="$?"&&a!=="$!"||d++;a=p}while(a);Kf(s)}function Fc(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return r}function RB(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var a=r.data;if(a==="$"||a==="$!"||a==="$?"){if(s===0)return r;s--}else a==="/$"&&s++}r=r.previousSibling}return null}var gh=Math.random().toString(36).slice(2),sa="__reactFiber$"+gh,Jf="__reactProps$"+gh,Ua="__reactContainer$"+gh,Ob="__reactEvents$"+gh,Kse="__reactListeners$"+gh,zse="__reactHandles$"+gh;function Yl(r){var s=r[sa];if(s)return s;for(var a=r.parentNode;a;){if(s=a[Ua]||a[sa]){if(a=s.alternate,s.child!==null||a!==null&&a.child!==null)for(r=RB(r);r!==null;){if(a=r[sa])return a;r=RB(r)}return s}r=a,a=r.parentNode}return null}function dm(r){return r=r[sa]||r[Ua],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Gu(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(De(33))}function fy(r){return r[Jf]||null}var Nb=[],Hu=-1;function el(r){return{current:r}}function jn(r){0>Hu||(r.current=Nb[Hu],Nb[Hu]=null,Hu--)}function Mn(r,s){Hu++,Nb[Hu]=r.current,r.current=s}var Jc={},mi=el(Jc),zi=el(!1),nd=Jc;function oh(r,s){var a=r.type.contextTypes;if(!a)return Jc;var d=r.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===s)return d.__reactInternalMemoizedMaskedChildContext;var p={},_;for(_ in a)p[_]=s[_];return d&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=p),p}function Yi(r){return r=r.childContextTypes,r!=null}function Mv(){jn(zi),jn(mi)}function CB(r,s,a){if(mi.current!==Jc)throw Error(De(168));Mn(mi,s),Mn(zi,a)}function w5(r,s,a){var d=r.stateNode;if(s=s.childContextTypes,typeof d.getChildContext!="function")return a;d=d.getChildContext();for(var p in d)if(!(p in s))throw Error(De(108,Nie(r)||"Unknown",p));return tr({},a,d)}function xv(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Jc,nd=mi.current,Mn(mi,r),Mn(zi,zi.current),!0}function wB(r,s,a){var d=r.stateNode;if(!d)throw Error(De(169));a?(r=w5(r,s,nd),d.__reactInternalMemoizedMergedChildContext=r,jn(zi),jn(mi),Mn(mi,r)):jn(zi),Mn(zi,a)}var Pa=null,my=!1,Iw=!1;function b5(r){Pa===null?Pa=[r]:Pa.push(r)}function Yse(r){my=!0,b5(r)}function tl(){if(!Iw&&Pa!==null){Iw=!0;var r=0,s=Sn;try{var a=Pa;for(Sn=1;r<a.length;r++){var d=a[r];do d=d(!0);while(d!==null)}Pa=null,my=!1}catch(p){throw Pa!==null&&(Pa=Pa.slice(r+1)),$4(LI,tl),p}finally{Sn=s,Iw=!1}}return null}var Ku=[],zu=0,Uv=null,Vv=0,Ks=[],zs=0,rd=null,ka=1,La="";function Wl(r,s){Ku[zu++]=Vv,Ku[zu++]=Uv,Uv=r,Vv=s}function I5(r,s,a){Ks[zs++]=ka,Ks[zs++]=La,Ks[zs++]=rd,rd=r;var d=ka;r=La;var p=32-Io(d)-1;d&=~(1<<p),a+=1;var _=32-Io(s)+p;if(30<_){var v=p-p%5;_=(d&(1<<v)-1).toString(32),d>>=v,p-=v,ka=1<<32-Io(s)+p|a<<p|d,La=_+r}else ka=1<<_|a<<p|d,La=r}function GI(r){r.return!==null&&(Wl(r,1),I5(r,1,0))}function HI(r){for(;r===Uv;)Uv=Ku[--zu],Ku[zu]=null,Vv=Ku[--zu],Ku[zu]=null;for(;r===rd;)rd=Ks[--zs],Ks[zs]=null,La=Ks[--zs],Ks[zs]=null,ka=Ks[--zs],Ks[zs]=null}var ps=null,hs=null,zn=!1,wo=null;function A5(r,s){var a=qs(5,null,null,0);a.elementType="DELETED",a.stateNode=s,a.return=r,s=r.deletions,s===null?(r.deletions=[a],r.flags|=16):s.push(a)}function bB(r,s){switch(r.tag){case 5:var a=r.type;return s=s.nodeType!==1||a.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(r.stateNode=s,ps=r,hs=Fc(s.firstChild),!0):!1;case 6:return s=r.pendingProps===""||s.nodeType!==3?null:s,s!==null?(r.stateNode=s,ps=r,hs=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(a=rd!==null?{id:ka,overflow:La}:null,r.memoizedState={dehydrated:s,treeContext:a,retryLane:1073741824},a=qs(18,null,null,0),a.stateNode=s,a.return=r,r.child=a,ps=r,hs=null,!0):!1;default:return!1}}function Pb(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Db(r){if(zn){var s=hs;if(s){var a=s;if(!bB(r,s)){if(Pb(r))throw Error(De(418));s=Fc(a.nextSibling);var d=ps;s&&bB(r,s)?A5(d,a):(r.flags=r.flags&-4097|2,zn=!1,ps=r)}}else{if(Pb(r))throw Error(De(418));r.flags=r.flags&-4097|2,zn=!1,ps=r}}}function IB(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;ps=r}function VE(r){if(r!==ps)return!1;if(!zn)return IB(r),zn=!0,!1;var s;if((s=r.tag!==3)&&!(s=r.tag!==5)&&(s=r.type,s=s!=="head"&&s!=="body"&&!Ib(r.type,r.memoizedProps)),s&&(s=hs)){if(Pb(r))throw O5(),Error(De(418));for(;s;)A5(r,s),s=Fc(s.nextSibling)}if(IB(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(De(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8){var a=r.data;if(a==="/$"){if(s===0){hs=Fc(r.nextSibling);break e}s--}else a!=="$"&&a!=="$!"&&a!=="$?"||s++}r=r.nextSibling}hs=null}}else hs=ps?Fc(r.stateNode.nextSibling):null;return!0}function O5(){for(var r=hs;r;)r=Fc(r.nextSibling)}function ah(){hs=ps=null,zn=!1}function KI(r){wo===null?wo=[r]:wo.push(r)}var qse=Ga.ReactCurrentBatchConfig;function uf(r,s,a){if(r=a.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(De(309));var d=a.stateNode}if(!d)throw Error(De(147,r));var p=d,_=""+r;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===_?s.ref:(s=function(v){var T=p.refs;v===null?delete T[_]:T[_]=v},s._stringRef=_,s)}if(typeof r!="string")throw Error(De(284));if(!a._owner)throw Error(De(290,r))}return r}function jE(r,s){throw r=Object.prototype.toString.call(s),Error(De(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r))}function AB(r){var s=r._init;return s(r._payload)}function N5(r){function s(q,z){if(r){var W=q.deletions;W===null?(q.deletions=[z],q.flags|=16):W.push(z)}}function a(q,z){if(!r)return null;for(;z!==null;)s(q,z),z=z.sibling;return null}function d(q,z){for(q=new Map;z!==null;)z.key!==null?q.set(z.key,z):q.set(z.index,z),z=z.sibling;return q}function p(q,z){return q=Hc(q,z),q.index=0,q.sibling=null,q}function _(q,z,W){return q.index=W,r?(W=q.alternate,W!==null?(W=W.index,W<z?(q.flags|=2,z):W):(q.flags|=2,z)):(q.flags|=1048576,z)}function v(q){return r&&q.alternate===null&&(q.flags|=2),q}function T(q,z,W,Z){return z===null||z.tag!==6?(z=Lw(W,q.mode,Z),z.return=q,z):(z=p(z,W),z.return=q,z)}function b(q,z,W,Z){var Ee=W.type;return Ee===ju?L(q,z,W.props.children,Z,W.key):z!==null&&(z.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===Ac&&AB(Ee)===z.type)?(Z=p(z,W.props),Z.ref=uf(q,z,W),Z.return=q,Z):(Z=sv(W.type,W.key,W.props,null,q.mode,Z),Z.ref=uf(q,z,W),Z.return=q,Z)}function N(q,z,W,Z){return z===null||z.tag!==4||z.stateNode.containerInfo!==W.containerInfo||z.stateNode.implementation!==W.implementation?(z=Mw(W,q.mode,Z),z.return=q,z):(z=p(z,W.children||[]),z.return=q,z)}function L(q,z,W,Z,Ee){return z===null||z.tag!==7?(z=Zl(W,q.mode,Z,Ee),z.return=q,z):(z=p(z,W),z.return=q,z)}function U(q,z,W){if(typeof z=="string"&&z!==""||typeof z=="number")return z=Lw(""+z,q.mode,W),z.return=q,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case AE:return W=sv(z.type,z.key,z.props,null,q.mode,W),W.ref=uf(q,null,z),W.return=q,W;case Vu:return z=Mw(z,q.mode,W),z.return=q,z;case Ac:var Z=z._init;return U(q,Z(z._payload),W)}if(Sf(z)||of(z))return z=Zl(z,q.mode,W,null),z.return=q,z;jE(q,z)}return null}function B(q,z,W,Z){var Ee=z!==null?z.key:null;if(typeof W=="string"&&W!==""||typeof W=="number")return Ee!==null?null:T(q,z,""+W,Z);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case AE:return W.key===Ee?b(q,z,W,Z):null;case Vu:return W.key===Ee?N(q,z,W,Z):null;case Ac:return Ee=W._init,B(q,z,Ee(W._payload),Z)}if(Sf(W)||of(W))return Ee!==null?null:L(q,z,W,Z,null);jE(q,W)}return null}function Y(q,z,W,Z,Ee){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return q=q.get(W)||null,T(z,q,""+Z,Ee);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case AE:return q=q.get(Z.key===null?W:Z.key)||null,b(z,q,Z,Ee);case Vu:return q=q.get(Z.key===null?W:Z.key)||null,N(z,q,Z,Ee);case Ac:var Oe=Z._init;return Y(q,z,W,Oe(Z._payload),Ee)}if(Sf(Z)||of(Z))return q=q.get(W)||null,L(z,q,Z,Ee,null);jE(z,Z)}return null}function F(q,z,W,Z){for(var Ee=null,Oe=null,we=z,Ne=z=0,at=null;we!==null&&Ne<W.length;Ne++){we.index>Ne?(at=we,we=null):at=we.sibling;var Ue=B(q,we,W[Ne],Z);if(Ue===null){we===null&&(we=at);break}r&&we&&Ue.alternate===null&&s(q,we),z=_(Ue,z,Ne),Oe===null?Ee=Ue:Oe.sibling=Ue,Oe=Ue,we=at}if(Ne===W.length)return a(q,we),zn&&Wl(q,Ne),Ee;if(we===null){for(;Ne<W.length;Ne++)we=U(q,W[Ne],Z),we!==null&&(z=_(we,z,Ne),Oe===null?Ee=we:Oe.sibling=we,Oe=we);return zn&&Wl(q,Ne),Ee}for(we=d(q,we);Ne<W.length;Ne++)at=Y(we,q,Ne,W[Ne],Z),at!==null&&(r&&at.alternate!==null&&we.delete(at.key===null?Ne:at.key),z=_(at,z,Ne),Oe===null?Ee=at:Oe.sibling=at,Oe=at);return r&&we.forEach(function(ct){return s(q,ct)}),zn&&Wl(q,Ne),Ee}function X(q,z,W,Z){var Ee=of(W);if(typeof Ee!="function")throw Error(De(150));if(W=Ee.call(W),W==null)throw Error(De(151));for(var Oe=Ee=null,we=z,Ne=z=0,at=null,Ue=W.next();we!==null&&!Ue.done;Ne++,Ue=W.next()){we.index>Ne?(at=we,we=null):at=we.sibling;var ct=B(q,we,Ue.value,Z);if(ct===null){we===null&&(we=at);break}r&&we&&ct.alternate===null&&s(q,we),z=_(ct,z,Ne),Oe===null?Ee=ct:Oe.sibling=ct,Oe=ct,we=at}if(Ue.done)return a(q,we),zn&&Wl(q,Ne),Ee;if(we===null){for(;!Ue.done;Ne++,Ue=W.next())Ue=U(q,Ue.value,Z),Ue!==null&&(z=_(Ue,z,Ne),Oe===null?Ee=Ue:Oe.sibling=Ue,Oe=Ue);return zn&&Wl(q,Ne),Ee}for(we=d(q,we);!Ue.done;Ne++,Ue=W.next())Ue=Y(we,q,Ne,Ue.value,Z),Ue!==null&&(r&&Ue.alternate!==null&&we.delete(Ue.key===null?Ne:Ue.key),z=_(Ue,z,Ne),Oe===null?Ee=Ue:Oe.sibling=Ue,Oe=Ue);return r&&we.forEach(function(Ze){return s(q,Ze)}),zn&&Wl(q,Ne),Ee}function te(q,z,W,Z){if(typeof W=="object"&&W!==null&&W.type===ju&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case AE:e:{for(var Ee=W.key,Oe=z;Oe!==null;){if(Oe.key===Ee){if(Ee=W.type,Ee===ju){if(Oe.tag===7){a(q,Oe.sibling),z=p(Oe,W.props.children),z.return=q,q=z;break e}}else if(Oe.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===Ac&&AB(Ee)===Oe.type){a(q,Oe.sibling),z=p(Oe,W.props),z.ref=uf(q,Oe,W),z.return=q,q=z;break e}a(q,Oe);break}else s(q,Oe);Oe=Oe.sibling}W.type===ju?(z=Zl(W.props.children,q.mode,Z,W.key),z.return=q,q=z):(Z=sv(W.type,W.key,W.props,null,q.mode,Z),Z.ref=uf(q,z,W),Z.return=q,q=Z)}return v(q);case Vu:e:{for(Oe=W.key;z!==null;){if(z.key===Oe)if(z.tag===4&&z.stateNode.containerInfo===W.containerInfo&&z.stateNode.implementation===W.implementation){a(q,z.sibling),z=p(z,W.children||[]),z.return=q,q=z;break e}else{a(q,z);break}else s(q,z);z=z.sibling}z=Mw(W,q.mode,Z),z.return=q,q=z}return v(q);case Ac:return Oe=W._init,te(q,z,Oe(W._payload),Z)}if(Sf(W))return F(q,z,W,Z);if(of(W))return X(q,z,W,Z);jE(q,W)}return typeof W=="string"&&W!==""||typeof W=="number"?(W=""+W,z!==null&&z.tag===6?(a(q,z.sibling),z=p(z,W),z.return=q,q=z):(a(q,z),z=Lw(W,q.mode,Z),z.return=q,q=z),v(q)):a(q,z)}return te}var ch=N5(!0),P5=N5(!1),jv=el(null),Fv=null,Yu=null,zI=null;function YI(){zI=Yu=Fv=null}function qI(r){var s=jv.current;jn(jv),r._currentValue=s}function kb(r,s,a){for(;r!==null;){var d=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),r===a)break;r=r.return}}function eh(r,s){Fv=r,zI=Yu=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&s&&(Ki=!0),r.firstContext=null)}function Js(r){var s=r._currentValue;if(zI!==r)if(r={context:r,memoizedValue:s,next:null},Yu===null){if(Fv===null)throw Error(De(308));Yu=r,Fv.dependencies={lanes:0,firstContext:r}}else Yu=Yu.next=r;return s}var ql=null;function XI(r){ql===null?ql=[r]:ql.push(r)}function D5(r,s,a,d){var p=s.interleaved;return p===null?(a.next=a,XI(s)):(a.next=p.next,p.next=a),s.interleaved=a,Va(r,d)}function Va(r,s){r.lanes|=s;var a=r.alternate;for(a!==null&&(a.lanes|=s),a=r,r=r.return;r!==null;)r.childLanes|=s,a=r.alternate,a!==null&&(a.childLanes|=s),a=r,r=r.return;return a.tag===3?a.stateNode:null}var Oc=!1;function JI(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function k5(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Ma(r,s){return{eventTime:r,lane:s,tag:0,payload:null,callback:null,next:null}}function Bc(r,s,a){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,cn&2){var p=d.pending;return p===null?s.next=s:(s.next=p.next,p.next=s),d.pending=s,Va(r,a)}return p=d.interleaved,p===null?(s.next=s,XI(d)):(s.next=p.next,p.next=s),d.interleaved=s,Va(r,a)}function ZE(r,s,a){if(s=s.updateQueue,s!==null&&(s=s.shared,(a&4194240)!==0)){var d=s.lanes;d&=r.pendingLanes,a|=d,s.lanes=a,MI(r,a)}}function OB(r,s){var a=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,a===d)){var p=null,_=null;if(a=a.firstBaseUpdate,a!==null){do{var v={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};_===null?p=_=v:_=_.next=v,a=a.next}while(a!==null);_===null?p=_=s:_=_.next=s}else p=_=s;a={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:_,shared:d.shared,effects:d.effects},r.updateQueue=a;return}r=a.lastBaseUpdate,r===null?a.firstBaseUpdate=s:r.next=s,a.lastBaseUpdate=s}function Bv(r,s,a,d){var p=r.updateQueue;Oc=!1;var _=p.firstBaseUpdate,v=p.lastBaseUpdate,T=p.shared.pending;if(T!==null){p.shared.pending=null;var b=T,N=b.next;b.next=null,v===null?_=N:v.next=N,v=b;var L=r.alternate;L!==null&&(L=L.updateQueue,T=L.lastBaseUpdate,T!==v&&(T===null?L.firstBaseUpdate=N:T.next=N,L.lastBaseUpdate=b))}if(_!==null){var U=p.baseState;v=0,L=N=b=null,T=_;do{var B=T.lane,Y=T.eventTime;if((d&B)===B){L!==null&&(L=L.next={eventTime:Y,lane:0,tag:T.tag,payload:T.payload,callback:T.callback,next:null});e:{var F=r,X=T;switch(B=s,Y=a,X.tag){case 1:if(F=X.payload,typeof F=="function"){U=F.call(Y,U,B);break e}U=F;break e;case 3:F.flags=F.flags&-65537|128;case 0:if(F=X.payload,B=typeof F=="function"?F.call(Y,U,B):F,B==null)break e;U=tr({},U,B);break e;case 2:Oc=!0}}T.callback!==null&&T.lane!==0&&(r.flags|=64,B=p.effects,B===null?p.effects=[T]:B.push(T))}else Y={eventTime:Y,lane:B,tag:T.tag,payload:T.payload,callback:T.callback,next:null},L===null?(N=L=Y,b=U):L=L.next=Y,v|=B;if(T=T.next,T===null){if(T=p.shared.pending,T===null)break;B=T,T=B.next,B.next=null,p.lastBaseUpdate=B,p.shared.pending=null}}while(!0);if(L===null&&(b=U),p.baseState=b,p.firstBaseUpdate=N,p.lastBaseUpdate=L,s=p.shared.interleaved,s!==null){p=s;do v|=p.lane,p=p.next;while(p!==s)}else _===null&&(p.shared.lanes=0);sd|=v,r.lanes=v,r.memoizedState=U}}function NB(r,s,a){if(r=s.effects,s.effects=null,r!==null)for(s=0;s<r.length;s++){var d=r[s],p=d.callback;if(p!==null){if(d.callback=null,d=a,typeof p!="function")throw Error(De(191,p));p.call(d)}}}var um={},ca=el(um),$f=el(um),Qf=el(um);function Xl(r){if(r===um)throw Error(De(174));return r}function $I(r,s){switch(Mn(Qf,s),Mn($f,r),Mn(ca,um),r=s.nodeType,r){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:pb(null,"");break;default:r=r===8?s.parentNode:s,s=r.namespaceURI||null,r=r.tagName,s=pb(s,r)}jn(ca),Mn(ca,s)}function lh(){jn(ca),jn($f),jn(Qf)}function L5(r){Xl(Qf.current);var s=Xl(ca.current),a=pb(s,r.type);s!==a&&(Mn($f,r),Mn(ca,a))}function QI(r){$f.current===r&&(jn(ca),jn($f))}var Zn=el(0);function Wv(r){for(var s=r;s!==null;){if(s.tag===13){var a=s.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Aw=[];function ZI(){for(var r=0;r<Aw.length;r++)Aw[r]._workInProgressVersionPrimary=null;Aw.length=0}var ev=Ga.ReactCurrentDispatcher,Ow=Ga.ReactCurrentBatchConfig,id=0,er=null,Lr=null,Hr=null,Gv=!1,Df=!1,Zf=0,Xse=0;function di(){throw Error(De(321))}function eA(r,s){if(s===null)return!1;for(var a=0;a<s.length&&a<r.length;a++)if(!Oo(r[a],s[a]))return!1;return!0}function tA(r,s,a,d,p,_){if(id=_,er=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,ev.current=r===null||r.memoizedState===null?Zse:eoe,r=a(d,p),Df){_=0;do{if(Df=!1,Zf=0,25<=_)throw Error(De(301));_+=1,Hr=Lr=null,s.updateQueue=null,ev.current=toe,r=a(d,p)}while(Df)}if(ev.current=Hv,s=Lr!==null&&Lr.next!==null,id=0,Hr=Lr=er=null,Gv=!1,s)throw Error(De(300));return r}function nA(){var r=Zf!==0;return Zf=0,r}function na(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hr===null?er.memoizedState=Hr=r:Hr=Hr.next=r,Hr}function $s(){if(Lr===null){var r=er.alternate;r=r!==null?r.memoizedState:null}else r=Lr.next;var s=Hr===null?er.memoizedState:Hr.next;if(s!==null)Hr=s,Lr=r;else{if(r===null)throw Error(De(310));Lr=r,r={memoizedState:Lr.memoizedState,baseState:Lr.baseState,baseQueue:Lr.baseQueue,queue:Lr.queue,next:null},Hr===null?er.memoizedState=Hr=r:Hr=Hr.next=r}return Hr}function em(r,s){return typeof s=="function"?s(r):s}function Nw(r){var s=$s(),a=s.queue;if(a===null)throw Error(De(311));a.lastRenderedReducer=r;var d=Lr,p=d.baseQueue,_=a.pending;if(_!==null){if(p!==null){var v=p.next;p.next=_.next,_.next=v}d.baseQueue=p=_,a.pending=null}if(p!==null){_=p.next,d=d.baseState;var T=v=null,b=null,N=_;do{var L=N.lane;if((id&L)===L)b!==null&&(b=b.next={lane:0,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),d=N.hasEagerState?N.eagerState:r(d,N.action);else{var U={lane:L,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null};b===null?(T=b=U,v=d):b=b.next=U,er.lanes|=L,sd|=L}N=N.next}while(N!==null&&N!==_);b===null?v=d:b.next=T,Oo(d,s.memoizedState)||(Ki=!0),s.memoizedState=d,s.baseState=v,s.baseQueue=b,a.lastRenderedState=d}if(r=a.interleaved,r!==null){p=r;do _=p.lane,er.lanes|=_,sd|=_,p=p.next;while(p!==r)}else p===null&&(a.lanes=0);return[s.memoizedState,a.dispatch]}function Pw(r){var s=$s(),a=s.queue;if(a===null)throw Error(De(311));a.lastRenderedReducer=r;var d=a.dispatch,p=a.pending,_=s.memoizedState;if(p!==null){a.pending=null;var v=p=p.next;do _=r(_,v.action),v=v.next;while(v!==p);Oo(_,s.memoizedState)||(Ki=!0),s.memoizedState=_,s.baseQueue===null&&(s.baseState=_),a.lastRenderedState=_}return[_,d]}function M5(){}function x5(r,s){var a=er,d=$s(),p=s(),_=!Oo(d.memoizedState,p);if(_&&(d.memoizedState=p,Ki=!0),d=d.queue,rA(j5.bind(null,a,d,r),[r]),d.getSnapshot!==s||_||Hr!==null&&Hr.memoizedState.tag&1){if(a.flags|=2048,tm(9,V5.bind(null,a,d,p,s),void 0,null),Kr===null)throw Error(De(349));id&30||U5(a,s,p)}return p}function U5(r,s,a){r.flags|=16384,r={getSnapshot:s,value:a},s=er.updateQueue,s===null?(s={lastEffect:null,stores:null},er.updateQueue=s,s.stores=[r]):(a=s.stores,a===null?s.stores=[r]:a.push(r))}function V5(r,s,a,d){s.value=a,s.getSnapshot=d,F5(s)&&B5(r)}function j5(r,s,a){return a(function(){F5(s)&&B5(r)})}function F5(r){var s=r.getSnapshot;r=r.value;try{var a=s();return!Oo(r,a)}catch{return!0}}function B5(r){var s=Va(r,1);s!==null&&Ao(s,r,1,-1)}function PB(r){var s=na();return typeof r=="function"&&(r=r()),s.memoizedState=s.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:em,lastRenderedState:r},s.queue=r,r=r.dispatch=Qse.bind(null,er,r),[s.memoizedState,r]}function tm(r,s,a,d){return r={tag:r,create:s,destroy:a,deps:d,next:null},s=er.updateQueue,s===null?(s={lastEffect:null,stores:null},er.updateQueue=s,s.lastEffect=r.next=r):(a=s.lastEffect,a===null?s.lastEffect=r.next=r:(d=a.next,a.next=r,r.next=d,s.lastEffect=r)),r}function W5(){return $s().memoizedState}function tv(r,s,a,d){var p=na();er.flags|=r,p.memoizedState=tm(1|s,a,void 0,d===void 0?null:d)}function _y(r,s,a,d){var p=$s();d=d===void 0?null:d;var _=void 0;if(Lr!==null){var v=Lr.memoizedState;if(_=v.destroy,d!==null&&eA(d,v.deps)){p.memoizedState=tm(s,a,_,d);return}}er.flags|=r,p.memoizedState=tm(1|s,a,_,d)}function DB(r,s){return tv(8390656,8,r,s)}function rA(r,s){return _y(2048,8,r,s)}function G5(r,s){return _y(4,2,r,s)}function H5(r,s){return _y(4,4,r,s)}function K5(r,s){if(typeof s=="function")return r=r(),s(r),function(){s(null)};if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function z5(r,s,a){return a=a!=null?a.concat([r]):null,_y(4,4,K5.bind(null,s,r),a)}function iA(){}function Y5(r,s){var a=$s();s=s===void 0?null:s;var d=a.memoizedState;return d!==null&&s!==null&&eA(s,d[1])?d[0]:(a.memoizedState=[r,s],r)}function q5(r,s){var a=$s();s=s===void 0?null:s;var d=a.memoizedState;return d!==null&&s!==null&&eA(s,d[1])?d[0]:(r=r(),a.memoizedState=[r,s],r)}function X5(r,s,a){return id&21?(Oo(a,s)||(a=e5(),er.lanes|=a,sd|=a,r.baseState=!0),s):(r.baseState&&(r.baseState=!1,Ki=!0),r.memoizedState=a)}function Jse(r,s){var a=Sn;Sn=a!==0&&4>a?a:4,r(!0);var d=Ow.transition;Ow.transition={};try{r(!1),s()}finally{Sn=a,Ow.transition=d}}function J5(){return $s().memoizedState}function $se(r,s,a){var d=Gc(r);if(a={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null},$5(r))Q5(s,a);else if(a=D5(r,s,a,d),a!==null){var p=Ci();Ao(a,r,d,p),Z5(a,s,d)}}function Qse(r,s,a){var d=Gc(r),p={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null};if($5(r))Q5(s,p);else{var _=r.alternate;if(r.lanes===0&&(_===null||_.lanes===0)&&(_=s.lastRenderedReducer,_!==null))try{var v=s.lastRenderedState,T=_(v,a);if(p.hasEagerState=!0,p.eagerState=T,Oo(T,v)){var b=s.interleaved;b===null?(p.next=p,XI(s)):(p.next=b.next,b.next=p),s.interleaved=p;return}}catch{}finally{}a=D5(r,s,p,d),a!==null&&(p=Ci(),Ao(a,r,d,p),Z5(a,s,d))}}function $5(r){var s=r.alternate;return r===er||s!==null&&s===er}function Q5(r,s){Df=Gv=!0;var a=r.pending;a===null?s.next=s:(s.next=a.next,a.next=s),r.pending=s}function Z5(r,s,a){if(a&4194240){var d=s.lanes;d&=r.pendingLanes,a|=d,s.lanes=a,MI(r,a)}}var Hv={readContext:Js,useCallback:di,useContext:di,useEffect:di,useImperativeHandle:di,useInsertionEffect:di,useLayoutEffect:di,useMemo:di,useReducer:di,useRef:di,useState:di,useDebugValue:di,useDeferredValue:di,useTransition:di,useMutableSource:di,useSyncExternalStore:di,useId:di,unstable_isNewReconciler:!1},Zse={readContext:Js,useCallback:function(r,s){return na().memoizedState=[r,s===void 0?null:s],r},useContext:Js,useEffect:DB,useImperativeHandle:function(r,s,a){return a=a!=null?a.concat([r]):null,tv(4194308,4,K5.bind(null,s,r),a)},useLayoutEffect:function(r,s){return tv(4194308,4,r,s)},useInsertionEffect:function(r,s){return tv(4,2,r,s)},useMemo:function(r,s){var a=na();return s=s===void 0?null:s,r=r(),a.memoizedState=[r,s],r},useReducer:function(r,s,a){var d=na();return s=a!==void 0?a(s):s,d.memoizedState=d.baseState=s,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:s},d.queue=r,r=r.dispatch=$se.bind(null,er,r),[d.memoizedState,r]},useRef:function(r){var s=na();return r={current:r},s.memoizedState=r},useState:PB,useDebugValue:iA,useDeferredValue:function(r){return na().memoizedState=r},useTransition:function(){var r=PB(!1),s=r[0];return r=Jse.bind(null,r[1]),na().memoizedState=r,[s,r]},useMutableSource:function(){},useSyncExternalStore:function(r,s,a){var d=er,p=na();if(zn){if(a===void 0)throw Error(De(407));a=a()}else{if(a=s(),Kr===null)throw Error(De(349));id&30||U5(d,s,a)}p.memoizedState=a;var _={value:a,getSnapshot:s};return p.queue=_,DB(j5.bind(null,d,_,r),[r]),d.flags|=2048,tm(9,V5.bind(null,d,_,a,s),void 0,null),a},useId:function(){var r=na(),s=Kr.identifierPrefix;if(zn){var a=La,d=ka;a=(d&~(1<<32-Io(d)-1)).toString(32)+a,s=":"+s+"R"+a,a=Zf++,0<a&&(s+="H"+a.toString(32)),s+=":"}else a=Xse++,s=":"+s+"r"+a.toString(32)+":";return r.memoizedState=s},unstable_isNewReconciler:!1},eoe={readContext:Js,useCallback:Y5,useContext:Js,useEffect:rA,useImperativeHandle:z5,useInsertionEffect:G5,useLayoutEffect:H5,useMemo:q5,useReducer:Nw,useRef:W5,useState:function(){return Nw(em)},useDebugValue:iA,useDeferredValue:function(r){var s=$s();return X5(s,Lr.memoizedState,r)},useTransition:function(){var r=Nw(em)[0],s=$s().memoizedState;return[r,s]},useMutableSource:M5,useSyncExternalStore:x5,useId:J5,unstable_isNewReconciler:!1},toe={readContext:Js,useCallback:Y5,useContext:Js,useEffect:rA,useImperativeHandle:z5,useInsertionEffect:G5,useLayoutEffect:H5,useMemo:q5,useReducer:Pw,useRef:W5,useState:function(){return Pw(em)},useDebugValue:iA,useDeferredValue:function(r){var s=$s();return Lr===null?s.memoizedState=r:X5(s,Lr.memoizedState,r)},useTransition:function(){var r=Pw(em)[0],s=$s().memoizedState;return[r,s]},useMutableSource:M5,useSyncExternalStore:x5,useId:J5,unstable_isNewReconciler:!1};function To(r,s){if(r&&r.defaultProps){s=tr({},s),r=r.defaultProps;for(var a in r)s[a]===void 0&&(s[a]=r[a]);return s}return s}function Lb(r,s,a,d){s=r.memoizedState,a=a(d,s),a=a==null?s:tr({},s,a),r.memoizedState=a,r.lanes===0&&(r.updateQueue.baseState=a)}var gy={isMounted:function(r){return(r=r._reactInternals)?pd(r)===r:!1},enqueueSetState:function(r,s,a){r=r._reactInternals;var d=Ci(),p=Gc(r),_=Ma(d,p);_.payload=s,a!=null&&(_.callback=a),s=Bc(r,_,p),s!==null&&(Ao(s,r,p,d),ZE(s,r,p))},enqueueReplaceState:function(r,s,a){r=r._reactInternals;var d=Ci(),p=Gc(r),_=Ma(d,p);_.tag=1,_.payload=s,a!=null&&(_.callback=a),s=Bc(r,_,p),s!==null&&(Ao(s,r,p,d),ZE(s,r,p))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var a=Ci(),d=Gc(r),p=Ma(a,d);p.tag=2,s!=null&&(p.callback=s),s=Bc(r,p,d),s!==null&&(Ao(s,r,d,a),ZE(s,r,d))}};function kB(r,s,a,d,p,_,v){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,_,v):s.prototype&&s.prototype.isPureReactComponent?!Yf(a,d)||!Yf(p,_):!0}function e6(r,s,a){var d=!1,p=Jc,_=s.contextType;return typeof _=="object"&&_!==null?_=Js(_):(p=Yi(s)?nd:mi.current,d=s.contextTypes,_=(d=d!=null)?oh(r,p):Jc),s=new s(a,_),r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=gy,r.stateNode=s,s._reactInternals=r,d&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=p,r.__reactInternalMemoizedMaskedChildContext=_),s}function LB(r,s,a,d){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(a,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(a,d),s.state!==r&&gy.enqueueReplaceState(s,s.state,null)}function Mb(r,s,a,d){var p=r.stateNode;p.props=a,p.state=r.memoizedState,p.refs={},JI(r);var _=s.contextType;typeof _=="object"&&_!==null?p.context=Js(_):(_=Yi(s)?nd:mi.current,p.context=oh(r,_)),p.state=r.memoizedState,_=s.getDerivedStateFromProps,typeof _=="function"&&(Lb(r,s,_,a),p.state=r.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(s=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),s!==p.state&&gy.enqueueReplaceState(p,p.state,null),Bv(r,a,p,d),p.state=r.memoizedState),typeof p.componentDidMount=="function"&&(r.flags|=4194308)}function dh(r,s){try{var a="",d=s;do a+=Oie(d),d=d.return;while(d);var p=a}catch(_){p=`
Error generating stack: `+_.message+`
`+_.stack}return{value:r,source:s,stack:p,digest:null}}function Dw(r,s,a){return{value:r,source:null,stack:a??null,digest:s??null}}function xb(r,s){try{console.error(s.value)}catch(a){setTimeout(function(){throw a})}}var noe=typeof WeakMap=="function"?WeakMap:Map;function t6(r,s,a){a=Ma(-1,a),a.tag=3,a.payload={element:null};var d=s.value;return a.callback=function(){zv||(zv=!0,zb=d),xb(r,s)},a}function n6(r,s,a){a=Ma(-1,a),a.tag=3;var d=r.type.getDerivedStateFromError;if(typeof d=="function"){var p=s.value;a.payload=function(){return d(p)},a.callback=function(){xb(r,s)}}var _=r.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(a.callback=function(){xb(r,s),typeof d!="function"&&(Wc===null?Wc=new Set([this]):Wc.add(this));var v=s.stack;this.componentDidCatch(s.value,{componentStack:v!==null?v:""})}),a}function MB(r,s,a){var d=r.pingCache;if(d===null){d=r.pingCache=new noe;var p=new Set;d.set(s,p)}else p=d.get(s),p===void 0&&(p=new Set,d.set(s,p));p.has(a)||(p.add(a),r=_oe.bind(null,r,s,a),s.then(r,r))}function xB(r){do{var s;if((s=r.tag===13)&&(s=r.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return r;r=r.return}while(r!==null);return null}function UB(r,s,a,d,p){return r.mode&1?(r.flags|=65536,r.lanes=p,r):(r===s?r.flags|=65536:(r.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(s=Ma(-1,1),s.tag=2,Bc(a,s,1))),a.lanes|=1),r)}var roe=Ga.ReactCurrentOwner,Ki=!1;function Ri(r,s,a,d){s.child=r===null?P5(s,null,a,d):ch(s,r.child,a,d)}function VB(r,s,a,d,p){a=a.render;var _=s.ref;return eh(s,p),d=tA(r,s,a,d,_,p),a=nA(),r!==null&&!Ki?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~p,ja(r,s,p)):(zn&&a&&GI(s),s.flags|=1,Ri(r,s,d,p),s.child)}function jB(r,s,a,d,p){if(r===null){var _=a.type;return typeof _=="function"&&!hA(_)&&_.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(s.tag=15,s.type=_,r6(r,s,_,d,p)):(r=sv(a.type,null,d,s,s.mode,p),r.ref=s.ref,r.return=s,s.child=r)}if(_=r.child,!(r.lanes&p)){var v=_.memoizedProps;if(a=a.compare,a=a!==null?a:Yf,a(v,d)&&r.ref===s.ref)return ja(r,s,p)}return s.flags|=1,r=Hc(_,d),r.ref=s.ref,r.return=s,s.child=r}function r6(r,s,a,d,p){if(r!==null){var _=r.memoizedProps;if(Yf(_,d)&&r.ref===s.ref)if(Ki=!1,s.pendingProps=d=_,(r.lanes&p)!==0)r.flags&131072&&(Ki=!0);else return s.lanes=r.lanes,ja(r,s,p)}return Ub(r,s,a,d,p)}function i6(r,s,a){var d=s.pendingProps,p=d.children,_=r!==null?r.memoizedState:null;if(d.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mn(Xu,us),us|=a;else{if(!(a&1073741824))return r=_!==null?_.baseLanes|a:a,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:r,cachePool:null,transitions:null},s.updateQueue=null,Mn(Xu,us),us|=r,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=_!==null?_.baseLanes:a,Mn(Xu,us),us|=d}else _!==null?(d=_.baseLanes|a,s.memoizedState=null):d=a,Mn(Xu,us),us|=d;return Ri(r,s,p,a),s.child}function s6(r,s){var a=s.ref;(r===null&&a!==null||r!==null&&r.ref!==a)&&(s.flags|=512,s.flags|=2097152)}function Ub(r,s,a,d,p){var _=Yi(a)?nd:mi.current;return _=oh(s,_),eh(s,p),a=tA(r,s,a,d,_,p),d=nA(),r!==null&&!Ki?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~p,ja(r,s,p)):(zn&&d&&GI(s),s.flags|=1,Ri(r,s,a,p),s.child)}function FB(r,s,a,d,p){if(Yi(a)){var _=!0;xv(s)}else _=!1;if(eh(s,p),s.stateNode===null)nv(r,s),e6(s,a,d),Mb(s,a,d,p),d=!0;else if(r===null){var v=s.stateNode,T=s.memoizedProps;v.props=T;var b=v.context,N=a.contextType;typeof N=="object"&&N!==null?N=Js(N):(N=Yi(a)?nd:mi.current,N=oh(s,N));var L=a.getDerivedStateFromProps,U=typeof L=="function"||typeof v.getSnapshotBeforeUpdate=="function";U||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(T!==d||b!==N)&&LB(s,v,d,N),Oc=!1;var B=s.memoizedState;v.state=B,Bv(s,d,v,p),b=s.memoizedState,T!==d||B!==b||zi.current||Oc?(typeof L=="function"&&(Lb(s,a,L,d),b=s.memoizedState),(T=Oc||kB(s,a,T,d,B,b,N))?(U||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(s.flags|=4194308)):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=b),v.props=d,v.state=b,v.context=N,d=T):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{v=s.stateNode,k5(r,s),T=s.memoizedProps,N=s.type===s.elementType?T:To(s.type,T),v.props=N,U=s.pendingProps,B=v.context,b=a.contextType,typeof b=="object"&&b!==null?b=Js(b):(b=Yi(a)?nd:mi.current,b=oh(s,b));var Y=a.getDerivedStateFromProps;(L=typeof Y=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(T!==U||B!==b)&&LB(s,v,d,b),Oc=!1,B=s.memoizedState,v.state=B,Bv(s,d,v,p);var F=s.memoizedState;T!==U||B!==F||zi.current||Oc?(typeof Y=="function"&&(Lb(s,a,Y,d),F=s.memoizedState),(N=Oc||kB(s,a,N,d,B,F,b)||!1)?(L||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,F,b),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,F,b)),typeof v.componentDidUpdate=="function"&&(s.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof v.componentDidUpdate!="function"||T===r.memoizedProps&&B===r.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||T===r.memoizedProps&&B===r.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=F),v.props=d,v.state=F,v.context=b,d=N):(typeof v.componentDidUpdate!="function"||T===r.memoizedProps&&B===r.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||T===r.memoizedProps&&B===r.memoizedState||(s.flags|=1024),d=!1)}return Vb(r,s,a,d,_,p)}function Vb(r,s,a,d,p,_){s6(r,s);var v=(s.flags&128)!==0;if(!d&&!v)return p&&wB(s,a,!1),ja(r,s,_);d=s.stateNode,roe.current=s;var T=v&&typeof a.getDerivedStateFromError!="function"?null:d.render();return s.flags|=1,r!==null&&v?(s.child=ch(s,r.child,null,_),s.child=ch(s,null,T,_)):Ri(r,s,T,_),s.memoizedState=d.state,p&&wB(s,a,!0),s.child}function o6(r){var s=r.stateNode;s.pendingContext?CB(r,s.pendingContext,s.pendingContext!==s.context):s.context&&CB(r,s.context,!1),$I(r,s.containerInfo)}function BB(r,s,a,d,p){return ah(),KI(p),s.flags|=256,Ri(r,s,a,d),s.child}var jb={dehydrated:null,treeContext:null,retryLane:0};function Fb(r){return{baseLanes:r,cachePool:null,transitions:null}}function a6(r,s,a){var d=s.pendingProps,p=Zn.current,_=!1,v=(s.flags&128)!==0,T;if((T=v)||(T=r!==null&&r.memoizedState===null?!1:(p&2)!==0),T?(_=!0,s.flags&=-129):(r===null||r.memoizedState!==null)&&(p|=1),Mn(Zn,p&1),r===null)return Db(s),r=s.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(s.mode&1?r.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(v=d.children,r=d.fallback,_?(d=s.mode,_=s.child,v={mode:"hidden",children:v},!(d&1)&&_!==null?(_.childLanes=0,_.pendingProps=v):_=yy(v,d,0,null),r=Zl(r,d,a,null),_.return=s,r.return=s,_.sibling=r,s.child=_,s.child.memoizedState=Fb(a),s.memoizedState=jb,r):sA(s,v));if(p=r.memoizedState,p!==null&&(T=p.dehydrated,T!==null))return ioe(r,s,v,d,T,p,a);if(_){_=d.fallback,v=s.mode,p=r.child,T=p.sibling;var b={mode:"hidden",children:d.children};return!(v&1)&&s.child!==p?(d=s.child,d.childLanes=0,d.pendingProps=b,s.deletions=null):(d=Hc(p,b),d.subtreeFlags=p.subtreeFlags&14680064),T!==null?_=Hc(T,_):(_=Zl(_,v,a,null),_.flags|=2),_.return=s,d.return=s,d.sibling=_,s.child=d,d=_,_=s.child,v=r.child.memoizedState,v=v===null?Fb(a):{baseLanes:v.baseLanes|a,cachePool:null,transitions:v.transitions},_.memoizedState=v,_.childLanes=r.childLanes&~a,s.memoizedState=jb,d}return _=r.child,r=_.sibling,d=Hc(_,{mode:"visible",children:d.children}),!(s.mode&1)&&(d.lanes=a),d.return=s,d.sibling=null,r!==null&&(a=s.deletions,a===null?(s.deletions=[r],s.flags|=16):a.push(r)),s.child=d,s.memoizedState=null,d}function sA(r,s){return s=yy({mode:"visible",children:s},r.mode,0,null),s.return=r,r.child=s}function FE(r,s,a,d){return d!==null&&KI(d),ch(s,r.child,null,a),r=sA(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function ioe(r,s,a,d,p,_,v){if(a)return s.flags&256?(s.flags&=-257,d=Dw(Error(De(422))),FE(r,s,v,d)):s.memoizedState!==null?(s.child=r.child,s.flags|=128,null):(_=d.fallback,p=s.mode,d=yy({mode:"visible",children:d.children},p,0,null),_=Zl(_,p,v,null),_.flags|=2,d.return=s,_.return=s,d.sibling=_,s.child=d,s.mode&1&&ch(s,r.child,null,v),s.child.memoizedState=Fb(v),s.memoizedState=jb,_);if(!(s.mode&1))return FE(r,s,v,null);if(p.data==="$!"){if(d=p.nextSibling&&p.nextSibling.dataset,d)var T=d.dgst;return d=T,_=Error(De(419)),d=Dw(_,d,void 0),FE(r,s,v,d)}if(T=(v&r.childLanes)!==0,Ki||T){if(d=Kr,d!==null){switch(v&-v){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=p&(d.suspendedLanes|v)?0:p,p!==0&&p!==_.retryLane&&(_.retryLane=p,Va(r,p),Ao(d,r,p,-1))}return uA(),d=Dw(Error(De(421))),FE(r,s,v,d)}return p.data==="$?"?(s.flags|=128,s.child=r.child,s=goe.bind(null,r),p._reactRetry=s,null):(r=_.treeContext,hs=Fc(p.nextSibling),ps=s,zn=!0,wo=null,r!==null&&(Ks[zs++]=ka,Ks[zs++]=La,Ks[zs++]=rd,ka=r.id,La=r.overflow,rd=s),s=sA(s,d.children),s.flags|=4096,s)}function WB(r,s,a){r.lanes|=s;var d=r.alternate;d!==null&&(d.lanes|=s),kb(r.return,s,a)}function kw(r,s,a,d,p){var _=r.memoizedState;_===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:a,tailMode:p}:(_.isBackwards=s,_.rendering=null,_.renderingStartTime=0,_.last=d,_.tail=a,_.tailMode=p)}function c6(r,s,a){var d=s.pendingProps,p=d.revealOrder,_=d.tail;if(Ri(r,s,d.children,a),d=Zn.current,d&2)d=d&1|2,s.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&WB(r,a,s);else if(r.tag===19)WB(r,a,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}d&=1}if(Mn(Zn,d),!(s.mode&1))s.memoizedState=null;else switch(p){case"forwards":for(a=s.child,p=null;a!==null;)r=a.alternate,r!==null&&Wv(r)===null&&(p=a),a=a.sibling;a=p,a===null?(p=s.child,s.child=null):(p=a.sibling,a.sibling=null),kw(s,!1,p,a,_);break;case"backwards":for(a=null,p=s.child,s.child=null;p!==null;){if(r=p.alternate,r!==null&&Wv(r)===null){s.child=p;break}r=p.sibling,p.sibling=a,a=p,p=r}kw(s,!0,a,null,_);break;case"together":kw(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function nv(r,s){!(s.mode&1)&&r!==null&&(r.alternate=null,s.alternate=null,s.flags|=2)}function ja(r,s,a){if(r!==null&&(s.dependencies=r.dependencies),sd|=s.lanes,!(a&s.childLanes))return null;if(r!==null&&s.child!==r.child)throw Error(De(153));if(s.child!==null){for(r=s.child,a=Hc(r,r.pendingProps),s.child=a,a.return=s;r.sibling!==null;)r=r.sibling,a=a.sibling=Hc(r,r.pendingProps),a.return=s;a.sibling=null}return s.child}function soe(r,s,a){switch(s.tag){case 3:o6(s),ah();break;case 5:L5(s);break;case 1:Yi(s.type)&&xv(s);break;case 4:$I(s,s.stateNode.containerInfo);break;case 10:var d=s.type._context,p=s.memoizedProps.value;Mn(jv,d._currentValue),d._currentValue=p;break;case 13:if(d=s.memoizedState,d!==null)return d.dehydrated!==null?(Mn(Zn,Zn.current&1),s.flags|=128,null):a&s.child.childLanes?a6(r,s,a):(Mn(Zn,Zn.current&1),r=ja(r,s,a),r!==null?r.sibling:null);Mn(Zn,Zn.current&1);break;case 19:if(d=(a&s.childLanes)!==0,r.flags&128){if(d)return c6(r,s,a);s.flags|=128}if(p=s.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Mn(Zn,Zn.current),d)break;return null;case 22:case 23:return s.lanes=0,i6(r,s,a)}return ja(r,s,a)}var l6,Bb,d6,u6;l6=function(r,s){for(var a=s.child;a!==null;){if(a.tag===5||a.tag===6)r.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Bb=function(){};d6=function(r,s,a,d){var p=r.memoizedProps;if(p!==d){r=s.stateNode,Xl(ca.current);var _=null;switch(a){case"input":p=lb(r,p),d=lb(r,d),_=[];break;case"select":p=tr({},p,{value:void 0}),d=tr({},d,{value:void 0}),_=[];break;case"textarea":p=hb(r,p),d=hb(r,d),_=[];break;default:typeof p.onClick!="function"&&typeof d.onClick=="function"&&(r.onclick=Lv)}fb(a,d);var v;a=null;for(N in p)if(!d.hasOwnProperty(N)&&p.hasOwnProperty(N)&&p[N]!=null)if(N==="style"){var T=p[N];for(v in T)T.hasOwnProperty(v)&&(a||(a={}),a[v]="")}else N!=="dangerouslySetInnerHTML"&&N!=="children"&&N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&N!=="autoFocus"&&(Ff.hasOwnProperty(N)?_||(_=[]):(_=_||[]).push(N,null));for(N in d){var b=d[N];if(T=p!=null?p[N]:void 0,d.hasOwnProperty(N)&&b!==T&&(b!=null||T!=null))if(N==="style")if(T){for(v in T)!T.hasOwnProperty(v)||b&&b.hasOwnProperty(v)||(a||(a={}),a[v]="");for(v in b)b.hasOwnProperty(v)&&T[v]!==b[v]&&(a||(a={}),a[v]=b[v])}else a||(_||(_=[]),_.push(N,a)),a=b;else N==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,T=T?T.__html:void 0,b!=null&&T!==b&&(_=_||[]).push(N,b)):N==="children"?typeof b!="string"&&typeof b!="number"||(_=_||[]).push(N,""+b):N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&(Ff.hasOwnProperty(N)?(b!=null&&N==="onScroll"&&Vn("scroll",r),_||T===b||(_=[])):(_=_||[]).push(N,b))}a&&(_=_||[]).push("style",a);var N=_;(s.updateQueue=N)&&(s.flags|=4)}};u6=function(r,s,a,d){a!==d&&(s.flags|=4)};function hf(r,s){if(!zn)switch(r.tailMode){case"hidden":s=r.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?r.tail=null:a.sibling=null;break;case"collapsed":a=r.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function ui(r){var s=r.alternate!==null&&r.alternate.child===r.child,a=0,d=0;if(s)for(var p=r.child;p!==null;)a|=p.lanes|p.childLanes,d|=p.subtreeFlags&14680064,d|=p.flags&14680064,p.return=r,p=p.sibling;else for(p=r.child;p!==null;)a|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=r,p=p.sibling;return r.subtreeFlags|=d,r.childLanes=a,s}function ooe(r,s,a){var d=s.pendingProps;switch(HI(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ui(s),null;case 1:return Yi(s.type)&&Mv(),ui(s),null;case 3:return d=s.stateNode,lh(),jn(zi),jn(mi),ZI(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(VE(s)?s.flags|=4:r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,wo!==null&&(Xb(wo),wo=null))),Bb(r,s),ui(s),null;case 5:QI(s);var p=Xl(Qf.current);if(a=s.type,r!==null&&s.stateNode!=null)d6(r,s,a,d,p),r.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!d){if(s.stateNode===null)throw Error(De(166));return ui(s),null}if(r=Xl(ca.current),VE(s)){d=s.stateNode,a=s.type;var _=s.memoizedProps;switch(d[sa]=s,d[Jf]=_,r=(s.mode&1)!==0,a){case"dialog":Vn("cancel",d),Vn("close",d);break;case"iframe":case"object":case"embed":Vn("load",d);break;case"video":case"audio":for(p=0;p<Rf.length;p++)Vn(Rf[p],d);break;case"source":Vn("error",d);break;case"img":case"image":case"link":Vn("error",d),Vn("load",d);break;case"details":Vn("toggle",d);break;case"input":$F(d,_),Vn("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!_.multiple},Vn("invalid",d);break;case"textarea":ZF(d,_),Vn("invalid",d)}fb(a,_),p=null;for(var v in _)if(_.hasOwnProperty(v)){var T=_[v];v==="children"?typeof T=="string"?d.textContent!==T&&(_.suppressHydrationWarning!==!0&&UE(d.textContent,T,r),p=["children",T]):typeof T=="number"&&d.textContent!==""+T&&(_.suppressHydrationWarning!==!0&&UE(d.textContent,T,r),p=["children",""+T]):Ff.hasOwnProperty(v)&&T!=null&&v==="onScroll"&&Vn("scroll",d)}switch(a){case"input":OE(d),QF(d,_,!0);break;case"textarea":OE(d),eB(d);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(d.onclick=Lv)}d=p,s.updateQueue=d,d!==null&&(s.flags|=4)}else{v=p.nodeType===9?p:p.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=j4(a)),r==="http://www.w3.org/1999/xhtml"?a==="script"?(r=v.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof d.is=="string"?r=v.createElement(a,{is:d.is}):(r=v.createElement(a),a==="select"&&(v=r,d.multiple?v.multiple=!0:d.size&&(v.size=d.size))):r=v.createElementNS(r,a),r[sa]=s,r[Jf]=d,l6(r,s,!1,!1),s.stateNode=r;e:{switch(v=mb(a,d),a){case"dialog":Vn("cancel",r),Vn("close",r),p=d;break;case"iframe":case"object":case"embed":Vn("load",r),p=d;break;case"video":case"audio":for(p=0;p<Rf.length;p++)Vn(Rf[p],r);p=d;break;case"source":Vn("error",r),p=d;break;case"img":case"image":case"link":Vn("error",r),Vn("load",r),p=d;break;case"details":Vn("toggle",r),p=d;break;case"input":$F(r,d),p=lb(r,d),Vn("invalid",r);break;case"option":p=d;break;case"select":r._wrapperState={wasMultiple:!!d.multiple},p=tr({},d,{value:void 0}),Vn("invalid",r);break;case"textarea":ZF(r,d),p=hb(r,d),Vn("invalid",r);break;default:p=d}fb(a,p),T=p;for(_ in T)if(T.hasOwnProperty(_)){var b=T[_];_==="style"?W4(r,b):_==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&F4(r,b)):_==="children"?typeof b=="string"?(a!=="textarea"||b!=="")&&Bf(r,b):typeof b=="number"&&Bf(r,""+b):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(Ff.hasOwnProperty(_)?b!=null&&_==="onScroll"&&Vn("scroll",r):b!=null&&OI(r,_,b,v))}switch(a){case"input":OE(r),QF(r,d,!1);break;case"textarea":OE(r),eB(r);break;case"option":d.value!=null&&r.setAttribute("value",""+Xc(d.value));break;case"select":r.multiple=!!d.multiple,_=d.value,_!=null?Ju(r,!!d.multiple,_,!1):d.defaultValue!=null&&Ju(r,!!d.multiple,d.defaultValue,!0);break;default:typeof p.onClick=="function"&&(r.onclick=Lv)}switch(a){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return ui(s),null;case 6:if(r&&s.stateNode!=null)u6(r,s,r.memoizedProps,d);else{if(typeof d!="string"&&s.stateNode===null)throw Error(De(166));if(a=Xl(Qf.current),Xl(ca.current),VE(s)){if(d=s.stateNode,a=s.memoizedProps,d[sa]=s,(_=d.nodeValue!==a)&&(r=ps,r!==null))switch(r.tag){case 3:UE(d.nodeValue,a,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&UE(d.nodeValue,a,(r.mode&1)!==0)}_&&(s.flags|=4)}else d=(a.nodeType===9?a:a.ownerDocument).createTextNode(d),d[sa]=s,s.stateNode=d}return ui(s),null;case 13:if(jn(Zn),d=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(zn&&hs!==null&&s.mode&1&&!(s.flags&128))O5(),ah(),s.flags|=98560,_=!1;else if(_=VE(s),d!==null&&d.dehydrated!==null){if(r===null){if(!_)throw Error(De(318));if(_=s.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(De(317));_[sa]=s}else ah(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;ui(s),_=!1}else wo!==null&&(Xb(wo),wo=null),_=!0;if(!_)return s.flags&65536?s:null}return s.flags&128?(s.lanes=a,s):(d=d!==null,d!==(r!==null&&r.memoizedState!==null)&&d&&(s.child.flags|=8192,s.mode&1&&(r===null||Zn.current&1?Ur===0&&(Ur=3):uA())),s.updateQueue!==null&&(s.flags|=4),ui(s),null);case 4:return lh(),Bb(r,s),r===null&&qf(s.stateNode.containerInfo),ui(s),null;case 10:return qI(s.type._context),ui(s),null;case 17:return Yi(s.type)&&Mv(),ui(s),null;case 19:if(jn(Zn),_=s.memoizedState,_===null)return ui(s),null;if(d=(s.flags&128)!==0,v=_.rendering,v===null)if(d)hf(_,!1);else{if(Ur!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(v=Wv(r),v!==null){for(s.flags|=128,hf(_,!1),d=v.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),s.subtreeFlags=0,d=a,a=s.child;a!==null;)_=a,r=d,_.flags&=14680066,v=_.alternate,v===null?(_.childLanes=0,_.lanes=r,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=v.childLanes,_.lanes=v.lanes,_.child=v.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=v.memoizedProps,_.memoizedState=v.memoizedState,_.updateQueue=v.updateQueue,_.type=v.type,r=v.dependencies,_.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a=a.sibling;return Mn(Zn,Zn.current&1|2),s.child}r=r.sibling}_.tail!==null&&gr()>uh&&(s.flags|=128,d=!0,hf(_,!1),s.lanes=4194304)}else{if(!d)if(r=Wv(v),r!==null){if(s.flags|=128,d=!0,a=r.updateQueue,a!==null&&(s.updateQueue=a,s.flags|=4),hf(_,!0),_.tail===null&&_.tailMode==="hidden"&&!v.alternate&&!zn)return ui(s),null}else 2*gr()-_.renderingStartTime>uh&&a!==1073741824&&(s.flags|=128,d=!0,hf(_,!1),s.lanes=4194304);_.isBackwards?(v.sibling=s.child,s.child=v):(a=_.last,a!==null?a.sibling=v:s.child=v,_.last=v)}return _.tail!==null?(s=_.tail,_.rendering=s,_.tail=s.sibling,_.renderingStartTime=gr(),s.sibling=null,a=Zn.current,Mn(Zn,d?a&1|2:a&1),s):(ui(s),null);case 22:case 23:return dA(),d=s.memoizedState!==null,r!==null&&r.memoizedState!==null!==d&&(s.flags|=8192),d&&s.mode&1?us&1073741824&&(ui(s),s.subtreeFlags&6&&(s.flags|=8192)):ui(s),null;case 24:return null;case 25:return null}throw Error(De(156,s.tag))}function aoe(r,s){switch(HI(s),s.tag){case 1:return Yi(s.type)&&Mv(),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return lh(),jn(zi),jn(mi),ZI(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 5:return QI(s),null;case 13:if(jn(Zn),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(De(340));ah()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return jn(Zn),null;case 4:return lh(),null;case 10:return qI(s.type._context),null;case 22:case 23:return dA(),null;case 24:return null;default:return null}}var BE=!1,pi=!1,coe=typeof WeakSet=="function"?WeakSet:Set,$e=null;function qu(r,s){var a=r.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(d){cr(r,s,d)}else a.current=null}function Wb(r,s,a){try{a()}catch(d){cr(r,s,d)}}var GB=!1;function loe(r,s){if(wb=Pv,r=_5(),WI(r)){if("selectionStart"in r)var a={start:r.selectionStart,end:r.selectionEnd};else e:{a=(a=r.ownerDocument)&&a.defaultView||window;var d=a.getSelection&&a.getSelection();if(d&&d.rangeCount!==0){a=d.anchorNode;var p=d.anchorOffset,_=d.focusNode;d=d.focusOffset;try{a.nodeType,_.nodeType}catch{a=null;break e}var v=0,T=-1,b=-1,N=0,L=0,U=r,B=null;t:for(;;){for(var Y;U!==a||p!==0&&U.nodeType!==3||(T=v+p),U!==_||d!==0&&U.nodeType!==3||(b=v+d),U.nodeType===3&&(v+=U.nodeValue.length),(Y=U.firstChild)!==null;)B=U,U=Y;for(;;){if(U===r)break t;if(B===a&&++N===p&&(T=v),B===_&&++L===d&&(b=v),(Y=U.nextSibling)!==null)break;U=B,B=U.parentNode}U=Y}a=T===-1||b===-1?null:{start:T,end:b}}else a=null}a=a||{start:0,end:0}}else a=null;for(bb={focusedElem:r,selectionRange:a},Pv=!1,$e=s;$e!==null;)if(s=$e,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,$e=r;else for(;$e!==null;){s=$e;try{var F=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(F!==null){var X=F.memoizedProps,te=F.memoizedState,q=s.stateNode,z=q.getSnapshotBeforeUpdate(s.elementType===s.type?X:To(s.type,X),te);q.__reactInternalSnapshotBeforeUpdate=z}break;case 3:var W=s.stateNode.containerInfo;W.nodeType===1?W.textContent="":W.nodeType===9&&W.documentElement&&W.removeChild(W.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(De(163))}}catch(Z){cr(s,s.return,Z)}if(r=s.sibling,r!==null){r.return=s.return,$e=r;break}$e=s.return}return F=GB,GB=!1,F}function kf(r,s,a){var d=s.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var p=d=d.next;do{if((p.tag&r)===r){var _=p.destroy;p.destroy=void 0,_!==void 0&&Wb(s,a,_)}p=p.next}while(p!==d)}}function Ey(r,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var a=s=s.next;do{if((a.tag&r)===r){var d=a.create;a.destroy=d()}a=a.next}while(a!==s)}}function Gb(r){var s=r.ref;if(s!==null){var a=r.stateNode;switch(r.tag){case 5:r=a;break;default:r=a}typeof s=="function"?s(r):s.current=r}}function h6(r){var s=r.alternate;s!==null&&(r.alternate=null,h6(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&(delete s[sa],delete s[Jf],delete s[Ob],delete s[Kse],delete s[zse])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function p6(r){return r.tag===5||r.tag===3||r.tag===4}function HB(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||p6(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Hb(r,s,a){var d=r.tag;if(d===5||d===6)r=r.stateNode,s?a.nodeType===8?a.parentNode.insertBefore(r,s):a.insertBefore(r,s):(a.nodeType===8?(s=a.parentNode,s.insertBefore(r,a)):(s=a,s.appendChild(r)),a=a._reactRootContainer,a!=null||s.onclick!==null||(s.onclick=Lv));else if(d!==4&&(r=r.child,r!==null))for(Hb(r,s,a),r=r.sibling;r!==null;)Hb(r,s,a),r=r.sibling}function Kb(r,s,a){var d=r.tag;if(d===5||d===6)r=r.stateNode,s?a.insertBefore(r,s):a.appendChild(r);else if(d!==4&&(r=r.child,r!==null))for(Kb(r,s,a),r=r.sibling;r!==null;)Kb(r,s,a),r=r.sibling}var Qr=null,Ro=!1;function bc(r,s,a){for(a=a.child;a!==null;)f6(r,s,a),a=a.sibling}function f6(r,s,a){if(aa&&typeof aa.onCommitFiberUnmount=="function")try{aa.onCommitFiberUnmount(dy,a)}catch{}switch(a.tag){case 5:pi||qu(a,s);case 6:var d=Qr,p=Ro;Qr=null,bc(r,s,a),Qr=d,Ro=p,Qr!==null&&(Ro?(r=Qr,a=a.stateNode,r.nodeType===8?r.parentNode.removeChild(a):r.removeChild(a)):Qr.removeChild(a.stateNode));break;case 18:Qr!==null&&(Ro?(r=Qr,a=a.stateNode,r.nodeType===8?bw(r.parentNode,a):r.nodeType===1&&bw(r,a),Kf(r)):bw(Qr,a.stateNode));break;case 4:d=Qr,p=Ro,Qr=a.stateNode.containerInfo,Ro=!0,bc(r,s,a),Qr=d,Ro=p;break;case 0:case 11:case 14:case 15:if(!pi&&(d=a.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){p=d=d.next;do{var _=p,v=_.destroy;_=_.tag,v!==void 0&&(_&2||_&4)&&Wb(a,s,v),p=p.next}while(p!==d)}bc(r,s,a);break;case 1:if(!pi&&(qu(a,s),d=a.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=a.memoizedProps,d.state=a.memoizedState,d.componentWillUnmount()}catch(T){cr(a,s,T)}bc(r,s,a);break;case 21:bc(r,s,a);break;case 22:a.mode&1?(pi=(d=pi)||a.memoizedState!==null,bc(r,s,a),pi=d):bc(r,s,a);break;default:bc(r,s,a)}}function KB(r){var s=r.updateQueue;if(s!==null){r.updateQueue=null;var a=r.stateNode;a===null&&(a=r.stateNode=new coe),s.forEach(function(d){var p=Eoe.bind(null,r,d);a.has(d)||(a.add(d),d.then(p,p))})}}function So(r,s){var a=s.deletions;if(a!==null)for(var d=0;d<a.length;d++){var p=a[d];try{var _=r,v=s,T=v;e:for(;T!==null;){switch(T.tag){case 5:Qr=T.stateNode,Ro=!1;break e;case 3:Qr=T.stateNode.containerInfo,Ro=!0;break e;case 4:Qr=T.stateNode.containerInfo,Ro=!0;break e}T=T.return}if(Qr===null)throw Error(De(160));f6(_,v,p),Qr=null,Ro=!1;var b=p.alternate;b!==null&&(b.return=null),p.return=null}catch(N){cr(p,s,N)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)m6(s,r),s=s.sibling}function m6(r,s){var a=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(So(s,r),ea(r),d&4){try{kf(3,r,r.return),Ey(3,r)}catch(X){cr(r,r.return,X)}try{kf(5,r,r.return)}catch(X){cr(r,r.return,X)}}break;case 1:So(s,r),ea(r),d&512&&a!==null&&qu(a,a.return);break;case 5:if(So(s,r),ea(r),d&512&&a!==null&&qu(a,a.return),r.flags&32){var p=r.stateNode;try{Bf(p,"")}catch(X){cr(r,r.return,X)}}if(d&4&&(p=r.stateNode,p!=null)){var _=r.memoizedProps,v=a!==null?a.memoizedProps:_,T=r.type,b=r.updateQueue;if(r.updateQueue=null,b!==null)try{T==="input"&&_.type==="radio"&&_.name!=null&&U4(p,_),mb(T,v);var N=mb(T,_);for(v=0;v<b.length;v+=2){var L=b[v],U=b[v+1];L==="style"?W4(p,U):L==="dangerouslySetInnerHTML"?F4(p,U):L==="children"?Bf(p,U):OI(p,L,U,N)}switch(T){case"input":db(p,_);break;case"textarea":V4(p,_);break;case"select":var B=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!_.multiple;var Y=_.value;Y!=null?Ju(p,!!_.multiple,Y,!1):B!==!!_.multiple&&(_.defaultValue!=null?Ju(p,!!_.multiple,_.defaultValue,!0):Ju(p,!!_.multiple,_.multiple?[]:"",!1))}p[Jf]=_}catch(X){cr(r,r.return,X)}}break;case 6:if(So(s,r),ea(r),d&4){if(r.stateNode===null)throw Error(De(162));p=r.stateNode,_=r.memoizedProps;try{p.nodeValue=_}catch(X){cr(r,r.return,X)}}break;case 3:if(So(s,r),ea(r),d&4&&a!==null&&a.memoizedState.isDehydrated)try{Kf(s.containerInfo)}catch(X){cr(r,r.return,X)}break;case 4:So(s,r),ea(r);break;case 13:So(s,r),ea(r),p=r.child,p.flags&8192&&(_=p.memoizedState!==null,p.stateNode.isHidden=_,!_||p.alternate!==null&&p.alternate.memoizedState!==null||(cA=gr())),d&4&&KB(r);break;case 22:if(L=a!==null&&a.memoizedState!==null,r.mode&1?(pi=(N=pi)||L,So(s,r),pi=N):So(s,r),ea(r),d&8192){if(N=r.memoizedState!==null,(r.stateNode.isHidden=N)&&!L&&r.mode&1)for($e=r,L=r.child;L!==null;){for(U=$e=L;$e!==null;){switch(B=$e,Y=B.child,B.tag){case 0:case 11:case 14:case 15:kf(4,B,B.return);break;case 1:qu(B,B.return);var F=B.stateNode;if(typeof F.componentWillUnmount=="function"){d=B,a=B.return;try{s=d,F.props=s.memoizedProps,F.state=s.memoizedState,F.componentWillUnmount()}catch(X){cr(d,a,X)}}break;case 5:qu(B,B.return);break;case 22:if(B.memoizedState!==null){YB(U);continue}}Y!==null?(Y.return=B,$e=Y):YB(U)}L=L.sibling}e:for(L=null,U=r;;){if(U.tag===5){if(L===null){L=U;try{p=U.stateNode,N?(_=p.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(T=U.stateNode,b=U.memoizedProps.style,v=b!=null&&b.hasOwnProperty("display")?b.display:null,T.style.display=B4("display",v))}catch(X){cr(r,r.return,X)}}}else if(U.tag===6){if(L===null)try{U.stateNode.nodeValue=N?"":U.memoizedProps}catch(X){cr(r,r.return,X)}}else if((U.tag!==22&&U.tag!==23||U.memoizedState===null||U===r)&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===r)break e;for(;U.sibling===null;){if(U.return===null||U.return===r)break e;L===U&&(L=null),U=U.return}L===U&&(L=null),U.sibling.return=U.return,U=U.sibling}}break;case 19:So(s,r),ea(r),d&4&&KB(r);break;case 21:break;default:So(s,r),ea(r)}}function ea(r){var s=r.flags;if(s&2){try{e:{for(var a=r.return;a!==null;){if(p6(a)){var d=a;break e}a=a.return}throw Error(De(160))}switch(d.tag){case 5:var p=d.stateNode;d.flags&32&&(Bf(p,""),d.flags&=-33);var _=HB(r);Kb(r,_,p);break;case 3:case 4:var v=d.stateNode.containerInfo,T=HB(r);Hb(r,T,v);break;default:throw Error(De(161))}}catch(b){cr(r,r.return,b)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function doe(r,s,a){$e=r,_6(r)}function _6(r,s,a){for(var d=(r.mode&1)!==0;$e!==null;){var p=$e,_=p.child;if(p.tag===22&&d){var v=p.memoizedState!==null||BE;if(!v){var T=p.alternate,b=T!==null&&T.memoizedState!==null||pi;T=BE;var N=pi;if(BE=v,(pi=b)&&!N)for($e=p;$e!==null;)v=$e,b=v.child,v.tag===22&&v.memoizedState!==null?qB(p):b!==null?(b.return=v,$e=b):qB(p);for(;_!==null;)$e=_,_6(_),_=_.sibling;$e=p,BE=T,pi=N}zB(r)}else p.subtreeFlags&8772&&_!==null?(_.return=p,$e=_):zB(r)}}function zB(r){for(;$e!==null;){var s=$e;if(s.flags&8772){var a=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:pi||Ey(5,s);break;case 1:var d=s.stateNode;if(s.flags&4&&!pi)if(a===null)d.componentDidMount();else{var p=s.elementType===s.type?a.memoizedProps:To(s.type,a.memoizedProps);d.componentDidUpdate(p,a.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var _=s.updateQueue;_!==null&&NB(s,_,d);break;case 3:var v=s.updateQueue;if(v!==null){if(a=null,s.child!==null)switch(s.child.tag){case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}NB(s,v,a)}break;case 5:var T=s.stateNode;if(a===null&&s.flags&4){a=T;var b=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&a.focus();break;case"img":b.src&&(a.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var N=s.alternate;if(N!==null){var L=N.memoizedState;if(L!==null){var U=L.dehydrated;U!==null&&Kf(U)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(De(163))}pi||s.flags&512&&Gb(s)}catch(B){cr(s,s.return,B)}}if(s===r){$e=null;break}if(a=s.sibling,a!==null){a.return=s.return,$e=a;break}$e=s.return}}function YB(r){for(;$e!==null;){var s=$e;if(s===r){$e=null;break}var a=s.sibling;if(a!==null){a.return=s.return,$e=a;break}$e=s.return}}function qB(r){for(;$e!==null;){var s=$e;try{switch(s.tag){case 0:case 11:case 15:var a=s.return;try{Ey(4,s)}catch(b){cr(s,a,b)}break;case 1:var d=s.stateNode;if(typeof d.componentDidMount=="function"){var p=s.return;try{d.componentDidMount()}catch(b){cr(s,p,b)}}var _=s.return;try{Gb(s)}catch(b){cr(s,_,b)}break;case 5:var v=s.return;try{Gb(s)}catch(b){cr(s,v,b)}}}catch(b){cr(s,s.return,b)}if(s===r){$e=null;break}var T=s.sibling;if(T!==null){T.return=s.return,$e=T;break}$e=s.return}}var uoe=Math.ceil,Kv=Ga.ReactCurrentDispatcher,oA=Ga.ReactCurrentOwner,Xs=Ga.ReactCurrentBatchConfig,cn=0,Kr=null,wr=null,ei=0,us=0,Xu=el(0),Ur=0,nm=null,sd=0,vy=0,aA=0,Lf=null,Hi=null,cA=0,uh=1/0,Na=null,zv=!1,zb=null,Wc=null,WE=!1,Mc=null,Yv=0,Mf=0,Yb=null,rv=-1,iv=0;function Ci(){return cn&6?gr():rv!==-1?rv:rv=gr()}function Gc(r){return r.mode&1?cn&2&&ei!==0?ei&-ei:qse.transition!==null?(iv===0&&(iv=e5()),iv):(r=Sn,r!==0||(r=window.event,r=r===void 0?16:a5(r.type)),r):1}function Ao(r,s,a,d){if(50<Mf)throw Mf=0,Yb=null,Error(De(185));cm(r,a,d),(!(cn&2)||r!==Kr)&&(r===Kr&&(!(cn&2)&&(vy|=a),Ur===4&&Pc(r,ei)),qi(r,d),a===1&&cn===0&&!(s.mode&1)&&(uh=gr()+500,my&&tl()))}function qi(r,s){var a=r.callbackNode;qie(r,s);var d=Nv(r,r===Kr?ei:0);if(d===0)a!==null&&rB(a),r.callbackNode=null,r.callbackPriority=0;else if(s=d&-d,r.callbackPriority!==s){if(a!=null&&rB(a),s===1)r.tag===0?Yse(XB.bind(null,r)):b5(XB.bind(null,r)),Gse(function(){!(cn&6)&&tl()}),a=null;else{switch(t5(d)){case 1:a=LI;break;case 4:a=Q4;break;case 16:a=Ov;break;case 536870912:a=Z4;break;default:a=Ov}a=C6(a,g6.bind(null,r))}r.callbackPriority=s,r.callbackNode=a}}function g6(r,s){if(rv=-1,iv=0,cn&6)throw Error(De(327));var a=r.callbackNode;if(th()&&r.callbackNode!==a)return null;var d=Nv(r,r===Kr?ei:0);if(d===0)return null;if(d&30||d&r.expiredLanes||s)s=qv(r,d);else{s=d;var p=cn;cn|=2;var _=v6();(Kr!==r||ei!==s)&&(Na=null,uh=gr()+500,Ql(r,s));do try{foe();break}catch(T){E6(r,T)}while(!0);YI(),Kv.current=_,cn=p,wr!==null?s=0:(Kr=null,ei=0,s=Ur)}if(s!==0){if(s===2&&(p=yb(r),p!==0&&(d=p,s=qb(r,p))),s===1)throw a=nm,Ql(r,0),Pc(r,d),qi(r,gr()),a;if(s===6)Pc(r,d);else{if(p=r.current.alternate,!(d&30)&&!hoe(p)&&(s=qv(r,d),s===2&&(_=yb(r),_!==0&&(d=_,s=qb(r,_))),s===1))throw a=nm,Ql(r,0),Pc(r,d),qi(r,gr()),a;switch(r.finishedWork=p,r.finishedLanes=d,s){case 0:case 1:throw Error(De(345));case 2:Gl(r,Hi,Na);break;case 3:if(Pc(r,d),(d&130023424)===d&&(s=cA+500-gr(),10<s)){if(Nv(r,0)!==0)break;if(p=r.suspendedLanes,(p&d)!==d){Ci(),r.pingedLanes|=r.suspendedLanes&p;break}r.timeoutHandle=Ab(Gl.bind(null,r,Hi,Na),s);break}Gl(r,Hi,Na);break;case 4:if(Pc(r,d),(d&4194240)===d)break;for(s=r.eventTimes,p=-1;0<d;){var v=31-Io(d);_=1<<v,v=s[v],v>p&&(p=v),d&=~_}if(d=p,d=gr()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*uoe(d/1960))-d,10<d){r.timeoutHandle=Ab(Gl.bind(null,r,Hi,Na),d);break}Gl(r,Hi,Na);break;case 5:Gl(r,Hi,Na);break;default:throw Error(De(329))}}}return qi(r,gr()),r.callbackNode===a?g6.bind(null,r):null}function qb(r,s){var a=Lf;return r.current.memoizedState.isDehydrated&&(Ql(r,s).flags|=256),r=qv(r,s),r!==2&&(s=Hi,Hi=a,s!==null&&Xb(s)),r}function Xb(r){Hi===null?Hi=r:Hi.push.apply(Hi,r)}function hoe(r){for(var s=r;;){if(s.flags&16384){var a=s.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var d=0;d<a.length;d++){var p=a[d],_=p.getSnapshot;p=p.value;try{if(!Oo(_(),p))return!1}catch{return!1}}}if(a=s.child,s.subtreeFlags&16384&&a!==null)a.return=s,s=a;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Pc(r,s){for(s&=~aA,s&=~vy,r.suspendedLanes|=s,r.pingedLanes&=~s,r=r.expirationTimes;0<s;){var a=31-Io(s),d=1<<a;r[a]=-1,s&=~d}}function XB(r){if(cn&6)throw Error(De(327));th();var s=Nv(r,0);if(!(s&1))return qi(r,gr()),null;var a=qv(r,s);if(r.tag!==0&&a===2){var d=yb(r);d!==0&&(s=d,a=qb(r,d))}if(a===1)throw a=nm,Ql(r,0),Pc(r,s),qi(r,gr()),a;if(a===6)throw Error(De(345));return r.finishedWork=r.current.alternate,r.finishedLanes=s,Gl(r,Hi,Na),qi(r,gr()),null}function lA(r,s){var a=cn;cn|=1;try{return r(s)}finally{cn=a,cn===0&&(uh=gr()+500,my&&tl())}}function od(r){Mc!==null&&Mc.tag===0&&!(cn&6)&&th();var s=cn;cn|=1;var a=Xs.transition,d=Sn;try{if(Xs.transition=null,Sn=1,r)return r()}finally{Sn=d,Xs.transition=a,cn=s,!(cn&6)&&tl()}}function dA(){us=Xu.current,jn(Xu)}function Ql(r,s){r.finishedWork=null,r.finishedLanes=0;var a=r.timeoutHandle;if(a!==-1&&(r.timeoutHandle=-1,Wse(a)),wr!==null)for(a=wr.return;a!==null;){var d=a;switch(HI(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&Mv();break;case 3:lh(),jn(zi),jn(mi),ZI();break;case 5:QI(d);break;case 4:lh();break;case 13:jn(Zn);break;case 19:jn(Zn);break;case 10:qI(d.type._context);break;case 22:case 23:dA()}a=a.return}if(Kr=r,wr=r=Hc(r.current,null),ei=us=s,Ur=0,nm=null,aA=vy=sd=0,Hi=Lf=null,ql!==null){for(s=0;s<ql.length;s++)if(a=ql[s],d=a.interleaved,d!==null){a.interleaved=null;var p=d.next,_=a.pending;if(_!==null){var v=_.next;_.next=p,d.next=v}a.pending=d}ql=null}return r}function E6(r,s){do{var a=wr;try{if(YI(),ev.current=Hv,Gv){for(var d=er.memoizedState;d!==null;){var p=d.queue;p!==null&&(p.pending=null),d=d.next}Gv=!1}if(id=0,Hr=Lr=er=null,Df=!1,Zf=0,oA.current=null,a===null||a.return===null){Ur=1,nm=s,wr=null;break}e:{var _=r,v=a.return,T=a,b=s;if(s=ei,T.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var N=b,L=T,U=L.tag;if(!(L.mode&1)&&(U===0||U===11||U===15)){var B=L.alternate;B?(L.updateQueue=B.updateQueue,L.memoizedState=B.memoizedState,L.lanes=B.lanes):(L.updateQueue=null,L.memoizedState=null)}var Y=xB(v);if(Y!==null){Y.flags&=-257,UB(Y,v,T,_,s),Y.mode&1&&MB(_,N,s),s=Y,b=N;var F=s.updateQueue;if(F===null){var X=new Set;X.add(b),s.updateQueue=X}else F.add(b);break e}else{if(!(s&1)){MB(_,N,s),uA();break e}b=Error(De(426))}}else if(zn&&T.mode&1){var te=xB(v);if(te!==null){!(te.flags&65536)&&(te.flags|=256),UB(te,v,T,_,s),KI(dh(b,T));break e}}_=b=dh(b,T),Ur!==4&&(Ur=2),Lf===null?Lf=[_]:Lf.push(_),_=v;do{switch(_.tag){case 3:_.flags|=65536,s&=-s,_.lanes|=s;var q=t6(_,b,s);OB(_,q);break e;case 1:T=b;var z=_.type,W=_.stateNode;if(!(_.flags&128)&&(typeof z.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Wc===null||!Wc.has(W)))){_.flags|=65536,s&=-s,_.lanes|=s;var Z=n6(_,T,s);OB(_,Z);break e}}_=_.return}while(_!==null)}S6(a)}catch(Ee){s=Ee,wr===a&&a!==null&&(wr=a=a.return);continue}break}while(!0)}function v6(){var r=Kv.current;return Kv.current=Hv,r===null?Hv:r}function uA(){(Ur===0||Ur===3||Ur===2)&&(Ur=4),Kr===null||!(sd&268435455)&&!(vy&268435455)||Pc(Kr,ei)}function qv(r,s){var a=cn;cn|=2;var d=v6();(Kr!==r||ei!==s)&&(Na=null,Ql(r,s));do try{poe();break}catch(p){E6(r,p)}while(!0);if(YI(),cn=a,Kv.current=d,wr!==null)throw Error(De(261));return Kr=null,ei=0,Ur}function poe(){for(;wr!==null;)y6(wr)}function foe(){for(;wr!==null&&!jie();)y6(wr)}function y6(r){var s=R6(r.alternate,r,us);r.memoizedProps=r.pendingProps,s===null?S6(r):wr=s,oA.current=null}function S6(r){var s=r;do{var a=s.alternate;if(r=s.return,s.flags&32768){if(a=aoe(a,s),a!==null){a.flags&=32767,wr=a;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Ur=6,wr=null;return}}else if(a=ooe(a,s,us),a!==null){wr=a;return}if(s=s.sibling,s!==null){wr=s;return}wr=s=r}while(s!==null);Ur===0&&(Ur=5)}function Gl(r,s,a){var d=Sn,p=Xs.transition;try{Xs.transition=null,Sn=1,moe(r,s,a,d)}finally{Xs.transition=p,Sn=d}return null}function moe(r,s,a,d){do th();while(Mc!==null);if(cn&6)throw Error(De(327));a=r.finishedWork;var p=r.finishedLanes;if(a===null)return null;if(r.finishedWork=null,r.finishedLanes=0,a===r.current)throw Error(De(177));r.callbackNode=null,r.callbackPriority=0;var _=a.lanes|a.childLanes;if(Xie(r,_),r===Kr&&(wr=Kr=null,ei=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||WE||(WE=!0,C6(Ov,function(){return th(),null})),_=(a.flags&15990)!==0,a.subtreeFlags&15990||_){_=Xs.transition,Xs.transition=null;var v=Sn;Sn=1;var T=cn;cn|=4,oA.current=null,loe(r,a),m6(a,r),Mse(bb),Pv=!!wb,bb=wb=null,r.current=a,doe(a),Fie(),cn=T,Sn=v,Xs.transition=_}else r.current=a;if(WE&&(WE=!1,Mc=r,Yv=p),_=r.pendingLanes,_===0&&(Wc=null),Gie(a.stateNode),qi(r,gr()),s!==null)for(d=r.onRecoverableError,a=0;a<s.length;a++)p=s[a],d(p.value,{componentStack:p.stack,digest:p.digest});if(zv)throw zv=!1,r=zb,zb=null,r;return Yv&1&&r.tag!==0&&th(),_=r.pendingLanes,_&1?r===Yb?Mf++:(Mf=0,Yb=r):Mf=0,tl(),null}function th(){if(Mc!==null){var r=t5(Yv),s=Xs.transition,a=Sn;try{if(Xs.transition=null,Sn=16>r?16:r,Mc===null)var d=!1;else{if(r=Mc,Mc=null,Yv=0,cn&6)throw Error(De(331));var p=cn;for(cn|=4,$e=r.current;$e!==null;){var _=$e,v=_.child;if($e.flags&16){var T=_.deletions;if(T!==null){for(var b=0;b<T.length;b++){var N=T[b];for($e=N;$e!==null;){var L=$e;switch(L.tag){case 0:case 11:case 15:kf(8,L,_)}var U=L.child;if(U!==null)U.return=L,$e=U;else for(;$e!==null;){L=$e;var B=L.sibling,Y=L.return;if(h6(L),L===N){$e=null;break}if(B!==null){B.return=Y,$e=B;break}$e=Y}}}var F=_.alternate;if(F!==null){var X=F.child;if(X!==null){F.child=null;do{var te=X.sibling;X.sibling=null,X=te}while(X!==null)}}$e=_}}if(_.subtreeFlags&2064&&v!==null)v.return=_,$e=v;else e:for(;$e!==null;){if(_=$e,_.flags&2048)switch(_.tag){case 0:case 11:case 15:kf(9,_,_.return)}var q=_.sibling;if(q!==null){q.return=_.return,$e=q;break e}$e=_.return}}var z=r.current;for($e=z;$e!==null;){v=$e;var W=v.child;if(v.subtreeFlags&2064&&W!==null)W.return=v,$e=W;else e:for(v=z;$e!==null;){if(T=$e,T.flags&2048)try{switch(T.tag){case 0:case 11:case 15:Ey(9,T)}}catch(Ee){cr(T,T.return,Ee)}if(T===v){$e=null;break e}var Z=T.sibling;if(Z!==null){Z.return=T.return,$e=Z;break e}$e=T.return}}if(cn=p,tl(),aa&&typeof aa.onPostCommitFiberRoot=="function")try{aa.onPostCommitFiberRoot(dy,r)}catch{}d=!0}return d}finally{Sn=a,Xs.transition=s}}return!1}function JB(r,s,a){s=dh(a,s),s=t6(r,s,1),r=Bc(r,s,1),s=Ci(),r!==null&&(cm(r,1,s),qi(r,s))}function cr(r,s,a){if(r.tag===3)JB(r,r,a);else for(;s!==null;){if(s.tag===3){JB(s,r,a);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Wc===null||!Wc.has(d))){r=dh(a,r),r=n6(s,r,1),s=Bc(s,r,1),r=Ci(),s!==null&&(cm(s,1,r),qi(s,r));break}}s=s.return}}function _oe(r,s,a){var d=r.pingCache;d!==null&&d.delete(s),s=Ci(),r.pingedLanes|=r.suspendedLanes&a,Kr===r&&(ei&a)===a&&(Ur===4||Ur===3&&(ei&130023424)===ei&&500>gr()-cA?Ql(r,0):aA|=a),qi(r,s)}function T6(r,s){s===0&&(r.mode&1?(s=DE,DE<<=1,!(DE&130023424)&&(DE=4194304)):s=1);var a=Ci();r=Va(r,s),r!==null&&(cm(r,s,a),qi(r,a))}function goe(r){var s=r.memoizedState,a=0;s!==null&&(a=s.retryLane),T6(r,a)}function Eoe(r,s){var a=0;switch(r.tag){case 13:var d=r.stateNode,p=r.memoizedState;p!==null&&(a=p.retryLane);break;case 19:d=r.stateNode;break;default:throw Error(De(314))}d!==null&&d.delete(s),T6(r,a)}var R6;R6=function(r,s,a){if(r!==null)if(r.memoizedProps!==s.pendingProps||zi.current)Ki=!0;else{if(!(r.lanes&a)&&!(s.flags&128))return Ki=!1,soe(r,s,a);Ki=!!(r.flags&131072)}else Ki=!1,zn&&s.flags&1048576&&I5(s,Vv,s.index);switch(s.lanes=0,s.tag){case 2:var d=s.type;nv(r,s),r=s.pendingProps;var p=oh(s,mi.current);eh(s,a),p=tA(null,s,d,r,p,a);var _=nA();return s.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Yi(d)?(_=!0,xv(s)):_=!1,s.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,JI(s),p.updater=gy,s.stateNode=p,p._reactInternals=s,Mb(s,d,r,a),s=Vb(null,s,d,!0,_,a)):(s.tag=0,zn&&_&&GI(s),Ri(null,s,p,a),s=s.child),s;case 16:d=s.elementType;e:{switch(nv(r,s),r=s.pendingProps,p=d._init,d=p(d._payload),s.type=d,p=s.tag=yoe(d),r=To(d,r),p){case 0:s=Ub(null,s,d,r,a);break e;case 1:s=FB(null,s,d,r,a);break e;case 11:s=VB(null,s,d,r,a);break e;case 14:s=jB(null,s,d,To(d.type,r),a);break e}throw Error(De(306,d,""))}return s;case 0:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:To(d,p),Ub(r,s,d,p,a);case 1:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:To(d,p),FB(r,s,d,p,a);case 3:e:{if(o6(s),r===null)throw Error(De(387));d=s.pendingProps,_=s.memoizedState,p=_.element,k5(r,s),Bv(s,d,null,a);var v=s.memoizedState;if(d=v.element,_.isDehydrated)if(_={element:d,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},s.updateQueue.baseState=_,s.memoizedState=_,s.flags&256){p=dh(Error(De(423)),s),s=BB(r,s,d,a,p);break e}else if(d!==p){p=dh(Error(De(424)),s),s=BB(r,s,d,a,p);break e}else for(hs=Fc(s.stateNode.containerInfo.firstChild),ps=s,zn=!0,wo=null,a=P5(s,null,d,a),s.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(ah(),d===p){s=ja(r,s,a);break e}Ri(r,s,d,a)}s=s.child}return s;case 5:return L5(s),r===null&&Db(s),d=s.type,p=s.pendingProps,_=r!==null?r.memoizedProps:null,v=p.children,Ib(d,p)?v=null:_!==null&&Ib(d,_)&&(s.flags|=32),s6(r,s),Ri(r,s,v,a),s.child;case 6:return r===null&&Db(s),null;case 13:return a6(r,s,a);case 4:return $I(s,s.stateNode.containerInfo),d=s.pendingProps,r===null?s.child=ch(s,null,d,a):Ri(r,s,d,a),s.child;case 11:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:To(d,p),VB(r,s,d,p,a);case 7:return Ri(r,s,s.pendingProps,a),s.child;case 8:return Ri(r,s,s.pendingProps.children,a),s.child;case 12:return Ri(r,s,s.pendingProps.children,a),s.child;case 10:e:{if(d=s.type._context,p=s.pendingProps,_=s.memoizedProps,v=p.value,Mn(jv,d._currentValue),d._currentValue=v,_!==null)if(Oo(_.value,v)){if(_.children===p.children&&!zi.current){s=ja(r,s,a);break e}}else for(_=s.child,_!==null&&(_.return=s);_!==null;){var T=_.dependencies;if(T!==null){v=_.child;for(var b=T.firstContext;b!==null;){if(b.context===d){if(_.tag===1){b=Ma(-1,a&-a),b.tag=2;var N=_.updateQueue;if(N!==null){N=N.shared;var L=N.pending;L===null?b.next=b:(b.next=L.next,L.next=b),N.pending=b}}_.lanes|=a,b=_.alternate,b!==null&&(b.lanes|=a),kb(_.return,a,s),T.lanes|=a;break}b=b.next}}else if(_.tag===10)v=_.type===s.type?null:_.child;else if(_.tag===18){if(v=_.return,v===null)throw Error(De(341));v.lanes|=a,T=v.alternate,T!==null&&(T.lanes|=a),kb(v,a,s),v=_.sibling}else v=_.child;if(v!==null)v.return=_;else for(v=_;v!==null;){if(v===s){v=null;break}if(_=v.sibling,_!==null){_.return=v.return,v=_;break}v=v.return}_=v}Ri(r,s,p.children,a),s=s.child}return s;case 9:return p=s.type,d=s.pendingProps.children,eh(s,a),p=Js(p),d=d(p),s.flags|=1,Ri(r,s,d,a),s.child;case 14:return d=s.type,p=To(d,s.pendingProps),p=To(d.type,p),jB(r,s,d,p,a);case 15:return r6(r,s,s.type,s.pendingProps,a);case 17:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:To(d,p),nv(r,s),s.tag=1,Yi(d)?(r=!0,xv(s)):r=!1,eh(s,a),e6(s,d,p),Mb(s,d,p,a),Vb(null,s,d,!0,r,a);case 19:return c6(r,s,a);case 22:return i6(r,s,a)}throw Error(De(156,s.tag))};function C6(r,s){return $4(r,s)}function voe(r,s,a,d){this.tag=r,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qs(r,s,a,d){return new voe(r,s,a,d)}function hA(r){return r=r.prototype,!(!r||!r.isReactComponent)}function yoe(r){if(typeof r=="function")return hA(r)?1:0;if(r!=null){if(r=r.$$typeof,r===PI)return 11;if(r===DI)return 14}return 2}function Hc(r,s){var a=r.alternate;return a===null?(a=qs(r.tag,s,r.key,r.mode),a.elementType=r.elementType,a.type=r.type,a.stateNode=r.stateNode,a.alternate=r,r.alternate=a):(a.pendingProps=s,a.type=r.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=r.flags&14680064,a.childLanes=r.childLanes,a.lanes=r.lanes,a.child=r.child,a.memoizedProps=r.memoizedProps,a.memoizedState=r.memoizedState,a.updateQueue=r.updateQueue,s=r.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},a.sibling=r.sibling,a.index=r.index,a.ref=r.ref,a}function sv(r,s,a,d,p,_){var v=2;if(d=r,typeof r=="function")hA(r)&&(v=1);else if(typeof r=="string")v=5;else e:switch(r){case ju:return Zl(a.children,p,_,s);case NI:v=8,p|=8;break;case sb:return r=qs(12,a,s,p|2),r.elementType=sb,r.lanes=_,r;case ob:return r=qs(13,a,s,p),r.elementType=ob,r.lanes=_,r;case ab:return r=qs(19,a,s,p),r.elementType=ab,r.lanes=_,r;case L4:return yy(a,p,_,s);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case D4:v=10;break e;case k4:v=9;break e;case PI:v=11;break e;case DI:v=14;break e;case Ac:v=16,d=null;break e}throw Error(De(130,r==null?r:typeof r,""))}return s=qs(v,a,s,p),s.elementType=r,s.type=d,s.lanes=_,s}function Zl(r,s,a,d){return r=qs(7,r,d,s),r.lanes=a,r}function yy(r,s,a,d){return r=qs(22,r,d,s),r.elementType=L4,r.lanes=a,r.stateNode={isHidden:!1},r}function Lw(r,s,a){return r=qs(6,r,null,s),r.lanes=a,r}function Mw(r,s,a){return s=qs(4,r.children!==null?r.children:[],r.key,s),s.lanes=a,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}function Soe(r,s,a,d,p){this.tag=s,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mw(0),this.expirationTimes=mw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mw(0),this.identifierPrefix=d,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function pA(r,s,a,d,p,_,v,T,b){return r=new Soe(r,s,a,T,b),s===1?(s=1,_===!0&&(s|=8)):s=0,_=qs(3,null,null,s),r.current=_,_.stateNode=r,_.memoizedState={element:d,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},JI(_),r}function Toe(r,s,a){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Vu,key:d==null?null:""+d,children:r,containerInfo:s,implementation:a}}function w6(r){if(!r)return Jc;r=r._reactInternals;e:{if(pd(r)!==r||r.tag!==1)throw Error(De(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Yi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(De(171))}if(r.tag===1){var a=r.type;if(Yi(a))return w5(r,a,s)}return s}function b6(r,s,a,d,p,_,v,T,b){return r=pA(a,d,!0,r,p,_,v,T,b),r.context=w6(null),a=r.current,d=Ci(),p=Gc(a),_=Ma(d,p),_.callback=s??null,Bc(a,_,p),r.current.lanes=p,cm(r,p,d),qi(r,d),r}function Sy(r,s,a,d){var p=s.current,_=Ci(),v=Gc(p);return a=w6(a),s.context===null?s.context=a:s.pendingContext=a,s=Ma(_,v),s.payload={element:r},d=d===void 0?null:d,d!==null&&(s.callback=d),r=Bc(p,s,v),r!==null&&(Ao(r,p,v,_),ZE(r,p,v)),v}function Xv(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function $B(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var a=r.retryLane;r.retryLane=a!==0&&a<s?a:s}}function fA(r,s){$B(r,s),(r=r.alternate)&&$B(r,s)}function Roe(){return null}var I6=typeof reportError=="function"?reportError:function(r){console.error(r)};function mA(r){this._internalRoot=r}Ty.prototype.render=mA.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(De(409));Sy(r,s,null,null)};Ty.prototype.unmount=mA.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;od(function(){Sy(null,r,null,null)}),s[Ua]=null}};function Ty(r){this._internalRoot=r}Ty.prototype.unstable_scheduleHydration=function(r){if(r){var s=i5();r={blockedOn:null,target:r,priority:s};for(var a=0;a<Nc.length&&s!==0&&s<Nc[a].priority;a++);Nc.splice(a,0,r),a===0&&o5(r)}};function _A(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Ry(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function QB(){}function Coe(r,s,a,d,p){if(p){if(typeof d=="function"){var _=d;d=function(){var N=Xv(v);_.call(N)}}var v=b6(s,d,r,0,null,!1,!1,"",QB);return r._reactRootContainer=v,r[Ua]=v.current,qf(r.nodeType===8?r.parentNode:r),od(),v}for(;p=r.lastChild;)r.removeChild(p);if(typeof d=="function"){var T=d;d=function(){var N=Xv(b);T.call(N)}}var b=pA(r,0,!1,null,null,!1,!1,"",QB);return r._reactRootContainer=b,r[Ua]=b.current,qf(r.nodeType===8?r.parentNode:r),od(function(){Sy(s,b,a,d)}),b}function Cy(r,s,a,d,p){var _=a._reactRootContainer;if(_){var v=_;if(typeof p=="function"){var T=p;p=function(){var b=Xv(v);T.call(b)}}Sy(s,v,r,p)}else v=Coe(a,s,r,p,d);return Xv(v)}n5=function(r){switch(r.tag){case 3:var s=r.stateNode;if(s.current.memoizedState.isDehydrated){var a=Tf(s.pendingLanes);a!==0&&(MI(s,a|1),qi(s,gr()),!(cn&6)&&(uh=gr()+500,tl()))}break;case 13:od(function(){var d=Va(r,1);if(d!==null){var p=Ci();Ao(d,r,1,p)}}),fA(r,1)}};xI=function(r){if(r.tag===13){var s=Va(r,134217728);if(s!==null){var a=Ci();Ao(s,r,134217728,a)}fA(r,134217728)}};r5=function(r){if(r.tag===13){var s=Gc(r),a=Va(r,s);if(a!==null){var d=Ci();Ao(a,r,s,d)}fA(r,s)}};i5=function(){return Sn};s5=function(r,s){var a=Sn;try{return Sn=r,s()}finally{Sn=a}};gb=function(r,s,a){switch(s){case"input":if(db(r,a),s=a.name,a.type==="radio"&&s!=null){for(a=r;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<a.length;s++){var d=a[s];if(d!==r&&d.form===r.form){var p=fy(d);if(!p)throw Error(De(90));x4(d),db(d,p)}}}break;case"textarea":V4(r,a);break;case"select":s=a.value,s!=null&&Ju(r,!!a.multiple,s,!1)}};K4=lA;z4=od;var woe={usingClientEntryPoint:!1,Events:[dm,Gu,fy,G4,H4,lA]},pf={findFiberByHostInstance:Yl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},boe={bundleType:pf.bundleType,version:pf.version,rendererPackageName:pf.rendererPackageName,rendererConfig:pf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ga.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=X4(r),r===null?null:r.stateNode},findFiberByHostInstance:pf.findFiberByHostInstance||Roe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var GE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!GE.isDisabled&&GE.supportsFiber)try{dy=GE.inject(boe),aa=GE}catch{}}_s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=woe;_s.createPortal=function(r,s){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_A(s))throw Error(De(200));return Toe(r,s,null,a)};_s.createRoot=function(r,s){if(!_A(r))throw Error(De(299));var a=!1,d="",p=I6;return s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onRecoverableError!==void 0&&(p=s.onRecoverableError)),s=pA(r,1,!1,null,null,a,!1,d,p),r[Ua]=s.current,qf(r.nodeType===8?r.parentNode:r),new mA(s)};_s.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(De(188)):(r=Object.keys(r).join(","),Error(De(268,r)));return r=X4(s),r=r===null?null:r.stateNode,r};_s.flushSync=function(r){return od(r)};_s.hydrate=function(r,s,a){if(!Ry(s))throw Error(De(200));return Cy(null,r,s,!0,a)};_s.hydrateRoot=function(r,s,a){if(!_A(r))throw Error(De(405));var d=a!=null&&a.hydratedSources||null,p=!1,_="",v=I6;if(a!=null&&(a.unstable_strictMode===!0&&(p=!0),a.identifierPrefix!==void 0&&(_=a.identifierPrefix),a.onRecoverableError!==void 0&&(v=a.onRecoverableError)),s=b6(s,null,r,1,a??null,p,!1,_,v),r[Ua]=s.current,qf(r),d)for(r=0;r<d.length;r++)a=d[r],p=a._getVersion,p=p(a._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[a,p]:s.mutableSourceEagerHydrationData.push(a,p);return new Ty(s)};_s.render=function(r,s,a){if(!Ry(s))throw Error(De(200));return Cy(null,r,s,!1,a)};_s.unmountComponentAtNode=function(r){if(!Ry(r))throw Error(De(40));return r._reactRootContainer?(od(function(){Cy(null,null,r,!1,function(){r._reactRootContainer=null,r[Ua]=null})}),!0):!1};_s.unstable_batchedUpdates=lA;_s.unstable_renderSubtreeIntoContainer=function(r,s,a,d){if(!Ry(a))throw Error(De(200));if(r==null||r._reactInternals===void 0)throw Error(De(38));return Cy(r,s,a,!1,d)};_s.version="18.3.1-next-f1338f8080-20240426";function A6(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(A6)}catch(r){console.error(r)}}A6(),A4.exports=_s;var O6=A4.exports,N6,ZB=O6;N6=ZB.createRoot,ZB.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rm(){return rm=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(r[d]=a[d])}return r},rm.apply(this,arguments)}var xc;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(xc||(xc={}));const e3="popstate";function Ioe(r){r===void 0&&(r={});function s(d,p){let{pathname:_,search:v,hash:T}=d.location;return Jb("",{pathname:_,search:v,hash:T},p.state&&p.state.usr||null,p.state&&p.state.key||"default")}function a(d,p){return typeof p=="string"?p:D6(p)}return Ooe(s,a,null,r)}function Ir(r,s){if(r===!1||r===null||typeof r>"u")throw new Error(s)}function P6(r,s){if(!r){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function Aoe(){return Math.random().toString(36).substr(2,8)}function t3(r,s){return{usr:r.state,key:r.key,idx:s}}function Jb(r,s,a,d){return a===void 0&&(a=null),rm({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof s=="string"?Eh(s):s,{state:a,key:s&&s.key||d||Aoe()})}function D6(r){let{pathname:s="/",search:a="",hash:d=""}=r;return a&&a!=="?"&&(s+=a.charAt(0)==="?"?a:"?"+a),d&&d!=="#"&&(s+=d.charAt(0)==="#"?d:"#"+d),s}function Eh(r){let s={};if(r){let a=r.indexOf("#");a>=0&&(s.hash=r.substr(a),r=r.substr(0,a));let d=r.indexOf("?");d>=0&&(s.search=r.substr(d),r=r.substr(0,d)),r&&(s.pathname=r)}return s}function Ooe(r,s,a,d){d===void 0&&(d={});let{window:p=document.defaultView,v5Compat:_=!1}=d,v=p.history,T=xc.Pop,b=null,N=L();N==null&&(N=0,v.replaceState(rm({},v.state,{idx:N}),""));function L(){return(v.state||{idx:null}).idx}function U(){T=xc.Pop;let te=L(),q=te==null?null:te-N;N=te,b&&b({action:T,location:X.location,delta:q})}function B(te,q){T=xc.Push;let z=Jb(X.location,te,q);N=L()+1;let W=t3(z,N),Z=X.createHref(z);try{v.pushState(W,"",Z)}catch(Ee){if(Ee instanceof DOMException&&Ee.name==="DataCloneError")throw Ee;p.location.assign(Z)}_&&b&&b({action:T,location:X.location,delta:1})}function Y(te,q){T=xc.Replace;let z=Jb(X.location,te,q);N=L();let W=t3(z,N),Z=X.createHref(z);v.replaceState(W,"",Z),_&&b&&b({action:T,location:X.location,delta:0})}function F(te){let q=p.location.origin!=="null"?p.location.origin:p.location.href,z=typeof te=="string"?te:D6(te);return z=z.replace(/ $/,"%20"),Ir(q,"No window.location.(origin|href) available to create URL for href: "+z),new URL(z,q)}let X={get action(){return T},get location(){return r(p,v)},listen(te){if(b)throw new Error("A history only accepts one active listener");return p.addEventListener(e3,U),b=te,()=>{p.removeEventListener(e3,U),b=null}},createHref(te){return s(p,te)},createURL:F,encodeLocation(te){let q=F(te);return{pathname:q.pathname,search:q.search,hash:q.hash}},push:B,replace:Y,go(te){return v.go(te)}};return X}var n3;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(n3||(n3={}));function Noe(r,s,a){return a===void 0&&(a="/"),Poe(r,s,a)}function Poe(r,s,a,d){let p=typeof s=="string"?Eh(s):s,_=M6(p.pathname||"/",a);if(_==null)return null;let v=k6(r);Doe(v);let T=null;for(let b=0;T==null&&b<v.length;++b){let N=Hoe(_);T=Boe(v[b],N)}return T}function k6(r,s,a,d){s===void 0&&(s=[]),a===void 0&&(a=[]),d===void 0&&(d="");let p=(_,v,T)=>{let b={relativePath:T===void 0?_.path||"":T,caseSensitive:_.caseSensitive===!0,childrenIndex:v,route:_};b.relativePath.startsWith("/")&&(Ir(b.relativePath.startsWith(d),'Absolute route path "'+b.relativePath+'" nested under path '+('"'+d+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),b.relativePath=b.relativePath.slice(d.length));let N=ed([d,b.relativePath]),L=a.concat(b);_.children&&_.children.length>0&&(Ir(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+N+'".')),k6(_.children,s,L,N)),!(_.path==null&&!_.index)&&s.push({path:N,score:joe(N,_.index),routesMeta:L})};return r.forEach((_,v)=>{var T;if(_.path===""||!((T=_.path)!=null&&T.includes("?")))p(_,v);else for(let b of L6(_.path))p(_,v,b)}),s}function L6(r){let s=r.split("/");if(s.length===0)return[];let[a,...d]=s,p=a.endsWith("?"),_=a.replace(/\?$/,"");if(d.length===0)return p?[_,""]:[_];let v=L6(d.join("/")),T=[];return T.push(...v.map(b=>b===""?_:[_,b].join("/"))),p&&T.push(...v),T.map(b=>r.startsWith("/")&&b===""?"/":b)}function Doe(r){r.sort((s,a)=>s.score!==a.score?a.score-s.score:Foe(s.routesMeta.map(d=>d.childrenIndex),a.routesMeta.map(d=>d.childrenIndex)))}const koe=/^:[\w-]+$/,Loe=3,Moe=2,xoe=1,Uoe=10,Voe=-2,r3=r=>r==="*";function joe(r,s){let a=r.split("/"),d=a.length;return a.some(r3)&&(d+=Voe),s&&(d+=Moe),a.filter(p=>!r3(p)).reduce((p,_)=>p+(koe.test(_)?Loe:_===""?xoe:Uoe),d)}function Foe(r,s){return r.length===s.length&&r.slice(0,-1).every((d,p)=>d===s[p])?r[r.length-1]-s[s.length-1]:0}function Boe(r,s,a){let{routesMeta:d}=r,p={},_="/",v=[];for(let T=0;T<d.length;++T){let b=d[T],N=T===d.length-1,L=_==="/"?s:s.slice(_.length)||"/",U=Woe({path:b.relativePath,caseSensitive:b.caseSensitive,end:N},L),B=b.route;if(!U)return null;Object.assign(p,U.params),v.push({params:p,pathname:ed([_,U.pathname]),pathnameBase:qoe(ed([_,U.pathnameBase])),route:B}),U.pathnameBase!=="/"&&(_=ed([_,U.pathnameBase]))}return v}function Woe(r,s){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[a,d]=Goe(r.path,r.caseSensitive,r.end),p=s.match(a);if(!p)return null;let _=p[0],v=_.replace(/(.)\/+$/,"$1"),T=p.slice(1);return{params:d.reduce((N,L,U)=>{let{paramName:B,isOptional:Y}=L;if(B==="*"){let X=T[U]||"";v=_.slice(0,_.length-X.length).replace(/(.)\/+$/,"$1")}const F=T[U];return Y&&!F?N[B]=void 0:N[B]=(F||"").replace(/%2F/g,"/"),N},{}),pathname:_,pathnameBase:v,pattern:r}}function Goe(r,s,a){s===void 0&&(s=!1),a===void 0&&(a=!0),P6(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let d=[],p="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(v,T,b)=>(d.push({paramName:T,isOptional:b!=null}),b?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(d.push({paramName:"*"}),p+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?p+="\\/*$":r!==""&&r!=="/"&&(p+="(?:(?=\\/|$))"),[new RegExp(p,s?void 0:"i"),d]}function Hoe(r){try{return r.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return P6(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),r}}function M6(r,s){if(s==="/")return r;if(!r.toLowerCase().startsWith(s.toLowerCase()))return null;let a=s.endsWith("/")?s.length-1:s.length,d=r.charAt(a);return d&&d!=="/"?null:r.slice(a)||"/"}function Koe(r,s){s===void 0&&(s="/");let{pathname:a,search:d="",hash:p=""}=typeof r=="string"?Eh(r):r;return{pathname:a?a.startsWith("/")?a:zoe(a,s):s,search:Xoe(d),hash:Joe(p)}}function zoe(r,s){let a=s.replace(/\/+$/,"").split("/");return r.split("/").forEach(p=>{p===".."?a.length>1&&a.pop():p!=="."&&a.push(p)}),a.length>1?a.join("/"):"/"}function xw(r,s,a,d){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(d)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Yoe(r){return r.filter((s,a)=>a===0||s.route.path&&s.route.path.length>0)}function x6(r,s){let a=Yoe(r);return s?a.map((d,p)=>p===a.length-1?d.pathname:d.pathnameBase):a.map(d=>d.pathnameBase)}function U6(r,s,a,d){d===void 0&&(d=!1);let p;typeof r=="string"?p=Eh(r):(p=rm({},r),Ir(!p.pathname||!p.pathname.includes("?"),xw("?","pathname","search",p)),Ir(!p.pathname||!p.pathname.includes("#"),xw("#","pathname","hash",p)),Ir(!p.search||!p.search.includes("#"),xw("#","search","hash",p)));let _=r===""||p.pathname==="",v=_?"/":p.pathname,T;if(v==null)T=a;else{let U=s.length-1;if(!d&&v.startsWith("..")){let B=v.split("/");for(;B[0]==="..";)B.shift(),U-=1;p.pathname=B.join("/")}T=U>=0?s[U]:"/"}let b=Koe(p,T),N=v&&v!=="/"&&v.endsWith("/"),L=(_||v===".")&&a.endsWith("/");return!b.pathname.endsWith("/")&&(N||L)&&(b.pathname+="/"),b}const ed=r=>r.join("/").replace(/\/\/+/g,"/"),qoe=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Xoe=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Joe=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function $oe(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const V6=["post","put","patch","delete"];new Set(V6);const Qoe=["get",...V6];new Set(Qoe);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function im(){return im=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(r[d]=a[d])}return r},im.apply(this,arguments)}const gA=ee.createContext(null),Zoe=ee.createContext(null),hm=ee.createContext(null),wy=ee.createContext(null),fd=ee.createContext({outlet:null,matches:[],isDataRoute:!1}),j6=ee.createContext(null);function pm(){return ee.useContext(wy)!=null}function EA(){return pm()||Ir(!1),ee.useContext(wy).location}function F6(r){ee.useContext(hm).static||ee.useLayoutEffect(r)}function eae(){let{isDataRoute:r}=ee.useContext(fd);return r?pae():tae()}function tae(){pm()||Ir(!1);let r=ee.useContext(gA),{basename:s,future:a,navigator:d}=ee.useContext(hm),{matches:p}=ee.useContext(fd),{pathname:_}=EA(),v=JSON.stringify(x6(p,a.v7_relativeSplatPath)),T=ee.useRef(!1);return F6(()=>{T.current=!0}),ee.useCallback(function(N,L){if(L===void 0&&(L={}),!T.current)return;if(typeof N=="number"){d.go(N);return}let U=U6(N,JSON.parse(v),_,L.relative==="path");r==null&&s!=="/"&&(U.pathname=U.pathname==="/"?s:ed([s,U.pathname])),(L.replace?d.replace:d.push)(U,L.state,L)},[s,d,v,_,r])}function nae(r,s){return rae(r,s)}function rae(r,s,a,d){pm()||Ir(!1);let{navigator:p}=ee.useContext(hm),{matches:_}=ee.useContext(fd),v=_[_.length-1],T=v?v.params:{};v&&v.pathname;let b=v?v.pathnameBase:"/";v&&v.route;let N=EA(),L;if(s){var U;let te=typeof s=="string"?Eh(s):s;b==="/"||(U=te.pathname)!=null&&U.startsWith(b)||Ir(!1),L=te}else L=N;let B=L.pathname||"/",Y=B;if(b!=="/"){let te=b.replace(/^\//,"").split("/");Y="/"+B.replace(/^\//,"").split("/").slice(te.length).join("/")}let F=Noe(r,{pathname:Y}),X=cae(F&&F.map(te=>Object.assign({},te,{params:Object.assign({},T,te.params),pathname:ed([b,p.encodeLocation?p.encodeLocation(te.pathname).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?b:ed([b,p.encodeLocation?p.encodeLocation(te.pathnameBase).pathname:te.pathnameBase])})),_,a,d);return s&&X?ee.createElement(wy.Provider,{value:{location:im({pathname:"/",search:"",hash:"",state:null,key:"default"},L),navigationType:xc.Pop}},X):X}function iae(){let r=hae(),s=$oe(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),a=r instanceof Error?r.stack:null,p={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},s),a?ee.createElement("pre",{style:p},a):null,null)}const sae=ee.createElement(iae,null);class oae extends ee.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,a){return a.location!==s.location||a.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:a.error,location:a.location,revalidation:s.revalidation||a.revalidation}}componentDidCatch(s,a){console.error("React Router caught the following error during render",s,a)}render(){return this.state.error!==void 0?ee.createElement(fd.Provider,{value:this.props.routeContext},ee.createElement(j6.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function aae(r){let{routeContext:s,match:a,children:d}=r,p=ee.useContext(gA);return p&&p.static&&p.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(p.staticContext._deepestRenderedBoundaryId=a.route.id),ee.createElement(fd.Provider,{value:s},d)}function cae(r,s,a,d){var p;if(s===void 0&&(s=[]),a===void 0&&(a=null),d===void 0&&(d=null),r==null){var _;if(!a)return null;if(a.errors)r=a.matches;else if((_=d)!=null&&_.v7_partialHydration&&s.length===0&&!a.initialized&&a.matches.length>0)r=a.matches;else return null}let v=r,T=(p=a)==null?void 0:p.errors;if(T!=null){let L=v.findIndex(U=>U.route.id&&(T==null?void 0:T[U.route.id])!==void 0);L>=0||Ir(!1),v=v.slice(0,Math.min(v.length,L+1))}let b=!1,N=-1;if(a&&d&&d.v7_partialHydration)for(let L=0;L<v.length;L++){let U=v[L];if((U.route.HydrateFallback||U.route.hydrateFallbackElement)&&(N=L),U.route.id){let{loaderData:B,errors:Y}=a,F=U.route.loader&&B[U.route.id]===void 0&&(!Y||Y[U.route.id]===void 0);if(U.route.lazy||F){b=!0,N>=0?v=v.slice(0,N+1):v=[v[0]];break}}}return v.reduceRight((L,U,B)=>{let Y,F=!1,X=null,te=null;a&&(Y=T&&U.route.id?T[U.route.id]:void 0,X=U.route.errorElement||sae,b&&(N<0&&B===0?(fae("route-fallback"),F=!0,te=null):N===B&&(F=!0,te=U.route.hydrateFallbackElement||null)));let q=s.concat(v.slice(0,B+1)),z=()=>{let W;return Y?W=X:F?W=te:U.route.Component?W=ee.createElement(U.route.Component,null):U.route.element?W=U.route.element:W=L,ee.createElement(aae,{match:U,routeContext:{outlet:L,matches:q,isDataRoute:a!=null},children:W})};return a&&(U.route.ErrorBoundary||U.route.errorElement||B===0)?ee.createElement(oae,{location:a.location,revalidation:a.revalidation,component:X,error:Y,children:z(),routeContext:{outlet:null,matches:q,isDataRoute:!0}}):z()},null)}var B6=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(B6||{}),W6=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(W6||{});function lae(r){let s=ee.useContext(gA);return s||Ir(!1),s}function dae(r){let s=ee.useContext(Zoe);return s||Ir(!1),s}function uae(r){let s=ee.useContext(fd);return s||Ir(!1),s}function G6(r){let s=uae(),a=s.matches[s.matches.length-1];return a.route.id||Ir(!1),a.route.id}function hae(){var r;let s=ee.useContext(j6),a=dae(),d=G6();return s!==void 0?s:(r=a.errors)==null?void 0:r[d]}function pae(){let{router:r}=lae(B6.UseNavigateStable),s=G6(W6.UseNavigateStable),a=ee.useRef(!1);return F6(()=>{a.current=!0}),ee.useCallback(function(p,_){_===void 0&&(_={}),a.current&&(typeof p=="number"?r.navigate(p):r.navigate(p,im({fromRouteId:s},_)))},[r,s])}const i3={};function fae(r,s,a){i3[r]||(i3[r]=!0)}function mae(r,s){r==null||r.v7_startTransition,r==null||r.v7_relativeSplatPath}function s3(r){let{to:s,replace:a,state:d,relative:p}=r;pm()||Ir(!1);let{future:_,static:v}=ee.useContext(hm),{matches:T}=ee.useContext(fd),{pathname:b}=EA(),N=eae(),L=U6(s,x6(T,_.v7_relativeSplatPath),b,p==="path"),U=JSON.stringify(L);return ee.useEffect(()=>N(JSON.parse(U),{replace:a,state:d,relative:p}),[N,U,p,a,d]),null}function $b(r){Ir(!1)}function _ae(r){let{basename:s="/",children:a=null,location:d,navigationType:p=xc.Pop,navigator:_,static:v=!1,future:T}=r;pm()&&Ir(!1);let b=s.replace(/^\/*/,"/"),N=ee.useMemo(()=>({basename:b,navigator:_,static:v,future:im({v7_relativeSplatPath:!1},T)}),[b,T,_,v]);typeof d=="string"&&(d=Eh(d));let{pathname:L="/",search:U="",hash:B="",state:Y=null,key:F="default"}=d,X=ee.useMemo(()=>{let te=M6(L,b);return te==null?null:{location:{pathname:te,search:U,hash:B,state:Y,key:F},navigationType:p}},[b,L,U,B,Y,F,p]);return X==null?null:ee.createElement(hm.Provider,{value:N},ee.createElement(wy.Provider,{children:a,value:X}))}function gae(r){let{children:s,location:a}=r;return nae(Qb(s),a)}new Promise(()=>{});function Qb(r,s){s===void 0&&(s=[]);let a=[];return ee.Children.forEach(r,(d,p)=>{if(!ee.isValidElement(d))return;let _=[...s,p];if(d.type===ee.Fragment){a.push.apply(a,Qb(d.props.children,_));return}d.type!==$b&&Ir(!1),!d.props.index||!d.props.children||Ir(!1);let v={id:d.props.id||_.join("-"),caseSensitive:d.props.caseSensitive,element:d.props.element,Component:d.props.Component,index:d.props.index,path:d.props.path,loader:d.props.loader,action:d.props.action,errorElement:d.props.errorElement,ErrorBoundary:d.props.ErrorBoundary,hasErrorBoundary:d.props.ErrorBoundary!=null||d.props.errorElement!=null,shouldRevalidate:d.props.shouldRevalidate,handle:d.props.handle,lazy:d.props.lazy};d.props.children&&(v.children=Qb(d.props.children,_)),a.push(v)}),a}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Eae="6";try{window.__reactRouterVersion=Eae}catch{}const vae="startTransition",o3=_ie[vae];function yae(r){let{basename:s,children:a,future:d,window:p}=r,_=ee.useRef();_.current==null&&(_.current=Ioe({window:p,v5Compat:!0}));let v=_.current,[T,b]=ee.useState({action:v.action,location:v.location}),{v7_startTransition:N}=d||{},L=ee.useCallback(U=>{N&&o3?o3(()=>b(U)):b(U)},[b,N]);return ee.useLayoutEffect(()=>v.listen(L),[v,L]),ee.useEffect(()=>mae(d),[d]),ee.createElement(_ae,{basename:s,children:a,location:T.location,navigationType:T.action,navigator:v,future:d})}var a3;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(a3||(a3={}));var c3;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(c3||(c3={}));var H6={exports:{}},K6={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hh=ee;function Sae(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Tae=typeof Object.is=="function"?Object.is:Sae,Rae=hh.useState,Cae=hh.useEffect,wae=hh.useLayoutEffect,bae=hh.useDebugValue;function Iae(r,s){var a=s(),d=Rae({inst:{value:a,getSnapshot:s}}),p=d[0].inst,_=d[1];return wae(function(){p.value=a,p.getSnapshot=s,Uw(p)&&_({inst:p})},[r,a,s]),Cae(function(){return Uw(p)&&_({inst:p}),r(function(){Uw(p)&&_({inst:p})})},[r]),bae(a),a}function Uw(r){var s=r.getSnapshot;r=r.value;try{var a=s();return!Tae(r,a)}catch{return!0}}function Aae(r,s){return s()}var Oae=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Aae:Iae;K6.useSyncExternalStore=hh.useSyncExternalStore!==void 0?hh.useSyncExternalStore:Oae;H6.exports=K6;var Nae=H6.exports,z6={exports:{}},Y6={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var by=ee,Pae=Nae;function Dae(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var kae=typeof Object.is=="function"?Object.is:Dae,Lae=Pae.useSyncExternalStore,Mae=by.useRef,xae=by.useEffect,Uae=by.useMemo,Vae=by.useDebugValue;Y6.useSyncExternalStoreWithSelector=function(r,s,a,d,p){var _=Mae(null);if(_.current===null){var v={hasValue:!1,value:null};_.current=v}else v=_.current;_=Uae(function(){function b(Y){if(!N){if(N=!0,L=Y,Y=d(Y),p!==void 0&&v.hasValue){var F=v.value;if(p(F,Y))return U=F}return U=Y}if(F=U,kae(L,Y))return F;var X=d(Y);return p!==void 0&&p(F,X)?(L=Y,F):(L=Y,U=X)}var N=!1,L,U,B=a===void 0?null:a;return[function(){return b(s())},B===null?void 0:function(){return b(B())}]},[s,a,d,p]);var T=Lae(r,_[0],_[1]);return xae(function(){v.hasValue=!0,v.value=T},[T]),Vae(T),T};z6.exports=Y6;var jae=z6.exports;function Fae(r){r()}let q6=Fae;const Bae=r=>q6=r,Wae=()=>q6,l3=Symbol.for("react-redux-context"),d3=typeof globalThis<"u"?globalThis:{};function Gae(){var r;if(!ee.createContext)return{};const s=(r=d3[l3])!=null?r:d3[l3]=new Map;let a=s.get(ee.createContext);return a||(a=ee.createContext(null),s.set(ee.createContext,a)),a}const $c=Gae();function vA(r=$c){return function(){return ee.useContext(r)}}const X6=vA(),Hae=()=>{throw new Error("uSES not initialized!")};let J6=Hae;const Kae=r=>{J6=r},zae=(r,s)=>r===s;function Yae(r=$c){const s=r===$c?X6:vA(r);return function(d,p={}){const{equalityFn:_=zae,stabilityCheck:v=void 0,noopCheck:T=void 0}=typeof p=="function"?{equalityFn:p}:p,{store:b,subscription:N,getServerState:L,stabilityCheck:U,noopCheck:B}=s();ee.useRef(!0);const Y=ee.useCallback({[d.name](X){return d(X)}}[d.name],[d,U,v]),F=J6(N.addNestedSub,b.getState,L||b.getState,Y,_);return ee.useDebugValue(F),F}}const xr=Yae();var $6={exports:{}},Tn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zr=typeof Symbol=="function"&&Symbol.for,yA=zr?Symbol.for("react.element"):60103,SA=zr?Symbol.for("react.portal"):60106,Iy=zr?Symbol.for("react.fragment"):60107,Ay=zr?Symbol.for("react.strict_mode"):60108,Oy=zr?Symbol.for("react.profiler"):60114,Ny=zr?Symbol.for("react.provider"):60109,Py=zr?Symbol.for("react.context"):60110,TA=zr?Symbol.for("react.async_mode"):60111,Dy=zr?Symbol.for("react.concurrent_mode"):60111,ky=zr?Symbol.for("react.forward_ref"):60112,Ly=zr?Symbol.for("react.suspense"):60113,qae=zr?Symbol.for("react.suspense_list"):60120,My=zr?Symbol.for("react.memo"):60115,xy=zr?Symbol.for("react.lazy"):60116,Xae=zr?Symbol.for("react.block"):60121,Jae=zr?Symbol.for("react.fundamental"):60117,$ae=zr?Symbol.for("react.responder"):60118,Qae=zr?Symbol.for("react.scope"):60119;function Es(r){if(typeof r=="object"&&r!==null){var s=r.$$typeof;switch(s){case yA:switch(r=r.type,r){case TA:case Dy:case Iy:case Oy:case Ay:case Ly:return r;default:switch(r=r&&r.$$typeof,r){case Py:case ky:case xy:case My:case Ny:return r;default:return s}}case SA:return s}}}function Q6(r){return Es(r)===Dy}Tn.AsyncMode=TA;Tn.ConcurrentMode=Dy;Tn.ContextConsumer=Py;Tn.ContextProvider=Ny;Tn.Element=yA;Tn.ForwardRef=ky;Tn.Fragment=Iy;Tn.Lazy=xy;Tn.Memo=My;Tn.Portal=SA;Tn.Profiler=Oy;Tn.StrictMode=Ay;Tn.Suspense=Ly;Tn.isAsyncMode=function(r){return Q6(r)||Es(r)===TA};Tn.isConcurrentMode=Q6;Tn.isContextConsumer=function(r){return Es(r)===Py};Tn.isContextProvider=function(r){return Es(r)===Ny};Tn.isElement=function(r){return typeof r=="object"&&r!==null&&r.$$typeof===yA};Tn.isForwardRef=function(r){return Es(r)===ky};Tn.isFragment=function(r){return Es(r)===Iy};Tn.isLazy=function(r){return Es(r)===xy};Tn.isMemo=function(r){return Es(r)===My};Tn.isPortal=function(r){return Es(r)===SA};Tn.isProfiler=function(r){return Es(r)===Oy};Tn.isStrictMode=function(r){return Es(r)===Ay};Tn.isSuspense=function(r){return Es(r)===Ly};Tn.isValidElementType=function(r){return typeof r=="string"||typeof r=="function"||r===Iy||r===Dy||r===Oy||r===Ay||r===Ly||r===qae||typeof r=="object"&&r!==null&&(r.$$typeof===xy||r.$$typeof===My||r.$$typeof===Ny||r.$$typeof===Py||r.$$typeof===ky||r.$$typeof===Jae||r.$$typeof===$ae||r.$$typeof===Qae||r.$$typeof===Xae)};Tn.typeOf=Es;$6.exports=Tn;var Zae=$6.exports,Z6=Zae,ece={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},tce={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},eW={};eW[Z6.ForwardRef]=ece;eW[Z6.Memo]=tce;var In={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RA=Symbol.for("react.element"),CA=Symbol.for("react.portal"),Uy=Symbol.for("react.fragment"),Vy=Symbol.for("react.strict_mode"),jy=Symbol.for("react.profiler"),Fy=Symbol.for("react.provider"),By=Symbol.for("react.context"),nce=Symbol.for("react.server_context"),Wy=Symbol.for("react.forward_ref"),Gy=Symbol.for("react.suspense"),Hy=Symbol.for("react.suspense_list"),Ky=Symbol.for("react.memo"),zy=Symbol.for("react.lazy"),rce=Symbol.for("react.offscreen"),tW;tW=Symbol.for("react.module.reference");function Qs(r){if(typeof r=="object"&&r!==null){var s=r.$$typeof;switch(s){case RA:switch(r=r.type,r){case Uy:case jy:case Vy:case Gy:case Hy:return r;default:switch(r=r&&r.$$typeof,r){case nce:case By:case Wy:case zy:case Ky:case Fy:return r;default:return s}}case CA:return s}}}In.ContextConsumer=By;In.ContextProvider=Fy;In.Element=RA;In.ForwardRef=Wy;In.Fragment=Uy;In.Lazy=zy;In.Memo=Ky;In.Portal=CA;In.Profiler=jy;In.StrictMode=Vy;In.Suspense=Gy;In.SuspenseList=Hy;In.isAsyncMode=function(){return!1};In.isConcurrentMode=function(){return!1};In.isContextConsumer=function(r){return Qs(r)===By};In.isContextProvider=function(r){return Qs(r)===Fy};In.isElement=function(r){return typeof r=="object"&&r!==null&&r.$$typeof===RA};In.isForwardRef=function(r){return Qs(r)===Wy};In.isFragment=function(r){return Qs(r)===Uy};In.isLazy=function(r){return Qs(r)===zy};In.isMemo=function(r){return Qs(r)===Ky};In.isPortal=function(r){return Qs(r)===CA};In.isProfiler=function(r){return Qs(r)===jy};In.isStrictMode=function(r){return Qs(r)===Vy};In.isSuspense=function(r){return Qs(r)===Gy};In.isSuspenseList=function(r){return Qs(r)===Hy};In.isValidElementType=function(r){return typeof r=="string"||typeof r=="function"||r===Uy||r===jy||r===Vy||r===Gy||r===Hy||r===rce||typeof r=="object"&&r!==null&&(r.$$typeof===zy||r.$$typeof===Ky||r.$$typeof===Fy||r.$$typeof===By||r.$$typeof===Wy||r.$$typeof===tW||r.getModuleId!==void 0)};In.typeOf=Qs;function ice(){const r=Wae();let s=null,a=null;return{clear(){s=null,a=null},notify(){r(()=>{let d=s;for(;d;)d.callback(),d=d.next})},get(){let d=[],p=s;for(;p;)d.push(p),p=p.next;return d},subscribe(d){let p=!0,_=a={callback:d,next:null,prev:a};return _.prev?_.prev.next=_:s=_,function(){!p||s===null||(p=!1,_.next?_.next.prev=_.prev:a=_.prev,_.prev?_.prev.next=_.next:s=_.next)}}}}const u3={notify(){},get:()=>[]};function sce(r,s){let a,d=u3,p=0,_=!1;function v(X){L();const te=d.subscribe(X);let q=!1;return()=>{q||(q=!0,te(),U())}}function T(){d.notify()}function b(){F.onStateChange&&F.onStateChange()}function N(){return _}function L(){p++,a||(a=r.subscribe(b),d=ice())}function U(){p--,a&&p===0&&(a(),a=void 0,d.clear(),d=u3)}function B(){_||(_=!0,L())}function Y(){_&&(_=!1,U())}const F={addNestedSub:v,notifyNestedSubs:T,handleChangeWrapper:b,isSubscribed:N,trySubscribe:B,tryUnsubscribe:Y,getListeners:()=>d};return F}const oce=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ace=oce?ee.useLayoutEffect:ee.useEffect;function cce({store:r,context:s,children:a,serverState:d,stabilityCheck:p="once",noopCheck:_="once"}){const v=ee.useMemo(()=>{const N=sce(r);return{store:r,subscription:N,getServerState:d?()=>d:void 0,stabilityCheck:p,noopCheck:_}},[r,d,p,_]),T=ee.useMemo(()=>r.getState(),[r]);ace(()=>{const{subscription:N}=v;return N.onStateChange=N.notifyNestedSubs,N.trySubscribe(),T!==r.getState()&&N.notifyNestedSubs(),()=>{N.tryUnsubscribe(),N.onStateChange=void 0}},[v,T]);const b=s||$c;return ee.createElement(b.Provider,{value:v},a)}function nW(r=$c){const s=r===$c?X6:vA(r);return function(){const{store:d}=s();return d}}const lce=nW();function dce(r=$c){const s=r===$c?lce:nW(r);return function(){return s().dispatch}}const No=dce();Kae(jae.useSyncExternalStoreWithSelector);Bae(O6.unstable_batchedUpdates);function bo(r){for(var s=arguments.length,a=Array(s>1?s-1:0),d=1;d<s;d++)a[d-1]=arguments[d];throw Error("[Immer] minified error nr: "+r+(a.length?" "+a.map(function(p){return"'"+p+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Qc(r){return!!r&&!!r[Kn]}function Fa(r){var s;return!!r&&(function(a){if(!a||typeof a!="object")return!1;var d=Object.getPrototypeOf(a);if(d===null)return!0;var p=Object.hasOwnProperty.call(d,"constructor")&&d.constructor;return p===Object||typeof p=="function"&&Function.toString.call(p)===vce}(r)||Array.isArray(r)||!!r[E3]||!!(!((s=r.constructor)===null||s===void 0)&&s[E3])||wA(r)||bA(r))}function ad(r,s,a){a===void 0&&(a=!1),vh(r)===0?(a?Object.keys:rh)(r).forEach(function(d){a&&typeof d=="symbol"||s(d,r[d],r)}):r.forEach(function(d,p){return s(p,d,r)})}function vh(r){var s=r[Kn];return s?s.i>3?s.i-4:s.i:Array.isArray(r)?1:wA(r)?2:bA(r)?3:0}function nh(r,s){return vh(r)===2?r.has(s):Object.prototype.hasOwnProperty.call(r,s)}function uce(r,s){return vh(r)===2?r.get(s):r[s]}function rW(r,s,a){var d=vh(r);d===2?r.set(s,a):d===3?r.add(a):r[s]=a}function iW(r,s){return r===s?r!==0||1/r==1/s:r!=r&&s!=s}function wA(r){return gce&&r instanceof Map}function bA(r){return Ece&&r instanceof Set}function Hl(r){return r.o||r.t}function IA(r){if(Array.isArray(r))return Array.prototype.slice.call(r);var s=oW(r);delete s[Kn];for(var a=rh(s),d=0;d<a.length;d++){var p=a[d],_=s[p];_.writable===!1&&(_.writable=!0,_.configurable=!0),(_.get||_.set)&&(s[p]={configurable:!0,writable:!0,enumerable:_.enumerable,value:r[p]})}return Object.create(Object.getPrototypeOf(r),s)}function AA(r,s){return s===void 0&&(s=!1),OA(r)||Qc(r)||!Fa(r)||(vh(r)>1&&(r.set=r.add=r.clear=r.delete=hce),Object.freeze(r),s&&ad(r,function(a,d){return AA(d,!0)},!0)),r}function hce(){bo(2)}function OA(r){return r==null||typeof r!="object"||Object.isFrozen(r)}function la(r){var s=nI[r];return s||bo(18,r),s}function pce(r,s){nI[r]||(nI[r]=s)}function Zb(){return sm}function Vw(r,s){s&&(la("Patches"),r.u=[],r.s=[],r.v=s)}function Jv(r){eI(r),r.p.forEach(fce),r.p=null}function eI(r){r===sm&&(sm=r.l)}function h3(r){return sm={p:[],l:sm,h:r,m:!0,_:0}}function fce(r){var s=r[Kn];s.i===0||s.i===1?s.j():s.g=!0}function jw(r,s){s._=s.p.length;var a=s.p[0],d=r!==void 0&&r!==a;return s.h.O||la("ES5").S(s,r,d),d?(a[Kn].P&&(Jv(s),bo(4)),Fa(r)&&(r=$v(s,r),s.l||Qv(s,r)),s.u&&la("Patches").M(a[Kn].t,r,s.u,s.s)):r=$v(s,a,[]),Jv(s),s.u&&s.v(s.u,s.s),r!==sW?r:void 0}function $v(r,s,a){if(OA(s))return s;var d=s[Kn];if(!d)return ad(s,function(T,b){return p3(r,d,s,T,b,a)},!0),s;if(d.A!==r)return s;if(!d.P)return Qv(r,d.t,!0),d.t;if(!d.I){d.I=!0,d.A._--;var p=d.i===4||d.i===5?d.o=IA(d.k):d.o,_=p,v=!1;d.i===3&&(_=new Set(p),p.clear(),v=!0),ad(_,function(T,b){return p3(r,d,p,T,b,a,v)}),Qv(r,p,!1),a&&r.u&&la("Patches").N(d,a,r.u,r.s)}return d.o}function p3(r,s,a,d,p,_,v){if(Qc(p)){var T=$v(r,p,_&&s&&s.i!==3&&!nh(s.R,d)?_.concat(d):void 0);if(rW(a,d,T),!Qc(T))return;r.m=!1}else v&&a.add(p);if(Fa(p)&&!OA(p)){if(!r.h.D&&r._<1)return;$v(r,p),s&&s.A.l||Qv(r,p)}}function Qv(r,s,a){a===void 0&&(a=!1),!r.l&&r.h.D&&r.m&&AA(s,a)}function Fw(r,s){var a=r[Kn];return(a?Hl(a):r)[s]}function f3(r,s){if(s in r)for(var a=Object.getPrototypeOf(r);a;){var d=Object.getOwnPropertyDescriptor(a,s);if(d)return d;a=Object.getPrototypeOf(a)}}function Dc(r){r.P||(r.P=!0,r.l&&Dc(r.l))}function Bw(r){r.o||(r.o=IA(r.t))}function tI(r,s,a){var d=wA(s)?la("MapSet").F(s,a):bA(s)?la("MapSet").T(s,a):r.O?function(p,_){var v=Array.isArray(p),T={i:v?1:0,A:_?_.A:Zb(),P:!1,I:!1,R:{},l:_,t:p,k:null,o:null,j:null,C:!1},b=T,N=om;v&&(b=[T],N=Cf);var L=Proxy.revocable(b,N),U=L.revoke,B=L.proxy;return T.k=B,T.j=U,B}(s,a):la("ES5").J(s,a);return(a?a.A:Zb()).p.push(d),d}function mce(r){return Qc(r)||bo(22,r),function s(a){if(!Fa(a))return a;var d,p=a[Kn],_=vh(a);if(p){if(!p.P&&(p.i<4||!la("ES5").K(p)))return p.t;p.I=!0,d=m3(a,_),p.I=!1}else d=m3(a,_);return ad(d,function(v,T){p&&uce(p.t,v)===T||rW(d,v,s(T))}),_===3?new Set(d):d}(r)}function m3(r,s){switch(s){case 2:return new Map(r);case 3:return Array.from(r)}return IA(r)}function _ce(){function r(_,v){var T=p[_];return T?T.enumerable=v:p[_]=T={configurable:!0,enumerable:v,get:function(){var b=this[Kn];return om.get(b,_)},set:function(b){var N=this[Kn];om.set(N,_,b)}},T}function s(_){for(var v=_.length-1;v>=0;v--){var T=_[v][Kn];if(!T.P)switch(T.i){case 5:d(T)&&Dc(T);break;case 4:a(T)&&Dc(T)}}}function a(_){for(var v=_.t,T=_.k,b=rh(T),N=b.length-1;N>=0;N--){var L=b[N];if(L!==Kn){var U=v[L];if(U===void 0&&!nh(v,L))return!0;var B=T[L],Y=B&&B[Kn];if(Y?Y.t!==U:!iW(B,U))return!0}}var F=!!v[Kn];return b.length!==rh(v).length+(F?0:1)}function d(_){var v=_.k;if(v.length!==_.t.length)return!0;var T=Object.getOwnPropertyDescriptor(v,v.length-1);if(T&&!T.get)return!0;for(var b=0;b<v.length;b++)if(!v.hasOwnProperty(b))return!0;return!1}var p={};pce("ES5",{J:function(_,v){var T=Array.isArray(_),b=function(L,U){if(L){for(var B=Array(U.length),Y=0;Y<U.length;Y++)Object.defineProperty(B,""+Y,r(Y,!0));return B}var F=oW(U);delete F[Kn];for(var X=rh(F),te=0;te<X.length;te++){var q=X[te];F[q]=r(q,L||!!F[q].enumerable)}return Object.create(Object.getPrototypeOf(U),F)}(T,_),N={i:T?5:4,A:v?v.A:Zb(),P:!1,I:!1,R:{},l:v,t:_,k:b,o:null,g:!1,C:!1};return Object.defineProperty(b,Kn,{value:N,writable:!0}),b},S:function(_,v,T){T?Qc(v)&&v[Kn].A===_&&s(_.p):(_.u&&function b(N){if(N&&typeof N=="object"){var L=N[Kn];if(L){var U=L.t,B=L.k,Y=L.R,F=L.i;if(F===4)ad(B,function(W){W!==Kn&&(U[W]!==void 0||nh(U,W)?Y[W]||b(B[W]):(Y[W]=!0,Dc(L)))}),ad(U,function(W){B[W]!==void 0||nh(B,W)||(Y[W]=!1,Dc(L))});else if(F===5){if(d(L)&&(Dc(L),Y.length=!0),B.length<U.length)for(var X=B.length;X<U.length;X++)Y[X]=!1;else for(var te=U.length;te<B.length;te++)Y[te]=!0;for(var q=Math.min(B.length,U.length),z=0;z<q;z++)B.hasOwnProperty(z)||(Y[z]=!0),Y[z]===void 0&&b(B[z])}}}}(_.p[0]),s(_.p))},K:function(_){return _.i===4?a(_):d(_)}})}var _3,sm,NA=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",gce=typeof Map<"u",Ece=typeof Set<"u",g3=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",sW=NA?Symbol.for("immer-nothing"):((_3={})["immer-nothing"]=!0,_3),E3=NA?Symbol.for("immer-draftable"):"__$immer_draftable",Kn=NA?Symbol.for("immer-state"):"__$immer_state",vce=""+Object.prototype.constructor,rh=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:Object.getOwnPropertyNames,oW=Object.getOwnPropertyDescriptors||function(r){var s={};return rh(r).forEach(function(a){s[a]=Object.getOwnPropertyDescriptor(r,a)}),s},nI={},om={get:function(r,s){if(s===Kn)return r;var a=Hl(r);if(!nh(a,s))return function(p,_,v){var T,b=f3(_,v);return b?"value"in b?b.value:(T=b.get)===null||T===void 0?void 0:T.call(p.k):void 0}(r,a,s);var d=a[s];return r.I||!Fa(d)?d:d===Fw(r.t,s)?(Bw(r),r.o[s]=tI(r.A.h,d,r)):d},has:function(r,s){return s in Hl(r)},ownKeys:function(r){return Reflect.ownKeys(Hl(r))},set:function(r,s,a){var d=f3(Hl(r),s);if(d!=null&&d.set)return d.set.call(r.k,a),!0;if(!r.P){var p=Fw(Hl(r),s),_=p==null?void 0:p[Kn];if(_&&_.t===a)return r.o[s]=a,r.R[s]=!1,!0;if(iW(a,p)&&(a!==void 0||nh(r.t,s)))return!0;Bw(r),Dc(r)}return r.o[s]===a&&(a!==void 0||s in r.o)||Number.isNaN(a)&&Number.isNaN(r.o[s])||(r.o[s]=a,r.R[s]=!0),!0},deleteProperty:function(r,s){return Fw(r.t,s)!==void 0||s in r.t?(r.R[s]=!1,Bw(r),Dc(r)):delete r.R[s],r.o&&delete r.o[s],!0},getOwnPropertyDescriptor:function(r,s){var a=Hl(r),d=Reflect.getOwnPropertyDescriptor(a,s);return d&&{writable:!0,configurable:r.i!==1||s!=="length",enumerable:d.enumerable,value:a[s]}},defineProperty:function(){bo(11)},getPrototypeOf:function(r){return Object.getPrototypeOf(r.t)},setPrototypeOf:function(){bo(12)}},Cf={};ad(om,function(r,s){Cf[r]=function(){return arguments[0]=arguments[0][0],s.apply(this,arguments)}}),Cf.deleteProperty=function(r,s){return Cf.set.call(this,r,s,void 0)},Cf.set=function(r,s,a){return om.set.call(this,r[0],s,a,r[0])};var yce=function(){function r(a){var d=this;this.O=g3,this.D=!0,this.produce=function(p,_,v){if(typeof p=="function"&&typeof _!="function"){var T=_;_=p;var b=d;return function(X){var te=this;X===void 0&&(X=T);for(var q=arguments.length,z=Array(q>1?q-1:0),W=1;W<q;W++)z[W-1]=arguments[W];return b.produce(X,function(Z){var Ee;return(Ee=_).call.apply(Ee,[te,Z].concat(z))})}}var N;if(typeof _!="function"&&bo(6),v!==void 0&&typeof v!="function"&&bo(7),Fa(p)){var L=h3(d),U=tI(d,p,void 0),B=!0;try{N=_(U),B=!1}finally{B?Jv(L):eI(L)}return typeof Promise<"u"&&N instanceof Promise?N.then(function(X){return Vw(L,v),jw(X,L)},function(X){throw Jv(L),X}):(Vw(L,v),jw(N,L))}if(!p||typeof p!="object"){if((N=_(p))===void 0&&(N=p),N===sW&&(N=void 0),d.D&&AA(N,!0),v){var Y=[],F=[];la("Patches").M(p,N,Y,F),v(Y,F)}return N}bo(21,p)},this.produceWithPatches=function(p,_){if(typeof p=="function")return function(N){for(var L=arguments.length,U=Array(L>1?L-1:0),B=1;B<L;B++)U[B-1]=arguments[B];return d.produceWithPatches(N,function(Y){return p.apply(void 0,[Y].concat(U))})};var v,T,b=d.produce(p,_,function(N,L){v=N,T=L});return typeof Promise<"u"&&b instanceof Promise?b.then(function(N){return[N,v,T]}):[b,v,T]},typeof(a==null?void 0:a.useProxies)=="boolean"&&this.setUseProxies(a.useProxies),typeof(a==null?void 0:a.autoFreeze)=="boolean"&&this.setAutoFreeze(a.autoFreeze)}var s=r.prototype;return s.createDraft=function(a){Fa(a)||bo(8),Qc(a)&&(a=mce(a));var d=h3(this),p=tI(this,a,void 0);return p[Kn].C=!0,eI(d),p},s.finishDraft=function(a,d){var p=a&&a[Kn],_=p.A;return Vw(_,d),jw(void 0,_)},s.setAutoFreeze=function(a){this.D=a},s.setUseProxies=function(a){a&&!g3&&bo(20),this.O=a},s.applyPatches=function(a,d){var p;for(p=d.length-1;p>=0;p--){var _=d[p];if(_.path.length===0&&_.op==="replace"){a=_.value;break}}p>-1&&(d=d.slice(p+1));var v=la("Patches").$;return Qc(a)?v(a,d):this.produce(a,function(T){return v(T,d)})},r}(),ms=new yce,aW=ms.produce;ms.produceWithPatches.bind(ms);ms.setAutoFreeze.bind(ms);ms.setUseProxies.bind(ms);ms.applyPatches.bind(ms);ms.createDraft.bind(ms);ms.finishDraft.bind(ms);function cd(r){"@babel/helpers - typeof";return cd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},cd(r)}function Sce(r,s){if(cd(r)!="object"||!r)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var d=a.call(r,s);if(cd(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(r)}function Tce(r){var s=Sce(r,"string");return cd(s)=="symbol"?s:s+""}function Rce(r,s,a){return(s=Tce(s))in r?Object.defineProperty(r,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[s]=a,r}function v3(r,s){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(r);s&&(d=d.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),a.push.apply(a,d)}return a}function y3(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?v3(Object(a),!0).forEach(function(d){Rce(r,d,a[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):v3(Object(a)).forEach(function(d){Object.defineProperty(r,d,Object.getOwnPropertyDescriptor(a,d))})}return r}function hi(r){return"Minified Redux error #"+r+"; visit https://redux.js.org/Errors?code="+r+" for the full message or use the non-minified dev environment for full errors. "}var S3=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),Ww=function(){return Math.random().toString(36).substring(7).split("").join(".")},Zv={INIT:"@@redux/INIT"+Ww(),REPLACE:"@@redux/REPLACE"+Ww(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Ww()}};function Cce(r){if(typeof r!="object"||r===null)return!1;for(var s=r;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return Object.getPrototypeOf(r)===s}function cW(r,s,a){var d;if(typeof s=="function"&&typeof a=="function"||typeof a=="function"&&typeof arguments[3]=="function")throw new Error(hi(0));if(typeof s=="function"&&typeof a>"u"&&(a=s,s=void 0),typeof a<"u"){if(typeof a!="function")throw new Error(hi(1));return a(cW)(r,s)}if(typeof r!="function")throw new Error(hi(2));var p=r,_=s,v=[],T=v,b=!1;function N(){T===v&&(T=v.slice())}function L(){if(b)throw new Error(hi(3));return _}function U(X){if(typeof X!="function")throw new Error(hi(4));if(b)throw new Error(hi(5));var te=!0;return N(),T.push(X),function(){if(te){if(b)throw new Error(hi(6));te=!1,N();var z=T.indexOf(X);T.splice(z,1),v=null}}}function B(X){if(!Cce(X))throw new Error(hi(7));if(typeof X.type>"u")throw new Error(hi(8));if(b)throw new Error(hi(9));try{b=!0,_=p(_,X)}finally{b=!1}for(var te=v=T,q=0;q<te.length;q++){var z=te[q];z()}return X}function Y(X){if(typeof X!="function")throw new Error(hi(10));p=X,B({type:Zv.REPLACE})}function F(){var X,te=U;return X={subscribe:function(z){if(typeof z!="object"||z===null)throw new Error(hi(11));function W(){z.next&&z.next(L())}W();var Z=te(W);return{unsubscribe:Z}}},X[S3]=function(){return this},X}return B({type:Zv.INIT}),d={dispatch:B,subscribe:U,getState:L,replaceReducer:Y},d[S3]=F,d}function wce(r){Object.keys(r).forEach(function(s){var a=r[s],d=a(void 0,{type:Zv.INIT});if(typeof d>"u")throw new Error(hi(12));if(typeof a(void 0,{type:Zv.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(hi(13))})}function bce(r){for(var s=Object.keys(r),a={},d=0;d<s.length;d++){var p=s[d];typeof r[p]=="function"&&(a[p]=r[p])}var _=Object.keys(a),v;try{wce(a)}catch(T){v=T}return function(b,N){if(b===void 0&&(b={}),v)throw v;for(var L=!1,U={},B=0;B<_.length;B++){var Y=_[B],F=a[Y],X=b[Y],te=F(X,N);if(typeof te>"u")throw N&&N.type,new Error(hi(14));U[Y]=te,L=L||te!==X}return L=L||_.length!==Object.keys(b).length,L?U:b}}function ey(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return s.length===0?function(d){return d}:s.length===1?s[0]:s.reduce(function(d,p){return function(){return d(p.apply(void 0,arguments))}})}function Ice(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return function(d){return function(){var p=d.apply(void 0,arguments),_=function(){throw new Error(hi(15))},v={getState:p.getState,dispatch:function(){return _.apply(void 0,arguments)}},T=s.map(function(b){return b(v)});return _=ey.apply(void 0,T)(p.dispatch),y3(y3({},p),{},{dispatch:_})}}}function lW(r){var s=function(d){var p=d.dispatch,_=d.getState;return function(v){return function(T){return typeof T=="function"?T(p,_,r):v(T)}}};return s}var rI=lW();rI.withExtraArgument=lW;var dW=function(){var r=function(s,a){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,p){d.__proto__=p}||function(d,p){for(var _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(d[_]=p[_])},r(s,a)};return function(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");r(s,a);function d(){this.constructor=s}s.prototype=a===null?Object.create(a):(d.prototype=a.prototype,new d)}}(),Ace=function(r,s){var a={label:0,sent:function(){if(_[0]&1)throw _[1];return _[1]},trys:[],ops:[]},d,p,_,v;return v={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function T(N){return function(L){return b([N,L])}}function b(N){if(d)throw new TypeError("Generator is already executing.");for(;a;)try{if(d=1,p&&(_=N[0]&2?p.return:N[0]?p.throw||((_=p.return)&&_.call(p),0):p.next)&&!(_=_.call(p,N[1])).done)return _;switch(p=0,_&&(N=[N[0]&2,_.value]),N[0]){case 0:case 1:_=N;break;case 4:return a.label++,{value:N[1],done:!1};case 5:a.label++,p=N[1],N=[0];continue;case 7:N=a.ops.pop(),a.trys.pop();continue;default:if(_=a.trys,!(_=_.length>0&&_[_.length-1])&&(N[0]===6||N[0]===2)){a=0;continue}if(N[0]===3&&(!_||N[1]>_[0]&&N[1]<_[3])){a.label=N[1];break}if(N[0]===6&&a.label<_[1]){a.label=_[1],_=N;break}if(_&&a.label<_[2]){a.label=_[2],a.ops.push(N);break}_[2]&&a.ops.pop(),a.trys.pop();continue}N=s.call(r,a)}catch(L){N=[6,L],p=0}finally{d=_=0}if(N[0]&5)throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}},ph=function(r,s){for(var a=0,d=s.length,p=r.length;a<d;a++,p++)r[p]=s[a];return r},Oce=Object.defineProperty,Nce=Object.defineProperties,Pce=Object.getOwnPropertyDescriptors,T3=Object.getOwnPropertySymbols,Dce=Object.prototype.hasOwnProperty,kce=Object.prototype.propertyIsEnumerable,R3=function(r,s,a){return s in r?Oce(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a},Kc=function(r,s){for(var a in s||(s={}))Dce.call(s,a)&&R3(r,a,s[a]);if(T3)for(var d=0,p=T3(s);d<p.length;d++){var a=p[d];kce.call(s,a)&&R3(r,a,s[a])}return r},Gw=function(r,s){return Nce(r,Pce(s))},Lce=function(r,s,a){return new Promise(function(d,p){var _=function(b){try{T(a.next(b))}catch(N){p(N)}},v=function(b){try{T(a.throw(b))}catch(N){p(N)}},T=function(b){return b.done?d(b.value):Promise.resolve(b.value).then(_,v)};T((a=a.apply(r,s)).next())})},Mce=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?ey:ey.apply(null,arguments)};function xce(r){if(typeof r!="object"||r===null)return!1;var s=Object.getPrototypeOf(r);if(s===null)return!0;for(var a=s;Object.getPrototypeOf(a)!==null;)a=Object.getPrototypeOf(a);return s===a}function zc(r,s){function a(){for(var d=[],p=0;p<arguments.length;p++)d[p]=arguments[p];if(s){var _=s.apply(void 0,d);if(!_)throw new Error("prepareAction did not return an object");return Kc(Kc({type:r,payload:_.payload},"meta"in _&&{meta:_.meta}),"error"in _&&{error:_.error})}return{type:r,payload:d[0]}}return a.toString=function(){return""+r},a.type=r,a.match=function(d){return d.type===r},a}var Uce=function(r){dW(s,r);function s(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];var p=r.apply(this,a)||this;return Object.setPrototypeOf(p,s.prototype),p}return Object.defineProperty(s,Symbol.species,{get:function(){return s},enumerable:!1,configurable:!0}),s.prototype.concat=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return r.prototype.concat.apply(this,a)},s.prototype.prepend=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return a.length===1&&Array.isArray(a[0])?new(s.bind.apply(s,ph([void 0],a[0].concat(this)))):new(s.bind.apply(s,ph([void 0],a.concat(this))))},s}(Array),Vce=function(r){dW(s,r);function s(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];var p=r.apply(this,a)||this;return Object.setPrototypeOf(p,s.prototype),p}return Object.defineProperty(s,Symbol.species,{get:function(){return s},enumerable:!1,configurable:!0}),s.prototype.concat=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return r.prototype.concat.apply(this,a)},s.prototype.prepend=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return a.length===1&&Array.isArray(a[0])?new(s.bind.apply(s,ph([void 0],a[0].concat(this)))):new(s.bind.apply(s,ph([void 0],a.concat(this))))},s}(Array);function iI(r){return Fa(r)?aW(r,function(){}):r}function jce(r){return typeof r=="boolean"}function Fce(){return function(s){return Bce(s)}}function Bce(r){r===void 0&&(r={});var s=r.thunk,a=s===void 0?!0:s;r.immutableCheck,r.serializableCheck,r.actionCreatorCheck;var d=new Uce;return a&&(jce(a)?d.push(rI):d.push(rI.withExtraArgument(a.extraArgument))),d}function Wce(r){var s=Fce(),a=r||{},d=a.reducer,p=d===void 0?void 0:d,_=a.middleware,v=_===void 0?s():_,T=a.devTools,b=T===void 0?!0:T,N=a.preloadedState,L=N===void 0?void 0:N,U=a.enhancers,B=U===void 0?void 0:U,Y;if(typeof p=="function")Y=p;else if(xce(p))Y=bce(p);else throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');var F=v;typeof F=="function"&&(F=F(s));var X=Ice.apply(void 0,F),te=ey;b&&(te=Mce(Kc({trace:!1},typeof b=="object"&&b)));var q=new Vce(X),z=q;Array.isArray(B)?z=ph([X],B):typeof B=="function"&&(z=B(q));var W=te.apply(void 0,z);return cW(Y,L,W)}function uW(r){var s={},a=[],d,p={addCase:function(_,v){var T=typeof _=="string"?_:_.type;if(!T)throw new Error("`builder.addCase` cannot be called with an empty action type");if(T in s)throw new Error("`builder.addCase` cannot be called with two reducers for the same action type");return s[T]=v,p},addMatcher:function(_,v){return a.push({matcher:_,reducer:v}),p},addDefaultCase:function(_){return d=_,p}};return r(p),[s,a,d]}function Gce(r){return typeof r=="function"}function Hce(r,s,a,d){a===void 0&&(a=[]);var p=typeof s=="function"?uW(s):[s,a,d],_=p[0],v=p[1],T=p[2],b;if(Gce(r))b=function(){return iI(r())};else{var N=iI(r);b=function(){return N}}function L(U,B){U===void 0&&(U=b());var Y=ph([_[B.type]],v.filter(function(F){var X=F.matcher;return X(B)}).map(function(F){var X=F.reducer;return X}));return Y.filter(function(F){return!!F}).length===0&&(Y=[T]),Y.reduce(function(F,X){if(X)if(Qc(F)){var te=F,q=X(te,B);return q===void 0?F:q}else{if(Fa(F))return aW(F,function(z){return X(z,B)});var q=X(F,B);if(q===void 0){if(F===null)return F;throw Error("A case reducer on a non-draftable value must not return undefined")}return q}return F},U)}return L.getInitialState=b,L}function Kce(r,s){return r+"/"+s}function yh(r){var s=r.name;if(!s)throw new Error("`name` is a required option for createSlice");var a=typeof r.initialState=="function"?r.initialState:iI(r.initialState),d=r.reducers||{},p=Object.keys(d),_={},v={},T={};p.forEach(function(L){var U=d[L],B=Kce(s,L),Y,F;"reducer"in U?(Y=U.reducer,F=U.prepare):Y=U,_[L]=Y,v[B]=Y,T[L]=F?zc(B,F):zc(B)});function b(){var L=typeof r.extraReducers=="function"?uW(r.extraReducers):[r.extraReducers],U=L[0],B=U===void 0?{}:U,Y=L[1],F=Y===void 0?[]:Y,X=L[2],te=X===void 0?void 0:X,q=Kc(Kc({},B),v);return Hce(a,function(z){for(var W in q)z.addCase(W,q[W]);for(var Z=0,Ee=F;Z<Ee.length;Z++){var Oe=Ee[Z];z.addMatcher(Oe.matcher,Oe.reducer)}te&&z.addDefaultCase(te)})}var N;return{name:s,reducer:function(L,U){return N||(N=b()),N(L,U)},actions:T,caseReducers:_,getInitialState:function(){return N||(N=b()),N.getInitialState()}}}var zce="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Yce=function(r){r===void 0&&(r=21);for(var s="",a=r;a--;)s+=zce[Math.random()*64|0];return s},qce=["name","message","stack","code"],Hw=function(){function r(s,a){this.payload=s,this.meta=a}return r}(),C3=function(){function r(s,a){this.payload=s,this.meta=a}return r}(),Xce=function(r){if(typeof r=="object"&&r!==null){for(var s={},a=0,d=qce;a<d.length;a++){var p=d[a];typeof r[p]=="string"&&(s[p]=r[p])}return s}return{message:String(r)}},nr=function(){function r(s,a,d){var p=zc(s+"/fulfilled",function(N,L,U,B){return{payload:N,meta:Gw(Kc({},B||{}),{arg:U,requestId:L,requestStatus:"fulfilled"})}}),_=zc(s+"/pending",function(N,L,U){return{payload:void 0,meta:Gw(Kc({},U||{}),{arg:L,requestId:N,requestStatus:"pending"})}}),v=zc(s+"/rejected",function(N,L,U,B,Y){return{payload:B,error:(d&&d.serializeError||Xce)(N||"Rejected"),meta:Gw(Kc({},Y||{}),{arg:U,requestId:L,rejectedWithValue:!!B,requestStatus:"rejected",aborted:(N==null?void 0:N.name)==="AbortError",condition:(N==null?void 0:N.name)==="ConditionError"})}}),T=typeof AbortController<"u"?AbortController:function(){function N(){this.signal={aborted:!1,addEventListener:function(){},dispatchEvent:function(){return!1},onabort:function(){},removeEventListener:function(){},reason:void 0,throwIfAborted:function(){}}}return N.prototype.abort=function(){},N}();function b(N){return function(L,U,B){var Y=d!=null&&d.idGenerator?d.idGenerator(N):Yce(),F=new T,X;function te(z){X=z,F.abort()}var q=function(){return Lce(this,null,function(){var z,W,Z,Ee,Oe,we,Ne;return Ace(this,function(at){switch(at.label){case 0:return at.trys.push([0,4,,5]),Ee=(z=d==null?void 0:d.condition)==null?void 0:z.call(d,N,{getState:U,extra:B}),$ce(Ee)?[4,Ee]:[3,2];case 1:Ee=at.sent(),at.label=2;case 2:if(Ee===!1||F.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};return Oe=new Promise(function(Ue,ct){return F.signal.addEventListener("abort",function(){return ct({name:"AbortError",message:X||"Aborted"})})}),L(_(Y,N,(W=d==null?void 0:d.getPendingMeta)==null?void 0:W.call(d,{requestId:Y,arg:N},{getState:U,extra:B}))),[4,Promise.race([Oe,Promise.resolve(a(N,{dispatch:L,getState:U,extra:B,requestId:Y,signal:F.signal,abort:te,rejectWithValue:function(Ue,ct){return new Hw(Ue,ct)},fulfillWithValue:function(Ue,ct){return new C3(Ue,ct)}})).then(function(Ue){if(Ue instanceof Hw)throw Ue;return Ue instanceof C3?p(Ue.payload,Y,N,Ue.meta):p(Ue,Y,N)})])];case 3:return Z=at.sent(),[3,5];case 4:return we=at.sent(),Z=we instanceof Hw?v(null,Y,N,we.payload,we.meta):v(we,Y,N),[3,5];case 5:return Ne=d&&!d.dispatchConditionRejection&&v.match(Z)&&Z.meta.condition,Ne||L(Z),[2,Z]}})})}();return Object.assign(q,{abort:te,requestId:Y,arg:N,unwrap:function(){return q.then(Jce)}})}}return Object.assign(b,{pending:_,rejected:v,fulfilled:p,typePrefix:s})}return r.withTypes=function(){return r},r}();function Jce(r){if(r.meta&&r.meta.rejectedWithValue)throw r.payload;if(r.error)throw r.error;return r.payload}function $ce(r){return r!==null&&typeof r=="object"&&typeof r.then=="function"}var PA="listenerMiddleware";zc(PA+"/add");zc(PA+"/removeAll");zc(PA+"/remove");var w3;typeof queueMicrotask=="function"&&queueMicrotask.bind(typeof window<"u"?window:typeof global<"u"?global:globalThis);_ce();function hW(r,s){return function(){return r.apply(s,arguments)}}const{toString:Qce}=Object.prototype,{getPrototypeOf:DA}=Object,{iterator:Yy,toStringTag:pW}=Symbol,qy=(r=>s=>{const a=Qce.call(s);return r[a]||(r[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),Po=r=>(r=r.toLowerCase(),s=>qy(s)===r),Xy=r=>s=>typeof s===r,{isArray:Sh}=Array,fh=Xy("undefined");function fm(r){return r!==null&&!fh(r)&&r.constructor!==null&&!fh(r.constructor)&&Xi(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const fW=Po("ArrayBuffer");function Zce(r){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(r):s=r&&r.buffer&&fW(r.buffer),s}const ele=Xy("string"),Xi=Xy("function"),mW=Xy("number"),mm=r=>r!==null&&typeof r=="object",tle=r=>r===!0||r===!1,ov=r=>{if(qy(r)!=="object")return!1;const s=DA(r);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(pW in r)&&!(Yy in r)},nle=r=>{if(!mm(r)||fm(r))return!1;try{return Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}catch{return!1}},rle=Po("Date"),ile=Po("File"),sle=Po("Blob"),ole=Po("FileList"),ale=r=>mm(r)&&Xi(r.pipe),cle=r=>{let s;return r&&(typeof FormData=="function"&&r instanceof FormData||Xi(r.append)&&((s=qy(r))==="formdata"||s==="object"&&Xi(r.toString)&&r.toString()==="[object FormData]"))},lle=Po("URLSearchParams"),[dle,ule,hle,ple]=["ReadableStream","Request","Response","Headers"].map(Po),fle=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _m(r,s,{allOwnKeys:a=!1}={}){if(r===null||typeof r>"u")return;let d,p;if(typeof r!="object"&&(r=[r]),Sh(r))for(d=0,p=r.length;d<p;d++)s.call(null,r[d],d,r);else{if(fm(r))return;const _=a?Object.getOwnPropertyNames(r):Object.keys(r),v=_.length;let T;for(d=0;d<v;d++)T=_[d],s.call(null,r[T],T,r)}}function _W(r,s){if(fm(r))return null;s=s.toLowerCase();const a=Object.keys(r);let d=a.length,p;for(;d-- >0;)if(p=a[d],s===p.toLowerCase())return p;return null}const Jl=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,gW=r=>!fh(r)&&r!==Jl;function sI(){const{caseless:r,skipUndefined:s}=gW(this)&&this||{},a={},d=(p,_)=>{const v=r&&_W(a,_)||_;ov(a[v])&&ov(p)?a[v]=sI(a[v],p):ov(p)?a[v]=sI({},p):Sh(p)?a[v]=p.slice():(!s||!fh(p))&&(a[v]=p)};for(let p=0,_=arguments.length;p<_;p++)arguments[p]&&_m(arguments[p],d);return a}const mle=(r,s,a,{allOwnKeys:d}={})=>(_m(s,(p,_)=>{a&&Xi(p)?r[_]=hW(p,a):r[_]=p},{allOwnKeys:d}),r),_le=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),gle=(r,s,a,d)=>{r.prototype=Object.create(s.prototype,d),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:s.prototype}),a&&Object.assign(r.prototype,a)},Ele=(r,s,a,d)=>{let p,_,v;const T={};if(s=s||{},r==null)return s;do{for(p=Object.getOwnPropertyNames(r),_=p.length;_-- >0;)v=p[_],(!d||d(v,r,s))&&!T[v]&&(s[v]=r[v],T[v]=!0);r=a!==!1&&DA(r)}while(r&&(!a||a(r,s))&&r!==Object.prototype);return s},vle=(r,s,a)=>{r=String(r),(a===void 0||a>r.length)&&(a=r.length),a-=s.length;const d=r.indexOf(s,a);return d!==-1&&d===a},yle=r=>{if(!r)return null;if(Sh(r))return r;let s=r.length;if(!mW(s))return null;const a=new Array(s);for(;s-- >0;)a[s]=r[s];return a},Sle=(r=>s=>r&&s instanceof r)(typeof Uint8Array<"u"&&DA(Uint8Array)),Tle=(r,s)=>{const d=(r&&r[Yy]).call(r);let p;for(;(p=d.next())&&!p.done;){const _=p.value;s.call(r,_[0],_[1])}},Rle=(r,s)=>{let a;const d=[];for(;(a=r.exec(s))!==null;)d.push(a);return d},Cle=Po("HTMLFormElement"),wle=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,d,p){return d.toUpperCase()+p}),b3=(({hasOwnProperty:r})=>(s,a)=>r.call(s,a))(Object.prototype),ble=Po("RegExp"),EW=(r,s)=>{const a=Object.getOwnPropertyDescriptors(r),d={};_m(a,(p,_)=>{let v;(v=s(p,_,r))!==!1&&(d[_]=v||p)}),Object.defineProperties(r,d)},Ile=r=>{EW(r,(s,a)=>{if(Xi(r)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const d=r[a];if(Xi(d)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},Ale=(r,s)=>{const a={},d=p=>{p.forEach(_=>{a[_]=!0})};return Sh(r)?d(r):d(String(r).split(s)),a},Ole=()=>{},Nle=(r,s)=>r!=null&&Number.isFinite(r=+r)?r:s;function Ple(r){return!!(r&&Xi(r.append)&&r[pW]==="FormData"&&r[Yy])}const Dle=r=>{const s=new Array(10),a=(d,p)=>{if(mm(d)){if(s.indexOf(d)>=0)return;if(fm(d))return d;if(!("toJSON"in d)){s[p]=d;const _=Sh(d)?[]:{};return _m(d,(v,T)=>{const b=a(v,p+1);!fh(b)&&(_[T]=b)}),s[p]=void 0,_}}return d};return a(r,0)},kle=Po("AsyncFunction"),Lle=r=>r&&(mm(r)||Xi(r))&&Xi(r.then)&&Xi(r.catch),vW=((r,s)=>r?setImmediate:s?((a,d)=>(Jl.addEventListener("message",({source:p,data:_})=>{p===Jl&&_===a&&d.length&&d.shift()()},!1),p=>{d.push(p),Jl.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",Xi(Jl.postMessage)),Mle=typeof queueMicrotask<"u"?queueMicrotask.bind(Jl):typeof process<"u"&&process.nextTick||vW,xle=r=>r!=null&&Xi(r[Yy]),_e={isArray:Sh,isArrayBuffer:fW,isBuffer:fm,isFormData:cle,isArrayBufferView:Zce,isString:ele,isNumber:mW,isBoolean:tle,isObject:mm,isPlainObject:ov,isEmptyObject:nle,isReadableStream:dle,isRequest:ule,isResponse:hle,isHeaders:ple,isUndefined:fh,isDate:rle,isFile:ile,isBlob:sle,isRegExp:ble,isFunction:Xi,isStream:ale,isURLSearchParams:lle,isTypedArray:Sle,isFileList:ole,forEach:_m,merge:sI,extend:mle,trim:fle,stripBOM:_le,inherits:gle,toFlatObject:Ele,kindOf:qy,kindOfTest:Po,endsWith:vle,toArray:yle,forEachEntry:Tle,matchAll:Rle,isHTMLForm:Cle,hasOwnProperty:b3,hasOwnProp:b3,reduceDescriptors:EW,freezeMethods:Ile,toObjectSet:Ale,toCamelCase:wle,noop:Ole,toFiniteNumber:Nle,findKey:_W,global:Jl,isContextDefined:gW,isSpecCompliantForm:Ple,toJSONObject:Dle,isAsyncFn:kle,isThenable:Lle,setImmediate:vW,asap:Mle,isIterable:xle};function Lt(r,s,a,d,p){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",s&&(this.code=s),a&&(this.config=a),d&&(this.request=d),p&&(this.response=p,this.status=p.status?p.status:null)}_e.inherits(Lt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_e.toJSONObject(this.config),code:this.code,status:this.status}}});const yW=Lt.prototype,SW={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{SW[r]={value:r}});Object.defineProperties(Lt,SW);Object.defineProperty(yW,"isAxiosError",{value:!0});Lt.from=(r,s,a,d,p,_)=>{const v=Object.create(yW);_e.toFlatObject(r,v,function(L){return L!==Error.prototype},N=>N!=="isAxiosError");const T=r&&r.message?r.message:"Error",b=s==null&&r?r.code:s;return Lt.call(v,T,b,a,d,p),r&&v.cause==null&&Object.defineProperty(v,"cause",{value:r,configurable:!0}),v.name=r&&r.name||"Error",_&&Object.assign(v,_),v};const Ule=null;function oI(r){return _e.isPlainObject(r)||_e.isArray(r)}function TW(r){return _e.endsWith(r,"[]")?r.slice(0,-2):r}function I3(r,s,a){return r?r.concat(s).map(function(p,_){return p=TW(p),!a&&_?"["+p+"]":p}).join(a?".":""):s}function Vle(r){return _e.isArray(r)&&!r.some(oI)}const jle=_e.toFlatObject(_e,{},null,function(s){return/^is[A-Z]/.test(s)});function Jy(r,s,a){if(!_e.isObject(r))throw new TypeError("target must be an object");s=s||new FormData,a=_e.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(X,te){return!_e.isUndefined(te[X])});const d=a.metaTokens,p=a.visitor||L,_=a.dots,v=a.indexes,b=(a.Blob||typeof Blob<"u"&&Blob)&&_e.isSpecCompliantForm(s);if(!_e.isFunction(p))throw new TypeError("visitor must be a function");function N(F){if(F===null)return"";if(_e.isDate(F))return F.toISOString();if(_e.isBoolean(F))return F.toString();if(!b&&_e.isBlob(F))throw new Lt("Blob is not supported. Use a Buffer instead.");return _e.isArrayBuffer(F)||_e.isTypedArray(F)?b&&typeof Blob=="function"?new Blob([F]):Buffer.from(F):F}function L(F,X,te){let q=F;if(F&&!te&&typeof F=="object"){if(_e.endsWith(X,"{}"))X=d?X:X.slice(0,-2),F=JSON.stringify(F);else if(_e.isArray(F)&&Vle(F)||(_e.isFileList(F)||_e.endsWith(X,"[]"))&&(q=_e.toArray(F)))return X=TW(X),q.forEach(function(W,Z){!(_e.isUndefined(W)||W===null)&&s.append(v===!0?I3([X],Z,_):v===null?X:X+"[]",N(W))}),!1}return oI(F)?!0:(s.append(I3(te,X,_),N(F)),!1)}const U=[],B=Object.assign(jle,{defaultVisitor:L,convertValue:N,isVisitable:oI});function Y(F,X){if(!_e.isUndefined(F)){if(U.indexOf(F)!==-1)throw Error("Circular reference detected in "+X.join("."));U.push(F),_e.forEach(F,function(q,z){(!(_e.isUndefined(q)||q===null)&&p.call(s,q,_e.isString(z)?z.trim():z,X,B))===!0&&Y(q,X?X.concat(z):[z])}),U.pop()}}if(!_e.isObject(r))throw new TypeError("data must be an object");return Y(r),s}function A3(r){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(d){return s[d]})}function kA(r,s){this._pairs=[],r&&Jy(r,this,s)}const RW=kA.prototype;RW.append=function(s,a){this._pairs.push([s,a])};RW.toString=function(s){const a=s?function(d){return s.call(this,d,A3)}:A3;return this._pairs.map(function(p){return a(p[0])+"="+a(p[1])},"").join("&")};function Fle(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function CW(r,s,a){if(!s)return r;const d=a&&a.encode||Fle;_e.isFunction(a)&&(a={serialize:a});const p=a&&a.serialize;let _;if(p?_=p(s,a):_=_e.isURLSearchParams(s)?s.toString():new kA(s,a).toString(d),_){const v=r.indexOf("#");v!==-1&&(r=r.slice(0,v)),r+=(r.indexOf("?")===-1?"?":"&")+_}return r}class O3{constructor(){this.handlers=[]}use(s,a,d){return this.handlers.push({fulfilled:s,rejected:a,synchronous:d?d.synchronous:!1,runWhen:d?d.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){_e.forEach(this.handlers,function(d){d!==null&&s(d)})}}const wW={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ble=typeof URLSearchParams<"u"?URLSearchParams:kA,Wle=typeof FormData<"u"?FormData:null,Gle=typeof Blob<"u"?Blob:null,Hle={isBrowser:!0,classes:{URLSearchParams:Ble,FormData:Wle,Blob:Gle},protocols:["http","https","file","blob","url","data"]},LA=typeof window<"u"&&typeof document<"u",aI=typeof navigator=="object"&&navigator||void 0,Kle=LA&&(!aI||["ReactNative","NativeScript","NS"].indexOf(aI.product)<0),zle=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Yle=LA&&window.location.href||"http://localhost",qle=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:LA,hasStandardBrowserEnv:Kle,hasStandardBrowserWebWorkerEnv:zle,navigator:aI,origin:Yle},Symbol.toStringTag,{value:"Module"})),fi={...qle,...Hle};function Xle(r,s){return Jy(r,new fi.classes.URLSearchParams,{visitor:function(a,d,p,_){return fi.isNode&&_e.isBuffer(a)?(this.append(d,a.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)},...s})}function Jle(r){return _e.matchAll(/\w+|\[(\w*)]/g,r).map(s=>s[0]==="[]"?"":s[1]||s[0])}function $le(r){const s={},a=Object.keys(r);let d;const p=a.length;let _;for(d=0;d<p;d++)_=a[d],s[_]=r[_];return s}function bW(r){function s(a,d,p,_){let v=a[_++];if(v==="__proto__")return!0;const T=Number.isFinite(+v),b=_>=a.length;return v=!v&&_e.isArray(p)?p.length:v,b?(_e.hasOwnProp(p,v)?p[v]=[p[v],d]:p[v]=d,!T):((!p[v]||!_e.isObject(p[v]))&&(p[v]=[]),s(a,d,p[v],_)&&_e.isArray(p[v])&&(p[v]=$le(p[v])),!T)}if(_e.isFormData(r)&&_e.isFunction(r.entries)){const a={};return _e.forEachEntry(r,(d,p)=>{s(Jle(d),p,a,0)}),a}return null}function Qle(r,s,a){if(_e.isString(r))try{return(s||JSON.parse)(r),_e.trim(r)}catch(d){if(d.name!=="SyntaxError")throw d}return(a||JSON.stringify)(r)}const gm={transitional:wW,adapter:["xhr","http","fetch"],transformRequest:[function(s,a){const d=a.getContentType()||"",p=d.indexOf("application/json")>-1,_=_e.isObject(s);if(_&&_e.isHTMLForm(s)&&(s=new FormData(s)),_e.isFormData(s))return p?JSON.stringify(bW(s)):s;if(_e.isArrayBuffer(s)||_e.isBuffer(s)||_e.isStream(s)||_e.isFile(s)||_e.isBlob(s)||_e.isReadableStream(s))return s;if(_e.isArrayBufferView(s))return s.buffer;if(_e.isURLSearchParams(s))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let T;if(_){if(d.indexOf("application/x-www-form-urlencoded")>-1)return Xle(s,this.formSerializer).toString();if((T=_e.isFileList(s))||d.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return Jy(T?{"files[]":s}:s,b&&new b,this.formSerializer)}}return _||p?(a.setContentType("application/json",!1),Qle(s)):s}],transformResponse:[function(s){const a=this.transitional||gm.transitional,d=a&&a.forcedJSONParsing,p=this.responseType==="json";if(_e.isResponse(s)||_e.isReadableStream(s))return s;if(s&&_e.isString(s)&&(d&&!this.responseType||p)){const v=!(a&&a.silentJSONParsing)&&p;try{return JSON.parse(s,this.parseReviver)}catch(T){if(v)throw T.name==="SyntaxError"?Lt.from(T,Lt.ERR_BAD_RESPONSE,this,null,this.response):T}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fi.classes.FormData,Blob:fi.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_e.forEach(["delete","get","head","post","put","patch"],r=>{gm.headers[r]={}});const Zle=_e.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ede=r=>{const s={};let a,d,p;return r&&r.split(`
`).forEach(function(v){p=v.indexOf(":"),a=v.substring(0,p).trim().toLowerCase(),d=v.substring(p+1).trim(),!(!a||s[a]&&Zle[a])&&(a==="set-cookie"?s[a]?s[a].push(d):s[a]=[d]:s[a]=s[a]?s[a]+", "+d:d)}),s},N3=Symbol("internals");function ff(r){return r&&String(r).trim().toLowerCase()}function av(r){return r===!1||r==null?r:_e.isArray(r)?r.map(av):String(r)}function tde(r){const s=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=a.exec(r);)s[d[1]]=d[2];return s}const nde=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Kw(r,s,a,d,p){if(_e.isFunction(d))return d.call(this,s,a);if(p&&(s=a),!!_e.isString(s)){if(_e.isString(d))return s.indexOf(d)!==-1;if(_e.isRegExp(d))return d.test(s)}}function rde(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,a,d)=>a.toUpperCase()+d)}function ide(r,s){const a=_e.toCamelCase(" "+s);["get","set","has"].forEach(d=>{Object.defineProperty(r,d+a,{value:function(p,_,v){return this[d].call(this,s,p,_,v)},configurable:!0})})}let Ji=class{constructor(s){s&&this.set(s)}set(s,a,d){const p=this;function _(T,b,N){const L=ff(b);if(!L)throw new Error("header name must be a non-empty string");const U=_e.findKey(p,L);(!U||p[U]===void 0||N===!0||N===void 0&&p[U]!==!1)&&(p[U||b]=av(T))}const v=(T,b)=>_e.forEach(T,(N,L)=>_(N,L,b));if(_e.isPlainObject(s)||s instanceof this.constructor)v(s,a);else if(_e.isString(s)&&(s=s.trim())&&!nde(s))v(ede(s),a);else if(_e.isObject(s)&&_e.isIterable(s)){let T={},b,N;for(const L of s){if(!_e.isArray(L))throw TypeError("Object iterator must return a key-value pair");T[N=L[0]]=(b=T[N])?_e.isArray(b)?[...b,L[1]]:[b,L[1]]:L[1]}v(T,a)}else s!=null&&_(a,s,d);return this}get(s,a){if(s=ff(s),s){const d=_e.findKey(this,s);if(d){const p=this[d];if(!a)return p;if(a===!0)return tde(p);if(_e.isFunction(a))return a.call(this,p,d);if(_e.isRegExp(a))return a.exec(p);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,a){if(s=ff(s),s){const d=_e.findKey(this,s);return!!(d&&this[d]!==void 0&&(!a||Kw(this,this[d],d,a)))}return!1}delete(s,a){const d=this;let p=!1;function _(v){if(v=ff(v),v){const T=_e.findKey(d,v);T&&(!a||Kw(d,d[T],T,a))&&(delete d[T],p=!0)}}return _e.isArray(s)?s.forEach(_):_(s),p}clear(s){const a=Object.keys(this);let d=a.length,p=!1;for(;d--;){const _=a[d];(!s||Kw(this,this[_],_,s,!0))&&(delete this[_],p=!0)}return p}normalize(s){const a=this,d={};return _e.forEach(this,(p,_)=>{const v=_e.findKey(d,_);if(v){a[v]=av(p),delete a[_];return}const T=s?rde(_):String(_).trim();T!==_&&delete a[_],a[T]=av(p),d[T]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const a=Object.create(null);return _e.forEach(this,(d,p)=>{d!=null&&d!==!1&&(a[p]=s&&_e.isArray(d)?d.join(", "):d)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,a])=>s+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...a){const d=new this(s);return a.forEach(p=>d.set(p)),d}static accessor(s){const d=(this[N3]=this[N3]={accessors:{}}).accessors,p=this.prototype;function _(v){const T=ff(v);d[T]||(ide(p,v),d[T]=!0)}return _e.isArray(s)?s.forEach(_):_(s),this}};Ji.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);_e.reduceDescriptors(Ji.prototype,({value:r},s)=>{let a=s[0].toUpperCase()+s.slice(1);return{get:()=>r,set(d){this[a]=d}}});_e.freezeMethods(Ji);function zw(r,s){const a=this||gm,d=s||a,p=Ji.from(d.headers);let _=d.data;return _e.forEach(r,function(T){_=T.call(a,_,p.normalize(),s?s.status:void 0)}),p.normalize(),_}function IW(r){return!!(r&&r.__CANCEL__)}function Th(r,s,a){Lt.call(this,r??"canceled",Lt.ERR_CANCELED,s,a),this.name="CanceledError"}_e.inherits(Th,Lt,{__CANCEL__:!0});function AW(r,s,a){const d=a.config.validateStatus;!a.status||!d||d(a.status)?r(a):s(new Lt("Request failed with status code "+a.status,[Lt.ERR_BAD_REQUEST,Lt.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function sde(r){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return s&&s[1]||""}function ode(r,s){r=r||10;const a=new Array(r),d=new Array(r);let p=0,_=0,v;return s=s!==void 0?s:1e3,function(b){const N=Date.now(),L=d[_];v||(v=N),a[p]=b,d[p]=N;let U=_,B=0;for(;U!==p;)B+=a[U++],U=U%r;if(p=(p+1)%r,p===_&&(_=(_+1)%r),N-v<s)return;const Y=L&&N-L;return Y?Math.round(B*1e3/Y):void 0}}function ade(r,s){let a=0,d=1e3/s,p,_;const v=(N,L=Date.now())=>{a=L,p=null,_&&(clearTimeout(_),_=null),r(...N)};return[(...N)=>{const L=Date.now(),U=L-a;U>=d?v(N,L):(p=N,_||(_=setTimeout(()=>{_=null,v(p)},d-U)))},()=>p&&v(p)]}const ty=(r,s,a=3)=>{let d=0;const p=ode(50,250);return ade(_=>{const v=_.loaded,T=_.lengthComputable?_.total:void 0,b=v-d,N=p(b),L=v<=T;d=v;const U={loaded:v,total:T,progress:T?v/T:void 0,bytes:b,rate:N||void 0,estimated:N&&T&&L?(T-v)/N:void 0,event:_,lengthComputable:T!=null,[s?"download":"upload"]:!0};r(U)},a)},P3=(r,s)=>{const a=r!=null;return[d=>s[0]({lengthComputable:a,total:r,loaded:d}),s[1]]},D3=r=>(...s)=>_e.asap(()=>r(...s)),cde=fi.hasStandardBrowserEnv?((r,s)=>a=>(a=new URL(a,fi.origin),r.protocol===a.protocol&&r.host===a.host&&(s||r.port===a.port)))(new URL(fi.origin),fi.navigator&&/(msie|trident)/i.test(fi.navigator.userAgent)):()=>!0,lde=fi.hasStandardBrowserEnv?{write(r,s,a,d,p,_){const v=[r+"="+encodeURIComponent(s)];_e.isNumber(a)&&v.push("expires="+new Date(a).toGMTString()),_e.isString(d)&&v.push("path="+d),_e.isString(p)&&v.push("domain="+p),_===!0&&v.push("secure"),document.cookie=v.join("; ")},read(r){const s=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function dde(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ude(r,s){return s?r.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):r}function OW(r,s,a){let d=!dde(s);return r&&(d||a==!1)?ude(r,s):s}const k3=r=>r instanceof Ji?{...r}:r;function ld(r,s){s=s||{};const a={};function d(N,L,U,B){return _e.isPlainObject(N)&&_e.isPlainObject(L)?_e.merge.call({caseless:B},N,L):_e.isPlainObject(L)?_e.merge({},L):_e.isArray(L)?L.slice():L}function p(N,L,U,B){if(_e.isUndefined(L)){if(!_e.isUndefined(N))return d(void 0,N,U,B)}else return d(N,L,U,B)}function _(N,L){if(!_e.isUndefined(L))return d(void 0,L)}function v(N,L){if(_e.isUndefined(L)){if(!_e.isUndefined(N))return d(void 0,N)}else return d(void 0,L)}function T(N,L,U){if(U in s)return d(N,L);if(U in r)return d(void 0,N)}const b={url:_,method:_,data:_,baseURL:v,transformRequest:v,transformResponse:v,paramsSerializer:v,timeout:v,timeoutMessage:v,withCredentials:v,withXSRFToken:v,adapter:v,responseType:v,xsrfCookieName:v,xsrfHeaderName:v,onUploadProgress:v,onDownloadProgress:v,decompress:v,maxContentLength:v,maxBodyLength:v,beforeRedirect:v,transport:v,httpAgent:v,httpsAgent:v,cancelToken:v,socketPath:v,responseEncoding:v,validateStatus:T,headers:(N,L,U)=>p(k3(N),k3(L),U,!0)};return _e.forEach(Object.keys({...r,...s}),function(L){const U=b[L]||p,B=U(r[L],s[L],L);_e.isUndefined(B)&&U!==T||(a[L]=B)}),a}const NW=r=>{const s=ld({},r);let{data:a,withXSRFToken:d,xsrfHeaderName:p,xsrfCookieName:_,headers:v,auth:T}=s;if(s.headers=v=Ji.from(v),s.url=CW(OW(s.baseURL,s.url,s.allowAbsoluteUrls),r.params,r.paramsSerializer),T&&v.set("Authorization","Basic "+btoa((T.username||"")+":"+(T.password?unescape(encodeURIComponent(T.password)):""))),_e.isFormData(a)){if(fi.hasStandardBrowserEnv||fi.hasStandardBrowserWebWorkerEnv)v.setContentType(void 0);else if(_e.isFunction(a.getHeaders)){const b=a.getHeaders(),N=["content-type","content-length"];Object.entries(b).forEach(([L,U])=>{N.includes(L.toLowerCase())&&v.set(L,U)})}}if(fi.hasStandardBrowserEnv&&(d&&_e.isFunction(d)&&(d=d(s)),d||d!==!1&&cde(s.url))){const b=p&&_&&lde.read(_);b&&v.set(p,b)}return s},hde=typeof XMLHttpRequest<"u",pde=hde&&function(r){return new Promise(function(a,d){const p=NW(r);let _=p.data;const v=Ji.from(p.headers).normalize();let{responseType:T,onUploadProgress:b,onDownloadProgress:N}=p,L,U,B,Y,F;function X(){Y&&Y(),F&&F(),p.cancelToken&&p.cancelToken.unsubscribe(L),p.signal&&p.signal.removeEventListener("abort",L)}let te=new XMLHttpRequest;te.open(p.method.toUpperCase(),p.url,!0),te.timeout=p.timeout;function q(){if(!te)return;const W=Ji.from("getAllResponseHeaders"in te&&te.getAllResponseHeaders()),Ee={data:!T||T==="text"||T==="json"?te.responseText:te.response,status:te.status,statusText:te.statusText,headers:W,config:r,request:te};AW(function(we){a(we),X()},function(we){d(we),X()},Ee),te=null}"onloadend"in te?te.onloadend=q:te.onreadystatechange=function(){!te||te.readyState!==4||te.status===0&&!(te.responseURL&&te.responseURL.indexOf("file:")===0)||setTimeout(q)},te.onabort=function(){te&&(d(new Lt("Request aborted",Lt.ECONNABORTED,r,te)),te=null)},te.onerror=function(Z){const Ee=Z&&Z.message?Z.message:"Network Error",Oe=new Lt(Ee,Lt.ERR_NETWORK,r,te);Oe.event=Z||null,d(Oe),te=null},te.ontimeout=function(){let Z=p.timeout?"timeout of "+p.timeout+"ms exceeded":"timeout exceeded";const Ee=p.transitional||wW;p.timeoutErrorMessage&&(Z=p.timeoutErrorMessage),d(new Lt(Z,Ee.clarifyTimeoutError?Lt.ETIMEDOUT:Lt.ECONNABORTED,r,te)),te=null},_===void 0&&v.setContentType(null),"setRequestHeader"in te&&_e.forEach(v.toJSON(),function(Z,Ee){te.setRequestHeader(Ee,Z)}),_e.isUndefined(p.withCredentials)||(te.withCredentials=!!p.withCredentials),T&&T!=="json"&&(te.responseType=p.responseType),N&&([B,F]=ty(N,!0),te.addEventListener("progress",B)),b&&te.upload&&([U,Y]=ty(b),te.upload.addEventListener("progress",U),te.upload.addEventListener("loadend",Y)),(p.cancelToken||p.signal)&&(L=W=>{te&&(d(!W||W.type?new Th(null,r,te):W),te.abort(),te=null)},p.cancelToken&&p.cancelToken.subscribe(L),p.signal&&(p.signal.aborted?L():p.signal.addEventListener("abort",L)));const z=sde(p.url);if(z&&fi.protocols.indexOf(z)===-1){d(new Lt("Unsupported protocol "+z+":",Lt.ERR_BAD_REQUEST,r));return}te.send(_||null)})},fde=(r,s)=>{const{length:a}=r=r?r.filter(Boolean):[];if(s||a){let d=new AbortController,p;const _=function(N){if(!p){p=!0,T();const L=N instanceof Error?N:this.reason;d.abort(L instanceof Lt?L:new Th(L instanceof Error?L.message:L))}};let v=s&&setTimeout(()=>{v=null,_(new Lt(`timeout ${s} of ms exceeded`,Lt.ETIMEDOUT))},s);const T=()=>{r&&(v&&clearTimeout(v),v=null,r.forEach(N=>{N.unsubscribe?N.unsubscribe(_):N.removeEventListener("abort",_)}),r=null)};r.forEach(N=>N.addEventListener("abort",_));const{signal:b}=d;return b.unsubscribe=()=>_e.asap(T),b}},mde=function*(r,s){let a=r.byteLength;if(a<s){yield r;return}let d=0,p;for(;d<a;)p=d+s,yield r.slice(d,p),d=p},_de=async function*(r,s){for await(const a of gde(r))yield*mde(a,s)},gde=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const s=r.getReader();try{for(;;){const{done:a,value:d}=await s.read();if(a)break;yield d}}finally{await s.cancel()}},L3=(r,s,a,d)=>{const p=_de(r,s);let _=0,v,T=b=>{v||(v=!0,d&&d(b))};return new ReadableStream({async pull(b){try{const{done:N,value:L}=await p.next();if(N){T(),b.close();return}let U=L.byteLength;if(a){let B=_+=U;a(B)}b.enqueue(new Uint8Array(L))}catch(N){throw T(N),N}},cancel(b){return T(b),p.return()}},{highWaterMark:2})},M3=64*1024,{isFunction:HE}=_e,Ede=(({Request:r,Response:s})=>({Request:r,Response:s}))(_e.global),{ReadableStream:x3,TextEncoder:U3}=_e.global,V3=(r,...s)=>{try{return!!r(...s)}catch{return!1}},vde=r=>{r=_e.merge.call({skipUndefined:!0},Ede,r);const{fetch:s,Request:a,Response:d}=r,p=s?HE(s):typeof fetch=="function",_=HE(a),v=HE(d);if(!p)return!1;const T=p&&HE(x3),b=p&&(typeof U3=="function"?(F=>X=>F.encode(X))(new U3):async F=>new Uint8Array(await new a(F).arrayBuffer())),N=_&&T&&V3(()=>{let F=!1;const X=new a(fi.origin,{body:new x3,method:"POST",get duplex(){return F=!0,"half"}}).headers.has("Content-Type");return F&&!X}),L=v&&T&&V3(()=>_e.isReadableStream(new d("").body)),U={stream:L&&(F=>F.body)};p&&["text","arrayBuffer","blob","formData","stream"].forEach(F=>{!U[F]&&(U[F]=(X,te)=>{let q=X&&X[F];if(q)return q.call(X);throw new Lt(`Response type '${F}' is not supported`,Lt.ERR_NOT_SUPPORT,te)})});const B=async F=>{if(F==null)return 0;if(_e.isBlob(F))return F.size;if(_e.isSpecCompliantForm(F))return(await new a(fi.origin,{method:"POST",body:F}).arrayBuffer()).byteLength;if(_e.isArrayBufferView(F)||_e.isArrayBuffer(F))return F.byteLength;if(_e.isURLSearchParams(F)&&(F=F+""),_e.isString(F))return(await b(F)).byteLength},Y=async(F,X)=>{const te=_e.toFiniteNumber(F.getContentLength());return te??B(X)};return async F=>{let{url:X,method:te,data:q,signal:z,cancelToken:W,timeout:Z,onDownloadProgress:Ee,onUploadProgress:Oe,responseType:we,headers:Ne,withCredentials:at="same-origin",fetchOptions:Ue}=NW(F),ct=s||fetch;we=we?(we+"").toLowerCase():"text";let Ze=fde([z,W&&W.toAbortSignal()],Z),Kt=null;const Mt=Ze&&Ze.unsubscribe&&(()=>{Ze.unsubscribe()});let dr;try{if(Oe&&N&&te!=="get"&&te!=="head"&&(dr=await Y(Ne,q))!==0){let ke=new a(X,{method:"POST",body:q,duplex:"half"}),qe;if(_e.isFormData(q)&&(qe=ke.headers.get("content-type"))&&Ne.setContentType(qe),ke.body){const[Ie,Et]=P3(dr,ty(D3(Oe)));q=L3(ke.body,M3,Ie,Et)}}_e.isString(at)||(at=at?"include":"omit");const en=_&&"credentials"in a.prototype,Ae={...Ue,signal:Ze,method:te.toUpperCase(),headers:Ne.normalize().toJSON(),body:q,duplex:"half",credentials:en?at:void 0};Kt=_&&new a(X,Ae);let fe=await(_?ct(Kt,Ue):ct(X,Ae));const ce=L&&(we==="stream"||we==="response");if(L&&(Ee||ce&&Mt)){const ke={};["status","statusText","headers"].forEach(vt=>{ke[vt]=fe[vt]});const qe=_e.toFiniteNumber(fe.headers.get("content-length")),[Ie,Et]=Ee&&P3(qe,ty(D3(Ee),!0))||[];fe=new d(L3(fe.body,M3,Ie,()=>{Et&&Et(),Mt&&Mt()}),ke)}we=we||"text";let me=await U[_e.findKey(U,we)||"text"](fe,F);return!ce&&Mt&&Mt(),await new Promise((ke,qe)=>{AW(ke,qe,{data:me,headers:Ji.from(fe.headers),status:fe.status,statusText:fe.statusText,config:F,request:Kt})})}catch(en){throw Mt&&Mt(),en&&en.name==="TypeError"&&/Load failed|fetch/i.test(en.message)?Object.assign(new Lt("Network Error",Lt.ERR_NETWORK,F,Kt),{cause:en.cause||en}):Lt.from(en,en&&en.code,F,Kt)}}},yde=new Map,PW=r=>{let s=r?r.env:{};const{fetch:a,Request:d,Response:p}=s,_=[d,p,a];let v=_.length,T=v,b,N,L=yde;for(;T--;)b=_[T],N=L.get(b),N===void 0&&L.set(b,N=T?new Map:vde(s)),L=N;return N};PW();const cI={http:Ule,xhr:pde,fetch:{get:PW}};_e.forEach(cI,(r,s)=>{if(r){try{Object.defineProperty(r,"name",{value:s})}catch{}Object.defineProperty(r,"adapterName",{value:s})}});const j3=r=>`- ${r}`,Sde=r=>_e.isFunction(r)||r===null||r===!1,DW={getAdapter:(r,s)=>{r=_e.isArray(r)?r:[r];const{length:a}=r;let d,p;const _={};for(let v=0;v<a;v++){d=r[v];let T;if(p=d,!Sde(d)&&(p=cI[(T=String(d)).toLowerCase()],p===void 0))throw new Lt(`Unknown adapter '${T}'`);if(p&&(_e.isFunction(p)||(p=p.get(s))))break;_[T||"#"+v]=p}if(!p){const v=Object.entries(_).map(([b,N])=>`adapter ${b} `+(N===!1?"is not supported by the environment":"is not available in the build"));let T=a?v.length>1?`since :
`+v.map(j3).join(`
`):" "+j3(v[0]):"as no adapter specified";throw new Lt("There is no suitable adapter to dispatch the request "+T,"ERR_NOT_SUPPORT")}return p},adapters:cI};function Yw(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Th(null,r)}function F3(r){return Yw(r),r.headers=Ji.from(r.headers),r.data=zw.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),DW.getAdapter(r.adapter||gm.adapter,r)(r).then(function(d){return Yw(r),d.data=zw.call(r,r.transformResponse,d),d.headers=Ji.from(d.headers),d},function(d){return IW(d)||(Yw(r),d&&d.response&&(d.response.data=zw.call(r,r.transformResponse,d.response),d.response.headers=Ji.from(d.response.headers))),Promise.reject(d)})}const kW="1.12.2",$y={};["object","boolean","number","function","string","symbol"].forEach((r,s)=>{$y[r]=function(d){return typeof d===r||"a"+(s<1?"n ":" ")+r}});const B3={};$y.transitional=function(s,a,d){function p(_,v){return"[Axios v"+kW+"] Transitional option '"+_+"'"+v+(d?". "+d:"")}return(_,v,T)=>{if(s===!1)throw new Lt(p(v," has been removed"+(a?" in "+a:"")),Lt.ERR_DEPRECATED);return a&&!B3[v]&&(B3[v]=!0,console.warn(p(v," has been deprecated since v"+a+" and will be removed in the near future"))),s?s(_,v,T):!0}};$y.spelling=function(s){return(a,d)=>(console.warn(`${d} is likely a misspelling of ${s}`),!0)};function Tde(r,s,a){if(typeof r!="object")throw new Lt("options must be an object",Lt.ERR_BAD_OPTION_VALUE);const d=Object.keys(r);let p=d.length;for(;p-- >0;){const _=d[p],v=s[_];if(v){const T=r[_],b=T===void 0||v(T,_,r);if(b!==!0)throw new Lt("option "+_+" must be "+b,Lt.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Lt("Unknown option "+_,Lt.ERR_BAD_OPTION)}}const cv={assertOptions:Tde,validators:$y},ta=cv.validators;let td=class{constructor(s){this.defaults=s||{},this.interceptors={request:new O3,response:new O3}}async request(s,a){try{return await this._request(s,a)}catch(d){if(d instanceof Error){let p={};Error.captureStackTrace?Error.captureStackTrace(p):p=new Error;const _=p.stack?p.stack.replace(/^.+\n/,""):"";try{d.stack?_&&!String(d.stack).endsWith(_.replace(/^.+\n.+\n/,""))&&(d.stack+=`
`+_):d.stack=_}catch{}}throw d}}_request(s,a){typeof s=="string"?(a=a||{},a.url=s):a=s||{},a=ld(this.defaults,a);const{transitional:d,paramsSerializer:p,headers:_}=a;d!==void 0&&cv.assertOptions(d,{silentJSONParsing:ta.transitional(ta.boolean),forcedJSONParsing:ta.transitional(ta.boolean),clarifyTimeoutError:ta.transitional(ta.boolean)},!1),p!=null&&(_e.isFunction(p)?a.paramsSerializer={serialize:p}:cv.assertOptions(p,{encode:ta.function,serialize:ta.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),cv.assertOptions(a,{baseUrl:ta.spelling("baseURL"),withXsrfToken:ta.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let v=_&&_e.merge(_.common,_[a.method]);_&&_e.forEach(["delete","get","head","post","put","patch","common"],F=>{delete _[F]}),a.headers=Ji.concat(v,_);const T=[];let b=!0;this.interceptors.request.forEach(function(X){typeof X.runWhen=="function"&&X.runWhen(a)===!1||(b=b&&X.synchronous,T.unshift(X.fulfilled,X.rejected))});const N=[];this.interceptors.response.forEach(function(X){N.push(X.fulfilled,X.rejected)});let L,U=0,B;if(!b){const F=[F3.bind(this),void 0];for(F.unshift(...T),F.push(...N),B=F.length,L=Promise.resolve(a);U<B;)L=L.then(F[U++],F[U++]);return L}B=T.length;let Y=a;for(;U<B;){const F=T[U++],X=T[U++];try{Y=F(Y)}catch(te){X.call(this,te);break}}try{L=F3.call(this,Y)}catch(F){return Promise.reject(F)}for(U=0,B=N.length;U<B;)L=L.then(N[U++],N[U++]);return L}getUri(s){s=ld(this.defaults,s);const a=OW(s.baseURL,s.url,s.allowAbsoluteUrls);return CW(a,s.params,s.paramsSerializer)}};_e.forEach(["delete","get","head","options"],function(s){td.prototype[s]=function(a,d){return this.request(ld(d||{},{method:s,url:a,data:(d||{}).data}))}});_e.forEach(["post","put","patch"],function(s){function a(d){return function(_,v,T){return this.request(ld(T||{},{method:s,headers:d?{"Content-Type":"multipart/form-data"}:{},url:_,data:v}))}}td.prototype[s]=a(),td.prototype[s+"Form"]=a(!0)});let Rde=class LW{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(_){a=_});const d=this;this.promise.then(p=>{if(!d._listeners)return;let _=d._listeners.length;for(;_-- >0;)d._listeners[_](p);d._listeners=null}),this.promise.then=p=>{let _;const v=new Promise(T=>{d.subscribe(T),_=T}).then(p);return v.cancel=function(){d.unsubscribe(_)},v},s(function(_,v,T){d.reason||(d.reason=new Th(_,v,T),a(d.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const a=this._listeners.indexOf(s);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const s=new AbortController,a=d=>{s.abort(d)};return this.subscribe(a),s.signal.unsubscribe=()=>this.unsubscribe(a),s.signal}static source(){let s;return{token:new LW(function(p){s=p}),cancel:s}}};function Cde(r){return function(a){return r.apply(null,a)}}function wde(r){return _e.isObject(r)&&r.isAxiosError===!0}const lI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(lI).forEach(([r,s])=>{lI[s]=r});function MW(r){const s=new td(r),a=hW(td.prototype.request,s);return _e.extend(a,td.prototype,s,{allOwnKeys:!0}),_e.extend(a,s,null,{allOwnKeys:!0}),a.create=function(p){return MW(ld(r,p))},a}const Er=MW(gm);Er.Axios=td;Er.CanceledError=Th;Er.CancelToken=Rde;Er.isCancel=IW;Er.VERSION=kW;Er.toFormData=Jy;Er.AxiosError=Lt;Er.Cancel=Er.CanceledError;Er.all=function(s){return Promise.all(s)};Er.spread=Cde;Er.isAxiosError=wde;Er.mergeConfig=ld;Er.AxiosHeaders=Ji;Er.formToJSON=r=>bW(_e.isHTMLForm(r)?new FormData(r):r);Er.getAdapter=DW.getAdapter;Er.HttpStatusCode=lI;Er.default=Er;const{Axios:yme,AxiosError:Sme,CanceledError:Tme,isCancel:Rme,CancelToken:Cme,VERSION:wme,all:bme,Cancel:Ime,isAxiosError:Ame,spread:Ome,toFormData:Nme,AxiosHeaders:Pme,HttpStatusCode:Dme,formToJSON:kme,getAdapter:Lme,mergeConfig:Mme}=Er,bde="http://localhost:8000/api",lr=Er.create({baseURL:bde,withCredentials:!0,headers:{"Content-Type":"application/json"}});lr.interceptors.request.use(r=>{const s=localStorage.getItem("token");return s&&(r.headers.Authorization=`Bearer ${s}`),r},r=>Promise.reject(r));lr.interceptors.response.use(r=>r,async r=>{var a;const s=r.config;if(((a=r.response)==null?void 0:a.status)===401&&!s._retry){s._retry=!0;try{const d=await lr.post("/refresh");return localStorage.setItem("token",d.data.access_token),lr.defaults.headers.common.Authorization=`Bearer ${d.data.access_token}`,lr(s)}catch(d){console.error("Refresh failed",d),localStorage.removeItem("token"),window.location.href="/"}}return Promise.reject(r)});const Ide=r=>lr.post("/login",r),Ade=()=>lr.get("/me"),Ode=r=>lr.post("/register",r),Nde=r=>lr.post("/verify-otp",r),Pde=r=>lr.post("/resend-otp",r),Dde=()=>lr.post("/logout"),kde=()=>lr.post("/refresh-token"),Lde=async()=>(await lr.get("/turn-credentials")).data,lv=nr("auth/login",async(r,{rejectWithValue:s})=>{var a;try{const d=await Ide(r);return localStorage.setItem("token",d.data.token),d.data}catch(d){return s(((a=d.response)==null?void 0:a.data)||"Login failed")}}),dv=nr("auth/register",async(r,{rejectWithValue:s})=>{var a;try{const d=await Ode(r);return localStorage.setItem("token",d.data.token),d.data}catch(d){return s(((a=d.response)==null?void 0:a.data)||"Registration failed")}}),uv=nr("auth/verifyOTP",async(r,{rejectWithValue:s})=>{var a;try{return(await Nde(r)).data}catch(d){return console.error("API Error:",d),s(((a=d.response)==null?void 0:a.data)||"Verification failed")}}),Mde=nr("auth/resendOTP",async(r,{rejectWithValue:s})=>{var a;try{return(await Pde(r)).data}catch(d){return s(((a=d.response)==null?void 0:a.data)||"Failed to resend OTP")}}),xW=nr("auth/logout",async(r,{rejectWithValue:s})=>{var a;try{const d=await Dde();return localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),d.data}catch(d){return s(((a=d.response)==null?void 0:a.data)||"Logout failed")}}),W3=nr("auth/refreshToken",async(r,{rejectWithValue:s})=>{var a;try{const d=await kde();return localStorage.setItem("token",d.data.access_token),localStorage.setItem("refreshToken",d.data.refresh_token),d.data}catch(d){return localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),s(((a=d.response)==null?void 0:a.data)||"Token refresh failed")}}),UW=yh({name:"auth",initialState:{user:null,token:localStorage.getItem("token"),refreshToken:localStorage.getItem("refreshToken"),isAuthenticated:!!localStorage.getItem("token"),loading:!1,error:null},reducers:{clearError:r=>{r.error=null},setUser:(r,s)=>{r.user=s.payload},clearAuth:r=>{r.user=null,r.token=null,r.refreshToken=null,r.isAuthenticated=!1,localStorage.removeItem("token"),localStorage.removeItem("refreshToken")}},extraReducers:r=>{r.addCase(lv.pending,s=>{s.loading=!0,s.error=null}).addCase(lv.fulfilled,(s,a)=>{a.payload.needsVerification?(s.loading=!1,s.isAuthenticated=!1):(s.loading=!1,s.user=a.payload.user,s.token=a.payload.token,s.isAuthenticated=!0)}).addCase(lv.rejected,(s,a)=>{s.loading=!1,s.error=a.payload,s.isAuthenticated=!1}).addCase(dv.pending,s=>{s.loading=!0,s.error=null}).addCase(dv.fulfilled,(s,a)=>{s.loading=!1,s.error=null}).addCase(dv.rejected,(s,a)=>{s.loading=!1,s.error=a.payload,s.isAuthenticated=!1}).addCase(uv.pending,s=>{s.loading=!0}).addCase(uv.fulfilled,(s,a)=>{s.loading=!1}).addCase(uv.rejected,(s,a)=>{s.loading=!1,s.error=a.payload}).addCase(xW.fulfilled,s=>{s.user=null,s.token=null,s.refreshToken=null,s.isAuthenticated=!1,s.loading=!1,s.error=null}).addCase(W3.fulfilled,(s,a)=>{s.token=a.payload.access_token,s.refreshToken=a.payload.refresh_token,s.isAuthenticated=!0}).addCase(W3.rejected,s=>{s.user=null,s.token=null,s.refreshToken=null,s.isAuthenticated=!1})}}),{clearError:VW,setUser:xde,clearAuth:Ude}=UW.actions,Vde=UW.reducer,jde=r=>lr.get("/chats",r),Fde=r=>lr.get(`/chats/${r}/messages`),Bde=r=>lr.post("/send/messages",r),Wde=r=>lr.post("/add/reaction",r),Gde=r=>lr.get(`/users/search?q=${r}`),Hde=r=>lr.post("/add-contact",{partnerId:r}),Kde=r=>lr.post("/chats/group",r),zde=(r,s)=>lr.post("/upload/file",r,s),jW=r=>lr.post("/agora/rtc-token",r),da=Object.create(null);da.open="0";da.close="1";da.ping="2";da.pong="3";da.message="4";da.upgrade="5";da.noop="6";const hv=Object.create(null);Object.keys(da).forEach(r=>{hv[da[r]]=r});const dI={type:"error",data:"parser error"},FW=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",BW=typeof ArrayBuffer=="function",WW=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,MA=({type:r,data:s},a,d)=>FW&&s instanceof Blob?a?d(s):G3(s,d):BW&&(s instanceof ArrayBuffer||WW(s))?a?d(s):G3(new Blob([s]),d):d(da[r]+(s||"")),G3=(r,s)=>{const a=new FileReader;return a.onload=function(){const d=a.result.split(",")[1];s("b"+(d||""))},a.readAsDataURL(r)};function H3(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let qw;function Yde(r,s){if(FW&&r.data instanceof Blob)return r.data.arrayBuffer().then(H3).then(s);if(BW&&(r.data instanceof ArrayBuffer||WW(r.data)))return s(H3(r.data));MA(r,!1,a=>{qw||(qw=new TextEncoder),s(qw.encode(a))})}const K3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wf=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<K3.length;r++)wf[K3.charCodeAt(r)]=r;const qde=r=>{let s=r.length*.75,a=r.length,d,p=0,_,v,T,b;r[r.length-1]==="="&&(s--,r[r.length-2]==="="&&s--);const N=new ArrayBuffer(s),L=new Uint8Array(N);for(d=0;d<a;d+=4)_=wf[r.charCodeAt(d)],v=wf[r.charCodeAt(d+1)],T=wf[r.charCodeAt(d+2)],b=wf[r.charCodeAt(d+3)],L[p++]=_<<2|v>>4,L[p++]=(v&15)<<4|T>>2,L[p++]=(T&3)<<6|b&63;return N},Xde=typeof ArrayBuffer=="function",xA=(r,s)=>{if(typeof r!="string")return{type:"message",data:GW(r,s)};const a=r.charAt(0);return a==="b"?{type:"message",data:Jde(r.substring(1),s)}:hv[a]?r.length>1?{type:hv[a],data:r.substring(1)}:{type:hv[a]}:dI},Jde=(r,s)=>{if(Xde){const a=qde(r);return GW(a,s)}else return{base64:!0,data:r}},GW=(r,s)=>{switch(s){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},HW="",$de=(r,s)=>{const a=r.length,d=new Array(a);let p=0;r.forEach((_,v)=>{MA(_,!1,T=>{d[v]=T,++p===a&&s(d.join(HW))})})},Qde=(r,s)=>{const a=r.split(HW),d=[];for(let p=0;p<a.length;p++){const _=xA(a[p],s);if(d.push(_),_.type==="error")break}return d};function Zde(){return new TransformStream({transform(r,s){Yde(r,a=>{const d=a.length;let p;if(d<126)p=new Uint8Array(1),new DataView(p.buffer).setUint8(0,d);else if(d<65536){p=new Uint8Array(3);const _=new DataView(p.buffer);_.setUint8(0,126),_.setUint16(1,d)}else{p=new Uint8Array(9);const _=new DataView(p.buffer);_.setUint8(0,127),_.setBigUint64(1,BigInt(d))}r.data&&typeof r.data!="string"&&(p[0]|=128),s.enqueue(p),s.enqueue(a)})}})}let Xw;function KE(r){return r.reduce((s,a)=>s+a.length,0)}function zE(r,s){if(r[0].length===s)return r.shift();const a=new Uint8Array(s);let d=0;for(let p=0;p<s;p++)a[p]=r[0][d++],d===r[0].length&&(r.shift(),d=0);return r.length&&d<r[0].length&&(r[0]=r[0].slice(d)),a}function eue(r,s){Xw||(Xw=new TextDecoder);const a=[];let d=0,p=-1,_=!1;return new TransformStream({transform(v,T){for(a.push(v);;){if(d===0){if(KE(a)<1)break;const b=zE(a,1);_=(b[0]&128)===128,p=b[0]&127,p<126?d=3:p===126?d=1:d=2}else if(d===1){if(KE(a)<2)break;const b=zE(a,2);p=new DataView(b.buffer,b.byteOffset,b.length).getUint16(0),d=3}else if(d===2){if(KE(a)<8)break;const b=zE(a,8),N=new DataView(b.buffer,b.byteOffset,b.length),L=N.getUint32(0);if(L>Math.pow(2,21)-1){T.enqueue(dI);break}p=L*Math.pow(2,32)+N.getUint32(4),d=3}else{if(KE(a)<p)break;const b=zE(a,p);T.enqueue(xA(_?b:Xw.decode(b),s)),d=0}if(p===0||p>r){T.enqueue(dI);break}}}})}const KW=4;function br(r){if(r)return tue(r)}function tue(r){for(var s in br.prototype)r[s]=br.prototype[s];return r}br.prototype.on=br.prototype.addEventListener=function(r,s){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(s),this};br.prototype.once=function(r,s){function a(){this.off(r,a),s.apply(this,arguments)}return a.fn=s,this.on(r,a),this};br.prototype.off=br.prototype.removeListener=br.prototype.removeAllListeners=br.prototype.removeEventListener=function(r,s){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+r];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var d,p=0;p<a.length;p++)if(d=a[p],d===s||d.fn===s){a.splice(p,1);break}return a.length===0&&delete this._callbacks["$"+r],this};br.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var s=new Array(arguments.length-1),a=this._callbacks["$"+r],d=1;d<arguments.length;d++)s[d-1]=arguments[d];if(a){a=a.slice(0);for(var d=0,p=a.length;d<p;++d)a[d].apply(this,s)}return this};br.prototype.emitReserved=br.prototype.emit;br.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};br.prototype.hasListeners=function(r){return!!this.listeners(r).length};const Qy=typeof Promise=="function"&&typeof Promise.resolve=="function"?s=>Promise.resolve().then(s):(s,a)=>a(s,0),Ys=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),nue="arraybuffer";function zW(r,...s){return s.reduce((a,d)=>(r.hasOwnProperty(d)&&(a[d]=r[d]),a),{})}const rue=Ys.setTimeout,iue=Ys.clearTimeout;function Zy(r,s){s.useNativeTimers?(r.setTimeoutFn=rue.bind(Ys),r.clearTimeoutFn=iue.bind(Ys)):(r.setTimeoutFn=Ys.setTimeout.bind(Ys),r.clearTimeoutFn=Ys.clearTimeout.bind(Ys))}const sue=1.33;function oue(r){return typeof r=="string"?aue(r):Math.ceil((r.byteLength||r.size)*sue)}function aue(r){let s=0,a=0;for(let d=0,p=r.length;d<p;d++)s=r.charCodeAt(d),s<128?a+=1:s<2048?a+=2:s<55296||s>=57344?a+=3:(d++,a+=4);return a}function YW(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function cue(r){let s="";for(let a in r)r.hasOwnProperty(a)&&(s.length&&(s+="&"),s+=encodeURIComponent(a)+"="+encodeURIComponent(r[a]));return s}function lue(r){let s={},a=r.split("&");for(let d=0,p=a.length;d<p;d++){let _=a[d].split("=");s[decodeURIComponent(_[0])]=decodeURIComponent(_[1])}return s}class due extends Error{constructor(s,a,d){super(s),this.description=a,this.context=d,this.type="TransportError"}}class UA extends br{constructor(s){super(),this.writable=!1,Zy(this,s),this.opts=s,this.query=s.query,this.socket=s.socket,this.supportsBinary=!s.forceBase64}onError(s,a,d){return super.emitReserved("error",new due(s,a,d)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(s){this.readyState==="open"&&this.write(s)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(s){const a=xA(s,this.socket.binaryType);this.onPacket(a)}onPacket(s){super.emitReserved("packet",s)}onClose(s){this.readyState="closed",super.emitReserved("close",s)}pause(s){}createUri(s,a={}){return s+"://"+this._hostname()+this._port()+this.opts.path+this._query(a)}_hostname(){const s=this.opts.hostname;return s.indexOf(":")===-1?s:"["+s+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(s){const a=cue(s);return a.length?"?"+a:""}}class uue extends UA{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(s){this.readyState="pausing";const a=()=>{this.readyState="paused",s()};if(this._polling||!this.writable){let d=0;this._polling&&(d++,this.once("pollComplete",function(){--d||a()})),this.writable||(d++,this.once("drain",function(){--d||a()}))}else a()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(s){const a=d=>{if(this.readyState==="opening"&&d.type==="open"&&this.onOpen(),d.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(d)};Qde(s,this.socket.binaryType).forEach(a),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const s=()=>{this.write([{type:"close"}])};this.readyState==="open"?s():this.once("open",s)}write(s){this.writable=!1,$de(s,a=>{this.doWrite(a,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const s=this.opts.secure?"https":"http",a=this.query||{};return this.opts.timestampRequests!==!1&&(a[this.opts.timestampParam]=YW()),!this.supportsBinary&&!a.sid&&(a.b64=1),this.createUri(s,a)}}let qW=!1;try{qW=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const hue=qW;function pue(){}class fue extends uue{constructor(s){if(super(s),typeof location<"u"){const a=location.protocol==="https:";let d=location.port;d||(d=a?"443":"80"),this.xd=typeof location<"u"&&s.hostname!==location.hostname||d!==s.port}}doWrite(s,a){const d=this.request({method:"POST",data:s});d.on("success",a),d.on("error",(p,_)=>{this.onError("xhr post error",p,_)})}doPoll(){const s=this.request();s.on("data",this.onData.bind(this)),s.on("error",(a,d)=>{this.onError("xhr poll error",a,d)}),this.pollXhr=s}}let ih=class pv extends br{constructor(s,a,d){super(),this.createRequest=s,Zy(this,d),this._opts=d,this._method=d.method||"GET",this._uri=a,this._data=d.data!==void 0?d.data:null,this._create()}_create(){var s;const a=zW(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");a.xdomain=!!this._opts.xd;const d=this._xhr=this.createRequest(a);try{d.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){d.setDisableHeaderCheck&&d.setDisableHeaderCheck(!0);for(let p in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(p)&&d.setRequestHeader(p,this._opts.extraHeaders[p])}}catch{}if(this._method==="POST")try{d.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{d.setRequestHeader("Accept","*/*")}catch{}(s=this._opts.cookieJar)===null||s===void 0||s.addCookies(d),"withCredentials"in d&&(d.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(d.timeout=this._opts.requestTimeout),d.onreadystatechange=()=>{var p;d.readyState===3&&((p=this._opts.cookieJar)===null||p===void 0||p.parseCookies(d.getResponseHeader("set-cookie"))),d.readyState===4&&(d.status===200||d.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof d.status=="number"?d.status:0)},0))},d.send(this._data)}catch(p){this.setTimeoutFn(()=>{this._onError(p)},0);return}typeof document<"u"&&(this._index=pv.requestsCount++,pv.requests[this._index]=this)}_onError(s){this.emitReserved("error",s,this._xhr),this._cleanup(!0)}_cleanup(s){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=pue,s)try{this._xhr.abort()}catch{}typeof document<"u"&&delete pv.requests[this._index],this._xhr=null}}_onLoad(){const s=this._xhr.responseText;s!==null&&(this.emitReserved("data",s),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};ih.requestsCount=0;ih.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",z3);else if(typeof addEventListener=="function"){const r="onpagehide"in Ys?"pagehide":"unload";addEventListener(r,z3,!1)}}function z3(){for(let r in ih.requests)ih.requests.hasOwnProperty(r)&&ih.requests[r].abort()}const mue=function(){const r=XW({xdomain:!1});return r&&r.responseType!==null}();class _ue extends fue{constructor(s){super(s);const a=s&&s.forceBase64;this.supportsBinary=mue&&!a}request(s={}){return Object.assign(s,{xd:this.xd},this.opts),new ih(XW,this.uri(),s)}}function XW(r){const s=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!s||hue))return new XMLHttpRequest}catch{}if(!s)try{return new Ys[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const JW=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class gue extends UA{get name(){return"websocket"}doOpen(){const s=this.uri(),a=this.opts.protocols,d=JW?{}:zW(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(d.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(s,a,d)}catch(p){return this.emitReserved("error",p)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=s=>this.onClose({description:"websocket connection closed",context:s}),this.ws.onmessage=s=>this.onData(s.data),this.ws.onerror=s=>this.onError("websocket error",s)}write(s){this.writable=!1;for(let a=0;a<s.length;a++){const d=s[a],p=a===s.length-1;MA(d,this.supportsBinary,_=>{try{this.doWrite(d,_)}catch{}p&&Qy(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const s=this.opts.secure?"wss":"ws",a=this.query||{};return this.opts.timestampRequests&&(a[this.opts.timestampParam]=YW()),this.supportsBinary||(a.b64=1),this.createUri(s,a)}}const Jw=Ys.WebSocket||Ys.MozWebSocket;class Eue extends gue{createSocket(s,a,d){return JW?new Jw(s,a,d):a?new Jw(s,a):new Jw(s)}doWrite(s,a){this.ws.send(a)}}class vue extends UA{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(s){return this.emitReserved("error",s)}this._transport.closed.then(()=>{this.onClose()}).catch(s=>{this.onError("webtransport error",s)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(s=>{const a=eue(Number.MAX_SAFE_INTEGER,this.socket.binaryType),d=s.readable.pipeThrough(a).getReader(),p=Zde();p.readable.pipeTo(s.writable),this._writer=p.writable.getWriter();const _=()=>{d.read().then(({done:T,value:b})=>{T||(this.onPacket(b),_())}).catch(T=>{})};_();const v={type:"open"};this.query.sid&&(v.data=`{"sid":"${this.query.sid}"}`),this._writer.write(v).then(()=>this.onOpen())})})}write(s){this.writable=!1;for(let a=0;a<s.length;a++){const d=s[a],p=a===s.length-1;this._writer.write(d).then(()=>{p&&Qy(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var s;(s=this._transport)===null||s===void 0||s.close()}}const yue={websocket:Eue,webtransport:vue,polling:_ue},Sue=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Tue=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function uI(r){if(r.length>8e3)throw"URI too long";const s=r,a=r.indexOf("["),d=r.indexOf("]");a!=-1&&d!=-1&&(r=r.substring(0,a)+r.substring(a,d).replace(/:/g,";")+r.substring(d,r.length));let p=Sue.exec(r||""),_={},v=14;for(;v--;)_[Tue[v]]=p[v]||"";return a!=-1&&d!=-1&&(_.source=s,_.host=_.host.substring(1,_.host.length-1).replace(/;/g,":"),_.authority=_.authority.replace("[","").replace("]","").replace(/;/g,":"),_.ipv6uri=!0),_.pathNames=Rue(_,_.path),_.queryKey=Cue(_,_.query),_}function Rue(r,s){const a=/\/{2,9}/g,d=s.replace(a,"/").split("/");return(s.slice(0,1)=="/"||s.length===0)&&d.splice(0,1),s.slice(-1)=="/"&&d.splice(d.length-1,1),d}function Cue(r,s){const a={};return s.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(d,p,_){p&&(a[p]=_)}),a}const hI=typeof addEventListener=="function"&&typeof removeEventListener=="function",fv=[];hI&&addEventListener("offline",()=>{fv.forEach(r=>r())},!1);class Yc extends br{constructor(s,a){if(super(),this.binaryType=nue,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,s&&typeof s=="object"&&(a=s,s=null),s){const d=uI(s);a.hostname=d.host,a.secure=d.protocol==="https"||d.protocol==="wss",a.port=d.port,d.query&&(a.query=d.query)}else a.host&&(a.hostname=uI(a.host).host);Zy(this,a),this.secure=a.secure!=null?a.secure:typeof location<"u"&&location.protocol==="https:",a.hostname&&!a.port&&(a.port=this.secure?"443":"80"),this.hostname=a.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=a.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},a.transports.forEach(d=>{const p=d.prototype.name;this.transports.push(p),this._transportsByName[p]=d}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=lue(this.opts.query)),hI&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},fv.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(s){const a=Object.assign({},this.opts.query);a.EIO=KW,a.transport=s,this.id&&(a.sid=this.id);const d=Object.assign({},this.opts,{query:a,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[s]);return new this._transportsByName[s](d)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const s=this.opts.rememberUpgrade&&Yc.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const a=this.createTransport(s);a.open(),this.setTransport(a)}setTransport(s){this.transport&&this.transport.removeAllListeners(),this.transport=s,s.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",a=>this._onClose("transport close",a))}onOpen(){this.readyState="open",Yc.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",s),this.emitReserved("heartbeat"),s.type){case"open":this.onHandshake(JSON.parse(s.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const a=new Error("server error");a.code=s.data,this._onError(a);break;case"message":this.emitReserved("data",s.data),this.emitReserved("message",s.data);break}}onHandshake(s){this.emitReserved("handshake",s),this.id=s.sid,this.transport.query.sid=s.sid,this._pingInterval=s.pingInterval,this._pingTimeout=s.pingTimeout,this._maxPayload=s.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const s=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+s,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},s),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const s=this._getWritablePackets();this.transport.send(s),this._prevBufferLen=s.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let a=1;for(let d=0;d<this.writeBuffer.length;d++){const p=this.writeBuffer[d].data;if(p&&(a+=oue(p)),d>0&&a>this._maxPayload)return this.writeBuffer.slice(0,d);a+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const s=Date.now()>this._pingTimeoutTime;return s&&(this._pingTimeoutTime=0,Qy(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),s}write(s,a,d){return this._sendPacket("message",s,a,d),this}send(s,a,d){return this._sendPacket("message",s,a,d),this}_sendPacket(s,a,d,p){if(typeof a=="function"&&(p=a,a=void 0),typeof d=="function"&&(p=d,d=null),this.readyState==="closing"||this.readyState==="closed")return;d=d||{},d.compress=d.compress!==!1;const _={type:s,data:a,options:d};this.emitReserved("packetCreate",_),this.writeBuffer.push(_),p&&this.once("flush",p),this.flush()}close(){const s=()=>{this._onClose("forced close"),this.transport.close()},a=()=>{this.off("upgrade",a),this.off("upgradeError",a),s()},d=()=>{this.once("upgrade",a),this.once("upgradeError",a)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?d():s()}):this.upgrading?d():s()),this}_onError(s){if(Yc.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",s),this._onClose("transport error",s)}_onClose(s,a){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),hI&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const d=fv.indexOf(this._offlineEventListener);d!==-1&&fv.splice(d,1)}this.readyState="closed",this.id=null,this.emitReserved("close",s,a),this.writeBuffer=[],this._prevBufferLen=0}}}Yc.protocol=KW;class wue extends Yc{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let s=0;s<this._upgrades.length;s++)this._probe(this._upgrades[s])}_probe(s){let a=this.createTransport(s),d=!1;Yc.priorWebsocketSuccess=!1;const p=()=>{d||(a.send([{type:"ping",data:"probe"}]),a.once("packet",U=>{if(!d)if(U.type==="pong"&&U.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",a),!a)return;Yc.priorWebsocketSuccess=a.name==="websocket",this.transport.pause(()=>{d||this.readyState!=="closed"&&(L(),this.setTransport(a),a.send([{type:"upgrade"}]),this.emitReserved("upgrade",a),a=null,this.upgrading=!1,this.flush())})}else{const B=new Error("probe error");B.transport=a.name,this.emitReserved("upgradeError",B)}}))};function _(){d||(d=!0,L(),a.close(),a=null)}const v=U=>{const B=new Error("probe error: "+U);B.transport=a.name,_(),this.emitReserved("upgradeError",B)};function T(){v("transport closed")}function b(){v("socket closed")}function N(U){a&&U.name!==a.name&&_()}const L=()=>{a.removeListener("open",p),a.removeListener("error",v),a.removeListener("close",T),this.off("close",b),this.off("upgrading",N)};a.once("open",p),a.once("error",v),a.once("close",T),this.once("close",b),this.once("upgrading",N),this._upgrades.indexOf("webtransport")!==-1&&s!=="webtransport"?this.setTimeoutFn(()=>{d||a.open()},200):a.open()}onHandshake(s){this._upgrades=this._filterUpgrades(s.upgrades),super.onHandshake(s)}_filterUpgrades(s){const a=[];for(let d=0;d<s.length;d++)~this.transports.indexOf(s[d])&&a.push(s[d]);return a}}let bue=class extends wue{constructor(s,a={}){const d=typeof s=="object"?s:a;(!d.transports||d.transports&&typeof d.transports[0]=="string")&&(d.transports=(d.transports||["polling","websocket","webtransport"]).map(p=>yue[p]).filter(p=>!!p)),super(s,d)}};function Iue(r,s="",a){let d=r;a=a||typeof location<"u"&&location,r==null&&(r=a.protocol+"//"+a.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=a.protocol+r:r=a.host+r),/^(https?|wss?):\/\//.test(r)||(typeof a<"u"?r=a.protocol+"//"+r:r="https://"+r),d=uI(r)),d.port||(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/";const _=d.host.indexOf(":")!==-1?"["+d.host+"]":d.host;return d.id=d.protocol+"://"+_+":"+d.port+s,d.href=d.protocol+"://"+_+(a&&a.port===d.port?"":":"+d.port),d}const Aue=typeof ArrayBuffer=="function",Oue=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,$W=Object.prototype.toString,Nue=typeof Blob=="function"||typeof Blob<"u"&&$W.call(Blob)==="[object BlobConstructor]",Pue=typeof File=="function"||typeof File<"u"&&$W.call(File)==="[object FileConstructor]";function VA(r){return Aue&&(r instanceof ArrayBuffer||Oue(r))||Nue&&r instanceof Blob||Pue&&r instanceof File}function mv(r,s){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let a=0,d=r.length;a<d;a++)if(mv(r[a]))return!0;return!1}if(VA(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return mv(r.toJSON(),!0);for(const a in r)if(Object.prototype.hasOwnProperty.call(r,a)&&mv(r[a]))return!0;return!1}function Due(r){const s=[],a=r.data,d=r;return d.data=pI(a,s),d.attachments=s.length,{packet:d,buffers:s}}function pI(r,s){if(!r)return r;if(VA(r)){const a={_placeholder:!0,num:s.length};return s.push(r),a}else if(Array.isArray(r)){const a=new Array(r.length);for(let d=0;d<r.length;d++)a[d]=pI(r[d],s);return a}else if(typeof r=="object"&&!(r instanceof Date)){const a={};for(const d in r)Object.prototype.hasOwnProperty.call(r,d)&&(a[d]=pI(r[d],s));return a}return r}function kue(r,s){return r.data=fI(r.data,s),delete r.attachments,r}function fI(r,s){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<s.length)return s[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let a=0;a<r.length;a++)r[a]=fI(r[a],s);else if(typeof r=="object")for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(r[a]=fI(r[a],s));return r}const Lue=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Mue=5;var Zt;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(Zt||(Zt={}));class xue{constructor(s){this.replacer=s}encode(s){return(s.type===Zt.EVENT||s.type===Zt.ACK)&&mv(s)?this.encodeAsBinary({type:s.type===Zt.EVENT?Zt.BINARY_EVENT:Zt.BINARY_ACK,nsp:s.nsp,data:s.data,id:s.id}):[this.encodeAsString(s)]}encodeAsString(s){let a=""+s.type;return(s.type===Zt.BINARY_EVENT||s.type===Zt.BINARY_ACK)&&(a+=s.attachments+"-"),s.nsp&&s.nsp!=="/"&&(a+=s.nsp+","),s.id!=null&&(a+=s.id),s.data!=null&&(a+=JSON.stringify(s.data,this.replacer)),a}encodeAsBinary(s){const a=Due(s),d=this.encodeAsString(a.packet),p=a.buffers;return p.unshift(d),p}}function Y3(r){return Object.prototype.toString.call(r)==="[object Object]"}class jA extends br{constructor(s){super(),this.reviver=s}add(s){let a;if(typeof s=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");a=this.decodeString(s);const d=a.type===Zt.BINARY_EVENT;d||a.type===Zt.BINARY_ACK?(a.type=d?Zt.EVENT:Zt.ACK,this.reconstructor=new Uue(a),a.attachments===0&&super.emitReserved("decoded",a)):super.emitReserved("decoded",a)}else if(VA(s)||s.base64)if(this.reconstructor)a=this.reconstructor.takeBinaryData(s),a&&(this.reconstructor=null,super.emitReserved("decoded",a));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+s)}decodeString(s){let a=0;const d={type:Number(s.charAt(0))};if(Zt[d.type]===void 0)throw new Error("unknown packet type "+d.type);if(d.type===Zt.BINARY_EVENT||d.type===Zt.BINARY_ACK){const _=a+1;for(;s.charAt(++a)!=="-"&&a!=s.length;);const v=s.substring(_,a);if(v!=Number(v)||s.charAt(a)!=="-")throw new Error("Illegal attachments");d.attachments=Number(v)}if(s.charAt(a+1)==="/"){const _=a+1;for(;++a&&!(s.charAt(a)===","||a===s.length););d.nsp=s.substring(_,a)}else d.nsp="/";const p=s.charAt(a+1);if(p!==""&&Number(p)==p){const _=a+1;for(;++a;){const v=s.charAt(a);if(v==null||Number(v)!=v){--a;break}if(a===s.length)break}d.id=Number(s.substring(_,a+1))}if(s.charAt(++a)){const _=this.tryParse(s.substr(a));if(jA.isPayloadValid(d.type,_))d.data=_;else throw new Error("invalid payload")}return d}tryParse(s){try{return JSON.parse(s,this.reviver)}catch{return!1}}static isPayloadValid(s,a){switch(s){case Zt.CONNECT:return Y3(a);case Zt.DISCONNECT:return a===void 0;case Zt.CONNECT_ERROR:return typeof a=="string"||Y3(a);case Zt.EVENT:case Zt.BINARY_EVENT:return Array.isArray(a)&&(typeof a[0]=="number"||typeof a[0]=="string"&&Lue.indexOf(a[0])===-1);case Zt.ACK:case Zt.BINARY_ACK:return Array.isArray(a)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Uue{constructor(s){this.packet=s,this.buffers=[],this.reconPack=s}takeBinaryData(s){if(this.buffers.push(s),this.buffers.length===this.reconPack.attachments){const a=kue(this.reconPack,this.buffers);return this.finishedReconstruction(),a}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Vue=Object.freeze(Object.defineProperty({__proto__:null,Decoder:jA,Encoder:xue,get PacketType(){return Zt},protocol:Mue},Symbol.toStringTag,{value:"Module"}));function Co(r,s,a){return r.on(s,a),function(){r.off(s,a)}}const jue=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class QW extends br{constructor(s,a,d){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=s,this.nsp=a,d&&d.auth&&(this.auth=d.auth),this._opts=Object.assign({},d),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const s=this.io;this.subs=[Co(s,"open",this.onopen.bind(this)),Co(s,"packet",this.onpacket.bind(this)),Co(s,"error",this.onerror.bind(this)),Co(s,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...s){return s.unshift("message"),this.emit.apply(this,s),this}emit(s,...a){var d,p,_;if(jue.hasOwnProperty(s))throw new Error('"'+s.toString()+'" is a reserved event name');if(a.unshift(s),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const v={type:Zt.EVENT,data:a};if(v.options={},v.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"){const L=this.ids++,U=a.pop();this._registerAckCallback(L,U),v.id=L}const T=(p=(d=this.io.engine)===null||d===void 0?void 0:d.transport)===null||p===void 0?void 0:p.writable,b=this.connected&&!(!((_=this.io.engine)===null||_===void 0)&&_._hasPingExpired());return this.flags.volatile&&!T||(b?(this.notifyOutgoingListeners(v),this.packet(v)):this.sendBuffer.push(v)),this.flags={},this}_registerAckCallback(s,a){var d;const p=(d=this.flags.timeout)!==null&&d!==void 0?d:this._opts.ackTimeout;if(p===void 0){this.acks[s]=a;return}const _=this.io.setTimeoutFn(()=>{delete this.acks[s];for(let T=0;T<this.sendBuffer.length;T++)this.sendBuffer[T].id===s&&this.sendBuffer.splice(T,1);a.call(this,new Error("operation has timed out"))},p),v=(...T)=>{this.io.clearTimeoutFn(_),a.apply(this,T)};v.withError=!0,this.acks[s]=v}emitWithAck(s,...a){return new Promise((d,p)=>{const _=(v,T)=>v?p(v):d(T);_.withError=!0,a.push(_),this.emit(s,...a)})}_addToQueue(s){let a;typeof s[s.length-1]=="function"&&(a=s.pop());const d={id:this._queueSeq++,tryCount:0,pending:!1,args:s,flags:Object.assign({fromQueue:!0},this.flags)};s.push((p,..._)=>d!==this._queue[0]?void 0:(p!==null?d.tryCount>this._opts.retries&&(this._queue.shift(),a&&a(p)):(this._queue.shift(),a&&a(null,..._)),d.pending=!1,this._drainQueue())),this._queue.push(d),this._drainQueue()}_drainQueue(s=!1){if(!this.connected||this._queue.length===0)return;const a=this._queue[0];a.pending&&!s||(a.pending=!0,a.tryCount++,this.flags=a.flags,this.emit.apply(this,a.args))}packet(s){s.nsp=this.nsp,this.io._packet(s)}onopen(){typeof this.auth=="function"?this.auth(s=>{this._sendConnectPacket(s)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(s){this.packet({type:Zt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},s):s})}onerror(s){this.connected||this.emitReserved("connect_error",s)}onclose(s,a){this.connected=!1,delete this.id,this.emitReserved("disconnect",s,a),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(s=>{if(!this.sendBuffer.some(d=>String(d.id)===s)){const d=this.acks[s];delete this.acks[s],d.withError&&d.call(this,new Error("socket has been disconnected"))}})}onpacket(s){if(s.nsp===this.nsp)switch(s.type){case Zt.CONNECT:s.data&&s.data.sid?this.onconnect(s.data.sid,s.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Zt.EVENT:case Zt.BINARY_EVENT:this.onevent(s);break;case Zt.ACK:case Zt.BINARY_ACK:this.onack(s);break;case Zt.DISCONNECT:this.ondisconnect();break;case Zt.CONNECT_ERROR:this.destroy();const d=new Error(s.data.message);d.data=s.data.data,this.emitReserved("connect_error",d);break}}onevent(s){const a=s.data||[];s.id!=null&&a.push(this.ack(s.id)),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(s){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const d of a)d.apply(this,s)}super.emit.apply(this,s),this._pid&&s.length&&typeof s[s.length-1]=="string"&&(this._lastOffset=s[s.length-1])}ack(s){const a=this;let d=!1;return function(...p){d||(d=!0,a.packet({type:Zt.ACK,id:s,data:p}))}}onack(s){const a=this.acks[s.id];typeof a=="function"&&(delete this.acks[s.id],a.withError&&s.data.unshift(null),a.apply(this,s.data))}onconnect(s,a){this.id=s,this.recovered=a&&this._pid===a,this._pid=a,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(s=>this.emitEvent(s)),this.receiveBuffer=[],this.sendBuffer.forEach(s=>{this.notifyOutgoingListeners(s),this.packet(s)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(s=>s()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Zt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(s){return this.flags.compress=s,this}get volatile(){return this.flags.volatile=!0,this}timeout(s){return this.flags.timeout=s,this}onAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(s),this}prependAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(s),this}offAny(s){if(!this._anyListeners)return this;if(s){const a=this._anyListeners;for(let d=0;d<a.length;d++)if(s===a[d])return a.splice(d,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(s){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(s),this}prependAnyOutgoing(s){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(s),this}offAnyOutgoing(s){if(!this._anyOutgoingListeners)return this;if(s){const a=this._anyOutgoingListeners;for(let d=0;d<a.length;d++)if(s===a[d])return a.splice(d,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(s){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const a=this._anyOutgoingListeners.slice();for(const d of a)d.apply(this,s.data)}}}function Rh(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Rh.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var s=Math.random(),a=Math.floor(s*this.jitter*r);r=Math.floor(s*10)&1?r+a:r-a}return Math.min(r,this.max)|0};Rh.prototype.reset=function(){this.attempts=0};Rh.prototype.setMin=function(r){this.ms=r};Rh.prototype.setMax=function(r){this.max=r};Rh.prototype.setJitter=function(r){this.jitter=r};class mI extends br{constructor(s,a){var d;super(),this.nsps={},this.subs=[],s&&typeof s=="object"&&(a=s,s=void 0),a=a||{},a.path=a.path||"/socket.io",this.opts=a,Zy(this,a),this.reconnection(a.reconnection!==!1),this.reconnectionAttempts(a.reconnectionAttempts||1/0),this.reconnectionDelay(a.reconnectionDelay||1e3),this.reconnectionDelayMax(a.reconnectionDelayMax||5e3),this.randomizationFactor((d=a.randomizationFactor)!==null&&d!==void 0?d:.5),this.backoff=new Rh({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(a.timeout==null?2e4:a.timeout),this._readyState="closed",this.uri=s;const p=a.parser||Vue;this.encoder=new p.Encoder,this.decoder=new p.Decoder,this._autoConnect=a.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(s){return arguments.length?(this._reconnection=!!s,s||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(s){return s===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=s,this)}reconnectionDelay(s){var a;return s===void 0?this._reconnectionDelay:(this._reconnectionDelay=s,(a=this.backoff)===null||a===void 0||a.setMin(s),this)}randomizationFactor(s){var a;return s===void 0?this._randomizationFactor:(this._randomizationFactor=s,(a=this.backoff)===null||a===void 0||a.setJitter(s),this)}reconnectionDelayMax(s){var a;return s===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=s,(a=this.backoff)===null||a===void 0||a.setMax(s),this)}timeout(s){return arguments.length?(this._timeout=s,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(s){if(~this._readyState.indexOf("open"))return this;this.engine=new bue(this.uri,this.opts);const a=this.engine,d=this;this._readyState="opening",this.skipReconnect=!1;const p=Co(a,"open",function(){d.onopen(),s&&s()}),_=T=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",T),s?s(T):this.maybeReconnectOnOpen()},v=Co(a,"error",_);if(this._timeout!==!1){const T=this._timeout,b=this.setTimeoutFn(()=>{p(),_(new Error("timeout")),a.close()},T);this.opts.autoUnref&&b.unref(),this.subs.push(()=>{this.clearTimeoutFn(b)})}return this.subs.push(p),this.subs.push(v),this}connect(s){return this.open(s)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const s=this.engine;this.subs.push(Co(s,"ping",this.onping.bind(this)),Co(s,"data",this.ondata.bind(this)),Co(s,"error",this.onerror.bind(this)),Co(s,"close",this.onclose.bind(this)),Co(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(s){try{this.decoder.add(s)}catch(a){this.onclose("parse error",a)}}ondecoded(s){Qy(()=>{this.emitReserved("packet",s)},this.setTimeoutFn)}onerror(s){this.emitReserved("error",s)}socket(s,a){let d=this.nsps[s];return d?this._autoConnect&&!d.active&&d.connect():(d=new QW(this,s,a),this.nsps[s]=d),d}_destroy(s){const a=Object.keys(this.nsps);for(const d of a)if(this.nsps[d].active)return;this._close()}_packet(s){const a=this.encoder.encode(s);for(let d=0;d<a.length;d++)this.engine.write(a[d],s.options)}cleanup(){this.subs.forEach(s=>s()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(s,a){var d;this.cleanup(),(d=this.engine)===null||d===void 0||d.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",s,a),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const s=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const a=this.backoff.duration();this._reconnecting=!0;const d=this.setTimeoutFn(()=>{s.skipReconnect||(this.emitReserved("reconnect_attempt",s.backoff.attempts),!s.skipReconnect&&s.open(p=>{p?(s._reconnecting=!1,s.reconnect(),this.emitReserved("reconnect_error",p)):s.onreconnect()}))},a);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}}onreconnect(){const s=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",s)}}const mf={};function _v(r,s){typeof r=="object"&&(s=r,r=void 0),s=s||{};const a=Iue(r,s.path||"/socket.io"),d=a.source,p=a.id,_=a.path,v=mf[p]&&_ in mf[p].nsps,T=s.forceNew||s["force new connection"]||s.multiplex===!1||v;let b;return T?b=new mI(d,s):(mf[p]||(mf[p]=new mI(d,s)),b=mf[p]),a.query&&!s.query&&(s.query=a.queryKey),b.socket(a.path,s)}Object.assign(_v,{Manager:mI,Socket:QW,io:_v,connect:_v});var ZW={exports:{}};(function(r,s){(function(a,d){r.exports=d()})(bE,function(){function a(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof bE<"u"?bE:typeof self<"u"?self:{};function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _=function(e){try{return!!e()}catch{return!0}},v=!_(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),T=v,b=Function.prototype,N=b.call,L=T&&b.bind.bind(N,N),U=T?L:function(e){return function(){return N.apply(e,arguments)}},B=U({}.isPrototypeOf),Y=function(e){return e&&e.Math===Math&&e},F=Y(typeof globalThis=="object"&&globalThis)||Y(typeof window=="object"&&window)||Y(typeof self=="object"&&self)||Y(typeof d=="object"&&d)||Y(typeof d=="object"&&d)||function(){return this}()||Function("return this")(),X=v,te=Function.prototype,q=te.apply,z=te.call,W=typeof Reflect=="object"&&Reflect.apply||(X?z.bind(q):function(){return z.apply(q,arguments)}),Z=U,Ee=Z({}.toString),Oe=Z("".slice),we=function(e){return Oe(Ee(e),8,-1)},Ne=we,at=U,Ue=function(e){if(Ne(e)==="Function")return at(e)},ct=typeof document=="object"&&document.all,Ze=ct===void 0&&ct!==void 0?function(e){return typeof e=="function"||e===ct}:function(e){return typeof e=="function"},Kt={},Mt=!_(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),dr=v,en=Function.prototype.call,Ae=dr?en.bind(en):function(){return en.apply(en,arguments)},fe={},ce={}.propertyIsEnumerable,me=Object.getOwnPropertyDescriptor,ke=me&&!ce.call({1:2},1);fe.f=ke?function(e){var t=me(this,e);return!!t&&t.enumerable}:ce;var qe,Ie,Et=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},vt=_,tn=we,zt=Object,Xe=U("".split),Fn=vt(function(){return!zt("z").propertyIsEnumerable(0)})?function(e){return tn(e)==="String"?Xe(e,""):zt(e)}:zt,Ar=function(e){return e==null},Ii=Ar,ua=TypeError,vs=function(e){if(Ii(e))throw new ua("Can't call method on "+e);return e},md=Fn,_d=vs,_n=function(e){return md(_d(e))},Ha=Ze,Bn=function(e){return typeof e=="object"?e!==null:Ha(e)},_i={},Ch=_i,wh=F,ym=Ze,Sm=function(e){return ym(e)?e:void 0},Or=function(e,t){return arguments.length<2?Sm(Ch[e])||Sm(wh[e]):Ch[e]&&Ch[e][t]||wh[e]&&wh[e][t]},bh=F.navigator,Tm=bh&&bh.userAgent,Zs=Tm?String(Tm):"",Ih=F,Ah=Zs,Rm=Ih.process,Oh=Ih.Deno,Nh=Rm&&Rm.versions||Oh&&Oh.version,Ph=Nh&&Nh.v8;Ph&&(Ie=(qe=Ph.split("."))[0]>0&&qe[0]<4?1:+(qe[0]+qe[1])),!Ie&&Ah&&(!(qe=Ah.match(/Edge\/(\d+)/))||qe[1]>=74)&&(qe=Ah.match(/Chrome\/(\d+)/))&&(Ie=+qe[1]);var Do=Ie,Dh=Do,Cm=_,Ve=F.String,et=!!Object.getOwnPropertySymbols&&!Cm(function(){var e=Symbol("symbol detection");return!Ve(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Dh&&Dh<41}),Qe=et&&!Symbol.sham&&typeof Symbol.iterator=="symbol",tt=Or,St=Ze,ni=B,Ai=Object,ys=Qe?function(e){return typeof e=="symbol"}:function(e){var t=tt("Symbol");return St(t)&&ni(t.prototype,Ai(e))},gd=String,Ka=function(e){try{return gd(e)}catch{return"Object"}},nS=Ze,rS=Ka,IG=TypeError,Oi=function(e){if(nS(e))return e;throw new IG(rS(e)+" is not a function")},AG=Oi,OG=Ar,wm=function(e,t){var n=e[t];return OG(n)?void 0:AG(n)},GA=Ae,HA=Ze,KA=Bn,NG=TypeError,zA={exports:{}},YA=F,PG=Object.defineProperty,DG=F,kG=function(e,t){try{PG(YA,e,{value:t,configurable:!0,writable:!0})}catch{YA[e]=t}return t},qA="__core-js_shared__",XA=zA.exports=DG[qA]||kG(qA,{});(XA.versions||(XA.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var iS=zA.exports,JA=iS,Ed=function(e,t){return JA[e]||(JA[e]=t||{})},LG=vs,MG=Object,ko=function(e){return MG(LG(e))},xG=ko,UG=U({}.hasOwnProperty),vr=Object.hasOwn||function(e,t){return UG(xG(e),t)},VG=U,jG=0,FG=Math.random(),BG=VG(1 .toString),sS=function(e){return"Symbol("+(e===void 0?"":e)+")_"+BG(++jG+FG,36)},WG=Ed,$A=vr,GG=sS,HG=et,KG=Qe,vd=F.Symbol,oS=WG("wks"),zG=KG?vd.for||vd:vd&&vd.withoutSetter||GG,An=function(e){return $A(oS,e)||(oS[e]=HG&&$A(vd,e)?vd[e]:zG("Symbol."+e)),oS[e]},YG=Ae,QA=Bn,ZA=ys,qG=wm,XG=function(e,t){var n,i;if(HA(n=e.toString)&&!KA(i=GA(n,e))||HA(n=e.valueOf)&&!KA(i=GA(n,e)))return i;throw new NG("Can't convert object to primitive value")},JG=TypeError,$G=An("toPrimitive"),QG=function(e,t){if(!QA(e)||ZA(e))return e;var n,i=qG(e,$G);if(i){if(n=YG(i,e,t),!QA(n)||ZA(n))return n;throw new JG("Can't convert object to primitive value")}return XG(e)},ZG=ys,aS=function(e){var t=QG(e,"string");return ZG(t)?t:t+""},eO=Bn,cS=F.document,e8=eO(cS)&&eO(cS.createElement),lS=function(e){return e8?cS.createElement(e):{}},t8=lS,tO=!Mt&&!_(function(){return Object.defineProperty(t8("div"),"a",{get:function(){return 7}}).a!==7}),n8=Mt,r8=Ae,i8=fe,s8=Et,o8=_n,a8=aS,c8=vr,l8=tO,nO=Object.getOwnPropertyDescriptor;Kt.f=n8?nO:function(e,t){if(e=o8(e),t=a8(t),l8)try{return nO(e,t)}catch{}if(c8(e,t))return s8(!r8(i8.f,e,t),e[t])};var d8=_,u8=Ze,h8=/#|\.prototype\./,kh=function(e,t){var n=f8[p8(e)];return n===_8||n!==m8&&(u8(t)?d8(t):!!t)},p8=kh.normalize=function(e){return String(e).replace(h8,".").toLowerCase()},f8=kh.data={},m8=kh.NATIVE="N",_8=kh.POLYFILL="P",rO=kh,g8=Oi,E8=v,v8=Ue(Ue.bind),za=function(e,t){return g8(e),t===void 0?e:E8?v8(e,t):function(){return e.apply(t,arguments)}},Ss={},iO=Mt&&_(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),y8=Bn,S8=String,T8=TypeError,gi=function(e){if(y8(e))return e;throw new T8(S8(e)+" is not an object")},R8=Mt,C8=tO,w8=iO,bm=gi,sO=aS,b8=TypeError,dS=Object.defineProperty,I8=Object.getOwnPropertyDescriptor,uS="enumerable",hS="configurable",pS="writable";Ss.f=R8?w8?function(e,t,n){if(bm(e),t=sO(t),bm(n),typeof e=="function"&&t==="prototype"&&"value"in n&&pS in n&&!n[pS]){var i=I8(e,t);i&&i[pS]&&(e[t]=n.value,n={configurable:hS in n?n[hS]:i[hS],enumerable:uS in n?n[uS]:i[uS],writable:!1})}return dS(e,t,n)}:dS:function(e,t,n){if(bm(e),t=sO(t),bm(n),C8)try{return dS(e,t,n)}catch{}if("get"in n||"set"in n)throw new b8("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var A8=Ss,O8=Et,rl=Mt?function(e,t,n){return A8.f(e,t,O8(1,n))}:function(e,t,n){return e[t]=n,e},Lh=F,N8=W,P8=Ue,D8=Ze,k8=Kt.f,L8=rO,yd=_i,M8=za,Sd=rl,oO=vr,x8=function(e){var t=function(n,i,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,o)}return N8(e,this,arguments)};return t.prototype=e.prototype,t},It=function(e,t){var n,i,o,c,l,u,h,f,m,g=e.target,E=e.global,y=e.stat,I=e.proto,C=E?Lh:y?Lh[g]:Lh[g]&&Lh[g].prototype,w=E?yd:yd[g]||Sd(yd,g,{})[g],D=w.prototype;for(c in t)i=!(n=L8(E?c:g+(y?".":"#")+c,e.forced))&&C&&oO(C,c),u=w[c],i&&(h=e.dontCallGetSet?(m=k8(C,c))&&m.value:C[c]),l=i&&h?h:t[c],(n||I||typeof u!=typeof l)&&(f=e.bind&&i?M8(l,Lh):e.wrap&&i?x8(l):I&&D8(l)?P8(l):l,(e.sham||l&&l.sham||u&&u.sham)&&Sd(f,"sham",!0),Sd(w,c,f),I&&(oO(yd,o=g+"Prototype")||Sd(yd,o,{}),Sd(yd[o],c,l),e.real&&D&&(n||!D[c])&&Sd(D,c,l)))},U8=Math.ceil,V8=Math.floor,j8=Math.trunc||function(e){var t=+e;return(t>0?V8:U8)(t)},F8=j8,fS=function(e){var t=+e;return t!=t||t===0?0:F8(t)},B8=fS,W8=Math.max,G8=Math.min,mS=function(e,t){var n=B8(e);return n<0?W8(n+t,0):G8(n,t)},H8=fS,K8=Math.min,aO=function(e){var t=H8(e);return t>0?K8(t,9007199254740991):0},z8=aO,Ya=function(e){return z8(e.length)},Y8=_n,q8=mS,X8=Ya,cO=function(e){return function(t,n,i){var o=Y8(t),c=X8(o);if(c===0)return!e&&-1;var l,u=q8(i,c);if(e&&n!=n){for(;c>u;)if((l=o[u++])!=l)return!0}else for(;c>u;u++)if((e||u in o)&&o[u]===n)return e||u||0;return!e&&-1}},_S={includes:cO(!0),indexOf:cO(!1)},J8=_S.includes;It({target:"Array",proto:!0,forced:_(function(){return!Array(1).includes()})},{includes:function(e){return J8(this,e,arguments.length>1?arguments[1]:void 0)}});var $8=F,Q8=_i,Ts=function(e,t){var n=Q8[e+"Prototype"],i=n&&n[t];if(i)return i;var o=$8[e],c=o&&o.prototype;return c&&c[t]},Z8=Ts("Array","includes"),eH=Bn,tH=we,nH=An("match"),lO=function(e){var t;return eH(e)&&((t=e[nH])!==void 0?!!t:tH(e)==="RegExp")},rH=lO,iH=TypeError,dO={};dO[An("toStringTag")]="z";var gS=String(dO)==="[object z]",sH=gS,oH=Ze,Im=we,aH=An("toStringTag"),cH=Object,lH=Im(function(){return arguments}())==="Arguments",qa=sH?Im:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,c){try{return o[c]}catch{}}(t=cH(e),aH))=="string"?n:lH?Im(t):(i=Im(t))==="Object"&&oH(t.callee)?"Arguments":i},dH=qa,uH=String,Ni=function(e){if(dH(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return uH(e)},hH=An("match"),pH=It,fH=function(e){if(rH(e))throw new iH("The method doesn't accept regular expressions");return e},mH=vs,uO=Ni,_H=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[hH]=!1,"/./"[e](t)}catch{}}return!1},gH=U("".indexOf);pH({target:"String",proto:!0,forced:!_H("includes")},{includes:function(e){return!!~gH(uO(mH(this)),uO(fH(e)),arguments.length>1?arguments[1]:void 0)}});var EH=Ts("String","includes"),hO=B,vH=Z8,yH=EH,ES=Array.prototype,vS=String.prototype,SH=function(e){var t=e.includes;return e===ES||hO(ES,e)&&t===ES.includes?vH:typeof e=="string"||e===vS||hO(vS,e)&&t===vS.includes?yH:t},pe=p(SH),TH=Oi,RH=ko,CH=Fn,wH=Ya,pO=TypeError,fO="Reduce of empty array with no initial value",bH=function(e){return function(t,n,i,o){var c=RH(t),l=CH(c),u=wH(c);if(TH(n),u===0&&i<2)throw new pO(fO);var h=e?u-1:0,f=e?-1:1;if(i<2)for(;;){if(h in l){o=l[h],h+=f;break}if(h+=f,e?h<0:u<=h)throw new pO(fO)}for(;e?h>=0:u>h;h+=f)h in l&&(o=n(o,l[h],h,c));return o}},IH={left:bH(!1)},AH=_,Am=function(e,t){var n=[][e];return!!n&&AH(function(){n.call(null,t||function(){return 1},1)})},Mh=F,OH=Zs,NH=we,Om=function(e){return OH.slice(0,e.length)===e},yS=Om("Bun/")?"BUN":Om("Cloudflare-Workers")?"CLOUDFLARE":Om("Deno/")?"DENO":Om("Node.js/")?"NODE":Mh.Bun&&typeof Bun.version=="string"?"BUN":Mh.Deno&&typeof Deno.version=="object"?"DENO":NH(Mh.process)==="process"?"NODE":Mh.window&&Mh.document?"BROWSER":"REST",Nm=yS==="NODE",PH=IH.left;It({target:"Array",proto:!0,forced:!Nm&&Do>79&&Do<83||!Am("reduce")},{reduce:function(e){var t=arguments.length;return PH(this,e,t,t>1?arguments[1]:void 0)}});var DH=Ts("Array","reduce"),kH=B,LH=DH,SS=Array.prototype,MH=function(e){var t=e.reduce;return e===SS||kH(SS,e)&&t===SS.reduce?LH:t},mO=MH,Rs=p(mO),xH=we,xh=Array.isArray||function(e){return xH(e)==="Array"},UH=It,VH=xh,jH=U([].reverse),_O=[1,2];UH({target:"Array",proto:!0,forced:String(_O)===String(_O.reverse())},{reverse:function(){return VH(this)&&(this.length=this.length),jH(this)}});var FH=Ts("Array","reverse"),BH=B,WH=FH,TS=Array.prototype,GH=function(e){var t=e.reverse;return e===TS||BH(TS,e)&&t===TS.reverse?WH:t},gO=GH,EO=p(gO),HH=sS,vO=Ed("keys"),Pm=function(e){return vO[e]||(vO[e]=HH(e))},KH=!_(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),zH=vr,YH=Ze,qH=ko,XH=KH,yO=Pm("IE_PROTO"),RS=Object,JH=RS.prototype,CS=XH?RS.getPrototypeOf:function(e){var t=qH(e);if(zH(t,yO))return t[yO];var n=t.constructor;return YH(n)&&t instanceof n?n.prototype:t instanceof RS?JH:null},$H=U,QH=Oi,ZH=Bn,eK=function(e){return ZH(e)||e===null},tK=String,nK=TypeError,rK=function(e,t,n){try{return $H(QH(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},iK=Bn,sK=vs,oK=function(e){if(eK(e))return e;throw new nK("Can't set "+tK(e)+" as a prototype")},aK=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=rK(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,o){return sK(i),oK(o),iK(i)&&(t?e(i,o):i.__proto__=o),i}}():void 0),Dm={},km={},wS=vr,cK=_n,lK=_S.indexOf,dK=km,SO=U([].push),TO=function(e,t){var n,i=cK(e),o=0,c=[];for(n in i)!wS(dK,n)&&wS(i,n)&&SO(c,n);for(;t.length>o;)wS(i,n=t[o++])&&(~lK(c,n)||SO(c,n));return c},bS=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],uK=TO,hK=bS.concat("length","prototype");Dm.f=Object.getOwnPropertyNames||function(e){return uK(e,hK)};var Uh={};Uh.f=Object.getOwnPropertySymbols;var pK=Or,fK=Dm,mK=Uh,_K=gi,gK=U([].concat),EK=pK("Reflect","ownKeys")||function(e){var t=fK.f(_K(e)),n=mK.f;return n?gK(t,n(e)):t},RO=vr,vK=EK,yK=Kt,SK=Ss,IS={},TK=TO,RK=bS,Lm=Object.keys||function(e){return TK(e,RK)},CK=Mt,wK=iO,bK=Ss,IK=gi,AK=_n,OK=Lm;IS.f=CK&&!wK?Object.defineProperties:function(e,t){IK(e);for(var n,i=AK(t),o=OK(t),c=o.length,l=0;c>l;)bK.f(e,n=o[l++],i[n]);return e};var Mm,CO=Or("document","documentElement"),NK=gi,PK=IS,wO=bS,DK=km,kK=CO,LK=lS,AS="prototype",OS="script",bO=Pm("IE_PROTO"),NS=function(){},IO=function(e){return"<"+OS+">"+e+"</"+OS+">"},AO=function(e){e.write(IO("")),e.close();var t=e.parentWindow.Object;return e=null,t},xm=function(){try{Mm=new ActiveXObject("htmlfile")}catch{}var e,t,n;xm=typeof document<"u"?document.domain&&Mm?AO(Mm):(t=LK("iframe"),n="java"+OS+":",t.style.display="none",kK.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(IO("document.F=Object")),e.close(),e.F):AO(Mm);for(var i=wO.length;i--;)delete xm[AS][wO[i]];return xm()};DK[bO]=!0;var Vh=Object.create||function(e,t){var n;return e!==null?(NS[AS]=NK(e),n=new NS,NS[AS]=null,n[bO]=e):n=xm(),t===void 0?n:PK.f(n,t)},MK=Bn,xK=rl,OO=Error,UK=U("".replace),VK=String(new OO("zxcasd").stack),NO=/\n\s*at [^:]*:[^\n]*/,jK=NO.test(VK),FK=Et,BK=!_(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",FK(1,7)),e.stack!==7)}),WK=rl,GK=function(e,t){if(jK&&typeof e=="string"&&!OO.prepareStackTrace)for(;t--;)e=UK(e,NO,"");return e},HK=BK,PO=Error.captureStackTrace,Td={},KK=Td,zK=An("iterator"),YK=Array.prototype,DO=function(e){return e!==void 0&&(KK.Array===e||YK[zK]===e)},qK=qa,kO=wm,XK=Ar,JK=Td,$K=An("iterator"),Um=function(e){if(!XK(e))return kO(e,$K)||kO(e,"@@iterator")||JK[qK(e)]},QK=Ae,ZK=Oi,ez=gi,tz=Ka,nz=Um,rz=TypeError,PS=function(e,t){var n=arguments.length<2?nz(e):t;if(ZK(n))return ez(QK(n,e));throw new rz(tz(e)+" is not iterable")},iz=Ae,LO=gi,sz=wm,MO=function(e,t,n){var i,o;LO(e);try{if(!(i=sz(e,"return"))){if(t==="throw")throw n;return n}i=iz(i,e)}catch(c){o=!0,i=c}if(t==="throw")throw n;if(o)throw i;return LO(i),n},oz=za,az=Ae,cz=gi,lz=Ka,dz=DO,uz=Ya,xO=B,hz=PS,pz=Um,UO=MO,fz=TypeError,Vm=function(e,t){this.stopped=e,this.result=t},VO=Vm.prototype,jh=function(e,t,n){var i,o,c,l,u,h,f,m=n&&n.that,g=!(!n||!n.AS_ENTRIES),E=!(!n||!n.IS_RECORD),y=!(!n||!n.IS_ITERATOR),I=!(!n||!n.INTERRUPTED),C=oz(t,m),w=function(P){return i&&UO(i,"normal",P),new Vm(!0,P)},D=function(P){return g?(cz(P),I?C(P[0],P[1],w):C(P[0],P[1])):I?C(P,w):C(P)};if(E)i=e.iterator;else if(y)i=e;else{if(!(o=pz(e)))throw new fz(lz(e)+" is not iterable");if(dz(o)){for(c=0,l=uz(e);l>c;c++)if((u=D(e[c]))&&xO(VO,u))return u;return new Vm(!1)}i=hz(e,o)}for(h=E?e.next:i.next;!(f=az(h,i)).done;){try{u=D(f.value)}catch(P){UO(i,"throw",P)}if(typeof u=="object"&&u&&xO(VO,u))return u}return new Vm(!1)},mz=Ni,_z=It,gz=B,Ez=CS,jm=aK,vz=function(e,t,n){for(var i=vK(t),o=SK.f,c=yK.f,l=0;l<i.length;l++){var u=i[l];RO(e,u)||n&&RO(n,u)||o(e,u,c(t,u))}},jO=Vh,DS=rl,kS=Et,yz=function(e,t){MK(t)&&"cause"in t&&xK(e,"cause",t.cause)},Sz=function(e,t,n,i){HK&&(PO?PO(e,t):WK(e,"stack",GK(n,i)))},Tz=jh,Rz=function(e,t){return e===void 0?arguments.length<2?"":t:mz(e)},Cz=An("toStringTag"),Fm=Error,wz=[].push,Rd=function(e,t){var n,i=gz(LS,this);jm?n=jm(new Fm,i?Ez(this):LS):(n=i?this:jO(LS),DS(n,Cz,"Error")),t!==void 0&&DS(n,"message",Rz(t)),Sz(n,Rd,n.stack,1),arguments.length>2&&yz(n,arguments[2]);var o=[];return Tz(e,wz,{that:o}),DS(n,"errors",o),n};jm?jm(Rd,Fm):vz(Rd,Fm,{name:!0});var LS=Rd.prototype=jO(Fm.prototype,{constructor:kS(1,Rd),message:kS(1,""),name:kS(1,"AggregateError")});_z({global:!0},{AggregateError:Rd});var Bm,Fh,Wm,bz=Ze,FO=F.WeakMap,Iz=bz(FO)&&/native code/.test(String(FO)),BO=F,Az=Bn,Oz=rl,MS=vr,xS=iS,Nz=Pm,Pz=km,WO="Object already initialized",US=BO.TypeError,Dz=BO.WeakMap;if(Iz||xS.state){var Lo=xS.state||(xS.state=new Dz);Lo.get=Lo.get,Lo.has=Lo.has,Lo.set=Lo.set,Bm=function(e,t){if(Lo.has(e))throw new US(WO);return t.facade=e,Lo.set(e,t),t},Fh=function(e){return Lo.get(e)||{}},Wm=function(e){return Lo.has(e)}}else{var Cd=Nz("state");Pz[Cd]=!0,Bm=function(e,t){if(MS(e,Cd))throw new US(WO);return t.facade=e,Oz(e,Cd,t),t},Fh=function(e){return MS(e,Cd)?e[Cd]:{}},Wm=function(e){return MS(e,Cd)}}var il,GO,HO,sl={set:Bm,get:Fh,has:Wm,enforce:function(e){return Wm(e)?Fh(e):Bm(e,{})},getterFor:function(e){return function(t){var n;if(!Az(t)||(n=Fh(t)).type!==e)throw new US("Incompatible receiver, "+e+" required");return n}}},VS=Mt,kz=vr,KO=Function.prototype,Lz=VS&&Object.getOwnPropertyDescriptor,zO=kz(KO,"name"),YO={PROPER:zO&&(function(){}).name==="something",CONFIGURABLE:zO&&(!VS||VS&&Lz(KO,"name").configurable)},Mz=rl,Xa=function(e,t,n,i){return i&&i.enumerable?e[t]=n:Mz(e,t,n),e},xz=_,Uz=Ze,Vz=Bn,jz=Vh,qO=CS,Fz=Xa,jS=An("iterator"),XO=!1;[].keys&&("next"in(HO=[].keys())?(GO=qO(qO(HO)))!==Object.prototype&&(il=GO):XO=!0);var Bz=!Vz(il)||xz(function(){var e={};return il[jS].call(e)!==e});Uz((il=Bz?{}:jz(il))[jS])||Fz(il,jS,function(){return this});var JO={IteratorPrototype:il,BUGGY_SAFARI_ITERATORS:XO},Wz=qa,Gz=gS?{}.toString:function(){return"[object "+Wz(this)+"]"},Hz=gS,Kz=Ss.f,zz=rl,Yz=vr,qz=Gz,$O=An("toStringTag"),ha=function(e,t,n,i){var o=n?e:e&&e.prototype;o&&(Yz(o,$O)||Kz(o,$O,{configurable:!0,value:t}),i&&!Hz&&zz(o,"toString",qz))},Xz=JO.IteratorPrototype,Jz=Vh,$z=Et,Qz=ha,Zz=Td,eY=function(){return this},FS=function(e,t,n,i){var o=t+" Iterator";return e.prototype=Jz(Xz,{next:$z(+!i,n)}),Qz(e,o,!1,!0),Zz[o]=eY,e},tY=It,nY=Ae,rY=YO,iY=FS,sY=CS,oY=ha,QO=Xa,ZO=Td,aY=JO,cY=rY.PROPER,Gm=aY.BUGGY_SAFARI_ITERATORS,BS=An("iterator"),eN="keys",Hm="values",tN="entries",lY=function(){return this},nN=function(e,t,n,i,o,c,l){iY(n,t,i);var u,h,f,m=function(D){if(D===o&&C)return C;if(!Gm&&D&&D in y)return y[D];switch(D){case eN:case Hm:case tN:return function(){return new n(this,D)}}return function(){return new n(this)}},g=t+" Iterator",E=!1,y=e.prototype,I=y[BS]||y["@@iterator"]||o&&y[o],C=!Gm&&I||m(o),w=t==="Array"&&y.entries||I;if(w&&(u=sY(w.call(new e)))!==Object.prototype&&u.next&&(oY(u,g,!0,!0),ZO[g]=lY),cY&&o===Hm&&I&&I.name!==Hm&&(E=!0,C=function(){return nY(I,this)}),o)if(h={values:m(Hm),keys:c?C:m(eN),entries:m(tN)},l)for(f in h)(Gm||E||!(f in y))&&QO(y,f,h[f]);else tY({target:t,proto:!0,forced:Gm||E},h);return l&&y[BS]!==C&&QO(y,BS,C,{}),ZO[t]=C,h},Km=function(e,t){return{value:e,done:t}},dY=_n,rN=Td,iN=sl;Ss.f;var uY=nN,zm=Km,sN="Array Iterator",hY=iN.set,pY=iN.getterFor(sN);uY(Array,"Array",function(e,t){hY(this,{type:sN,target:dY(e),index:0,kind:t})},function(){var e=pY(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,zm(void 0,!0);switch(e.kind){case"keys":return zm(n,!1);case"values":return zm(t[n],!1)}return zm([n,t[n]],!1)},"values"),rN.Arguments=rN.Array;var fY=Ss,Ym=function(e,t,n){return fY.f(e,t,n)},mY=Or,_Y=Ym,gY=Mt,oN=An("species"),EY=B,vY=TypeError,WS=function(e,t){if(EY(t,e))return e;throw new vY("Incorrect invocation")},yY=Ze,GS=iS,SY=U(Function.toString);yY(GS.inspectSource)||(GS.inspectSource=function(e){return SY(e)});var aN=GS.inspectSource,TY=U,RY=_,cN=Ze,CY=qa,wY=aN,lN=function(){},dN=Or("Reflect","construct"),HS=/^\s*(?:class|function)\b/,bY=TY(HS.exec),IY=!HS.test(lN),Bh=function(e){if(!cN(e))return!1;try{return dN(lN,[],e),!0}catch{return!1}},uN=function(e){if(!cN(e))return!1;switch(CY(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return IY||!!bY(HS,wY(e))}catch{return!0}};uN.sham=!0;var Wh,wd,hN,KS,qm=!dN||RY(function(){var e;return Bh(Bh.call)||!Bh(Object)||!Bh(function(){e=!0})||e})?uN:Bh,AY=qm,OY=Ka,NY=TypeError,pN=gi,PY=function(e){if(AY(e))return e;throw new NY(OY(e)+" is not a constructor")},DY=Ar,kY=An("species"),zS=function(e,t){var n,i=pN(e).constructor;return i===void 0||DY(n=pN(i)[kY])?t:PY(n)},Ja=U([].slice),LY=TypeError,ol=function(e,t){if(e<t)throw new LY("Not enough arguments");return e},fN=/(?:ipad|iphone|ipod).*applewebkit/i.test(Zs),$i=F,MY=W,xY=za,mN=Ze,UY=vr,_N=_,gN=CO,VY=Ja,EN=lS,jY=ol,FY=fN,BY=Nm,YS=$i.setImmediate,qS=$i.clearImmediate,WY=$i.process,XS=$i.Dispatch,GY=$i.Function,vN=$i.MessageChannel,HY=$i.String,JS=0,Gh={},yN="onreadystatechange";_N(function(){Wh=$i.location});var $S=function(e){if(UY(Gh,e)){var t=Gh[e];delete Gh[e],t()}},QS=function(e){return function(){$S(e)}},SN=function(e){$S(e.data)},TN=function(e){$i.postMessage(HY(e),Wh.protocol+"//"+Wh.host)};YS&&qS||(YS=function(e){jY(arguments.length,1);var t=mN(e)?e:GY(e),n=VY(arguments,1);return Gh[++JS]=function(){MY(t,void 0,n)},wd(JS),JS},qS=function(e){delete Gh[e]},BY?wd=function(e){WY.nextTick(QS(e))}:XS&&XS.now?wd=function(e){XS.now(QS(e))}:vN&&!FY?(KS=(hN=new vN).port2,hN.port1.onmessage=SN,wd=xY(KS.postMessage,KS)):$i.addEventListener&&mN($i.postMessage)&&!$i.importScripts&&Wh&&Wh.protocol!=="file:"&&!_N(TN)?(wd=TN,$i.addEventListener("message",SN,!1)):wd=yN in EN("script")?function(e){gN.appendChild(EN("script"))[yN]=function(){gN.removeChild(this),$S(e)}}:function(e){setTimeout(QS(e),0)});var Xm={set:YS,clear:qS},RN=F,KY=Mt,zY=Object.getOwnPropertyDescriptor,CN=function(e){if(!KY)return RN[e];var t=zY(RN,e);return t&&t.value},wN=function(){this.head=null,this.tail=null};wN.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var bd,ZS,eT,tT,bN,IN=wN,YY=/ipad|iphone|ipod/i.test(Zs)&&typeof Pebble<"u",qY=/web0s(?!.*chrome)/i.test(Zs),Id=F,XY=CN,AN=za,nT=Xm.set,JY=IN,$Y=fN,QY=YY,ZY=qY,rT=Nm,ON=Id.MutationObserver||Id.WebKitMutationObserver,NN=Id.document,PN=Id.process,Jm=Id.Promise,iT=XY("queueMicrotask");if(!iT){var $m=new JY,Qm=function(){var e,t;for(rT&&(e=PN.domain)&&e.exit();t=$m.get();)try{t()}catch(n){throw $m.head&&bd(),n}e&&e.enter()};$Y||rT||ZY||!ON||!NN?!QY&&Jm&&Jm.resolve?((tT=Jm.resolve(void 0)).constructor=Jm,bN=AN(tT.then,tT),bd=function(){bN(Qm)}):rT?bd=function(){PN.nextTick(Qm)}:(nT=AN(nT,Id),bd=function(){nT(Qm)}):(ZS=!0,eT=NN.createTextNode(""),new ON(Qm).observe(eT,{characterData:!0}),bd=function(){eT.data=ZS=!ZS}),iT=function(e){$m.head||bd(),$m.add(e)}}var DN=iT,Ad=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},al=F.Promise,e9=F,Hh=al,t9=Ze,n9=rO,r9=aN,i9=An,kN=yS,sT=Do,LN=Hh&&Hh.prototype,s9=i9("species"),MN=t9(e9.PromiseRejectionEvent),o9=n9("Promise",function(){var e=r9(Hh),t=e!==String(Hh);if(!t&&sT===66||!LN.catch||!LN.finally)return!0;if(!sT||sT<51||!/native code/.test(e)){var n=new Hh(function(o){o(1)}),i=function(o){o(function(){},function(){})};if((n.constructor={})[s9]=i,!(n.then(function(){})instanceof i))return!0}return!(t||kN!=="BROWSER"&&kN!=="DENO"||MN)}),Kh={CONSTRUCTOR:o9,REJECTION_EVENT:MN},Mo={},xN=Oi,a9=TypeError,c9=function(e){var t,n;this.promise=new e(function(i,o){if(t!==void 0||n!==void 0)throw new a9("Bad Promise constructor");t=i,n=o}),this.resolve=xN(t),this.reject=xN(n)};Mo.f=function(e){return new c9(e)};var oT,UN,l9=It,Zm=Nm,$a=F,zh=Ae,d9=Xa,u9=ha,h9=function(e){var t=mY(e);gY&&t&&!t[oN]&&_Y(t,oN,{configurable:!0,get:function(){return this}})},p9=Oi,aT=Ze,f9=Bn,m9=WS,_9=zS,VN=Xm.set,cT=DN,g9=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},E9=Ad,v9=IN,jN=sl,lT=al,FN=Kh,BN=Mo,e_="Promise",WN=FN.CONSTRUCTOR,y9=FN.REJECTION_EVENT,dT=jN.getterFor(e_),S9=jN.set,T9=lT&&lT.prototype,Yh=lT,uT=T9,GN=$a.TypeError,hT=$a.document,pT=$a.process,fT=BN.f,R9=fT,C9=!!(hT&&hT.createEvent&&$a.dispatchEvent),HN="unhandledrejection",KN=function(e){var t;return!(!f9(e)||!aT(t=e.then))&&t},zN=function(e,t){var n,i,o,c=t.value,l=t.state===1,u=l?e.ok:e.fail,h=e.resolve,f=e.reject,m=e.domain;try{u?(l||(t.rejection===2&&b9(t),t.rejection=1),u===!0?n=c:(m&&m.enter(),n=u(c),m&&(m.exit(),o=!0)),n===e.promise?f(new GN("Promise-chain cycle")):(i=KN(n))?zh(i,n,h,f):h(n)):f(c)}catch(g){m&&!o&&m.exit(),f(g)}},YN=function(e,t){e.notified||(e.notified=!0,cT(function(){for(var n,i=e.reactions;n=i.get();)zN(n,e);e.notified=!1,t&&!e.rejection&&w9(e)}))},qN=function(e,t,n){var i,o;C9?((i=hT.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),$a.dispatchEvent(i)):i={promise:t,reason:n},!y9&&(o=$a["on"+e])?o(i):e===HN&&g9("Unhandled promise rejection",n)},w9=function(e){zh(VN,$a,function(){var t,n=e.facade,i=e.value;if(XN(e)&&(t=E9(function(){Zm?pT.emit("unhandledRejection",i,n):qN(HN,n,i)}),e.rejection=Zm||XN(e)?2:1,t.error))throw t.value})},XN=function(e){return e.rejection!==1&&!e.parent},b9=function(e){zh(VN,$a,function(){var t=e.facade;Zm?pT.emit("rejectionHandled",t):qN("rejectionhandled",t,e.value)})},Od=function(e,t,n){return function(i){e(t,i,n)}},Nd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,YN(e,!0))},mT=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new GN("Promise can't be resolved itself");var i=KN(t);i?cT(function(){var o={done:!1};try{zh(i,t,Od(mT,o,e),Od(Nd,o,e))}catch(c){Nd(o,c,e)}}):(e.value=t,e.state=1,YN(e,!1))}catch(o){Nd({done:!1},o,e)}}};WN&&(uT=(Yh=function(e){m9(this,uT),p9(e),zh(oT,this);var t=dT(this);try{e(Od(mT,t),Od(Nd,t))}catch(n){Nd(t,n)}}).prototype,(oT=function(e){S9(this,{type:e_,done:!1,notified:!1,parent:!1,reactions:new v9,rejection:!1,state:0,value:null})}).prototype=d9(uT,"then",function(e,t){var n=dT(this),i=fT(_9(this,Yh));return n.parent=!0,i.ok=!aT(e)||e,i.fail=aT(t)&&t,i.domain=Zm?pT.domain:void 0,n.state===0?n.reactions.add(i):cT(function(){zN(i,n)}),i.promise}),UN=function(){var e=new oT,t=dT(e);this.promise=e,this.resolve=Od(mT,t),this.reject=Od(Nd,t)},BN.f=fT=function(e){return e===Yh||e===void 0?new UN(e):R9(e)}),l9({global:!0,wrap:!0,forced:WN},{Promise:Yh}),u9(Yh,e_,!1,!0),h9(e_);var JN=An("iterator"),$N=!1;try{var I9=0,QN={next:function(){return{done:!!I9++}},return:function(){$N=!0}};QN[JN]=function(){return this},Array.from(QN,function(){throw 2})}catch{}var A9=al,O9=function(e,t){try{if(!t&&!$N)return!1}catch{return!1}var n=!1;try{var i={};i[JN]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},t_=Kh.CONSTRUCTOR||!O9(function(e){A9.all(e).then(void 0,function(){})}),N9=Ae,P9=Oi,D9=Mo,k9=Ad,L9=jh;It({target:"Promise",stat:!0,forced:t_},{all:function(e){var t=this,n=D9.f(t),i=n.resolve,o=n.reject,c=k9(function(){var l=P9(t.resolve),u=[],h=0,f=1;L9(e,function(m){var g=h++,E=!1;f++,N9(l,t,m).then(function(y){E||(E=!0,u[g]=y,--f||i(u))},o)}),--f||i(u)});return c.error&&o(c.value),n.promise}});var M9=It,x9=Kh.CONSTRUCTOR;al&&al.prototype,M9({target:"Promise",proto:!0,forced:x9,real:!0},{catch:function(e){return this.then(void 0,e)}});var U9=Ae,V9=Oi,j9=Mo,F9=Ad,B9=jh;It({target:"Promise",stat:!0,forced:t_},{race:function(e){var t=this,n=j9.f(t),i=n.reject,o=F9(function(){var c=V9(t.resolve);B9(e,function(l){U9(c,t,l).then(n.resolve,i)})});return o.error&&i(o.value),n.promise}});var W9=Mo;It({target:"Promise",stat:!0,forced:Kh.CONSTRUCTOR},{reject:function(e){var t=W9.f(this);return(0,t.reject)(e),t.promise}});var G9=gi,H9=Bn,K9=Mo,ZN=function(e,t){if(G9(e),H9(t)&&t.constructor===e)return t;var n=K9.f(e);return(0,n.resolve)(t),n.promise},z9=It,Y9=al,q9=Kh.CONSTRUCTOR,X9=ZN,J9=Or("Promise"),$9=!q9;z9({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return X9($9&&this===J9?Y9:this,e)}});var Q9=Ae,Z9=Oi,e7=Mo,t7=Ad,n7=jh;It({target:"Promise",stat:!0,forced:t_},{allSettled:function(e){var t=this,n=e7.f(t),i=n.resolve,o=n.reject,c=t7(function(){var l=Z9(t.resolve),u=[],h=0,f=1;n7(e,function(m){var g=h++,E=!1;f++,Q9(l,t,m).then(function(y){E||(E=!0,u[g]={status:"fulfilled",value:y},--f||i(u))},function(y){E||(E=!0,u[g]={status:"rejected",reason:y},--f||i(u))})}),--f||i(u)});return c.error&&o(c.value),n.promise}});var r7=Ae,i7=Oi,s7=Or,o7=Mo,a7=Ad,c7=jh,eP="No one promise resolved";It({target:"Promise",stat:!0,forced:t_},{any:function(e){var t=this,n=s7("AggregateError"),i=o7.f(t),o=i.resolve,c=i.reject,l=a7(function(){var u=i7(t.resolve),h=[],f=0,m=1,g=!1;c7(e,function(E){var y=f++,I=!1;m++,r7(u,t,E).then(function(C){I||g||(g=!0,o(C))},function(C){I||g||(I=!0,h[y]=C,--m||c(new n(h,eP)))})}),--m||c(new n(h,eP))});return l.error&&c(l.value),i.promise}});var l7=It,d7=W,u7=Ja,h7=Mo,p7=Oi,tP=Ad,_T=F.Promise,nP=!1;l7({target:"Promise",stat:!0,forced:!_T||!_T.try||tP(function(){_T.try(function(e){nP=e===8},8)}).error||!nP},{try:function(e){var t=arguments.length>1?u7(arguments,1):[],n=h7.f(this),i=tP(function(){return d7(p7(e),void 0,t)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var f7=Mo;It({target:"Promise",stat:!0},{withResolvers:function(){var e=f7.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var m7=It,gT=al,_7=_,g7=Or,E7=Ze,v7=zS,rP=ZN,y7=gT&&gT.prototype;m7({target:"Promise",proto:!0,real:!0,forced:!!gT&&_7(function(){y7.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=v7(this,g7("Promise")),n=E7(e);return this.then(n?function(i){return rP(t,e()).then(function(){return i})}:e,n?function(i){return rP(t,e()).then(function(){throw i})}:e)}});var ET=U,S7=fS,T7=Ni,R7=vs,C7=ET("".charAt),iP=ET("".charCodeAt),w7=ET("".slice),sP=function(e){return function(t,n){var i,o,c=T7(R7(t)),l=S7(n),u=c.length;return l<0||l>=u?e?"":void 0:(i=iP(c,l))<55296||i>56319||l+1===u||(o=iP(c,l+1))<56320||o>57343?e?C7(c,l):i:e?w7(c,l,l+2):o-56320+(i-55296<<10)+65536}},vT={codeAt:sP(!1),charAt:sP(!0)},b7=vT.charAt,I7=Ni,oP=sl,A7=nN,aP=Km,cP="String Iterator",O7=oP.set,N7=oP.getterFor(cP);A7(String,"String",function(e){O7(this,{type:cP,string:I7(e),index:0})},function(){var e,t=N7(this),n=t.string,i=t.index;return i>=n.length?aP(void 0,!0):(e=b7(n,i),t.index+=e.length,aP(e,!1))});var P7=_i.Promise,D7={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},k7=F,L7=ha,lP=Td;for(var yT in D7)L7(k7[yT],yT),lP[yT]=lP.Array;var dP=P7,ve=p(dP),M7=Ts("Array","values"),x7=qa,U7=vr,V7=B,j7=M7,ST=Array.prototype,F7={DOMTokenList:!0,NodeList:!0},B7=function(e){var t=e.values;return e===ST||V7(ST,e)&&t===ST.values||U7(F7,x7(e))?j7:t},Ei=p(B7),uP=Ka,W7=TypeError,hP=Ja,G7=Math.floor,TT=function(e,t){var n=e.length;if(n<8)for(var i,o,c=1;c<n;){for(o=c,i=e[c];o&&t(e[o-1],i)>0;)e[o]=e[--o];o!==c++&&(e[o]=i)}else for(var l=G7(n/2),u=TT(hP(e,0,l),t),h=TT(hP(e,l),t),f=u.length,m=h.length,g=0,E=0;g<f||E<m;)e[g+E]=g<f&&E<m?t(u[g],h[E])<=0?u[g++]:h[E++]:g<f?u[g++]:h[E++];return e},pP=TT,fP=Zs.match(/firefox\/(\d+)/i),H7=!!fP&&+fP[1],K7=/MSIE|Trident/.test(Zs),mP=Zs.match(/AppleWebKit\/(\d+)\./),z7=!!mP&&+mP[1],Y7=It,_P=U,q7=Oi,X7=ko,gP=Ya,J7=function(e,t){if(!delete e[t])throw new W7("Cannot delete property "+uP(t)+" of "+uP(e))},EP=Ni,RT=_,$7=pP,Q7=Am,vP=H7,Z7=K7,yP=Do,SP=z7,Qa=[],TP=_P(Qa.sort),eq=_P(Qa.push),tq=RT(function(){Qa.sort(void 0)}),nq=RT(function(){Qa.sort(null)}),rq=Q7("sort"),RP=!RT(function(){if(yP)return yP<70;if(!(vP&&vP>3)){if(Z7)return!0;if(SP)return SP<603;var e,t,n,i,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Qa.push({k:t+i,v:n})}for(Qa.sort(function(c,l){return l.v-c.v}),i=0;i<Qa.length;i++)t=Qa[i].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});Y7({target:"Array",proto:!0,forced:tq||!nq||!rq||!RP},{sort:function(e){e!==void 0&&q7(e);var t=X7(this);if(RP)return e===void 0?TP(t):TP(t,e);var n,i,o=[],c=gP(t);for(i=0;i<c;i++)i in t&&eq(o,t[i]);for($7(o,function(l){return function(u,h){return h===void 0?-1:u===void 0?1:l!==void 0?+l(u,h)||0:EP(u)>EP(h)?1:-1}}(e)),n=gP(o),i=0;i<n;)t[i]=o[i++];for(;i<c;)J7(t,i++);return t}});var iq=Ts("Array","sort"),sq=B,oq=iq,CT=Array.prototype,aq=function(e){var t=e.sort;return e===CT||sq(CT,e)&&t===CT.sort?oq:t},cl=p(aq),cq=It,lq=U,dq=mS,uq=RangeError,CP=String.fromCharCode,wP=String.fromCodePoint,hq=lq([].join);cq({target:"String",stat:!0,forced:!!wP&&wP.length!==1},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,o=0;i>o;){if(t=+arguments[o++],dq(t,1114111)!==t)throw new uq(t+" is not a valid code point");n[o]=t<65536?CP(t):CP(55296+((t-=65536)>>10),t%1024+56320)}return hq(n,"")}});var pq=_,fq=An("iterator"),n_=!pq(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(o,c){t.delete("b"),i+=c+o}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[fq]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),mq=Xa,wT=It,bP=F,bT=CN,_q=Or,r_=Ae,eo=U,qh=Mt,IP=n_,AP=Xa,gq=Ym,Eq=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:mq(e,i,t[i],n);return e},vq=ha,yq=FS,IT=sl,OP=WS,AT=Ze,Sq=vr,Tq=za,Rq=qa,Cq=gi,NP=Bn,vi=Ni,wq=Vh,PP=Et,DP=PS,bq=Um,i_=Km,Pd=ol,Iq=pP,Aq=An("iterator"),Dd="URLSearchParams",kP=Dd+"Iterator",LP=IT.set,Cs=IT.getterFor(Dd),Oq=IT.getterFor(kP),MP=bT("fetch"),s_=bT("Request"),Xh=bT("Headers"),OT=s_&&s_.prototype,xP=Xh&&Xh.prototype,Nq=bP.TypeError,Pq=bP.encodeURIComponent,Dq=String.fromCharCode,kq=_q("String","fromCodePoint"),Lq=parseInt,o_=eo("".charAt),UP=eo([].join),Za=eo([].push),VP=eo("".replace),Mq=eo([].shift),jP=eo([].splice),FP=eo("".split),BP=eo("".slice),xq=eo(/./.exec),Uq=/\+/g,Vq=/^[0-9a-f]+$/i,WP=function(e,t){var n=BP(e,t,t+2);return xq(Vq,n)?Lq(n,16):NaN},jq=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},Fq=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},GP=function(e){for(var t=(e=VP(e,Uq," ")).length,n="",i=0;i<t;){var o=o_(e,i);if(o==="%"){if(o_(e,i+1)==="%"||i+3>t){n+="%",i++;continue}var c=WP(e,i+1);if(c!=c){n+=o,i++;continue}i+=2;var l=jq(c);if(l===0)o=Dq(c);else{if(l===1||l>4){n+="",i++;continue}for(var u=[c],h=1;h<l&&!(++i+3>t||o_(e,i)!=="%");){var f=WP(e,i+1);if(f!=f){i+=3;break}if(f>191||f<128)break;Za(u,f),i+=2,h++}if(u.length!==l){n+="";continue}var m=Fq(u);m===null?n+="":o=kq(m)}}n+=o,i++}return n},Bq=/[!'()~]|%20/g,Wq={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Gq=function(e){return Wq[e]},HP=function(e){return VP(Pq(e),Bq,Gq)},NT=yq(function(e,t){LP(this,{type:kP,target:Cs(e).entries,index:0,kind:t})},Dd,function(){var e=Oq(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,i_(void 0,!0);var i=t[n];switch(e.kind){case"keys":return i_(i.key,!1);case"values":return i_(i.value,!1)}return i_([i.key,i.value],!1)},!0),KP=function(e){this.entries=[],this.url=null,e!==void 0&&(NP(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?o_(e,0)==="?"?BP(e,1):e:vi(e)))};KP.prototype={type:Dd,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,o,c,l,u,h=this.entries,f=bq(e);if(f)for(n=(t=DP(e,f)).next;!(i=r_(n,t)).done;){if(c=(o=DP(Cq(i.value))).next,(l=r_(c,o)).done||(u=r_(c,o)).done||!r_(c,o).done)throw new Nq("Expected sequence with length 2");Za(h,{key:vi(l.value),value:vi(u.value)})}else for(var m in e)Sq(e,m)&&Za(h,{key:m,value:vi(e[m])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,o=FP(e,"&"),c=0;c<o.length;)(t=o[c++]).length&&(n=FP(t,"="),Za(i,{key:GP(Mq(n)),value:GP(UP(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],Za(n,HP(e.key)+"="+HP(e.value));return UP(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var a_=function(){OP(this,kd);var e=LP(this,new KP(arguments.length>0?arguments[0]:void 0));qh||(this.size=e.entries.length)},kd=a_.prototype;if(Eq(kd,{append:function(e,t){var n=Cs(this);Pd(arguments.length,2),Za(n.entries,{key:vi(e),value:vi(t)}),qh||this.length++,n.updateURL()},delete:function(e){for(var t=Cs(this),n=Pd(arguments.length,1),i=t.entries,o=vi(e),c=n<2?void 0:arguments[1],l=c===void 0?c:vi(c),u=0;u<i.length;){var h=i[u];if(h.key!==o||l!==void 0&&h.value!==l)u++;else if(jP(i,u,1),l!==void 0)break}qh||(this.size=i.length),t.updateURL()},get:function(e){var t=Cs(this).entries;Pd(arguments.length,1);for(var n=vi(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=Cs(this).entries;Pd(arguments.length,1);for(var n=vi(e),i=[],o=0;o<t.length;o++)t[o].key===n&&Za(i,t[o].value);return i},has:function(e){for(var t=Cs(this).entries,n=Pd(arguments.length,1),i=vi(e),o=n<2?void 0:arguments[1],c=o===void 0?o:vi(o),l=0;l<t.length;){var u=t[l++];if(u.key===i&&(c===void 0||u.value===c))return!0}return!1},set:function(e,t){var n=Cs(this);Pd(arguments.length,1);for(var i,o=n.entries,c=!1,l=vi(e),u=vi(t),h=0;h<o.length;h++)(i=o[h]).key===l&&(c?jP(o,h--,1):(c=!0,i.value=u));c||Za(o,{key:l,value:u}),qh||(this.size=o.length),n.updateURL()},sort:function(){var e=Cs(this);Iq(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Cs(this).entries,i=Tq(e,arguments.length>1?arguments[1]:void 0),o=0;o<n.length;)i((t=n[o++]).value,t.key,this)},keys:function(){return new NT(this,"keys")},values:function(){return new NT(this,"values")},entries:function(){return new NT(this,"entries")}},{enumerable:!0}),AP(kd,Aq,kd.entries,{}),AP(kd,"toString",function(){return Cs(this).serialize()},{enumerable:!0}),qh&&gq(kd,"size",{get:function(){return Cs(this).entries.length},configurable:!0,enumerable:!0}),vq(a_,Dd),wT({global:!0,forced:!IP},{URLSearchParams:a_}),!IP&&AT(Xh)){var Hq=eo(xP.has),Kq=eo(xP.set),zP=function(e){if(NP(e)){var t,n=e.body;if(Rq(n)===Dd)return t=e.headers?new Xh(e.headers):new Xh,Hq(t,"content-type")||Kq(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),wq(e,{body:PP(0,vi(n)),headers:PP(0,t)})}return e};if(AT(MP)&&wT({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return MP(e,arguments.length>1?zP(arguments[1]):{})}}),AT(s_)){var PT=function(e){return OP(this,OT),new s_(e,arguments.length>1?zP(arguments[1]):{})};OT.constructor=PT,PT.prototype=OT,wT({global:!0,dontCallGetSet:!0,forced:!0},{Request:PT})}}var ws,zq={URLSearchParams:a_,getState:Cs},Yq=_i.URLSearchParams,YP=Mt,qq=U,Xq=Ae,Jq=_,DT=Lm,$q=Uh,Qq=fe,Zq=ko,eX=Fn,Ld=Object.assign,qP=Object.defineProperty,tX=qq([].concat),nX=!Ld||Jq(function(){if(YP&&Ld({b:1},Ld(qP({},"a",{enumerable:!0,get:function(){qP(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(o){t[o]=o}),Ld({},e)[n]!==7||DT(Ld({},t)).join("")!==i})?function(e,t){for(var n=Zq(e),i=arguments.length,o=1,c=$q.f,l=Qq.f;i>o;)for(var u,h=eX(arguments[o++]),f=c?tX(DT(h),c(h)):DT(h),m=f.length,g=0;m>g;)u=f[g++],YP&&!Xq(l,h,u)||(n[u]=h[u]);return n}:Ld,rX=gi,iX=MO,sX=Mt,oX=Ss,aX=Et,kT=function(e,t,n){sX?oX.f(e,t,aX(0,n)):e[t]=n},cX=za,lX=Ae,dX=ko,uX=function(e,t,n,i){try{return i?t(rX(n)[0],n[1]):t(n)}catch(o){iX(e,"throw",o)}},hX=DO,pX=qm,fX=Ya,XP=kT,mX=PS,_X=Um,JP=Array,ll=U,LT=2147483647,gX=/[^\0-\u007E]/,$P=/[.\u3002\uFF0E\uFF61]/g,QP="Overflow: input needs wider integers to process",ZP=RangeError,EX=ll($P.exec),Md=Math.floor,MT=String.fromCharCode,eD=ll("".charCodeAt),tD=ll([].join),ec=ll([].push),vX=ll("".replace),yX=ll("".split),SX=ll("".toLowerCase),nD=function(e){return e+22+75*(e<26)},TX=function(e,t,n){var i=0;for(e=n?Md(e/700):e>>1,e+=Md(e/t);e>455;)e=Md(e/35),i+=36;return Md(i+36*e/(e+38))},RX=function(e){var t=[];e=function(D){for(var P=[],x=0,K=D.length;x<K;){var H=eD(D,x++);if(H>=55296&&H<=56319&&x<K){var j=eD(D,x++);(64512&j)==56320?ec(P,((1023&H)<<10)+(1023&j)+65536):(ec(P,H),x--)}else ec(P,H)}return P}(e);var n,i,o=e.length,c=128,l=0,u=72;for(n=0;n<e.length;n++)(i=e[n])<128&&ec(t,MT(i));var h=t.length,f=h;for(h&&ec(t,"-");f<o;){var m=LT;for(n=0;n<e.length;n++)(i=e[n])>=c&&i<m&&(m=i);var g=f+1;if(m-c>Md((LT-l)/g))throw new ZP(QP);for(l+=(m-c)*g,c=m,n=0;n<e.length;n++){if((i=e[n])<c&&++l>LT)throw new ZP(QP);if(i===c){for(var E=l,y=36;;){var I=y<=u?1:y>=u+26?26:y-u;if(E<I)break;var C=E-I,w=36-I;ec(t,MT(nD(I+C%w))),E=Md(C/w),y+=36}ec(t,MT(nD(E))),u=TX(l,g,f===h),l=0,f++}}l++,c++}return tD(t,"")},CX=It,xT=Mt,wX=n_,UT=F,rD=za,bs=U,c_=Xa,Is=Ym,bX=WS,VT=vr,jT=nX,xd=function(e){var t=dX(e),n=pX(this),i=arguments.length,o=i>1?arguments[1]:void 0,c=o!==void 0;c&&(o=cX(o,i>2?arguments[2]:void 0));var l,u,h,f,m,g,E=_X(t),y=0;if(!E||this===JP&&hX(E))for(l=fX(t),u=n?new this(l):JP(l);l>y;y++)g=c?o(t[y],y):t[y],XP(u,y,g);else for(u=n?new this:[],m=(f=mX(t,E)).next;!(h=lX(m,f)).done;y++)g=c?uX(f,o,[h.value,y],!0):h.value,XP(u,y,g);return u.length=y,u},to=Ja,IX=vT.codeAt,AX=function(e){var t,n,i=[],o=yX(vX(SX(e),$P,"."),".");for(t=0;t<o.length;t++)n=o[t],ec(i,EX(gX,n)?"xn--"+RX(n):n);return tD(i,".")},pa=Ni,OX=ha,NX=ol,iD=zq,sD=sl,PX=sD.set,l_=sD.getterFor("URL"),DX=iD.URLSearchParams,kX=iD.getState,Jh=UT.URL,FT=UT.TypeError,d_=UT.parseInt,LX=Math.floor,oD=Math.pow,As=bs("".charAt),no=bs(/./.exec),$h=bs([].join),MX=bs(1 .toString),xX=bs([].pop),Ud=bs([].push),BT=bs("".replace),UX=bs([].shift),VX=bs("".split),Qh=bs("".slice),u_=bs("".toLowerCase),jX=bs([].unshift),WT="Invalid scheme",dl="Invalid host",aD="Invalid port",cD=/[a-z]/i,FX=/[\d+-.a-z]/i,GT=/\d/,BX=/^0x/i,WX=/^[0-7]+$/,GX=/^\d+$/,lD=/^[\da-f]+$/i,HX=/[\0\t\n\r #%/:<>?@[\\\]^|]/,KX=/[\0\t\n\r #/:<>?@[\\\]^|]/,zX=/^[\u0000-\u0020]+/,YX=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,qX=/[\t\n\r]/g,Zh=function(e){var t,n,i,o;if(typeof e=="number"){for(t=[],n=0;n<4;n++)jX(t,e%256),e=LX(e/256);return $h(t,".")}if(typeof e=="object"){for(t="",i=function(c){for(var l=null,u=1,h=null,f=0,m=0;m<8;m++)c[m]!==0?(f>u&&(l=h,u=f),h=null,f=0):(h===null&&(h=m),++f);return f>u?h:l}(e),n=0;n<8;n++)o&&e[n]===0||(o&&(o=!1),i===n?(t+=n?":":"::",o=!0):(t+=MX(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},h_={},dD=jT({},h_,{" ":1,'"':1,"<":1,">":1,"`":1}),uD=jT({},dD,{"#":1,"?":1,"{":1,"}":1}),HT=jT({},uD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),tc=function(e,t){var n=IX(e,0);return n>32&&n<127&&!VT(t,e)?e:encodeURIComponent(e)},p_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ep=function(e,t){var n;return e.length===2&&no(cD,As(e,0))&&((n=As(e,1))===":"||!t&&n==="|")},hD=function(e){var t;return e.length>1&&ep(Qh(e,0,2))&&(e.length===2||(t=As(e,2))==="/"||t==="\\"||t==="?"||t==="#")},XX=function(e){return e==="."||u_(e)==="%2e"},KT={},pD={},zT={},fD={},mD={},YT={},_D={},gD={},f_={},m_={},qT={},XT={},JT={},$T={},ED={},QT={},Vd={},xo={},vD={},ul={},fa={},ZT=function(e,t,n){var i,o,c,l=pa(e);if(t){if(o=this.parse(l))throw new FT(o);this.searchParams=null}else{if(n!==void 0&&(i=new ZT(n,!0)),o=this.parse(l,null,i))throw new FT(o);(c=kX(new DX)).bindURL(this),this.searchParams=c}};ZT.prototype={type:"URL",parse:function(e,t,n){var i,o,c,l,u,h=this,f=t||KT,m=0,g="",E=!1,y=!1,I=!1;for(e=pa(e),t||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,e=BT(e,zX,""),e=BT(e,YX,"$1")),e=BT(e,qX,""),i=xd(e);m<=i.length;){switch(o=i[m],f){case KT:if(!o||!no(cD,o)){if(t)return WT;f=zT;continue}g+=u_(o),f=pD;break;case pD:if(o&&(no(FX,o)||o==="+"||o==="-"||o==="."))g+=u_(o);else{if(o!==":"){if(t)return WT;g="",f=zT,m=0;continue}if(t&&(h.isSpecial()!==VT(p_,g)||g==="file"&&(h.includesCredentials()||h.port!==null)||h.scheme==="file"&&!h.host))return;if(h.scheme=g,t)return void(h.isSpecial()&&p_[h.scheme]===h.port&&(h.port=null));g="",h.scheme==="file"?f=$T:h.isSpecial()&&n&&n.scheme===h.scheme?f=fD:h.isSpecial()?f=gD:i[m+1]==="/"?(f=mD,m++):(h.cannotBeABaseURL=!0,Ud(h.path,""),f=vD)}break;case zT:if(!n||n.cannotBeABaseURL&&o!=="#")return WT;if(n.cannotBeABaseURL&&o==="#"){h.scheme=n.scheme,h.path=to(n.path),h.query=n.query,h.fragment="",h.cannotBeABaseURL=!0,f=fa;break}f=n.scheme==="file"?$T:YT;continue;case fD:if(o!=="/"||i[m+1]!=="/"){f=YT;continue}f=f_,m++;break;case mD:if(o==="/"){f=m_;break}f=xo;continue;case YT:if(h.scheme=n.scheme,o===ws)h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=to(n.path),h.query=n.query;else if(o==="/"||o==="\\"&&h.isSpecial())f=_D;else if(o==="?")h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=to(n.path),h.query="",f=ul;else{if(o!=="#"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=to(n.path),h.path.length--,f=xo;continue}h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=to(n.path),h.query=n.query,h.fragment="",f=fa}break;case _D:if(!h.isSpecial()||o!=="/"&&o!=="\\"){if(o!=="/"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,f=xo;continue}f=m_}else f=f_;break;case gD:if(f=f_,o!=="/"||As(g,m+1)!=="/")continue;m++;break;case f_:if(o!=="/"&&o!=="\\"){f=m_;continue}break;case m_:if(o==="@"){E&&(g="%40"+g),E=!0,c=xd(g);for(var C=0;C<c.length;C++){var w=c[C];if(w!==":"||I){var D=tc(w,HT);I?h.password+=D:h.username+=D}else I=!0}g=""}else if(o===ws||o==="/"||o==="?"||o==="#"||o==="\\"&&h.isSpecial()){if(E&&g==="")return"Invalid authority";m-=xd(g).length+1,g="",f=qT}else g+=o;break;case qT:case XT:if(t&&h.scheme==="file"){f=QT;continue}if(o!==":"||y){if(o===ws||o==="/"||o==="?"||o==="#"||o==="\\"&&h.isSpecial()){if(h.isSpecial()&&g==="")return dl;if(t&&g===""&&(h.includesCredentials()||h.port!==null))return;if(l=h.parseHost(g))return l;if(g="",f=Vd,t)return;continue}o==="["?y=!0:o==="]"&&(y=!1),g+=o}else{if(g==="")return dl;if(l=h.parseHost(g))return l;if(g="",f=JT,t===XT)return}break;case JT:if(!no(GT,o)){if(o===ws||o==="/"||o==="?"||o==="#"||o==="\\"&&h.isSpecial()||t){if(g!==""){var P=d_(g,10);if(P>65535)return aD;h.port=h.isSpecial()&&P===p_[h.scheme]?null:P,g=""}if(t)return;f=Vd;continue}return aD}g+=o;break;case $T:if(h.scheme="file",o==="/"||o==="\\")f=ED;else{if(!n||n.scheme!=="file"){f=xo;continue}switch(o){case ws:h.host=n.host,h.path=to(n.path),h.query=n.query;break;case"?":h.host=n.host,h.path=to(n.path),h.query="",f=ul;break;case"#":h.host=n.host,h.path=to(n.path),h.query=n.query,h.fragment="",f=fa;break;default:hD($h(to(i,m),""))||(h.host=n.host,h.path=to(n.path),h.shortenPath()),f=xo;continue}}break;case ED:if(o==="/"||o==="\\"){f=QT;break}n&&n.scheme==="file"&&!hD($h(to(i,m),""))&&(ep(n.path[0],!0)?Ud(h.path,n.path[0]):h.host=n.host),f=xo;continue;case QT:if(o===ws||o==="/"||o==="\\"||o==="?"||o==="#"){if(!t&&ep(g))f=xo;else if(g===""){if(h.host="",t)return;f=Vd}else{if(l=h.parseHost(g))return l;if(h.host==="localhost"&&(h.host=""),t)return;g="",f=Vd}continue}g+=o;break;case Vd:if(h.isSpecial()){if(f=xo,o!=="/"&&o!=="\\")continue}else if(t||o!=="?")if(t||o!=="#"){if(o!==ws&&(f=xo,o!=="/"))continue}else h.fragment="",f=fa;else h.query="",f=ul;break;case xo:if(o===ws||o==="/"||o==="\\"&&h.isSpecial()||!t&&(o==="?"||o==="#")){if((u=u_(u=g))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(h.shortenPath(),o==="/"||o==="\\"&&h.isSpecial()||Ud(h.path,"")):XX(g)?o==="/"||o==="\\"&&h.isSpecial()||Ud(h.path,""):(h.scheme==="file"&&!h.path.length&&ep(g)&&(h.host&&(h.host=""),g=As(g,0)+":"),Ud(h.path,g)),g="",h.scheme==="file"&&(o===ws||o==="?"||o==="#"))for(;h.path.length>1&&h.path[0]==="";)UX(h.path);o==="?"?(h.query="",f=ul):o==="#"&&(h.fragment="",f=fa)}else g+=tc(o,uD);break;case vD:o==="?"?(h.query="",f=ul):o==="#"?(h.fragment="",f=fa):o!==ws&&(h.path[0]+=tc(o,h_));break;case ul:t||o!=="#"?o!==ws&&(o==="'"&&h.isSpecial()?h.query+="%27":h.query+=o==="#"?"%23":tc(o,h_)):(h.fragment="",f=fa);break;case fa:o!==ws&&(h.fragment+=tc(o,dD))}m++}},parseHost:function(e){var t,n,i;if(As(e,0)==="["){if(As(e,e.length-1)!=="]"||(t=function(o){var c,l,u,h,f,m,g,E=[0,0,0,0,0,0,0,0],y=0,I=null,C=0,w=function(){return As(o,C)};if(w()===":"){if(As(o,1)!==":")return;C+=2,I=++y}for(;w();){if(y===8)return;if(w()!==":"){for(c=l=0;l<4&&no(lD,w());)c=16*c+d_(w(),16),C++,l++;if(w()==="."){if(l===0||(C-=l,y>6))return;for(u=0;w();){if(h=null,u>0){if(!(w()==="."&&u<4))return;C++}if(!no(GT,w()))return;for(;no(GT,w());){if(f=d_(w(),10),h===null)h=f;else{if(h===0)return;h=10*h+f}if(h>255)return;C++}E[y]=256*E[y]+h,++u!=2&&u!==4||y++}if(u!==4)return;break}if(w()===":"){if(C++,!w())return}else if(w())return;E[y++]=c}else{if(I!==null)return;C++,I=++y}}if(I!==null)for(m=y-I,y=7;y!==0&&m>0;)g=E[y],E[y--]=E[I+m-1],E[I+--m]=g;else if(y!==8)return;return E}(Qh(e,1,-1)),!t))return dl;this.host=t}else if(this.isSpecial()){if(e=AX(e),no(HX,e)||(t=function(o){var c,l,u,h,f,m,g,E=VX(o,".");if(E.length&&E[E.length-1]===""&&E.length--,(c=E.length)>4)return o;for(l=[],u=0;u<c;u++){if((h=E[u])==="")return o;if(f=10,h.length>1&&As(h,0)==="0"&&(f=no(BX,h)?16:8,h=Qh(h,f===8?1:2)),h==="")m=0;else{if(!no(f===10?GX:f===8?WX:lD,h))return o;m=d_(h,f)}Ud(l,m)}for(u=0;u<c;u++)if(m=l[u],u===c-1){if(m>=oD(256,5-c))return null}else if(m>255)return null;for(g=xX(l),u=0;u<l.length;u++)g+=l[u]*oD(256,3-u);return g}(e),t===null))return dl;this.host=t}else{if(no(KX,e))return dl;for(t="",n=xd(e),i=0;i<n.length;i++)t+=tc(n[i],h_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return VT(p_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&ep(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,o=e.host,c=e.port,l=e.path,u=e.query,h=e.fragment,f=t+":";return o!==null?(f+="//",e.includesCredentials()&&(f+=n+(i?":"+i:"")+"@"),f+=Zh(o),c!==null&&(f+=":"+c)):t==="file"&&(f+="//"),f+=e.cannotBeABaseURL?l[0]:l.length?"/"+$h(l,"/"):"",u!==null&&(f+="?"+u),h!==null&&(f+="#"+h),f},setHref:function(e){var t=this.parse(e);if(t)throw new FT(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new jd(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Zh(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(pa(e)+":",KT)},getUsername:function(){return this.username},setUsername:function(e){var t=xd(pa(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=tc(t[n],HT)}},getPassword:function(){return this.password},setPassword:function(e){var t=xd(pa(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=tc(t[n],HT)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Zh(e):Zh(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,qT)},getHostname:function(){var e=this.host;return e===null?"":Zh(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,XT)},getPort:function(){var e=this.port;return e===null?"":pa(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=pa(e))===""?this.port=null:this.parse(e,JT))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+$h(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Vd))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=pa(e))===""?this.query=null:(As(e,0)==="?"&&(e=Qh(e,1)),this.query="",this.parse(e,ul)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=pa(e))!==""?(As(e,0)==="#"&&(e=Qh(e,1)),this.fragment="",this.parse(e,fa)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var jd=function(e){var t=bX(this,yi),n=NX(arguments.length,1)>1?arguments[1]:void 0,i=PX(t,new ZT(e,!1,n));xT||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},yi=jd.prototype,Os=function(e,t){return{get:function(){return l_(this)[e]()},set:t&&function(n){return l_(this)[t](n)},configurable:!0,enumerable:!0}};if(xT&&(Is(yi,"href",Os("serialize","setHref")),Is(yi,"origin",Os("getOrigin")),Is(yi,"protocol",Os("getProtocol","setProtocol")),Is(yi,"username",Os("getUsername","setUsername")),Is(yi,"password",Os("getPassword","setPassword")),Is(yi,"host",Os("getHost","setHost")),Is(yi,"hostname",Os("getHostname","setHostname")),Is(yi,"port",Os("getPort","setPort")),Is(yi,"pathname",Os("getPathname","setPathname")),Is(yi,"search",Os("getSearch","setSearch")),Is(yi,"searchParams",Os("getSearchParams")),Is(yi,"hash",Os("getHash","setHash"))),c_(yi,"toJSON",function(){return l_(this).serialize()},{enumerable:!0}),c_(yi,"toString",function(){return l_(this).serialize()},{enumerable:!0}),Jh){var yD=Jh.createObjectURL,SD=Jh.revokeObjectURL;yD&&c_(jd,"createObjectURL",rD(yD,Jh)),SD&&c_(jd,"revokeObjectURL",rD(SD,Jh))}OX(jd,"URL"),CX({global:!0,forced:!wX,sham:!xT},{URL:jd});var JX=It,TD=_,$X=ol,RD=Ni,QX=n_,eR=Or("URL"),ZX=QX&&TD(function(){eR.canParse()}),eJ=TD(function(){return eR.canParse.length!==1});JX({target:"URL",stat:!0,forced:!ZX||eJ},{canParse:function(e){var t=$X(arguments.length,1),n=RD(e),i=t<2||arguments[1]===void 0?void 0:RD(arguments[1]);try{return!!new eR(n,i)}catch{return!1}}});var tJ=It,nJ=ol,CD=Ni,rJ=n_,iJ=Or("URL");tJ({target:"URL",stat:!0,forced:!rJ},{parse:function(e){var t=nJ(arguments.length,1),n=CD(e),i=t<2||arguments[1]===void 0?void 0:CD(arguments[1]);try{return new iJ(n,i)}catch{return null}}});var __=p(_i.URL);let wD=!0,bD=!0;function g_(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function hl(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(l,u){if(l!==t)return o.apply(this,arguments);const h=f=>{const m=n(f);m&&(u.handleEvent?u.handleEvent(m):u(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,h),o.apply(this,[l,h])};const c=i.removeEventListener;i.removeEventListener=function(l,u){if(l!==t||!this._eventMap||!this._eventMap[t])return c.apply(this,arguments);if(!this._eventMap[t].has(u))return c.apply(this,arguments);const h=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[l,h])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(l){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),l&&this.addEventListener(t,this["_on"+t]=l)},enumerable:!0,configurable:!0})}function sJ(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(wD=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function oJ(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(bD=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function ID(){if(typeof window=="object"){if(wD)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function tR(e,t){bD&&console.warn(e+" is deprecated, please use "+t+" instead.")}function AD(e){return Object.prototype.toString.call(e)==="[object Object]"}function OD(e){var t;return AD(e)?Rs(t=Object.keys(e)).call(t,function(n,i){const o=AD(e[i]),c=o?OD(e[i]):e[i],l=o&&!Object.keys(c).length;return c===void 0||l?n:Object.assign(n,{[i]:c})},{}):e}function nR(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?nR(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(o=>{nR(e,e.get(o),n)})}))}function ND(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const c=[];return e.forEach(l=>{l.type==="track"&&l.trackIdentifier===t.id&&c.push(l)}),c.forEach(l=>{e.forEach(u=>{u.type===i&&u.trackId===l.id&&nR(e,u,o)})}),o}const PD=ID;function DD(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const u={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const f=typeof l[h]=="object"?l[h]:{ideal:l[h]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const m=function(g,E){return g?g+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(f.ideal!==void 0){u.optional=u.optional||[];let g={};typeof f.ideal=="number"?(g[m("min",h)]=f.ideal,u.optional.push(g),g={},g[m("max",h)]=f.ideal,u.optional.push(g)):(g[m("",h)]=f.ideal,u.optional.push(g))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[m("",h)]=f.exact):["min","max"].forEach(g=>{f[g]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[m(g,h)]=f[g])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},o=function(l,u){if(t.version>=61)return u(l);if((l=JSON.parse(JSON.stringify(l)))&&typeof l.audio=="object"){const h=function(f,m,g){m in f&&!(g in f)&&(f[g]=f[m],delete f[m])};h((l=JSON.parse(JSON.stringify(l))).audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const f=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||f)){let m;if(delete l.video.facingMode,h.exact==="environment"||h.ideal==="environment"?m=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(g=>{g=g.filter(y=>y.kind==="videoinput");let E=g.find(y=>m.some(I=>{var C;return pe(C=y.label.toLowerCase()).call(C,I)}));return!E&&g.length&&pe(m).call(m,"back")&&(E=g[g.length-1]),E&&(l.video.deviceId=h.exact?{exact:E.deviceId}:{ideal:E.deviceId}),l.video=i(l.video),PD("chrome: "+JSON.stringify(l)),u(l)})}l.video=i(l.video)}return PD("chrome: "+JSON.stringify(l)),u(l)},c=function(l){return t.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(l,u,h){o(l,f=>{n.webkitGetUserMedia(f,u,m=>{h&&h(c(m))})})}).bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return o(u,h=>l(h).then(f=>{if(h.audio&&!f.getAudioTracks().length||h.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return f},f=>ve.reject(c(f))))}}}function kD(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function LD(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):{track:i.track};const c=new Event("track");c.track=i.track,c.receiver=o,c.transceiver={receiver:o},c.streams=[n.stream],this.dispatchEvent(c)}),n.stream.getTracks().forEach(i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.id):{track:i};const c=new Event("track");c.track=i,c.receiver=o,c.transceiver={receiver:o},c.streams=[n.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else hl(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function MD(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=o.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){let h=o.apply(this,arguments);return h||(h=t(this,l),this._senders.push(h)),h};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){c.apply(this,arguments);const u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(c=>{this._senders.push(t(this,c))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(c=>{const l=this._senders.find(u=>u.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function xD(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const c=function(u){const h={};return u.result().forEach(f=>{const m={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(g=>{m[g]=f.stat(g)}),h[m.id]=m}),h},l=function(u){return new Map(Object.keys(u).map(h=>[h,u[h]]))};if(arguments.length>=2){const u=function(h){i(l(c(h)))};return t.apply(this,[u,n])}return new ve((u,h)=>{t.apply(this,[function(f){u(l(c(f)))},h])}).then(i,o)}}function UD(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>ND(c,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),hl(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>ND(o,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,o,c;return this.getSenders().forEach(l=>{l.track===n&&(i?c=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===n&&(o?c=!0:o=l),l.track===n)),c||i&&o?ve.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():ve.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function VD(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[c.id]=[c].concat(u)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],i.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const u=this._shimmedLocalStreams[l].indexOf(c);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),o.apply(this,arguments)}}function jD(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return VD(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const h=n.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(f=>this._reverseStreams[f.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(f=>{if(this.getSenders().find(g=>g.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const f=new e.MediaStream(h.getTracks());this._streams[h.id]=f,this._reverseStreams[f.id]=h,h=f}i.apply(this,[h])};const o=e.RTCPeerConnection.prototype.removeStream;function c(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(g=>{const E=h._reverseStreams[g],y=h._streams[E.id];m=m.replace(new RegExp(y.id,"g"),E.id)}),new RTCSessionDescription({type:f.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(y=>y===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[f.id];if(E)E.addTrack(h),ve.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new e.MediaStream([h]);this._streams[f.id]=y,this._reverseStreams[y.id]=f,this.addStream(y)}return this.getSenders().find(y=>y.track===h)},["createOffer","createAnswer"].forEach(function(h){const f=e.RTCPeerConnection.prototype[h],m={[h](){const g=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[E=>{const y=c(this,E);g[0].apply(null,[y])},E=>{g[1]&&g[1].apply(null,E)},arguments[2]]):f.apply(this,arguments).then(E=>c(this,E))}};e.RTCPeerConnection.prototype[h]=m[h]});const l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(g=>{const E=h._reverseStreams[g],y=h._streams[E.id];m=m.replace(new RegExp(E.id,"g"),y.id)}),new RTCSessionDescription({type:f.type,sdp:m})}(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const h=u.get.apply(this);return h.type===""?h:c(this,h)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(g=>h.track===g)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function rR(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function FD(e,t){hl(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var BD=Object.freeze({__proto__:null,fixNegotiationNeeded:FD,shimAddTrackRemoveTrack:jD,shimAddTrackRemoveTrackWithNative:VD,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const o=n.video&&n.video.width,c=n.video&&n.video.height,l=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:l||3}},o&&(n.video.mandatory.maxWidth=o),c&&(n.video.mandatory.maxHeight=c),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:MD,shimGetStats:xD,shimGetUserMedia:DD,shimMediaStream:kD,shimOnTrack:LD,shimPeerConnection:rR,shimSenderReceiverGetStats:UD});function WD(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,c,l){tR("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(c,l)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(l,u,h){u in l&&!(h in l)&&(l[h]=l[u],delete l[u])},c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),o(l.audio,"autoGainControl","mozAutoGainControl"),o(l.audio,"noiseSuppression","mozNoiseSuppression")),c(l)},i&&i.prototype.getSettings){const l=i.prototype.getSettings;i.prototype.getSettings=function(){const u=l.apply(this,arguments);return o(u,"mozAutoGainControl","autoGainControl"),o(u,"mozNoiseSuppression","noiseSuppression"),u}}if(i&&i.prototype.applyConstraints){const l=i.prototype.applyConstraints;i.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u,"autoGainControl","mozAutoGainControl"),o(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function GD(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function iR(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const c=e.RTCPeerConnection.prototype[o],l={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=l[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,c,l]=arguments;return i.apply(this,[o||null]).then(u=>{if(t.version<53&&!c)try{u.forEach(h=>{h.type=n[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((f,m)=>{u.set(m,Object.assign({},f,{type:n[f.type]||f.type}))})}return u}).then(c,l)}}function HD(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ve.resolve(new Map)}}function KD(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),hl(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function zD(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){tR("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&pe(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function YD(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function qD(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(i){const{sender:c}=o,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=n,c.sendEncodings=n,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return o})}function XD(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function JD(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ve.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function $D(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ve.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var QD=Object.freeze({__proto__:null,shimAddTransceiver:qD,shimCreateAnswer:$D,shimCreateOffer:JD,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,ve.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:XD,shimGetUserMedia:WD,shimOnTrack:GD,shimPeerConnection:iR,shimRTCDataChannel:YD,shimReceiverGetStats:KD,shimRemoveStream:zD,shimSenderGetStats:HD});function ZD(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),pe(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(o=>t.call(this,o,n)),n.getVideoTracks().forEach(o=>t.call(this,o,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];return o&&o.forEach(l=>{var u;this._localStreams?pe(u=this._localStreams).call(u,l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(o=>{pe(i).call(i,o.track)&&this.removeTrack(o)})})}}function ek(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(o=>{var c;if(this._remoteStreams||(this._remoteStreams=[]),pe(c=this._remoteStreams).call(c,o))return;this._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,this.dispatchEvent(l)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const c=new Event("addstream");c.stream=o,n.dispatchEvent(c)})}),t.apply(n,arguments)}}}function tk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,c=t.setRemoteDescription,l=t.addIceCandidate;t.createOffer=function(h,f){const m=arguments.length>=2?arguments[2]:arguments[0],g=n.apply(this,[m]);return f?(g.then(h,f),ve.resolve()):g},t.createAnswer=function(h,f){const m=arguments.length>=2?arguments[2]:arguments[0],g=i.apply(this,[m]);return f?(g.then(h,f),ve.resolve()):g};let u=function(h,f,m){const g=o.apply(this,[h]);return m?(g.then(f,m),ve.resolve()):g};t.setLocalDescription=u,u=function(h,f,m){const g=c.apply(this,[h]);return m?(g.then(f,m),ve.resolve()):g},t.setRemoteDescription=u,u=function(h,f,m){const g=l.apply(this,[h]);return m?(g.then(f,m),ve.resolve()):g},t.addIceCandidate=u}function nk(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>i(rk(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,o){t.mediaDevices.getUserMedia(n).then(i,o)}).bind(t))}function rk(e){return e&&e.video!==void 0?Object.assign({},e,{video:OD(e.video)}):e}function ik(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const o=[];for(let c=0;c<n.iceServers.length;c++){let l=n.iceServers[c];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(tR("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(n.iceServers[c])}n.iceServers=o}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function sk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ok(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(c=>c.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function ak(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var ck=Object.freeze({__proto__:null,shimAudioContext:ak,shimCallbacksAPI:tk,shimConstraints:rk,shimCreateOfferLegacy:ok,shimGetUserMedia:nk,shimLocalStreamsAPI:ZD,shimRTCIceServerUrls:ik,shimRemoteStreamsAPI:ek,shimTrackEventTransceiver:sk}),lk=`	
\v\f\r \u2028\u2029\uFEFF`,aJ=vs,cJ=Ni,sR=lk,dk=U("".replace),lJ=RegExp("^["+sR+"]+"),dJ=RegExp("(^|[^"+sR+"])["+sR+"]+$"),uJ=function(e){return function(t){var n=cJ(aJ(t));return 1&e&&(n=dk(n,lJ,"")),2&e&&(n=dk(n,dJ,"$1")),n}},hJ={trim:uJ(3)},pJ=YO.PROPER,fJ=_,uk=lk,mJ=hJ.trim;It({target:"String",proto:!0,forced:function(e){return fJ(function(){return!!uk[e]()||""[e]()!==""||pJ&&uk[e].name!==e})}("trim")},{trim:function(){return mJ(this)}});var _J=Ts("String","trim"),gJ=B,EJ=_J,oR=String.prototype,vJ=function(e){var t=e.trim;return typeof e=="string"||e===oR||gJ(oR,e)&&t===oR.trim?EJ:t},Nr=p(vJ),hk={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,o)=>(o>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(o=>o.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let c=8;c<i.length;c+=2)switch(i[c]){case"raddr":o.relatedAddress=i[c+1];break;case"rport":o.relatedPort=parseInt(i[c+1],10);break;case"tcptype":o.tcpType=i[c+1];break;case"ufrag":o.ufrag=i[c+1],o.usernameFragment=i[c+1];break;default:o[i[c]]===void 0&&(o[i[c]]=i[c+1])}return o},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const o=n.component;o==="rtp"?i.push(1):o==="rtcp"?i.push(2):i.push(o),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const c=n.type;return i.push("typ"),i.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const o={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),o.name=i[0],o.clockRate=parseInt(i[1],10),o.channels=i.length===3?parseInt(i[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let o;const c=n.substring(n.indexOf(" ")+1).split(";");for(let l=0;l<c.length;l++)o=c[l].trim().split("="),i[o[0].trim()]=o[1];return i},t.writeFmtp=function(n){let i="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const c=[];Object.keys(n.parameters).forEach(l=>{n.parameters[l]!==void 0?c.push(l+"="+n.parameters[l]):c.push(l)}),i+="a=fmtp:"+o+" "+c.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(c=>{i+="a=rtcp-fb:"+o+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,i),10)},c=n.indexOf(":",i);return c>-1?(o.attribute=n.substring(i+1,c),o.value=n.substring(c+1)):o.attribute=n.substring(i+1),o},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(o=>parseInt(o,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let o="a=setup:"+i+`\r
`;return n.fingerprints.forEach(c=>{o+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),o},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const o=t.matchPrefix(n+i,"a=ice-ufrag:")[0],c=t.matchPrefix(n+i,"a=ice-pwd:")[0];return o&&c?{usernameFragment:o.substring(12),password:c.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");i.profile=o[2];for(let l=3;l<o.length;l++){const u=o[l],h=t.matchPrefix(n,"a=rtpmap:"+u+" ")[0];if(h){const f=t.parseRtpMap(h),m=t.matchPrefix(n,"a=fmtp:"+u+" ");switch(f.parameters=m.length?t.parseFmtp(m[0]):{},f.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),i.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(f.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(l=>{i.headerExtensions.push(t.parseExtmap(l))});const c=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(l=>{c.forEach(u=>{l.rtcpFeedback.find(h=>h.type===u.type&&h.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),i},t.writeRtpDescription=function(n,i){let o="";o+="m="+n+" ",o+=i.codecs.length>0?"9":"0",o+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=i.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(l=>{o+=t.writeRtpMap(l),o+=t.writeFmtp(l),o+=t.writeRtcpFb(l)});let c=0;return i.codecs.forEach(l=>{l.maxptime>c&&(c=l.maxptime)}),c>0&&(o+="a=maxptime:"+c+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(l=>{o+=t.writeExtmap(l)}),o},t.parseRtpEncodingParameters=function(n){const i=[],o=t.parseRtpParameters(n),c=o.fecMechanisms.indexOf("RED")!==-1,l=o.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(n,"a=ssrc:").map(E=>t.parseSsrcMedia(E)).filter(E=>E.attribute==="cname"),h=u.length>0&&u[0].ssrc;let f;const m=t.matchPrefix(n,"a=ssrc-group:FID").map(E=>E.substring(17).split(" ").map(y=>parseInt(y,10)));m.length>0&&m[0].length>1&&m[0][0]===h&&(f=m[0][1]),o.codecs.forEach(E=>{if(E.name.toUpperCase()==="RTX"&&E.parameters.apt){let y={ssrc:h,codecPayloadType:parseInt(E.parameters.apt,10)};h&&f&&(y.rtx={ssrc:f}),i.push(y),c&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:h,mechanism:l?"red+ulpfec":"red"},i.push(y))}}),i.length===0&&h&&i.push({ssrc:h});let g=t.matchPrefix(n,"b=");return g.length&&(g=g[0].indexOf("b=TIAS:")===0?parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?1e3*parseInt(g[0].substring(5),10)*.95-16e3:void 0,i.forEach(E=>{E.maxBitrate=g})),i},t.parseRtcpParameters=function(n){const i={},o=t.matchPrefix(n,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];o&&(i.cname=o.value,i.ssrc=o.ssrc);const c=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=c.length>0,i.compound=c.length===0;const l=t.matchPrefix(n,"a=rtcp-mux");return i.mux=l.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const o=t.matchPrefix(n,"a=msid:");if(o.length===1)return i=o[0].substring(7).split(" "),{stream:i[0],track:i[1]};const c=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");return c.length>0?(i=c[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:");let c;o.length>0&&(c=parseInt(o[0].substring(19),10)),isNaN(c)&&(c=65536);const l=t.matchPrefix(n,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:i.fmt,maxMessageSize:c};const u=t.matchPrefix(n,"a=sctpmap:");if(u.length>0){const h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:c}}},t.writeSctpDescription=function(n,i){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&o.push("a=max-message-size:"+i.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,o){let c;const l=i!==void 0?i:2;return c=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+c+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const o=t.splitLines(n);for(let c=0;c<o.length;c++)switch(o[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[c].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let o=0;o<i.length;o++)if(i[o].length<2||i[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(hk);var pk=hk.exports,Fd=p(pk),yJ=a({__proto__:null,default:Fd},[pk]);function E_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),o=Fd.parseCandidate(n.candidate),c=Object.assign(i,o);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,hl(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function aR(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||hl(e,"icecandidate",t=>{if(t.candidate){const n=Fd.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function v_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(u){if(!u||!u.sdp)return!1;const h=Fd.splitSections(u.sdp);return h.shift(),h.some(f=>{const m=Fd.parseMLine(f);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},i=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const f=parseInt(h[1],10);return f!=f?-1:f},o=function(u){let h=65536;return t.browser==="firefox"&&(h=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),h},c=function(u,h){let f=65536;t.browser==="firefox"&&t.version===57&&(f=65535);const m=Fd.matchPrefix(u.sdp,"a=max-message-size:");return m.length>0?f=parseInt(m[0].substr(19),10):t.browser==="firefox"&&h!==-1&&(f=2147483637),f},l=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=i(arguments[0]),h=o(u),f=c(arguments[0],u);let m;m=h===0&&f===0?Number.POSITIVE_INFINITY:h===0||f===0?Math.max(h,f):Math.min(h,f);const g={};Object.defineProperty(g,"maxMessageSize",{get:()=>m}),this._sctp=g}return l.apply(this,arguments)}}function y_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,o){const c=i.send;i.send=function(){const l=arguments[0],u=l.length||l.size||l.byteLength;if(i.readyState==="open"&&o.sctp&&u>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return c.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},hl(e,"datachannel",i=>(t(i.channel,i.target),i))}function cR(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const c=o.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const l=new Event("connectionstatechange",o);c.dispatchEvent(l)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function lR(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(c=>Nr(c).call(c)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function S_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ve.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ve.resolve())})}function T_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var SJ=Object.freeze({__proto__:null,removeExtmapAllowMixed:lR,shimAddIceCandidateNullOrEmpty:S_,shimConnectionState:cR,shimMaxMessageSize:v_,shimParameterlessSetLocalDescription:T_,shimRTCIceCandidate:E_,shimRTCIceCandidateRelayProtocol:aR,shimSendThrowTypeError:y_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=ID,i=function(c){const l={browser:null,version:null};if(c===void 0||!c.navigator)return l.browser="Not a browser.",l;const{navigator:u}=c;if(u.mozGetUserMedia)l.browser="firefox",l.version=g_(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection)l.browser="chrome",l.version=g_(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!c.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=g_(u.userAgent,/AppleWebKit\/(\d+)\./,1),l.supportsUnifiedPlan=c.RTCRtpTransceiver&&"currentDirection"in c.RTCRtpTransceiver.prototype}return l}(e),o={browserDetails:i,commonShim:SJ,extractVersion:g_,disableLog:sJ,disableWarnings:oJ,sdp:yJ};switch(i.browser){case"chrome":if(!BD||!rR||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=BD,S_(e,i),T_(e),DD(e,i),kD(e),rR(e,i),LD(e),jD(e,i),MD(e),xD(e),UD(e),FD(e,i),E_(e),aR(e),cR(e),v_(e,i),y_(e),lR(e,i);break;case"firefox":if(!QD||!iR||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=QD,S_(e,i),T_(e),WD(e,i),iR(e,i),GD(e),zD(e),HD(e),KD(e),YD(e),qD(e),XD(e),JD(e),$D(e),E_(e),cR(e),v_(e,i),y_(e);break;case"safari":if(!ck||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=ck,S_(e,i),T_(e),ik(e),ok(e),tk(e),ZD(e),ek(e),sk(e),nk(e),ak(e),E_(e),aR(e),v_(e,i),y_(e),lR(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var dR=F;It({global:!0,forced:dR.globalThis!==dR},{globalThis:dR});var fk=p(F),uR={exports:{}};(function(e,t){(function(n,i){var o="function",c="undefined",l="object",u="string",h="major",f="model",m="name",g="type",E="vendor",y="version",I="architecture",C="console",w="mobile",D="tablet",P="smarttv",x="wearable",K="embedded",H="Amazon",j="Apple",J="ASUS",re="BlackBerry",se="Browser",le="Chrome",Je="Firefox",nt="Google",Fe="Huawei",Rt="LG",yt="Microsoft",_r="Motorola",ie="Opera",he="Samsung",Te="Sharp",oe="Sony",R="Xiaomi",V="Zebra",G="Facebook",ue="Chromium OS",Ke="Mac OS",jt=" Browser",Pn=function(wn){for(var Dn={},Ht=0;Ht<wn.length;Ht++)Dn[wn[Ht].toUpperCase()]=wn[Ht];return Dn},cs=function(wn,Dn){return typeof wn===u&&Gs(Dn).indexOf(Gs(wn))!==-1},Gs=function(wn){return wn.toLowerCase()},sf=function(wn,Dn){if(typeof wn===u)return wn=wn.replace(/^\s\s*/,""),typeof Dn===c?wn:wn.substring(0,500)},Fl=function(wn,Dn){for(var Ht,li,vo,mn,Aa,ht,yo=0;yo<Dn.length&&!Aa;){var Bl=Dn[yo],Zo=Dn[yo+1];for(Ht=li=0;Ht<Bl.length&&!Aa&&Bl[Ht];)if(Aa=Bl[Ht++].exec(wn))for(vo=0;vo<Zo.length;vo++)ht=Aa[++li],typeof(mn=Zo[vo])===l&&mn.length>0?mn.length===2?typeof mn[1]==o?this[mn[0]]=mn[1].call(this,ht):this[mn[0]]=mn[1]:mn.length===3?typeof mn[1]!==o||mn[1].exec&&mn[1].test?this[mn[0]]=ht?ht.replace(mn[1],mn[2]):i:this[mn[0]]=ht?mn[1].call(this,ht,mn[2]):i:mn.length===4&&(this[mn[0]]=ht?mn[3].call(this,ht.replace(mn[1],mn[2])):i):this[mn]=ht||i;yo+=2}},ku=function(wn,Dn){for(var Ht in Dn)if(typeof Dn[Ht]===l&&Dn[Ht].length>0){for(var li=0;li<Dn[Ht].length;li++)if(cs(Dn[Ht][li],wn))return Ht==="?"?i:Ht}else if(cs(Dn[Ht],wn))return Ht==="?"?i:Ht;return Dn.hasOwnProperty("*")?Dn["*"]:wn},TE={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},RE={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,y],[/opios[\/ ]+([\w\.]+)/i],[y,[m,ie+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[m,ie+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[m,ie]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[m,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[m,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[m,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[m,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[m,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[m,"UC"+se]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[m,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[m,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[m,"Smart Lenovo "+se]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+se],y],[/\bfocus\/([\w\.]+)/i],[y,[m,Je+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[m,ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[m,ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[m,"MIUI"+jt]],[/fxios\/([\w\.-]+)/i],[y,[m,Je]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[m,"360"]],[/\b(qq)\/([\w\.]+)/i],[[m,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1"+jt],y],[/samsungbrowser\/([\w\.]+)/i],[y,[m,he+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[m,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[m,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[m,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[m],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,G],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[m,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[m,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[m,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[m,le+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,le+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[m,"Android "+se]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[y,ku,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[m,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[m,Je+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[m,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[m,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,Gs]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",Gs]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,Gs]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[E,he],[g,D]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[E,he],[g,w]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[E,j],[g,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[E,j],[g,D]],[/(macintosh);/i],[f,[E,j]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[E,Te],[g,w]],[/(?:honor)([-\w ]+)[;\)]/i],[f,[E,"Honor"],[g,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[E,Fe],[g,D]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[E,Fe],[g,w]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[f,/_/g," "],[E,R],[g,w]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[E,R],[g,D]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[E,"OPPO"],[g,w]],[/\b(opd2\d{3}a?) bui/i],[f,[E,"OPPO"],[g,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[E,"Vivo"],[g,w]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[E,"Realme"],[g,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[E,_r],[g,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[E,_r],[g,D]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[E,Rt],[g,D]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[E,Rt],[g,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[E,"Lenovo"],[g,D]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[E,"Nokia"],[g,w]],[/(pixel c)\b/i],[f,[E,nt],[g,D]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[E,nt],[g,w]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[E,oe],[g,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[E,oe],[g,D]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[E,"OnePlus"],[g,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[E,H],[g,D]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[E,H],[g,w]],[/(playbook);[-\w\),; ]+(rim)/i],[f,E,[g,D]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[E,re],[g,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[E,J],[g,D]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[E,J],[g,w]],[/(nexus 9)/i],[f,[E,"HTC"],[g,D]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[E,[f,/_/g," "],[g,w]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[f,[E,"TCL"],[g,D]],[/(itel) ((\w+))/i],[[E,Gs],f,[g,ku,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[E,"Acer"],[g,D]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[E,"Meizu"],[g,w]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[E,"Ulefone"],[g,w]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[E,"Energizer"],[g,w]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[E,"Cat"],[g,w]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[E,"Smartfren"],[g,w]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[E,"Nothing"],[g,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[E,f,[g,w]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[E,f,[g,D]],[/(surface duo)/i],[f,[E,yt],[g,D]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[E,"Fairphone"],[g,w]],[/(u304aa)/i],[f,[E,"AT&T"],[g,w]],[/\bsie-(\w*)/i],[f,[E,"Siemens"],[g,w]],[/\b(rct\w+) b/i],[f,[E,"RCA"],[g,D]],[/\b(venue[\d ]{2,7}) b/i],[f,[E,"Dell"],[g,D]],[/\b(q(?:mv|ta)\w+) b/i],[f,[E,"Verizon"],[g,D]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[E,"Barnes & Noble"],[g,D]],[/\b(tm\d{3}\w+) b/i],[f,[E,"NuVision"],[g,D]],[/\b(k88) b/i],[f,[E,"ZTE"],[g,D]],[/\b(nx\d{3}j) b/i],[f,[E,"ZTE"],[g,w]],[/\b(gen\d{3}) b.+49h/i],[f,[E,"Swiss"],[g,w]],[/\b(zur\d{3}) b/i],[f,[E,"Swiss"],[g,D]],[/\b((zeki)?tb.*\b) b/i],[f,[E,"Zeki"],[g,D]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[E,"Dragon Touch"],f,[g,D]],[/\b(ns-?\w{0,9}) b/i],[f,[E,"Insignia"],[g,D]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[E,"NextBook"],[g,D]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[E,"Voice"],f,[g,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[E,"LvTel"],f,[g,w]],[/\b(ph-1) /i],[f,[E,"Essential"],[g,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[E,"Envizen"],[g,D]],[/\b(trio[-\w\. ]+) b/i],[f,[E,"MachSpeed"],[g,D]],[/\btu_(1491) b/i],[f,[E,"Rotor"],[g,D]],[/(shield[\w ]+) b/i],[f,[E,"Nvidia"],[g,D]],[/(sprint) (\w+)/i],[E,f,[g,w]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[E,yt],[g,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[E,V],[g,D]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[E,V],[g,w]],[/smart-tv.+(samsung)/i],[E,[g,P]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[E,he],[g,P]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[E,Rt],[g,P]],[/(apple) ?tv/i],[E,[f,j+" TV"],[g,P]],[/crkey/i],[[f,le+"cast"],[E,nt],[g,P]],[/droid.+aft(\w+)( bui|\))/i],[f,[E,H],[g,P]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[E,Te],[g,P]],[/(bravia[\w ]+)( bui|\))/i],[f,[E,oe],[g,P]],[/(mitv-\w{5}) bui/i],[f,[E,R],[g,P]],[/Hbbtv.*(technisat) (.*);/i],[E,f,[g,P]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[E,sf],[f,sf],[g,P]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,P]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[E,f,[g,C]],[/droid.+; (shield) bui/i],[f,[E,"Nvidia"],[g,C]],[/(playstation [345portablevi]+)/i],[f,[E,oe],[g,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[E,yt],[g,C]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[f,[E,he],[g,x]],[/((pebble))app/i],[E,f,[g,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[E,j],[g,x]],[/droid.+; (glass) \d/i],[f,[E,nt],[g,x]],[/droid.+; (wt63?0{2,3})\)/i],[f,[E,V],[g,x]],[/droid.+; (glass) \d/i],[f,[E,nt],[g,x]],[/(pico) (4|neo3(?: link|pro)?)/i],[E,f,[g,x]],[/; (quest( \d| pro)?)/i],[f,[E,G],[g,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[E,[g,K]],[/(aeobc)\b/i],[f,[E,H],[g,K]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[g,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[g,D]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,D]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,w]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[E,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[m,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[m,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[m,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[m,[y,ku,TE]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,ku,TE],[m,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,Ke],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,y],[/\(bb(10);/i],[y,[m,re]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[m,Je+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[m,le+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,ue],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,y],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[m,y]]},ls=function(wn,Dn){if(typeof wn===l&&(Dn=wn,wn=i),!(this instanceof ls))return new ls(wn,Dn).getResult();var Ht=typeof n!==c&&n.navigator?n.navigator:i,li=wn||(Ht&&Ht.userAgent?Ht.userAgent:""),vo=Ht&&Ht.userAgentData?Ht.userAgentData:i,mn=Dn?function(ht,yo){var Bl={};for(var Zo in ht)yo[Zo]&&yo[Zo].length%2==0?Bl[Zo]=yo[Zo].concat(ht[Zo]):Bl[Zo]=ht[Zo];return Bl}(RE,Dn):RE,Aa=Ht&&Ht.userAgent==li;return this.getBrowser=function(){var ht={};return ht[m]=i,ht[y]=i,Fl.call(ht,li,mn.browser),ht[h]=function(yo){return typeof yo===u?yo.replace(/[^\d\.]/g,"").split(".")[0]:i}(ht[y]),Aa&&Ht&&Ht.brave&&typeof Ht.brave.isBrave==o&&(ht[m]="Brave"),ht},this.getCPU=function(){var ht={};return ht[I]=i,Fl.call(ht,li,mn.cpu),ht},this.getDevice=function(){var ht={};return ht[E]=i,ht[f]=i,ht[g]=i,Fl.call(ht,li,mn.device),Aa&&!ht[g]&&vo&&vo.mobile&&(ht[g]=w),Aa&&ht[f]=="Macintosh"&&Ht&&typeof Ht.standalone!==c&&Ht.maxTouchPoints&&Ht.maxTouchPoints>2&&(ht[f]="iPad",ht[g]=D),ht},this.getEngine=function(){var ht={};return ht[m]=i,ht[y]=i,Fl.call(ht,li,mn.engine),ht},this.getOS=function(){var ht={};return ht[m]=i,ht[y]=i,Fl.call(ht,li,mn.os),Aa&&!ht[m]&&vo&&vo.platform&&vo.platform!="Unknown"&&(ht[m]=vo.platform.replace(/chrome os/i,ue).replace(/macos/i,Ke)),ht},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return li},this.setUA=function(ht){return li=typeof ht===u&&ht.length>500?sf(ht,500):ht,this},this.setUA(li),this};ls.VERSION="0.7.40",ls.BROWSER=Pn([m,y,h]),ls.CPU=Pn([I]),ls.DEVICE=Pn([f,E,g,C,w,P,D,x,K]),ls.ENGINE=ls.OS=Pn([m,y]),e.exports&&(t=e.exports=ls),t.UAParser=ls;var Ia=typeof n!==c&&(n.jQuery||n.Zepto);if(Ia&&!Ia.ua){var CE=new ls;Ia.ua=CE.getResult(),Ia.ua.get=function(){return CE.getUA()},Ia.ua.set=function(wn){CE.setUA(wn);var Dn=CE.getResult();for(var Ht in Dn)Ia.ua[Ht]=Dn[Ht]}}})(typeof window=="object"?window:d)})(uR,uR.exports);var TJ=p(uR.exports),mk=Xm.clear;It({global:!0,bind:!0,forced:F.clearImmediate!==mk},{clearImmediate:mk});var _k=F,RJ=W,CJ=Ze,wJ=yS,bJ=Zs,IJ=Ja,AJ=ol,OJ=_k.Function,NJ=/MSIE .\./.test(bJ)||wJ==="BUN"&&function(){var e=_k.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),PJ=It,gk=F,Ek=Xm.set,DJ=function(e,t){var n=1;return NJ?function(i,o){var c=AJ(arguments.length,1)>n,l=CJ(i)?i:OJ(i),u=c?IJ(arguments,n):[],h=c?function(){RJ(l,this,u)}:l;return e(h)}:e},vk=gk.setImmediate?DJ(Ek):Ek;PJ({global:!0,bind:!0,forced:gk.setImmediate!==vk},{setImmediate:vk});var yk=p(_i.setImmediate),kJ=F,LJ=DN,MJ=Oi,xJ=ol,UJ=Mt;It({global:!0,dontCallGetSet:!0,forced:_(function(){return UJ&&Object.getOwnPropertyDescriptor(kJ,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){xJ(arguments.length,1),LJ(MJ(e))}});var Sk=p(_i.queueMicrotask);function Tk(e,t){return function(){return e.apply(t,arguments)}}const{toString:VJ}=Object.prototype,{getPrototypeOf:hR}=Object,{iterator:R_,toStringTag:Rk}=Symbol,C_=(pR=Object.create(null),e=>{const t=VJ.call(e);return pR[t]||(pR[t]=t.slice(8,-1).toLowerCase())});var pR;const ro=e=>(e=e.toLowerCase(),t=>C_(t)===e),w_=e=>t=>typeof t===e,{isArray:Bd}=Array,tp=w_("undefined"),Ck=ro("ArrayBuffer"),jJ=w_("string"),Pi=w_("function"),wk=w_("number"),b_=e=>e!==null&&typeof e=="object",I_=e=>{if(C_(e)!=="object")return!1;const t=hR(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Rk in e||R_ in e)},FJ=ro("Date"),BJ=ro("File"),WJ=ro("Blob"),GJ=ro("FileList"),HJ=ro("URLSearchParams"),[KJ,zJ,YJ,qJ]=["ReadableStream","Request","Response","Headers"].map(ro);function np(e,t){let n,i,{allOwnKeys:o=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Bd(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const c=o?Object.getOwnPropertyNames(e):Object.keys(e),l=c.length;let u;for(n=0;n<l;n++)u=c[n],t.call(null,e[u],u,e)}}function bk(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,o=n.length;for(;o-- >0;)if(i=n[o],t===i.toLowerCase())return i;return null}const pl=fk!==void 0?fk:typeof self<"u"?self:typeof window<"u"?window:bE,Ik=e=>!tp(e)&&e!==pl,XJ=(fR=typeof Uint8Array<"u"&&hR(Uint8Array),e=>fR&&e instanceof fR);var fR;const JJ=ro("HTMLFormElement"),Ak=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),$J=ro("RegExp"),Ok=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};np(n,(o,c)=>{let l;(l=t(o,c,e))!==!1&&(i[c]=l||o)}),Object.defineProperties(e,i)},QJ=ro("AsyncFunction"),Nk=(Pk=typeof yk=="function",Dk=Pi(pl.postMessage),Pk?yk:Dk?(mR="axios@".concat(Math.random()),A_=[],pl.addEventListener("message",e=>{let{source:t,data:n}=e;t===pl&&n===mR&&A_.length&&A_.shift()()},!1),e=>{A_.push(e),pl.postMessage(mR,"*")}):e=>setTimeout(e));var Pk,Dk,mR,A_;const ZJ=Sk!==void 0?Sk.bind(pl):typeof process<"u"&&process.nextTick||Nk;var ge={isArray:Bd,isArrayBuffer:Ck,isBuffer:function(e){return e!==null&&!tp(e)&&e.constructor!==null&&!tp(e.constructor)&&Pi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Pi(e.append)&&((t=C_(e))==="formdata"||t==="object"&&Pi(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ck(e.buffer),t},isString:jJ,isNumber:wk,isBoolean:e=>e===!0||e===!1,isObject:b_,isPlainObject:I_,isReadableStream:KJ,isRequest:zJ,isResponse:YJ,isHeaders:qJ,isUndefined:tp,isDate:FJ,isFile:BJ,isBlob:WJ,isRegExp:$J,isFunction:Pi,isStream:e=>b_(e)&&Pi(e.pipe),isURLSearchParams:HJ,isTypedArray:XJ,isFileList:GJ,forEach:np,merge:function e(){const{caseless:t}=Ik(this)&&this||{},n={},i=(o,c)=>{const l=t&&bk(n,c)||c;I_(n[l])&&I_(o)?n[l]=e(n[l],o):I_(o)?n[l]=e({},o):Bd(o)?n[l]=o.slice():n[l]=o};for(let o=0,c=arguments.length;o<c;o++)arguments[o]&&np(arguments[o],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return np(t,(o,c)=>{n&&Pi(o)?e[c]=Tk(o,n):e[c]=o},{allOwnKeys:i}),e},trim:e=>Nr(e)?Nr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let o,c,l;const u={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),c=o.length;c-- >0;)l=o[c],i&&!i(l,e,t)||u[l]||(t[l]=e[l],u[l]=!0);e=n!==!1&&hR(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:C_,kindOfTest:ro,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(Bd(e))return e;let t=e.length;if(!wk(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[R_]).call(e);let i;for(;(i=n.next())&&!i.done;){const o=i.value;t.call(e,o[0],o[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:JJ,hasOwnProperty:Ak,hasOwnProp:Ak,reduceDescriptors:Ok,freezeMethods:e=>{Ok(e,(t,n)=>{if(Pi(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];Pi(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=o=>{o.forEach(c=>{n[c]=!0})};return Bd(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:bk,global:pl,isContextDefined:Ik,isSpecCompliantForm:function(e){return!!(e&&Pi(e.append)&&e[Rk]==="FormData"&&e[R_])},toJSONObject:e=>{const t=new Array(10),n=(i,o)=>{if(b_(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[o]=i;const c=Bd(i)?[]:{};return np(i,(l,u)=>{const h=n(l,o+1);!tp(h)&&(c[u]=h)}),t[o]=void 0,c}}return i};return n(e,0)},isAsyncFn:QJ,isThenable:e=>e&&(b_(e)||Pi(e))&&Pi(e.then)&&Pi(e.catch),setImmediate:Nk,asap:ZJ,isIterable:e=>e!=null&&Pi(e[R_])};function Pt(e,t,n,i,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),o&&(this.response=o,this.status=o.status?o.status:null)}ge.inherits(Pt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ge.toJSONObject(this.config),code:this.code,status:this.status}}});const kk=Pt.prototype,Lk={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Lk[e]={value:e}}),Object.defineProperties(Pt,Lk),Object.defineProperty(kk,"isAxiosError",{value:!0}),Pt.from=(e,t,n,i,o,c)=>{const l=Object.create(kk);return ge.toFlatObject(e,l,function(u){return u!==Error.prototype},u=>u!=="isAxiosError"),Pt.call(l,e.message,t,n,i,o),l.cause=e,l.name=e.name,c&&Object.assign(l,c),l};function _R(e){return ge.isPlainObject(e)||ge.isArray(e)}function Mk(e){return ge.endsWith(e,"[]")?e.slice(0,-2):e}function xk(e,t,n){return e?e.concat(t).map(function(i,o){return i=Mk(i),!n&&o?"["+i+"]":i}).join(n?".":""):t}const e$=ge.toFlatObject(ge,{},null,function(e){return/^is[A-Z]/.test(e)});function O_(e,t,n){if(!ge.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=ge.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,y){return!ge.isUndefined(y[E])})).metaTokens,o=n.visitor||f,c=n.dots,l=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&ge.isSpecCompliantForm(t);if(!ge.isFunction(o))throw new TypeError("visitor must be a function");function h(E){if(E===null)return"";if(ge.isDate(E))return E.toISOString();if(!u&&ge.isBlob(E))throw new Pt("Blob is not supported. Use a Buffer instead.");return ge.isArrayBuffer(E)||ge.isTypedArray(E)?u&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function f(E,y,I){let C=E;if(E&&!I&&typeof E=="object"){if(ge.endsWith(y,"{}"))y=i?y:y.slice(0,-2),E=JSON.stringify(E);else if(ge.isArray(E)&&function(w){return ge.isArray(w)&&!w.some(_R)}(E)||(ge.isFileList(E)||ge.endsWith(y,"[]"))&&(C=ge.toArray(E)))return y=Mk(y),C.forEach(function(w,D){!ge.isUndefined(w)&&w!==null&&t.append(l===!0?xk([y],D,c):l===null?y:y+"[]",h(w))}),!1}return!!_R(E)||(t.append(xk(I,y,c),h(E)),!1)}const m=[],g=Object.assign(e$,{defaultVisitor:f,convertValue:h,isVisitable:_R});if(!ge.isObject(e))throw new TypeError("data must be an object");return function E(y,I){if(!ge.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+I.join("."));m.push(y),ge.forEach(y,function(C,w){(!(ge.isUndefined(C)||C===null)&&o.call(t,C,ge.isString(w)?Nr(w).call(w):w,I,g))===!0&&E(C,I?I.concat(w):[w])}),m.pop()}}(e),t}function Uk(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function gR(e,t){this._pairs=[],e&&O_(e,this,t)}const Vk=gR.prototype;function t$(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function jk(e,t,n){if(!t)return e;const i=n&&n.encode||t$;ge.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let c;if(c=o?o(t,n):ge.isURLSearchParams(t)?t.toString():new gR(t,n).toString(i),c){const l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+c}return e}Vk.append=function(e,t){this._pairs.push([e,t])},Vk.toString=function(e){const t=e?function(n){return e.call(this,n,Uk)}:Uk;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var Fk=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ge.forEach(this.handlers,function(t){t!==null&&e(t)})}},Bk={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Wk={exports:{}},n$=It,r$=Mt,Gk=Ss.f;n$({target:"Object",stat:!0,forced:Object.defineProperty!==Gk,sham:!r$},{defineProperty:Gk});var Hk=_i.Object,i$=Wk.exports=function(e,t,n){return Hk.defineProperty(e,t,n)};Hk.defineProperty.sham&&(i$.sham=!0);var Kk=p(Wk.exports),s$=TypeError,zk=xh,o$=qm,a$=Bn,c$=An("species"),Yk=Array,l$=function(e){var t;return zk(e)&&(t=e.constructor,(o$(t)&&(t===Yk||zk(t.prototype))||a$(t)&&(t=t[c$])===null)&&(t=void 0)),t===void 0?Yk:t},qk=function(e,t){return new(l$(e))(t===0?0:t)},d$=_,u$=Do,h$=An("species"),Xk=function(e){return u$>=51||!d$(function(){var t=[];return(t.constructor={})[h$]=function(){return{foo:1}},t[e](Boolean).foo!==1})},p$=It,f$=_,m$=xh,_$=Bn,g$=ko,E$=Ya,Jk=function(e){if(e>9007199254740991)throw s$("Maximum allowed index exceeded");return e},$k=kT,v$=qk,y$=Xk,S$=Do,Qk=An("isConcatSpreadable"),T$=S$>=51||!f$(function(){var e=[];return e[Qk]=!1,e.concat()[0]!==e}),R$=function(e){if(!_$(e))return!1;var t=e[Qk];return t!==void 0?!!t:m$(e)};p$({target:"Array",proto:!0,forced:!T$||!y$("concat")},{concat:function(e){var t,n,i,o,c,l=g$(this),u=v$(l,0),h=0;for(t=-1,i=arguments.length;t<i;t++)if(R$(c=t===-1?l:arguments[t]))for(o=E$(c),Jk(h+o),n=0;n<o;n++,h++)n in c&&$k(u,h,c[n]);else Jk(h+1),$k(u,h++,c);return u.length=h,u}});var Zk={},C$=we,w$=_n,e1=Dm.f,b$=Ja,t1=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Zk.f=function(e){return t1&&C$(e)==="Window"?function(t){try{return e1(t)}catch{return b$(t1)}}(e):e1(w$(e))};var Wd={},I$=An;Wd.f=I$;var n1=_i,A$=vr,O$=Wd,N$=Ss.f,Yn=function(e){var t=n1.Symbol||(n1.Symbol={});A$(t,e)||N$(t,e,{value:O$.f(e)})},P$=Ae,D$=Or,k$=An,L$=Xa,r1=function(){var e=D$("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=k$("toPrimitive");t&&!t[i]&&L$(t,i,function(o){return P$(n,this)},{})},M$=za,x$=Fn,U$=ko,V$=Ya,j$=qk,i1=U([].push),F$=function(e){var t=e===1,n=e===2,i=e===3,o=e===4,c=e===6,l=e===7,u=e===5||c;return function(h,f,m,g){for(var E,y,I=U$(h),C=x$(I),w=V$(C),D=M$(f,m),P=0,x=g||j$,K=t?x(h,w):n||l?x(h,0):void 0;w>P;P++)if((u||P in C)&&(y=D(E=C[P],P,I),e))if(t)K[P]=y;else if(y)switch(e){case 3:return!0;case 5:return E;case 6:return P;case 2:i1(K,E)}else switch(e){case 4:return!1;case 7:i1(K,E)}return c?-1:i||o?o:K}},s1={forEach:F$(0)},N_=It,rp=F,ER=Ae,B$=U,Gd=Mt,Hd=et,W$=_,Vr=vr,G$=B,vR=gi,P_=_n,yR=aS,H$=Ni,SR=Et,Kd=Vh,o1=Lm,K$=Dm,a1=Zk,z$=Uh,c1=Kt,l1=Ss,Y$=IS,d1=fe,u1=Xa,q$=Ym,TR=Ed,h1=km,p1=sS,X$=An,J$=Wd,$$=Yn,Q$=r1,Z$=ha,f1=sl,D_=s1.forEach,Di=Pm("hidden"),k_="Symbol",ip="prototype",eQ=f1.set,m1=f1.getterFor(k_),io=Object[ip],fl=rp.Symbol,L_=fl&&fl[ip],tQ=rp.RangeError,nQ=rp.TypeError,RR=rp.QObject,_1=c1.f,ml=l1.f,g1=a1.f,rQ=d1.f,E1=B$([].push),ma=TR("symbols"),sp=TR("op-symbols"),iQ=TR("wks"),CR=!RR||!RR[ip]||!RR[ip].findChild,v1=function(e,t,n){var i=_1(io,t);i&&delete io[t],ml(e,t,n),i&&e!==io&&ml(io,t,i)},wR=Gd&&W$(function(){return Kd(ml({},"a",{get:function(){return ml(this,"a",{value:7}).a}})).a!==7})?v1:ml,bR=function(e,t){var n=ma[e]=Kd(L_);return eQ(n,{type:k_,tag:e,description:t}),Gd||(n.description=t),n},M_=function(e,t,n){e===io&&M_(sp,t,n),vR(e);var i=yR(t);return vR(n),Vr(ma,i)?(n.enumerable?(Vr(e,Di)&&e[Di][i]&&(e[Di][i]=!1),n=Kd(n,{enumerable:SR(0,!1)})):(Vr(e,Di)||ml(e,Di,SR(1,Kd(null))),e[Di][i]=!0),wR(e,i,n)):ml(e,i,n)},IR=function(e,t){vR(e);var n=P_(t),i=o1(n).concat(R1(n));return D_(i,function(o){Gd&&!ER(y1,n,o)||M_(e,o,n[o])}),e},y1=function(e){var t=yR(e),n=ER(rQ,this,t);return!(this===io&&Vr(ma,t)&&!Vr(sp,t))&&(!(n||!Vr(this,t)||!Vr(ma,t)||Vr(this,Di)&&this[Di][t])||n)},S1=function(e,t){var n=P_(e),i=yR(t);if(n!==io||!Vr(ma,i)||Vr(sp,i)){var o=_1(n,i);return!o||!Vr(ma,i)||Vr(n,Di)&&n[Di][i]||(o.enumerable=!0),o}},T1=function(e){var t=g1(P_(e)),n=[];return D_(t,function(i){Vr(ma,i)||Vr(h1,i)||E1(n,i)}),n},R1=function(e){var t=e===io,n=g1(t?sp:P_(e)),i=[];return D_(n,function(o){!Vr(ma,o)||t&&!Vr(io,o)||E1(i,ma[o])}),i};Hd||(fl=function(){if(G$(L_,this))throw new nQ("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?H$(arguments[0]):void 0,t=p1(e),n=function(i){var o=this===void 0?rp:this;o===io&&ER(n,sp,i),Vr(o,Di)&&Vr(o[Di],t)&&(o[Di][t]=!1);var c=SR(1,i);try{wR(o,t,c)}catch(l){if(!(l instanceof tQ))throw l;v1(o,t,c)}};return Gd&&CR&&wR(io,t,{configurable:!0,set:n}),bR(t,e)},u1(L_=fl[ip],"toString",function(){return m1(this).tag}),u1(fl,"withoutSetter",function(e){return bR(p1(e),e)}),d1.f=y1,l1.f=M_,Y$.f=IR,c1.f=S1,K$.f=a1.f=T1,z$.f=R1,J$.f=function(e){return bR(X$(e),e)},Gd&&q$(L_,"description",{configurable:!0,get:function(){return m1(this).description}})),N_({global:!0,wrap:!0,forced:!Hd,sham:!Hd},{Symbol:fl}),D_(o1(iQ),function(e){$$(e)}),N_({target:k_,stat:!0,forced:!Hd},{useSetter:function(){CR=!0},useSimple:function(){CR=!1}}),N_({target:"Object",stat:!0,forced:!Hd,sham:!Gd},{create:function(e,t){return t===void 0?Kd(e):IR(Kd(e),t)},defineProperty:M_,defineProperties:IR,getOwnPropertyDescriptor:S1}),N_({target:"Object",stat:!0,forced:!Hd},{getOwnPropertyNames:T1}),Q$(),Z$(fl,k_),h1[Di]=!0;var C1=et&&!!Symbol.for&&!!Symbol.keyFor,sQ=It,oQ=Or,aQ=vr,cQ=Ni,w1=Ed,lQ=C1,AR=w1("string-to-symbol-registry"),dQ=w1("symbol-to-string-registry");sQ({target:"Symbol",stat:!0,forced:!lQ},{for:function(e){var t=cQ(e);if(aQ(AR,t))return AR[t];var n=oQ("Symbol")(t);return AR[t]=n,dQ[n]=t,n}});var uQ=It,hQ=vr,pQ=ys,fQ=Ka,mQ=C1,b1=Ed("symbol-to-string-registry");uQ({target:"Symbol",stat:!0,forced:!mQ},{keyFor:function(e){if(!pQ(e))throw new TypeError(fQ(e)+" is not a symbol");if(hQ(b1,e))return b1[e]}});var I1=xh,_Q=Ze,A1=we,gQ=Ni,O1=U([].push),EQ=It,N1=Or,P1=W,vQ=Ae,op=U,D1=_,k1=Ze,L1=ys,M1=Ja,yQ=function(e){if(_Q(e))return e;if(I1(e)){for(var t=e.length,n=[],i=0;i<t;i++){var o=e[i];typeof o=="string"?O1(n,o):typeof o!="number"&&A1(o)!=="Number"&&A1(o)!=="String"||O1(n,gQ(o))}var c=n.length,l=!0;return function(u,h){if(l)return l=!1,h;if(I1(this))return h;for(var f=0;f<c;f++)if(n[f]===u)return h}}},SQ=et,TQ=String,nc=N1("JSON","stringify"),x_=op(/./.exec),x1=op("".charAt),RQ=op("".charCodeAt),CQ=op("".replace),wQ=op(1 .toString),bQ=/[\uD800-\uDFFF]/g,U1=/^[\uD800-\uDBFF]$/,V1=/^[\uDC00-\uDFFF]$/,j1=!SQ||D1(function(){var e=N1("Symbol")("stringify detection");return nc([e])!=="[null]"||nc({a:e})!=="{}"||nc(Object(e))!=="{}"}),F1=D1(function(){return nc("\uDF06\uD834")!=='"\\udf06\\ud834"'||nc("\uDEAD")!=='"\\udead"'}),IQ=function(e,t){var n=M1(arguments),i=yQ(t);if(k1(i)||e!==void 0&&!L1(e))return n[1]=function(o,c){if(k1(i)&&(c=vQ(i,this,TQ(o),c)),!L1(c))return c},P1(nc,null,n)},AQ=function(e,t,n){var i=x1(n,t-1),o=x1(n,t+1);return x_(U1,e)&&!x_(V1,o)||x_(V1,e)&&!x_(U1,i)?"\\u"+wQ(RQ(e,0),16):e};nc&&EQ({target:"JSON",stat:!0,forced:j1||F1},{stringify:function(e,t,n){var i=M1(arguments),o=P1(j1?IQ:nc,null,i);return F1&&typeof o=="string"?CQ(o,bQ,AQ):o}});var B1=Uh,OQ=ko;It({target:"Object",stat:!0,forced:!et||_(function(){B1.f(1)})},{getOwnPropertySymbols:function(e){var t=B1.f;return t?t(OQ(e)):[]}}),Yn("asyncIterator"),Yn("hasInstance"),Yn("isConcatSpreadable"),Yn("iterator"),Yn("match"),Yn("matchAll"),Yn("replace"),Yn("search"),Yn("species"),Yn("split");var NQ=r1;Yn("toPrimitive"),NQ();var PQ=Or,DQ=ha;Yn("toStringTag"),DQ(PQ("Symbol"),"Symbol"),Yn("unscopables"),ha(F.JSON,"JSON",!0);var kQ=_i.Symbol,LQ=An,MQ=Ss.f,W1=LQ("metadata"),G1=Function.prototype;G1[W1]===void 0&&MQ(G1,W1,{value:null}),Yn("asyncDispose"),Yn("dispose"),Yn("metadata");var xQ=kQ,UQ=U,OR=Or("Symbol"),VQ=OR.keyFor,jQ=UQ(OR.prototype.valueOf),H1=OR.isRegisteredSymbol||function(e){try{return VQ(jQ(e))!==void 0}catch{return!1}};It({target:"Symbol",stat:!0},{isRegisteredSymbol:H1});for(var FQ=Ed,K1=Or,BQ=U,WQ=ys,GQ=An,U_=K1("Symbol"),z1=U_.isWellKnownSymbol,Y1=K1("Object","getOwnPropertyNames"),HQ=BQ(U_.prototype.valueOf),q1=FQ("wks"),NR=0,X1=Y1(U_),KQ=X1.length;NR<KQ;NR++)try{var J1=X1[NR];WQ(U_[J1])&&GQ(J1)}catch{}var $1=function(e){if(z1&&z1(e))return!0;try{for(var t=HQ(e),n=0,i=Y1(q1),o=i.length;n<o;n++)if(q1[i[n]]==t)return!0}catch{}return!1};It({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:$1}),Yn("customMatcher"),Yn("observable"),It({target:"Symbol",stat:!0},{isRegistered:H1}),It({target:"Symbol",stat:!0,forced:!0},{isWellKnown:$1}),Yn("matcher"),Yn("metadataKey"),Yn("patternMatch"),Yn("replaceAll");var zd=p(xQ),Q1=p(Wd.f("iterator"));function ap(e){return ap=typeof zd=="function"&&typeof Q1=="symbol"?function(t){return typeof t}:function(t){return t&&typeof zd=="function"&&t.constructor===zd&&t!==zd.prototype?"symbol":typeof t},ap(e)}var zQ=p(Wd.f("toPrimitive"));function YQ(e){var t=function(n,i){if(ap(n)!="object"||!n)return n;var o=n[zQ];if(o!==void 0){var c=o.call(n,i);if(ap(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(e,"string");return ap(t)=="symbol"?t:t+""}function O(e,t,n){return(t=YQ(t))in e?Kk(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z1=p(Yq),qQ={isBrowser:!0,classes:{URLSearchParams:Z1!==void 0?Z1:gR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const PR=typeof window<"u"&&typeof document<"u",DR=typeof navigator=="object"&&navigator||void 0,XQ=PR&&(!DR||["ReactNative","NativeScript","NS"].indexOf(DR.product)<0),JQ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",$Q=PR&&window.location.href||"http://localhost";function eL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function tL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eL(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eL(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var ri=tL(tL({},Object.freeze({__proto__:null,hasBrowserEnv:PR,hasStandardBrowserEnv:XQ,hasStandardBrowserWebWorkerEnv:JQ,navigator:DR,origin:$Q})),qQ),QQ=gi,ZQ=Ae,eZ=vr,tZ=B,nZ=function(){var e=QQ(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},nL=RegExp.prototype,rL=function(e){var t=e.flags;return t!==void 0||"flags"in nL||eZ(e,"flags")||!tZ(nL,e)?t:ZQ(nZ,e)},rZ=vT.charAt,iL=Ae,iZ=gi,sZ=Ze,oZ=we,aZ=/./.exec,cZ=TypeError,lZ=It,sL=Ae,oL=Ue,dZ=FS,V_=Km,aL=vs,cL=aO,cp=Ni,uZ=gi,hZ=Bn,pZ=we,fZ=lO,lL=rL,mZ=wm,_Z=_,gZ=zS,EZ=function(e,t,n){return t+(n?rZ(e,t).length:1)},vZ=function(e,t){var n=e.exec;if(sZ(n)){var i=iL(n,e,t);return i!==null&&iZ(i),i}if(oZ(e)==="RegExp")return iL(aZ,e,t);throw new cZ("RegExp#exec called on incompatible receiver")},dL=sl,yZ=An("matchAll"),uL="RegExp String",hL=uL+" Iterator",SZ=dL.set,TZ=dL.getterFor(hL),RZ=TypeError,kR=oL("".indexOf),j_=oL("".matchAll),LR=!!j_&&!_Z(function(){j_("a",/./)}),CZ=dZ(function(e,t,n,i){SZ(this,{type:hL,regexp:e,string:t,global:n,unicode:i,done:!1})},uL,function(){var e=TZ(this);if(e.done)return V_(void 0,!0);var t=e.regexp,n=e.string,i=vZ(t,n);return i===null?(e.done=!0,V_(void 0,!0)):e.global?(cp(i[0])===""&&(t.lastIndex=EZ(n,cL(t.lastIndex),e.unicode)),V_(i,!1)):(e.done=!0,V_(i,!1))}),pL=function(e){var t,n,i,o=uZ(this),c=cp(e),l=gZ(o,RegExp),u=cp(lL(o));return t=new l(l===RegExp?o.source:o,u),n=!!~kR(u,"g"),i=!!~kR(u,"u"),t.lastIndex=cL(o.lastIndex),new CZ(t,c,n,i)};lZ({target:"String",proto:!0,forced:LR},{matchAll:function(e){var t,n,i,o,c=aL(this);if(hZ(e)){if(fZ(e)&&(t=cp(aL(lL(e))),!~kR(t,"g")))throw new RZ("`.matchAll` does not allow non-global regexes");if(LR)return j_(c,e);if((i=mZ(e,yZ))===void 0&&pZ(e)==="RegExp"&&(i=pL),i)return sL(i,e,c)}else if(LR)return j_(c,e);return n=cp(c),o=new RegExp(e,"g"),sL(pL,o,n)}});var wZ=Ts("String","matchAll"),bZ=B,IZ=wZ,MR=String.prototype,AZ=function(e){var t=e.matchAll;return typeof e=="string"||e===MR||bZ(MR,e)&&t===MR.matchAll?IZ:t},OZ=p(AZ);function fL(e){function t(n,i,o,c){let l=n[c++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),h=c>=n.length;return l=!l&&ge.isArray(o)?o.length:l,h?(ge.hasOwnProp(o,l)?o[l]=[o[l],i]:o[l]=i,!u):(o[l]&&ge.isObject(o[l])||(o[l]=[]),t(n,i,o[l],c)&&ge.isArray(o[l])&&(o[l]=function(f){const m={},g=Object.keys(f);let E;const y=g.length;let I;for(E=0;E<y;E++)I=g[E],m[I]=f[I];return m}(o[l])),!u)}if(ge.isFormData(e)&&ge.isFunction(e.entries)){const n={};return ge.forEachEntry(e,(i,o)=>{t(function(c){return OZ(ge).call(ge,/\w+|\[(\w*)]/g,c).map(l=>l[0]==="[]"?"":l[1]||l[0])}(i),o,n,0)}),n}return null}const xR={transitional:Bk,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,o=ge.isObject(e);if(o&&ge.isHTMLForm(e)&&(e=new FormData(e)),ge.isFormData(e))return i?JSON.stringify(fL(e)):e;if(ge.isArrayBuffer(e)||ge.isBuffer(e)||ge.isStream(e)||ge.isFile(e)||ge.isBlob(e)||ge.isReadableStream(e))return e;if(ge.isArrayBufferView(e))return e.buffer;if(ge.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(l,u){return O_(l,new ri.classes.URLSearchParams,Object.assign({visitor:function(h,f,m,g){return ri.isNode&&ge.isBuffer(h)?(this.append(f,h.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},u))}(e,this.formSerializer).toString();if((c=ge.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return O_(c?{"files[]":e}:e,l&&new l,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),function(l,u,h){if(ge.isString(l))try{return(u||JSON.parse)(l),Nr(ge).call(ge,l)}catch(f){if(f.name!=="SyntaxError")throw f}return(h||JSON.stringify)(l)}(e)):e}],transformResponse:[function(e){const t=this.transitional||xR.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(ge.isResponse(e)||ge.isReadableStream(e))return e;if(e&&ge.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(c){if(o)throw c.name==="SyntaxError"?Pt.from(c,Pt.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ri.classes.FormData,Blob:ri.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ge.forEach(["delete","get","head","post","put","patch"],e=>{xR.headers[e]={}});var UR=xR;const NZ=ge.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),mL=Symbol("internals");function lp(e){var t;return e&&Nr(t=String(e)).call(t).toLowerCase()}function F_(e){return e===!1||e==null?e:ge.isArray(e)?e.map(F_):String(e)}function VR(e,t,n,i,o){return ge.isFunction(i)?i.call(this,t,n):(o&&(t=n),ge.isString(t)?ge.isString(i)?t.indexOf(i)!==-1:ge.isRegExp(i)?i.test(t):void 0:void 0)}class B_{constructor(t){t&&this.set(t)}set(t,n,i){const o=this;function c(h,f,m){const g=lp(f);if(!g)throw new Error("header name must be a non-empty string");const E=ge.findKey(o,g);(!E||o[E]===void 0||m===!0||m===void 0&&o[E]!==!1)&&(o[E||f]=F_(h))}const l=(h,f)=>ge.forEach(h,(m,g)=>c(m,g,f));if(ge.isPlainObject(t)||t instanceof this.constructor)l(t,n);else if(ge.isString(t)&&(t=Nr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Nr(u=t).call(u)))l((h=>{const f={};let m,g,E;return h&&h.split(`
`).forEach(function(y){var I,C;E=y.indexOf(":"),m=Nr(I=y.substring(0,E)).call(I).toLowerCase(),g=Nr(C=y.substring(E+1)).call(C),!m||f[m]&&NZ[m]||(m==="set-cookie"?f[m]?f[m].push(g):f[m]=[g]:f[m]=f[m]?f[m]+", "+g:g)}),f})(t),n);else if(ge.isObject(t)&&ge.isIterable(t)){let h,f,m={};for(const g of t){if(!ge.isArray(g))throw TypeError("Object iterator must return a key-value pair");m[f=g[0]]=(h=m[f])?ge.isArray(h)?[...h,g[1]]:[h,g[1]]:g[1]}l(m,n)}else t!=null&&c(n,t,i);var u;return this}get(t,n){if(t=lp(t)){const i=ge.findKey(this,t);if(i){const o=this[i];if(!n)return o;if(n===!0)return function(c){const l=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=u.exec(c);)l[h[1]]=h[2];return l}(o);if(ge.isFunction(n))return n.call(this,o,i);if(ge.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=lp(t)){const i=ge.findKey(this,t);return!(!i||this[i]===void 0||n&&!VR(0,this[i],i,n))}return!1}delete(t,n){const i=this;let o=!1;function c(l){if(l=lp(l)){const u=ge.findKey(i,l);!u||n&&!VR(0,i[u],u,n)||(delete i[u],o=!0)}}return ge.isArray(t)?t.forEach(c):c(t),o}clear(t){const n=Object.keys(this);let i=n.length,o=!1;for(;i--;){const c=n[i];t&&!VR(0,this[c],c,t,!0)||(delete this[c],o=!0)}return o}normalize(t){const n=this,i={};return ge.forEach(this,(o,c)=>{var l;const u=ge.findKey(i,c);if(u)return n[u]=F_(o),void delete n[c];const h=t?function(f){return Nr(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,g,E)=>g.toUpperCase()+E)}(c):Nr(l=String(c)).call(l);h!==c&&delete n[c],n[h]=F_(o),i[h]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return ge.forEach(this,(i,o)=>{i!=null&&i!==!1&&(n[o]=t&&ge.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];return o.forEach(l=>n.set(l)),n}static accessor(t){const n=(this[mL]=this[mL]={accessors:{}}).accessors,i=this.prototype;function o(c){const l=lp(c);n[l]||(function(u,h){const f=ge.toCamelCase(" "+h);["get","set","has"].forEach(m=>{Object.defineProperty(u,m+f,{value:function(g,E,y){return this[m].call(this,h,g,E,y)},configurable:!0})})}(i,c),n[l]=!0)}return ge.isArray(t)?t.forEach(o):o(t),this}}B_.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ge.reduceDescriptors(B_.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(o){this[i]=o}}}),ge.freezeMethods(B_);var so=B_;function jR(e,t){const n=this||UR,i=t||n,o=so.from(i.headers);let c=i.data;return ge.forEach(e,function(l){c=l.call(n,c,o.normalize(),t?t.status:void 0)}),o.normalize(),c}function _L(e){return!(!e||!e.__CANCEL__)}function Yd(e,t,n){Pt.call(this,e??"canceled",Pt.ERR_CANCELED,t,n),this.name="CanceledError"}function gL(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new Pt("Request failed with status code "+n.status,[Pt.ERR_BAD_REQUEST,Pt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}ge.inherits(Yd,Pt,{__CANCEL__:!0});const W_=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const o=function(c,l){c=c||10;const u=new Array(c),h=new Array(c);let f,m=0,g=0;return l=l!==void 0?l:1e3,function(E){const y=Date.now(),I=h[g];f||(f=y),u[m]=E,h[m]=y;let C=g,w=0;for(;C!==m;)w+=u[C++],C%=c;if(m=(m+1)%c,m===g&&(g=(g+1)%c),y-f<l)return;const D=I&&y-I;return D?Math.round(1e3*w/D):void 0}}(50,250);return function(c,l){let u,h,f=0,m=1e3/l;const g=function(E){f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),u=null,h&&(clearTimeout(h),h=null),c.apply(null,E)};return[function(){const E=Date.now(),y=E-f;for(var I=arguments.length,C=new Array(I),w=0;w<I;w++)C[w]=arguments[w];y>=m?g(C,E):(u=C,h||(h=setTimeout(()=>{h=null,g(u)},m-y)))},()=>u&&g(u)]}(c=>{const l=c.loaded,u=c.lengthComputable?c.total:void 0,h=l-i,f=o(h);i=l,e({loaded:l,total:u,progress:u?l/u:void 0,bytes:h,rate:f||void 0,estimated:f&&u&&l<=u?(u-l)/f:void 0,event:c,lengthComputable:u!=null,[t?"download":"upload"]:!0})},n)},EL=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},vL=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return ge.asap(()=>e(...n))};var PZ=ri.hasStandardBrowserEnv?((e,t)=>n=>(n=new __(n,ri.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new __(ri.origin),ri.navigator&&/(msie|trident)/i.test(ri.navigator.userAgent)):()=>!0,DZ=ri.hasStandardBrowserEnv?{write(e,t,n,i,o,c){const l=[e+"="+encodeURIComponent(t)];ge.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),ge.isString(i)&&l.push("path="+i),ge.isString(o)&&l.push("domain="+o),c===!0&&l.push("secure"),document.cookie=l.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function yL(e,t,n){let i=!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(t);return e&&(i||n==0)?function(o,c){return c?o.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):o}(e,t):t}function SL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}const TL=e=>e instanceof so?function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?SL(Object(i),!0).forEach(function(o){O(t,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):SL(Object(i)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(i,o))})}return t}({},e):e;function _l(e,t){t=t||{};const n={};function i(f,m,g,E){return ge.isPlainObject(f)&&ge.isPlainObject(m)?ge.merge.call({caseless:E},f,m):ge.isPlainObject(m)?ge.merge({},m):ge.isArray(m)?m.slice():m}function o(f,m,g,E){return ge.isUndefined(m)?ge.isUndefined(f)?void 0:i(void 0,f,0,E):i(f,m,0,E)}function c(f,m){if(!ge.isUndefined(m))return i(void 0,m)}function l(f,m){return ge.isUndefined(m)?ge.isUndefined(f)?void 0:i(void 0,f):i(void 0,m)}function u(f,m,g){return g in t?i(f,m):g in e?i(void 0,f):void 0}const h={url:c,method:c,data:c,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(f,m,g)=>o(TL(f),TL(m),0,!0)};return ge.forEach(Object.keys(Object.assign({},e,t)),function(f){const m=h[f]||o,g=m(e[f],t[f],f);ge.isUndefined(g)&&m!==u||(n[f]=g)}),n}var RL=e=>{const t=_l({},e);let n,{data:i,withXSRFToken:o,xsrfHeaderName:c,xsrfCookieName:l,headers:u,auth:h}=t;if(t.headers=u=so.from(u),t.url=jk(yL(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),h&&u.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),ge.isFormData(i)){if(ri.hasStandardBrowserEnv||ri.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((n=u.getContentType())!==!1){const[f,...m]=n?n.split(";").map(g=>Nr(g).call(g)).filter(Boolean):[];u.setContentType([f||"multipart/form-data",...m].join("; "))}}if(ri.hasStandardBrowserEnv&&(o&&ge.isFunction(o)&&(o=o(t)),o||o!==!1&&PZ(t.url))){const f=c&&l&&DZ.read(l);f&&u.set(c,f)}return t},kZ=typeof XMLHttpRequest<"u"&&function(e){return new ve(function(t,n){const i=RL(e);let o=i.data;const c=so.from(i.headers).normalize();let l,u,h,f,m,{responseType:g,onUploadProgress:E,onDownloadProgress:y}=i;function I(){f&&f(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(l),i.signal&&i.signal.removeEventListener("abort",l)}let C=new XMLHttpRequest;function w(){if(!C)return;const P=so.from("getAllResponseHeaders"in C&&C.getAllResponseHeaders());gL(function(x){t(x),I()},function(x){n(x),I()},{data:g&&g!=="text"&&g!=="json"?C.response:C.responseText,status:C.status,statusText:C.statusText,headers:P,config:e,request:C}),C=null}C.open(i.method.toUpperCase(),i.url,!0),C.timeout=i.timeout,"onloadend"in C?C.onloadend=w:C.onreadystatechange=function(){C&&C.readyState===4&&(C.status!==0||C.responseURL&&C.responseURL.indexOf("file:")===0)&&setTimeout(w)},C.onabort=function(){C&&(n(new Pt("Request aborted",Pt.ECONNABORTED,e,C)),C=null)},C.onerror=function(){n(new Pt("Network Error",Pt.ERR_NETWORK,e,C)),C=null},C.ontimeout=function(){let P=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const x=i.transitional||Bk;i.timeoutErrorMessage&&(P=i.timeoutErrorMessage),n(new Pt(P,x.clarifyTimeoutError?Pt.ETIMEDOUT:Pt.ECONNABORTED,e,C)),C=null},o===void 0&&c.setContentType(null),"setRequestHeader"in C&&ge.forEach(c.toJSON(),function(P,x){C.setRequestHeader(x,P)}),ge.isUndefined(i.withCredentials)||(C.withCredentials=!!i.withCredentials),g&&g!=="json"&&(C.responseType=i.responseType),y&&([h,m]=W_(y,!0),C.addEventListener("progress",h)),E&&C.upload&&([u,f]=W_(E),C.upload.addEventListener("progress",u),C.upload.addEventListener("loadend",f)),(i.cancelToken||i.signal)&&(l=P=>{C&&(n(!P||P.type?new Yd(null,e,C):P),C.abort(),C=null)},i.cancelToken&&i.cancelToken.subscribe(l),i.signal&&(i.signal.aborted?l():i.signal.addEventListener("abort",l)));const D=function(P){const x=/^([-+\w]{1,25})(:?\/\/|:)/.exec(P);return x&&x[1]||""}(i.url);D&&ri.protocols.indexOf(D)===-1?n(new Pt("Unsupported protocol "+D+":",Pt.ERR_BAD_REQUEST,e)):C.send(o||null)})},LZ=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,o=new AbortController;const c=function(f){if(!i){i=!0,u();const m=f instanceof Error?f:this.reason;o.abort(m instanceof Pt?m:new Yd(m instanceof Error?m.message:m))}};let l=t&&setTimeout(()=>{l=null,c(new Pt("timeout ".concat(t," of ms exceeded"),Pt.ETIMEDOUT))},t);const u=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(c):f.removeEventListener("abort",c)}),e=null)};e.forEach(f=>f.addEventListener("abort",c));const{signal:h}=o;return h.unsubscribe=()=>ge.asap(u),h}},FR=p(dP),CL=Wd.f("asyncIterator"),MZ=p(CL);function BR(e,t){this.v=e,this.k=t}function Qi(e){return function(){return new dp(e.apply(this,arguments))}}function dp(e){var t,n;function i(c,l){try{var u=e[c](l),h=u.value,f=h instanceof BR;FR.resolve(f?h.v:h).then(function(m){if(f){var g=c==="return"?"return":"next";if(!h.k||m.done)return i(g,m);m=e[g](m).value}o(u.done?"return":"normal",m)},function(m){i("throw",m)})}catch(m){o("throw",m)}}function o(c,l){switch(c){case"return":t.resolve({value:l,done:!0});break;case"throw":t.reject(l);break;default:t.resolve({value:l,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(c,l){return new FR(function(u,h){var f={key:c,arg:l,resolve:u,reject:h,next:null};n?n=n.next=f:(t=n=f,i(c,l))})},typeof e.return!="function"&&(this.return=void 0)}function pt(e){return new BR(e,0)}function G_(e){var t={},n=!1;function i(o,c){return n=!0,c=new FR(function(l){l(e[o](c))}),{done:!1,value:new BR(c,1)}}return t[zd!==void 0&&Q1||"@@iterator"]=function(){return this},t.next=function(o){return n?(n=!1,o):i("next",o)},typeof e.throw=="function"&&(t.throw=function(o){if(n)throw n=!1,o;return i("throw",o)}),typeof e.return=="function"&&(t.return=function(o){return n?(n=!1,o):i("return",o)}),t}dp.prototype[typeof zd=="function"&&MZ||"@@asyncIterator"]=function(){return this},dp.prototype.next=function(e){return this._invoke("next",e)},dp.prototype.throw=function(e){return this._invoke("throw",e)},dp.prototype.return=function(e){return this._invoke("return",e)};var WR=p(CL);function GR(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=WR,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new H_(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function H_(e){function t(n){if(Object(n)!==n)return ve.reject(new TypeError(n+" is not an object."));var i=n.done;return ve.resolve(n.value).then(function(o){return{value:o,done:i}})}return H_=function(n){this.s=n,this.n=n.next},H_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?ve.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?ve.reject(n):t(i.apply(this.s,arguments))}},new H_(e)}const xZ=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,o=0;for(;o<n;)i=o+t,yield e.slice(o,i),o=i},UZ=function(){var e=Qi(function*(t,n){var i,o=!1,c=!1;try{for(var l,u=GR(VZ(t));o=!(l=yield pt(u.next())).done;o=!1){const h=l.value;yield*G_(GR(xZ(h,n)))}}catch(h){c=!0,i=h}finally{try{o&&u.return!=null&&(yield pt(u.return()))}finally{if(c)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),VZ=function(){var e=Qi(function*(t){if(t[WR])return void(yield*G_(GR(t)));const n=t.getReader();try{for(;;){const{done:i,value:o}=yield pt(n.read());if(i)break;yield o}}finally{yield pt(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),wL=(e,t,n,i)=>{const o=UZ(e,t);let c,l=0,u=h=>{c||(c=!0,i&&i(h))};return new ReadableStream({async pull(h){try{const{done:f,value:m}=await o.next();if(f)return u(),void h.close();let g=m.byteLength;if(n){let E=l+=g;n(E)}h.enqueue(new Uint8Array(m))}catch(f){throw u(f),f}},cancel:h=>(u(h),o.return())},{highWaterMark:2})};function bL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function IL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bL(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bL(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const K_=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",AL=K_&&typeof ReadableStream=="function",jZ=K_&&(typeof TextEncoder=="function"?(OL=new TextEncoder,e=>OL.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var OL;const NL=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},FZ=AL&&NL(()=>{let e=!1;const t=new Request(ri.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),HR=AL&&NL(()=>ge.isReadableStream(new Response("").body)),z_={stream:HR&&(e=>e.body)};var PL;K_&&(PL=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!z_[e]&&(z_[e]=ge.isFunction(PL[e])?t=>t[e]():(t,n)=>{throw new Pt("Response type '".concat(e,"' is not supported"),Pt.ERR_NOT_SUPPORT,n)})}));const BZ=async(e,t)=>{const n=ge.toFiniteNumber(e.getContentLength());return n??(async i=>i==null?0:ge.isBlob(i)?i.size:ge.isSpecCompliantForm(i)?(await new Request(ri.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:ge.isArrayBufferView(i)||ge.isArrayBuffer(i)?i.byteLength:(ge.isURLSearchParams(i)&&(i+=""),ge.isString(i)?(await jZ(i)).byteLength:void 0))(t)};var WZ=K_&&(async e=>{let{url:t,method:n,data:i,signal:o,cancelToken:c,timeout:l,onDownloadProgress:u,onUploadProgress:h,responseType:f,headers:m,withCredentials:g="same-origin",fetchOptions:E}=RL(e);f=f?(f+"").toLowerCase():"text";let y,I=LZ([o,c&&c.toAbortSignal()],l);const C=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let w;try{if(h&&FZ&&n!=="get"&&n!=="head"&&(w=await BZ(m,i))!==0){let H,j=new Request(t,{method:"POST",body:i,duplex:"half"});if(ge.isFormData(i)&&(H=j.headers.get("content-type"))&&m.setContentType(H),j.body){const[J,re]=EL(w,W_(vL(h)));i=wL(j.body,65536,J,re)}}ge.isString(g)||(g=g?"include":"omit");const D="credentials"in Request.prototype;y=new Request(t,IL(IL({},E),{},{signal:I,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:i,duplex:"half",credentials:D?g:void 0}));let P=await fetch(y);const x=HR&&(f==="stream"||f==="response");if(HR&&(u||x&&C)){const H={};["status","statusText","headers"].forEach(se=>{H[se]=P[se]});const j=ge.toFiniteNumber(P.headers.get("content-length")),[J,re]=u&&EL(j,W_(vL(u),!0))||[];P=new Response(wL(P.body,65536,J,()=>{re&&re(),C&&C()}),H)}f=f||"text";let K=await z_[ge.findKey(z_,f)||"text"](P,e);return!x&&C&&C(),await new ve((H,j)=>{gL(H,j,{data:K,headers:so.from(P.headers),status:P.status,statusText:P.statusText,config:e,request:y})})}catch(D){throw C&&C(),D&&D.name==="TypeError"&&/Load failed|fetch/i.test(D.message)?Object.assign(new Pt("Network Error",Pt.ERR_NETWORK,e,y),{cause:D.cause||D}):Pt.from(D,D&&D.code,e,y)}});const KR={http:null,xhr:kZ,fetch:WZ};ge.forEach(KR,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const DL=e=>"- ".concat(e),GZ=e=>ge.isFunction(e)||e===null||e===!1;var kL={getAdapter:e=>{e=ge.isArray(e)?e:[e];const{length:t}=e;let n,i;const o={};for(let c=0;c<t;c++){let l;if(n=e[c],i=n,!GZ(n)&&(i=KR[(l=String(n)).toLowerCase()],i===void 0))throw new Pt("Unknown adapter '".concat(l,"'"));if(i)break;o[l||"#"+c]=i}if(!i){const c=Object.entries(o).map(l=>{let[u,h]=l;return"adapter ".concat(u," ")+(h===!1?"is not supported by the environment":"is not available in the build")});throw new Pt("There is no suitable adapter to dispatch the request "+(t?c.length>1?`since :
`+c.map(DL).join(`
`):" "+DL(c[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:KR};function zR(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Yd(null,e)}function LL(e){return zR(e),e.headers=so.from(e.headers),e.data=jR.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),kL.getAdapter(e.adapter||UR.adapter)(e).then(function(t){return zR(e),t.data=jR.call(e,e.transformResponse,t),t.headers=so.from(t.headers),t},function(t){return _L(t)||(zR(e),t&&t.response&&(t.response.data=jR.call(e,e.transformResponse,t.response),t.response.headers=so.from(t.response.headers))),ve.reject(t)})}const ML="1.9.0",Y_={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Y_[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const xL={};Y_.transitional=function(e,t,n){function i(o,c){return"[Axios v"+ML+"] Transitional option '"+o+"'"+c+(n?". "+n:"")}return(o,c,l)=>{if(e===!1)throw new Pt(i(c," has been removed"+(t?" in "+t:"")),Pt.ERR_DEPRECATED);return t&&!xL[c]&&(xL[c]=!0,console.warn(i(c," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,c,l)}},Y_.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var q_={assertOptions:function(e,t,n){if(typeof e!="object")throw new Pt("options must be an object",Pt.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let o=i.length;for(;o-- >0;){const c=i[o],l=t[c];if(l){const u=e[c],h=u===void 0||l(u,c,e);if(h!==!0)throw new Pt("option "+c+" must be "+h,Pt.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Pt("Unknown option "+c,Pt.ERR_BAD_OPTION)}},validators:Y_};const Uo=q_.validators;let X_=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Fk,response:new Fk}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=_l(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:o}=t;n!==void 0&&q_.assertOptions(n,{silentJSONParsing:Uo.transitional(Uo.boolean),forcedJSONParsing:Uo.transitional(Uo.boolean),clarifyTimeoutError:Uo.transitional(Uo.boolean)},!1),i!=null&&(ge.isFunction(i)?t.paramsSerializer={serialize:i}:q_.assertOptions(i,{encode:Uo.function,serialize:Uo.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),q_.assertOptions(t,{baseUrl:Uo.spelling("baseURL"),withXsrfToken:Uo.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let c=o&&ge.merge(o.common,o[t.method]);o&&ge.forEach(["delete","get","head","post","put","patch","common"],y=>{delete o[y]}),t.headers=so.concat(c,o);const l=[];let u=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(u=u&&y.synchronous,l.unshift(y.fulfilled,y.rejected))});const h=[];let f;this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)});let m,g=0;if(!u){const y=[LL.bind(this),void 0];for(y.unshift.apply(y,l),y.push.apply(y,h),m=y.length,f=ve.resolve(t);g<m;)f=f.then(y[g++],y[g++]);return f}m=l.length;let E=t;for(g=0;g<m;){const y=l[g++],I=l[g++];try{E=y(E)}catch(C){I.call(this,C);break}}try{f=LL.call(this,E)}catch(y){return ve.reject(y)}for(g=0,m=h.length;g<m;)f=f.then(h[g++],h[g++]);return f}getUri(e){return jk(yL((e=_l(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ge.forEach(["delete","get","head","options"],function(e){X_.prototype[e]=function(t,n){return this.request(_l(n||{},{method:e,url:t,data:(n||{}).data}))}}),ge.forEach(["post","put","patch"],function(e){function t(n){return function(i,o,c){return this.request(_l(c||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}X_.prototype[e]=t(),X_.prototype[e+"Form"]=t(!0)});var J_=X_;class YR{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ve(function(o){n=o});const i=this;this.promise.then(o=>{if(!i._listeners)return;let c=i._listeners.length;for(;c-- >0;)i._listeners[c](o);i._listeners=null}),this.promise.then=o=>{let c;const l=new ve(u=>{i.subscribe(u),c=u}).then(o);return l.cancel=function(){i.unsubscribe(c)},l},t(function(o,c,l){i.reason||(i.reason=new Yd(o,c,l),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new YR(function(i){t=i}),cancel:t}}}var HZ=YR;const qR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(qR).forEach(e=>{let[t,n]=e;qR[n]=t});var KZ=qR;const yr=function e(t){const n=new J_(t),i=Tk(J_.prototype.request,n);return ge.extend(i,J_.prototype,n,{allOwnKeys:!0}),ge.extend(i,n,null,{allOwnKeys:!0}),i.create=function(o){return e(_l(t,o))},i}(UR);yr.Axios=J_,yr.CanceledError=Yd,yr.CancelToken=HZ,yr.isCancel=_L,yr.VERSION=ML,yr.toFormData=O_,yr.AxiosError=Pt,yr.Cancel=yr.CanceledError,yr.all=function(e){return ve.all(e)},yr.spread=function(e){return function(t){return e.apply(null,t)}},yr.isAxiosError=function(e){return ge.isObject(e)&&e.isAxiosError===!0},yr.mergeConfig=_l,yr.AxiosHeaders=so,yr.formToJSON=e=>fL(ge.isHTMLForm(e)?new FormData(e):e),yr.getAdapter=kL.getAdapter,yr.HttpStatusCode=KZ,yr.default=yr;var Yr=yr;const zZ=()=>{};function up(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:zZ};return e.promise=new ve((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const $_=new Map,Q_=new Map,Vo=new Map;let xn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),gt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const UL=new TJ;let oo=UL.getResult(),XR=null;function dt(e){if(!XR){oo=UL.getResult();const t=function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return gt.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return gt.CHROME;case"Safari":case"Mobile Safari":return gt.SAFARI;case"Edge":return gt.EDGE;case"Firefox":return gt.FIREFOX;case"QQ":case"QQBrowser":return gt.QQ;case"Opera":return gt.OPERA;case"WeChat":return gt.WECHAT;default:return u.browser.name||""}}(oo),n=VL(oo),i=function(u){return u.os.name==="Windows"?u.os.version?u.os.name+" "+u.os.version:u.os.name:u.os.name||""}(oo),o=oo.os.version,c=VL(oo,!1),l=oo.device.type;if(!(t&&n&&i&&o))return{name:t,version:n,os:i,osVersion:o,browserVersion:c,deviceType:l};XR={name:t,version:n,os:i,osVersion:o,browserVersion:c,deviceType:l}}return XR}function VL(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function Z_(){return dt().os}function jL(){const e=dt();return"".concat(e.os," ").concat(e.osVersion)}function eg(){const e=dt();return!!(oo.engine.name==="WebKit"&&e.os===xn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==gt.SAFARI||Sr()&&e.name!==gt.SAFARI)}function _a(){return dt().name===gt.CHROME}function rr(){return dt().name===gt.SAFARI}function FL(){const e=dt();if(e.name!==gt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function BL(){return dt().name===gt.EDGE}function sn(){return dt().name===gt.FIREFOX}function Sr(){return dt().os===xn.IOS}function qd(e){const t=dt();return!(t.name!==gt.CHROME||!t.osVersion)&&Number(t.version)>=e}function WL(e){const t=dt();return!(t.name!==gt.CHROME||!t.osVersion)&&Number(t.version)<e}function JR(e,t,n){const i=dt();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function $R(e){const t=dt();return!(t.name!==gt.EDGE||!t.osVersion)&&Number(t.version)>=e}function QR(e){const t=dt();return!(t.name!==gt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function GL(e){const t=dt();return!(t.name!==gt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function HL(e,t,n){const i=dt();if(i.os!==xn.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])>t||Number(o[0])>e:t?Number(o[0])===e&&Number(o[1])>=t||Number(o[0])>e:Number(o[0])>=e}function KL(e,t,n){const i=dt();if(i.os!==xn.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e}function ZR(e,t,n){const i=dt();if(i.name!==gt.SAFARI||!i.osVersion||!i.browserVersion)return!1;const o=i.browserVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function e0(e){const t=dt();return!(t.name!==gt.OPERA||!t.osVersion)&&Number(t.version)>=e}function zL(){const e=dt();if(e.os!==xn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Xd(){const e=dt();if(e.os!==xn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function t0(){const e=dt();if(e.os!==xn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function YL(){const e=dt();if(e.os!==xn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Ns(){return rr()&&navigator.maxTouchPoints>0}function qL(){return dt().name===gt.WECHAT}function XL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function n0(){const e=Z_();return function(){const{deviceType:t}=dt();return t==="mobile"||t==="tablet"}()||e===xn.ANDROID||e===xn.IOS||e===xn.HARMONY_OS}function ga(){const e=dt();return e.name!==gt.EDGE&&e.name!==gt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function tg(){return Z_()===xn.ANDROID}function hp(){const e=dt();return tg()&&(e.name===gt.CHROME||e.name===gt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function We(e,t,n){return(t=function(i){var o=function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function JL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JL(Object(n),!0).forEach(function(i){We(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JL(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let k=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),ne=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),We(this,"code",void 0),We(this,"message",void 0),We(this,"data",void 0),We(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function ao(e,t){if(typeof e!="boolean")throw new ne(k.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function kn(e,t,n){if(!pe(n).call(n,e))throw new ne(k.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Dt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(o){return typeof o=="number"&&o%1==0}(e))throw new ne(k.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function r0(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ne(k.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Dt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Dt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Dt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Dt(e.ideal,"".concat(t,".ideal"),1,1/0)}else Dt(e,t,1,1/0)}function qn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ne(k.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!$L(e,n,i,o))throw new ne(k.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(o?" ASCII characters only.":""))}function Ea(e,t){if(!Array.isArray(e))throw new ne(k.INVALID_PARAMS,"".concat(t," should be an array"))}function on(e){return e==null}function $L(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||function(o){if(typeof o!="string")return!1;for(let c=0;c<o.length;c+=1){const l=o.charCodeAt(c);if(l<0||l>255)return!1}return!0}(e))}var pp=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(pp||{}),i0=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(i0||{});const QL=new class{constructor(){We(this,"_clientSize",null),We(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),We(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),We(this,"getStyle",e=>window.getComputedStyle(e,null)),We(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:o,visibility:c,opacity:l,filter:u}=i;return(o==="none"||pe(t=["hidden","collapse"]).call(t,c)||Number(l)<.1)&&(n=!1),!!n&&(u&&u.split(" ").filter(h=>{var f;const m=h.split("(")[0];return pe(f=["brightness","blur","opacity"]).call(f,m)}).map(h=>{const[f,m]=h.split(/\(|\)/);return[f,Number(m.match(/^[0-9\.]+/))]}).forEach(h=>{const[f,m]=h;switch(f){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),We(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const o=l=>t(l);let c=e;for(;c&&i;)o(c)||(n=!1,i=!1),c=c.parentElement,c||(i=!1);return n}),We(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),We(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:o,top:c,bottom:l}=e.getBoundingClientRect(),u=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:n,left:i,right:o,top:c,bottom:l,clientWidth:u,clientHeight:h,clientMin:Math.min(u,h)}}),We(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),We(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),We(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),We(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,o=e/6,c=t/6,l=[],u=10**6;for(let h=0;h<5;h++)for(let f=0;f<5;f++){const m=(n*u+(h===0?.1:h===4?(o*h*u-1e5)/u:o*h)*u)/u,g=(i*u+(f===0?.1:f===4?(c*f*u-1e5)/u:c*f)*u)/u;l.push({x:m,y:g})}return[...l]}),We(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),We(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),We(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:o,clientWidth:c,clientMin:l}=this._clientSize;let u,h,f,m;if(e<0)u=0;else{if(!(e<c))return!1;u=e}if(t<0)return!1;if(h=t<c?t:c,n<0)f=0;else{if(!(n<o))return!1;f=n}if(i<0)return!1;m=i<o?i:o;const g=h-u,E=m-f;return this.checkSizeIsVisible(g,E,l)}),We(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),We(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(pp.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(pp.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(pp.SIZE)}}return this.returnHiddenResult(pp.STYLE)}return this.returnHiddenResult(i0.UNMOUNTED)}return this.returnHiddenResult(i0.INVALID_HTML_ELEMENT)}),We(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function s0(e){return new TextEncoder().encode(e)}const ZL=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},o0=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(o=>{i+=o.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",s0(e)),16);class nn{constructor(){We(this,"_events",{}),We(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const i=this._events[t],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(l=>l);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let l=0;l<n.length;l+=1){const u=n[l];u.once&&this.off(t,u.listener),u.listener.apply(this,o||[])}}safeEmit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,i)}catch(l){console.error("safeEmit event:".concat(t," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(t,n){let i=t.length;for(;i--;)if(t[i].listener===n)return i;return-1}}let fp=null;function eM(){if(fp)return fp;if(window.electron)return fp=window.electron;if(!window.require)return null;try{return fp=window.require("electron"),fp}catch{return null}}let un=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),Jt=function(e){return e.TRACER="tracer",e}({});function tM(e){return Dt(e.timeout,"config.timeout",0,1e5),Dt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Dt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Dt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let YZ=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ct=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function mp(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function nM(e){return qn(e.turnServerURL,"turnServerURL"),qn(e.username,"username"),qn(e.password,"password"),e.udpport&&Dt(e.udpport,"udpport",1,99999,!0),e.forceturn&&ao(e.forceturn,"forceturn"),e.security&&ao(e.security,"security"),e.tcpport&&Dt(e.tcpport,"tcpport",1,99999,!0),!0}function a0(e){return e.level!==void 0&&kn(e.level,"level",[1,2,3]),e.delay!==void 0&&Dt(e.delay,"delay",0,3e3,!0),!0}let st=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ir=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Si=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Jd=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function sr(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return e.getListeners(t).length===0?ve.reject(new ne(k.UNEXPECTED_ERROR,"can not emit promise")):new ve((c,l)=>{e.emit(t,...i,c,l)})}function xt(e,t){if(e.getListeners(t).length===0)return ve.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return sr(e,t,...i)}function ki(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return _p(e,t,...i)}function _p(e,t){let n=null,i=null;for(var o=arguments.length,c=new Array(o>2?o-2:0),l=2;l<o;l++)c[l-2]=arguments[l];if(e.emit(t,...c,u=>{n=u},u=>{i=u}),i!==null)throw i;if(n===null)throw new ne(k.UNEXPECTED_ERROR,"handler is not sync");return n}const gn=new class extends nn{set networkState(e){this.emit(Jd.NETWORK_STATE_CHANGE,e,this._networkState),e===Si.ONLINE?this.emit(Jd.ONLINE):e===Si.OFFLINE&&(this.onlineWaiter=new ve(t=>{this.once(Jd.ONLINE,()=>{this.onlineWaiter=void 0,t(Si.ONLINE)})}),this.emit(Jd.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Si.ONLINE}constructor(){super(),We(this,"_moduleName","network-indicator"),We(this,"_networkState",Si.ONLINE),We(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Si.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Si.OFFLINE})}};function ng(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function $d(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function rg(e){ve!==void 0?ve.resolve().then(e):setTimeout(e,0)}function $t(e){return JSON.parse(JSON.stringify(e))}function gl(e){try{return $t(e)}catch{return e}}const rM={};function rc(e,t){rM[t]||(rM[t]=!0,e())}function El(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function ic(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function iM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function sM(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=Rs(t).call(t,(l,u)=>l+u.length,0),o=new Uint8Array(new ArrayBuffer(i));let c=0;return t.forEach(l=>{o.set(l,c),c+=l.length}),o}function jo(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function oM(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?jo(n):n.size}),t+138}function qZ(e){const t=new ne(k.TIMEOUT,"timeout");return new ve((n,i)=>{window.setTimeout(()=>i(t),e)})}function Xn(e){return new ve(t=>{window.setTimeout(t,e)})}function Ut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Ut(e-n.length,"")}function vl(){return Ut(32,"").toUpperCase()}const ig=()=>{},aM=new class{constructor(){We(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var o=arguments.length,c=new Array(o>4?o-4:0),l=4;l<o;l++)c[l-4]=arguments[l];if(this.fnMap.has(t)){const u=this.fnMap.get(t);if(u.threshold!==n){u.fn(...u.args),clearTimeout(u.timer);const h=window.setTimeout(()=>{const f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:c,skipFn:i})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,de(de({},u),{},{fn:e,args:c,skipFn:i}))}else{const u=window.setTimeout(()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:c,skipFn:i})}}},cM=aM.throttleByKey.bind(aM);function lM(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function c0(e,t){if(!lM(e)||!lM(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=c0(e[i],t[i]);return n}{const n=de({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=c0(e[i],t[i]):n[i]=t[i]);return n}}function dM(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function Qd(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function l0(e){return Rs(e).call(e,(t,n)=>t+n,0)}function uM(e){const t="0123456789abcdef";function n(x){let K,H="";for(K=0;K<=3;K++)H+=t.charAt(x>>8*K+4&15)+t.charAt(x>>8*K&15);return H}function i(x,K){const H=(65535&x)+(65535&K);return(x>>16)+(K>>16)+(H>>16)<<16|65535&H}function o(x,K,H,j,J,re){return i(function(se,le){return se<<le|se>>>32-le}(i(i(K,x),i(j,re)),J),H)}function c(x,K,H,j,J,re,se){return o(K&H|~K&j,x,K,J,re,se)}function l(x,K,H,j,J,re,se){return o(K&j|H&~j,x,K,J,re,se)}function u(x,K,H,j,J,re,se){return o(K^H^j,x,K,J,re,se)}function h(x,K,H,j,J,re,se){return o(H^(K|~j),x,K,J,re,se)}const f=function(x){let K;const H=1+(x.length+8>>6),j=new Array(16*H);for(K=0;K<16*H;K++)j[K]=0;for(K=0;K<x.length;K++)j[K>>2]|=x.charCodeAt(K)<<K%4*8;return j[K>>2]|=128<<K%4*8,j[16*H-2]=8*x.length,j}(e);let m,g,E,y,I,C=1732584193,w=-271733879,D=-1732584194,P=271733878;for(m=0;m<f.length;m+=16)g=C,E=w,y=D,I=P,C=c(C,w,D,P,f[m+0],7,-680876936),P=c(P,C,w,D,f[m+1],12,-389564586),D=c(D,P,C,w,f[m+2],17,606105819),w=c(w,D,P,C,f[m+3],22,-1044525330),C=c(C,w,D,P,f[m+4],7,-176418897),P=c(P,C,w,D,f[m+5],12,1200080426),D=c(D,P,C,w,f[m+6],17,-1473231341),w=c(w,D,P,C,f[m+7],22,-45705983),C=c(C,w,D,P,f[m+8],7,1770035416),P=c(P,C,w,D,f[m+9],12,-1958414417),D=c(D,P,C,w,f[m+10],17,-42063),w=c(w,D,P,C,f[m+11],22,-1990404162),C=c(C,w,D,P,f[m+12],7,1804603682),P=c(P,C,w,D,f[m+13],12,-40341101),D=c(D,P,C,w,f[m+14],17,-1502002290),w=c(w,D,P,C,f[m+15],22,1236535329),C=l(C,w,D,P,f[m+1],5,-165796510),P=l(P,C,w,D,f[m+6],9,-1069501632),D=l(D,P,C,w,f[m+11],14,643717713),w=l(w,D,P,C,f[m+0],20,-373897302),C=l(C,w,D,P,f[m+5],5,-701558691),P=l(P,C,w,D,f[m+10],9,38016083),D=l(D,P,C,w,f[m+15],14,-660478335),w=l(w,D,P,C,f[m+4],20,-405537848),C=l(C,w,D,P,f[m+9],5,568446438),P=l(P,C,w,D,f[m+14],9,-1019803690),D=l(D,P,C,w,f[m+3],14,-187363961),w=l(w,D,P,C,f[m+8],20,1163531501),C=l(C,w,D,P,f[m+13],5,-1444681467),P=l(P,C,w,D,f[m+2],9,-51403784),D=l(D,P,C,w,f[m+7],14,1735328473),w=l(w,D,P,C,f[m+12],20,-1926607734),C=u(C,w,D,P,f[m+5],4,-378558),P=u(P,C,w,D,f[m+8],11,-2022574463),D=u(D,P,C,w,f[m+11],16,1839030562),w=u(w,D,P,C,f[m+14],23,-35309556),C=u(C,w,D,P,f[m+1],4,-1530992060),P=u(P,C,w,D,f[m+4],11,1272893353),D=u(D,P,C,w,f[m+7],16,-155497632),w=u(w,D,P,C,f[m+10],23,-1094730640),C=u(C,w,D,P,f[m+13],4,681279174),P=u(P,C,w,D,f[m+0],11,-358537222),D=u(D,P,C,w,f[m+3],16,-722521979),w=u(w,D,P,C,f[m+6],23,76029189),C=u(C,w,D,P,f[m+9],4,-640364487),P=u(P,C,w,D,f[m+12],11,-421815835),D=u(D,P,C,w,f[m+15],16,530742520),w=u(w,D,P,C,f[m+2],23,-995338651),C=h(C,w,D,P,f[m+0],6,-198630844),P=h(P,C,w,D,f[m+7],10,1126891415),D=h(D,P,C,w,f[m+14],15,-1416354905),w=h(w,D,P,C,f[m+5],21,-57434055),C=h(C,w,D,P,f[m+12],6,1700485571),P=h(P,C,w,D,f[m+3],10,-1894986606),D=h(D,P,C,w,f[m+10],15,-1051523),w=h(w,D,P,C,f[m+1],21,-2054922799),C=h(C,w,D,P,f[m+8],6,1873313359),P=h(P,C,w,D,f[m+15],10,-30611744),D=h(D,P,C,w,f[m+6],15,-1560198380),w=h(w,D,P,C,f[m+13],21,1309151649),C=h(C,w,D,P,f[m+4],6,-145523070),P=h(P,C,w,D,f[m+11],10,-1120210379),D=h(D,P,C,w,f[m+2],15,718787259),w=h(w,D,P,C,f[m+9],21,-343485551),C=i(C,g),w=i(w,E),D=i(D,y),P=i(P,I);return n(C)+n(w)+n(D)+n(P)}let XZ=1,hM=console,ur=class{static setLogger(e){hM=e}constructor(e,t){We(this,"id",void 0),We(this,"lockingPromise",ve.resolve()),We(this,"locks",0),We(this,"name",""),We(this,"lockId",void 0),this.lockId=XZ++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");hM.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new ve(o=>{t=()=>{this.locks-=1,this.logger("unlocked",e),o()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Zd(e,t){return function(n,i,o){const c=o.value;if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const l=this[t];if(!l)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const u=await l.lock("From ".concat(e,".").concat(i));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return await c.apply(this,f)}finally{u()}},o}}const Rn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function d0(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function co(e,t,n,i){const o=Object.assign({},Rn,i);let c=o.timeout;const l=async()=>{await function(f){return new ve(m=>{window.setTimeout(m,f)})}(c),c*=o.timeoutFactor,c=Math.min(o.maxRetryTimeout,c)};let u=!1;const h=new ve(async(f,m)=>{t=t||(()=>!1),n=n||(()=>!0);for(let g=0;g<o.maxRetryCount;g+=1){if(u)return m(new ne(k.OPERATION_ABORTED));try{const E=await e();if(!t(E,g)||g+1===o.maxRetryCount)return f(E);await l()}catch(E){if(!n(E,g)||g+1===o.maxRetryCount)return m(E);await l()}}});return h.cancel=()=>u=!0,h}let sg,pM=class{constructor(e){We(this,"input",[]),We(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Rs(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},og=0,u0=0;function h0(e,t,n,i){return new ve((o,c)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),og+=jo(t.data)):n&&(t.data.size?og+=t.data.size:t.data instanceof FormData?og+=oM(t.data):og+=jo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Yr.request(t).then(l=>{typeof l.data=="string"?u0+=jo(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?u0+=l.data.byteLength:u0+=jo(JSON.stringify(l.data)),o(l.data)}).catch(l=>{Yr.isCancel(l)?c(new ne(k.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?c(new ne(k.NETWORK_TIMEOUT,l.message)):l.response?c(new ne(k.NETWORK_RESPONSE_ERROR,l.response.status)):c(new ne(k.NETWORK_ERROR,l.message))})})}async function JZ(e,t){const n=new Blob([t.data],{type:"buffer"});return await h0(e,de(de({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const fM=()=>window.isSecureContext!==void 0;function Ps(e){if(Array.isArray(e))return e.map(n=>n);if(!mM(e))return e;const t={};for(const n in e){const i=e[n];mM(i)||Array.isArray(i)?t[n]=Ps(i):t[n]=i}return t}function mM(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let p0=class{constructor(e){We(this,"input",[]),We(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Fo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},gp={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Fo,remoteCandidate:Fo},updateInterval:0},_M={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},gM={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},EM={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},vM={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let f0=class{constructor(e,t){We(this,"onFirstVideoReceived",void 0),We(this,"onFirstVideoDecoded",void 0),We(this,"onFirstAudioReceived",void 0),We(this,"onFirstVideoDecodedTimeout",void 0),We(this,"onFirstAudioDecoded",void 0),We(this,"onSelectedLocalCandidateChanged",void 0),We(this,"onSelectedRemoteCandidateChanged",void 0),We(this,"videoIsReady",!1),We(this,"videoIsReady2",{}),We(this,"pc",void 0),We(this,"options",void 0),We(this,"intervalTimer",void 0),We(this,"stats",Ps(gp)),We(this,"isFirstVideoReceived",{}),We(this,"isFirstVideoDecoded",{}),We(this,"isFirstAudioReceived",{}),We(this,"isFirstAudioDecoded",{}),We(this,"isFirstVideoDecodedTimeout",{}),We(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ve(e=>{e({local:de({},Fo),remote:de({},Fo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,o=0,c=0,l=0;for(const u of n)e[u].forEach((h,f)=>{if(!this.lossRateWindowStats[t-1][u][f]||!this.lossRateWindowStats[0][u][f])return;const m=this.lossRateWindowStats[t-1][u][f].packets-this.lossRateWindowStats[0][u][f].packets,g=this.lossRateWindowStats[t-1][u][f].packetsLost-this.lossRateWindowStats[0][u][f].packetsLost;u==="videoSend"||u==="audioSend"?(i+=m,c+=g):(o+=m,l+=g),Number.isNaN(m)||Number.isNaN(m)?h.packetLostRate=0:h.packetLostRate=m<=0||g<=0?0:g/(m+g)});e.sendPacketLossRate=i<=0||c<=0?0:c/(i+c),e.recvPacketLossRate=o<=0||l<=0?0:l/(o+l)}},$Z=class extends f0{constructor(){super(...arguments),We(this,"_stats",gp),We(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Ps(gp);const n=t.filter(o=>o.type==="ssrc");this.processSSRCStats(n);const i=t.find(o=>o.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const i=pe(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const o=Ps(gM);o.codec=t.googCodecName,o.adaptionChangeReason="none",t.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(t.googAvgEncodeMs),o.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.firsCount=Number(t.googFirReceived),o.nacksCount=Number(t.googNacksReceived),o.plisCount=Number(t.googPlisReceived),o.frameCount=Number(t.framesEncoded),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=Ps(_M),c=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(o.codec=t.googCodecName,o.targetDelayMs=Number(t.googTargetDelayMs),o.renderDelayMs=Number(t.googRenderDelayMs),o.currentDelayMs=Number(t.googCurrentDelayMs),o.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),o.decodeMs=Number(t.googDecodeMs),o.maxDecodeMs=Number(t.googMaxDecodeMs),o.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},o.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},o.decodeFrameRate=Number(t.googFrameRateDecoded),o.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},o.jitterBufferMs=Number(t.googJitterBufferMs),o.firsCount=Number(t.googFirsSent),o.nacksCount=Number(t.googNacksSent),o.plisCount=Number(t.googPlisSent),o.framesDecodeCount=Number(t.framesDecoded),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),c){const l=c.stats,u=Date.now()-c.lts;o.framesDecodeFreezeTime=l.framesDecodeFreezeTime,o.framesDecodeInterval=l.framesDecodeInterval,o.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(c.lts=Date.now(),o.framesDecodeInterval=u,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):o.framesDecodeCount<c.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:de({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=Ps(vM);o.codec=t.googCodecName,o.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,o.decodingCNG=Number(t.googDecodingCNG),o.decodingCTN=Number(t.googDecodingCTN),o.decodingCTSG=Number(t.googDecodingCTSG),o.decodingNormal=Number(t.googDecodingNormal),o.decodingPLC=Number(t.googDecodingPLC),o.decodingPLCCNG=Number(t.googDecodingPLCCNG),o.expandRate=Number(t.googExpandRate),o.accelerateRate=Number(t.googAccelerateRate),o.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),o.speechExpandRate=Number(t.googSpeechExpandRate),o.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),o.jitterBufferMs=Number(t.googJitterBufferMs),o.jitterMs=Number(t.googJitterReceived),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),o.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=Ps(EM);o.codec=t.googCodecName,o.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,o.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new ve((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(o=>{i[o]=n.stat(o)}),t.push(i)}),t}},Ep=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),ag=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),m0=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Li=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var eu=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(eu||{});function vp(e,t,n,i){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:eu.kNone;if(!t)return;const c=Number(t[n]);if(typeof c!="number")return;const l=Number(t[i]);if(typeof l!="number")return;if(!e)return l?c/l*o:void 0;const u=Number(e[n]);if(typeof u!="number")return;const h=Number(e[i]);if(typeof h!="number")return;const f=l-h;return f?(c-u)/f*o:void 0}let yM=class extends f0{constructor(){super(...arguments),We(this,"_stats",gp),We(this,"report",void 0),We(this,"lastDecodeVideoReceiverStats",new Map),We(this,"lastVideoFramesRecv",new Map),We(this,"lastVideoFramesSent",new Map),We(this,"lastVideoFramesDecode",new Map),We(this,"lastVideoFramesOutput",new Map),We(this,"lastVideoJBDelay",new Map),We(this,"lastAudioJBDelay",new Map),We(this,"mediaBytesSent",new Map),We(this,"mediaBytesRetransmit",new Map),We(this,"mediaBytesTargetEncode",new Map),We(this,"lastDecodeAudioReceiverStats",new Map),We(this,"lastAudioConcealment",new Map),We(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ps(gp),this.report.forEach(e=>{switch(e.type){case Li.OUTBOUND:case Li.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===Li.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Li.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Li.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Li.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:de({},Fo),remote:de({},Fo)};return e.forEach(n=>{let i;if(n.type===Li.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===Li.CANDIDATE_PAIR&&n.selected&&(i=n),i){const o=(c,l)=>{c.type=l.type,c.id=l.id,l.address&&(c.address=l.address),l.candidateType&&(c.candidateType=l.candidateType),l.port&&(c.port=l.port),l.priority&&(c.priority=l.priority),l.protocol&&(c.protocol=l.protocol),l.relayProtocol&&(c.relayProtocol=l.relayProtocol)};if(i.localCandidateId){const c=e.get(i.localCandidateId);c&&o(t.local,c)}if(i.remoteCandidateId){const c=e.get(i.remoteCandidateId);c&&o(t.remote,c)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Li.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Li.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Li.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(de({},t),de({},this.stats.selectedCandidatePair.localCandidate)),e.type===Li.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(de({},t),de({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=Ps(vM),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=vp(n,t,"totalProcessingDelay","jitterBufferEmittedCount",eu.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,de({},t))}calculateAudioFreeze(e,t,n){const i=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&i!=null){const o=i.lts,c=n.timestamp,l=c-o;if(l<=0)return;const u=e.concealedSamples-t.concealedSamples-0,h=i.nonSilent+u,f=e.totalSamplesReceived-t.totalSamplesReceived;if(f<=0)return;const m=80*f/l,g=200*f/l,E=l/f;let y=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,h>m&&(i.plc80>0?(e.freezeSamples80+=u,e.freezeMs80+=Math.round(u*E)):(e.freezeSamples80+=h,e.freezeMs80+=Math.round(h*E)),y=i.plc80+1);let I=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,h>g&&(i.plc200>0?(e.freezeSamples200+=u,e.freezeMs200+=Math.round(u*E)):(e.freezeSamples200+=h,e.freezeMs200+=Math.round(h*E)),I=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:u,lts:c,plc80:y,plc200:I})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(l=>l.ssrc===e.ssrc);t||(t=Ps(_M),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),o=this.lastVideoFramesOutput.get(t.ssrc),c=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const l=t.decodedFrame?t.decodedFrame.width:0,u=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,l,u),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const l=n.stats,u=c-n.lts;t.framesDecodeFreezeTime=l.framesDecodeFreezeTime,t.framesDecodeInterval=l.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=u,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<l.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=vp(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=vp(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",eu.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=vp(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",eu.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=vp(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",eu.kMillisecondsFromSeconds),i&&c-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((c-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:0}),t.framesDroppedCount&&e.framesReceived&&(o&&c-o.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-o.count)/((c-o.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:Math.max(t.outputFrameRate,0)})):o?t.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:de({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=Ps(gM),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const i=new p0(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const o=new p0(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const o=new p0(10);o.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,o)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const o=e.framesEncoded-i.lastFrameCount,c=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*c/o}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,Li.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Ps(EM),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Li.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const i=Array.from(Ei(n=this.report).call(n)).find(o=>o.type===t&&o.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,o,c,l;const u=t?this.report.get(t):void 0,h=(i=u==null?void 0:u.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof h!="number")return;let f=(o=u==null?void 0:u.frameWidth)!==null&&o!==void 0?o:e.frameWidth,m=(c=u==null?void 0:u.frameHeight)!==null&&c!==void 0?c:e.frameHeight,g=(l=u==null?void 0:u.framesPerSecond)!==null&&l!==void 0?l:e.framesPerSecond;if(typeof f=="number"&&typeof m=="number"||(f=0,m=0),g==null){const E=Date.now(),y=this.lastVideoFramesSent.get(n.ssrc);y&&E-y.lts>=800?(g=Math.round((h-y.count)/((E-y.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:E,rate:g})):y?g=y.rate:this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:E,rate:0})}n.sentFrame={width:f,height:m,frameRate:Math.max(0,g)}}processVideoTrackReceiverStats(e,t,n){var i,o,c,l,u;const h=t?this.report.get(t):void 0,f=(i=h==null?void 0:h.framesReceived)!==null&&i!==void 0?i:e.framesReceived,m=(o=h==null?void 0:h.frameWidth)!==null&&o!==void 0?o:e.frameWidth,g=(c=h==null?void 0:h.frameHeight)!==null&&c!==void 0?c:e.frameHeight,E=(l=h==null?void 0:h.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,y=(u=h==null?void 0:h.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount;if(typeof f=="number"){const I=this.lastVideoFramesRecv.get(n.ssrc),C=Date.now();n.framesReceivedCount=f;let w=0;I&&C-I.lts>=800?(w=Math.round((f-I.count)/((C-I.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:C,rate:w})):I?w=I.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:C,rate:0}),n.receivedFrame={width:m||0,height:g||0,frameRate:w||0},n.decodedFrame={width:m||0,height:g||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:g||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(E&&y){const I=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let C=I.jitterBufferMs;const w=y-I.jitterBufferEmittedCount;w>0&&(C=1e3*(E-I.jitterBufferDelay)/w),n.jitterBufferMs=C,n.currentDelayMs=Math.round(C),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:E,jitterBufferEmittedCount:y,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,o,c,l;const u=t?this.report.get(t):void 0,h=(i=(o=u==null?void 0:u.echoReturnLoss)!==null&&o!==void 0?o:e.echoReturnLoss)!==null&&i!==void 0?i:0,f=(c=(l=u==null?void 0:u.echoReturnLossEnhancement)!==null&&l!==void 0?l:e.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;n.aecReturnLoss=h,n.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(e,t,n){var i,o,c,l,u,h,f,m,g;const E=t?this.report.get(t):void 0,y=(i=E==null?void 0:E.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,I=(o=E==null?void 0:E.totalSamplesReceived)!==null&&o!==void 0?o:e.totalSamplesReceived,C=(c=E==null?void 0:E.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,w=(l=E==null?void 0:E.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount,D=(u=E==null?void 0:E.audioLevel)!==null&&u!==void 0?u:e==null?void 0:e.audioLevel,P=(h=E==null?void 0:E.totalSamplesDuration)!==null&&h!==void 0?h:e==null?void 0:e.totalSamplesDuration,x=(f=E==null?void 0:E.concealedSamples)!==null&&f!==void 0?f:e.concealedSamples,K=(m=E==null?void 0:E.silentConcealedSamples)!==null&&m!==void 0?m:e.silentConcealedSamples,H=(g=E==null?void 0:E.concealmentEvents)!==null&&g!==void 0?g:e.concealmentEvents;if(typeof I=="number"&&(n.totalSamplesReceived=I),typeof K=="number"&&(n.silentConcealedSamples=K),typeof H=="number"&&(n.concealmentEvents=H),typeof x=="number"&&(n.concealedSamples=x),y&&I&&(n.accelerateRate=y/I),C&&w){const J=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let re=J.jitterBufferMs;const se=w-J.jitterBufferEmittedCount;se>0&&(re=1e3*(C-J.jitterBufferDelay)/se),n.jitterBufferMs=Math.round(re),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:w,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=D;let j=1920;P&&I&&(j=I/P/50,n.receivedFrames=Math.round(I/j)),x&&(n.droppedFrames=Math.round(x/j))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(o=>{e+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{t=t===null?o.diffMean():t+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{n=n===null?o.diffMean():n+o.diffMean()});const i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},QZ=class extends f0{updateStats(){return ve.resolve()}};function _0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const c=function(){const l=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return l&&l[0]?Number(l[0].split("/")[1]):null}();return c?c<76?new $Z(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new yM(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):function(l){if(!window.RTCStatsReport)return!1;const u=l.getStats();return!!(u instanceof ve||function(h){return!!h&&(typeof h=="object"||typeof h=="function")&&typeof h.then=="function"}(u))}(e)?new yM(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new QZ(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o})}const SM="websdk_ng_install_id";function g0(){try{if(M("INSTALL_ID"))return M("INSTALL_ID");let e=window.localStorage.getItem(SM);return e||(e=vl(),window.localStorage.setItem(SM,e)),Ot("INSTALL_ID",e),e}catch{return}}const Zi=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.24.0"),E0=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let yl=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const or=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),o=[];for(let u=0;u<6;u++)o.push("1");const c=o.join(""),l={};return l[e]=i,l[t]=c,Object.assign(l,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=or;const cg={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},v0={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},y0="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",S0={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},qt=de(de(de(de({},S0),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:v0,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},cg),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Ot(e,t,n){var i,o,c;pe(i=Object.keys(qt)).call(i,e)&&(!n&&pe(o=Object.keys(lo)).call(o,e)||(qt[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(qt.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(c=!!t,qt.USE_NEW_NETWORK_CONFIG=c,c&&(qt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],qt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],qt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],qt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],qt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",qt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",qt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(qt.ENABLE_INSTANT_VIDEO=!0,qt.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(qt.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(qt.NEW_TURN_MODE||(qt.NEW_TURN_MODE=4))))}function M(e){return qt[e]}E0||(qt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],qt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],qt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],qt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],qt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],qt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],qt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",qt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",qt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",qt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",qt.AREAS=["NORTH_AMERICA","OVERSEA"]);let TM=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const lo={};var Ge=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Ge||{});let yp=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const RM=128,ZZ=96,CM=1e3,tu=10;let eee=0;var wM=(()=>{var e={8:(i,o,c)=>{c.r(o),c.d(o,{Parser:()=>se,Printer:()=>Rt,parse:()=>he,print:()=>Te});const l=`
`,u="".concat("\r").concat(l),h=" ";let f;function m(oe){return oe>="0"&&oe<="9"}function g(oe){return oe>="!"&&oe<="~"}function E(oe){return g(oe)||oe>=""&&oe<=""}function y(oe){return oe==="!"||oe>="#"&&oe<="'"||oe>="*"&&oe<="+"||oe>="-"&&oe<="."||oe>="0"&&oe<="9"||oe>="A"&&oe<="Z"||oe>="^"&&oe<="~"}function I(oe){return oe>="1"&&oe<="9"}function C(oe){return oe>="A"&&oe<="Z"||oe>="a"&&oe<="z"}function w(oe){return oe==="d"||oe==="h"||oe==="m"||oe==="s"}function D(oe){return oe>""&&oe<"	"||oe>"\v"&&oe<"\f"||oe>""&&oe<""}function P(oe){return C(oe)||m(oe)||oe==="+"||oe==="/"}function x(oe){return m(oe)||C(oe)||oe==="+"||oe==="/"||oe==="-"||oe==="_"}function K(oe){return C(oe)||m(oe)||oe==="+"||oe==="/"}function H(oe,R){var V=Object.keys(oe);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(oe);R&&(G=G.filter(function(ue){return Object.getOwnPropertyDescriptor(oe,ue).enumerable})),V.push.apply(V,G)}return V}function j(oe){for(var R=1;R<arguments.length;R++){var V=arguments[R]!=null?arguments[R]:{};R%2?H(Object(V),!0).forEach(function(G){J(oe,G,V[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(oe,Object.getOwnPropertyDescriptors(V)):H(Object(V)).forEach(function(G){Object.defineProperty(oe,G,Object.getOwnPropertyDescriptor(V,G))})}return oe}function J(oe,R,V){return R in oe?Object.defineProperty(oe,R,{value:V,enumerable:!0,configurable:!0,writable:!0}):oe[R]=V,oe}(function(oe){oe.VERSION="v",oe.ORIGIN="o",oe.SESSION_NAME="s",oe.INFORMATION="i",oe.URI="u",oe.EMAIL="e",oe.PHONE="p",oe.CONNECTION="c",oe.BANDWIDTH="b",oe.TIME="t",oe.REPEAT="r",oe.ZONE_ADJUSTMENTS="z",oe.KEY="k",oe.ATTRIBUTE="a",oe.MEDIA="m"})(f||(f={}));class re{consumeText(R,V){let G=V;for(;G<R.length;){const ue=R[G];if(ue==="\0"||ue==="\r"||ue===l)break;G+=1}if(G-V==0)throw new Error("Invalid text, at ".concat(R));return G}consumeUnicastAddress(R,V,G){return this.consumeTill(R,V,h)}consumeOneOrMore(R,V,G){let ue=V;for(;G(R[ue]);)ue++;if(ue-V==0)throw new Error("Invalid rule at ".concat(V,"."));return ue}consumeSpace(R,V){if(R[V]===h)return V+1;throw new Error("Invalid space at ".concat(V,"."))}consumeIP4Address(R,V){let G=V;for(let ue=0;ue<4;ue++)if(G=this.consumeDecimalUChar(R,G),ue!==3){if(R[G]!==".")throw new Error("Invalid IP4 address.");G++}return G}consumeDecimalUChar(R,V){let G=V;for(let Ke=0;Ke<3&&m(R[G]);Ke++,G++);if(G-V==0)throw new Error("Invalid decimal uchar.");const ue=parseInt(R.slice(V,G));if(ue>=0&&ue<=255)return G;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,V){let G=this.consumeHexpart(R,V);return R[G]===":"&&(G+=1,G=this.consumeIP4Address(R,G)),G}consumeHexpart(R,V){let G=V;if(R[G]===":"&&R[G+1]===":"){G+=2;try{G=this.consumeHexseq(R,G)}catch{}return G}if(G=this.consumeHexseq(R,G),R[G]===":"&&R[G+1]===":"){G+=2;try{G=this.consumeHexseq(R,G)}catch{}return G}return G}consumeHexseq(R,V){let G=V;for(;G=this.consumeHex4(R,G),R[G]===":"&&R[G+1]!==":";)G+=1;return G}consumeHex4(R,V){let G=0;for(;G<4;G++)if(!((ue=R[V+G])>="0"&&ue<="9"||ue>="a"&&ue<="f"||ue>="A"&&ue<="F")){if(G===0)throw new Error("Invalid hex 4");break}var ue;return V+G}consumeFQDN(R,V){let G=V;for(;m(R[G])||C(R[G])||R[G]==="-"||R[G]===".";)G+=1;if(G-V<4)throw new Error("Invalid FQDN");return G}consumeExtnAddr(R,V){return this.consumeOneOrMore(R,V,E)}consumeMulticastAddress(R,V,G){switch(G){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,V);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,V);default:try{return this.consumeFQDN(R,V)}catch{return this.consumeExtnAddr(R,V)}}}consumeIP6MulticastAddress(R,V){const G=this.consumeHexpart(R,V);return R[G]==="/"?this.consumeInteger(R,G+1):G}consumeIP4MulticastAddress(R,V){let G=V+3;const ue=R.slice(V,G),Ke=parseInt(ue);if(Ke<224||Ke>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let jt=0;jt<3;jt++){if(R[G]!==".")throw new Error("Invalid IP4 multicast address.");G+=1,G=this.consumeDecimalUChar(R,G)}return R[G]==="/"&&(G+=1),G=this.consumeTTL(R,G),R[G]==="/"&&(G=this.consumeInteger(R,G)),G}consumeInteger(R,V){if(!I(R[V]))throw new Error("Invalid integer.");for(V+=1;m(R[V]);)V+=1;return V}consumeTTL(R,V){if(R[V]==="0")return V+1;if(!I(R[V]))throw new Error("Invalid TTL.");V+=1;for(let G=0;G<2&&m(R[V]);G++)V+=1;return V}consumeToken(R,V){return this.consumeOneOrMore(R,V,y)}consumeTime(R,V){let G=V;if(R[G]==="0")return G+1;for(I(R[G])&&(G+=1);m(R[G]);)G++;if(G-V<10)throw new Error("Invalid time");return G}consumeAddress(R,V){return this.consumeTill(R,V,h)}consumeTypedTime(R,V){let G=V;return G=this.consumeOneOrMore(R,G,m),w(R[G])?G+1:G}consumeRepeatInterval(R,V){if(!I(R[V]))throw new Error("Invalid repeat interval");for(V+=1;m(R[V]);)V+=1;return w(R[V])&&(V+=1),V}consumePort(R,V){return this.consumeOneOrMore(R,V,m)}consume(R,V,G){for(let ue=0;ue<G.length;ue++){if(V+ue>=R.length)throw new Error("consume exceeding value length");if(R[V+ue]!==G[ue])throw new Error("consume ".concat(G," failed at ").concat(ue))}return V+G.length}consumeTill(R,V,G){let ue=V;for(;ue<R.length&&(typeof G!="string"||R[ue]!==G)&&(typeof G!="function"||!G(R[ue]));)ue++;return ue}}class se extends re{constructor(){super(),J(this,"records",[]),J(this,"currentLine",0)}parse(R){const V=this.probeEOL(R);this.records=R.split(V).filter(Ia=>!!Nr(Ia).call(Ia)).map(this.parseLine),this.currentLine=0;const G=this.parseVersion(),ue=this.parseOrigin(),Ke=this.parseSessionName(),jt=this.parseInformation(),Pn=this.parseUri(),cs=this.parseEmail(),Gs=this.parsePhone(),sf=this.parseConnection(),Fl=this.parseBandWidth(),ku=this.parseTimeFields(),TE=this.parseKey(),RE=this.parseSessionAttribute(),ls=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:G,origin:ue,sessionName:Ke,information:jt,uri:Pn,emails:cs,phones:Gs,connection:sf,bandwidths:Fl,timeFields:ku,key:TE,attributes:RE,mediaDescriptions:ls}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let V=0;V<R.length;V++)if(R[V]===l)return R[V-1]==="\r"?u:l;throw new Error("Invalid newline character.")}parseLine(R,V){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const G=R[0];if(R[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:G,value:R.slice(2),line:V,cur:0}}parseSessionAttribute(){const R=new Je;for(;this.currentLine<this.records.length;){const V=this.getCurrentRecord();if(V.type!==f.ATTRIBUTE)break;const G={attField:this.extractOneOrMore(V,ue=>y(ue)&&ue!==":"),_cur:0};V.value[V.cur]===":"&&(V.cur+=1,G.attValue=this.extractOneOrMore(V,D)),R.parse(G),this.currentLine++}return R.digest()}parseMediaAttributes(R){const V=new nt(R);for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==f.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(G,Ke=>y(Ke)&&Ke!==":"),_cur:0};G.value[G.cur]===":"&&(G.cur+=1,ue.attValue=this.extractOneOrMore(G,D)),V.parse(ue),this.currentLine++}return V.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===f.KEY){if(R.value==="prompt"||R.value==="clear:"||R.value==="base64:"||R.value==="uri:")return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===f.ZONE_ADJUSTMENTS){const V=[];for(;;)try{const G=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let ue=!1;R.value[R.cur]==="-"&&(ue=!0,R.cur+=1);const Ke=this.extract(R,this.consumeTypedTime);V.push({time:G,typedTime:Ke,back:ue})}catch{break}if(V.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,V}return[]}parseRepeat(){const R=[];for(;;){const V=this.getCurrentRecord();if(V.type!==f.REPEAT)break;{const G=this.extract(V,this.consumeRepeatInterval),ue=this.parseTypedTime(V);R.push({repeatInterval:G,typedTimes:ue}),this.currentLine++}}return R}parseTypedTime(R){const V=[];for(;;)try{this.consumeSpaceForRecord(R),V.push(this.extract(R,this.consumeTypedTime))}catch{break}if(V.length===0)throw new Error("Invalid typed time.");return V}parseTime(){const R=this.getCurrentRecord(),V=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const G=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:V,stopTime:G}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const V=this.getCurrentRecord();if(V.type!==f.BANDWIDTH)break;{const G=this.extractOneOrMore(V,y);if(V.value[V.cur]!==":")throw new Error("Invalid bandwidth field.");V.cur++;const ue=this.extractOneOrMore(V,m);R.push({bwtype:G,bandwidth:ue}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==f.VERSION)throw new Error("first sdp record must be version");const V=R.value.slice(0,this.consumeOneOrMore(R.value,0,m));if(V.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,V}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");const V=this.extractOneOrMore(R,E);this.consumeSpaceForRecord(R);const G=this.extractOneOrMore(R,m);this.consumeSpaceForRecord(R);const ue=this.extractOneOrMore(R,m);this.consumeSpaceForRecord(R);const Ke=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);const jt=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);const Pn=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:V,sessId:G,sessVersion:ue,nettype:Ke,addrtype:jt,unicastAddress:Pn}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===f.SESSION_NAME){const V=this.extract(R,this.consumeText);return this.currentLine++,V}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==f.INFORMATION)return;const V=this.extract(R,this.consumeText);return this.currentLine++,V}parseUri(){const R=this.getCurrentRecord();if(R.type===f.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const V=this.getCurrentRecord();if(V.type!==f.EMAIL)break;R.push(V.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const V=this.getCurrentRecord();if(V.type!==f.PHONE)break;R.push(V.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===f.CONNECTION){const V=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);const G=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);const ue=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:V,addrtype:G,address:ue}}}parseMedia(){const R=this.getCurrentRecord(),V=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let G=this.extract(R,this.consumePort);R.value[R.cur]==="/"&&(R.cur+=1,G+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const ue=[];for(ue.push(this.extract(R,this.consumeToken));R.value[R.cur]==="/";)R.cur+=1,ue.push(this.extract(R,this.consumeToken));if(ue.length===0)throw new Error("Invalid proto");const Ke=this.parseFmt(R);return this.currentLine++,{mediaType:V,port:G,protos:ue,fmts:Ke}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===f.TIME;){const V=this.parseTime(),G=this.parseRepeat(),ue=this.parseZone();R.push({time:V,repeats:G,zones:ue})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){const V=this.parseMedia(),G=this.parseInformation(),ue=this.parseConnections(),Ke=this.parseBandWidth(),jt=this.parseKey(),Pn=this.parseMediaAttributes(V);R.push({media:V,information:G,connections:ue,bandwidths:Ke,key:jt,attributes:Pn})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const V=[];for(;;)try{this.consumeSpaceForRecord(R),V.push(this.extract(R,this.consumeToken))}catch{break}if(V.length===0)throw new Error("Invalid fmts");return V}extract(R,V){for(var G=arguments.length,ue=new Array(G>2?G-2:0),Ke=2;Ke<G;Ke++)ue[Ke-2]=arguments[Ke];const jt=V.call(this,R.value,R.cur,...ue),Pn=R.value.slice(R.cur,jt);return R.cur=jt,Pn}extractOneOrMore(R,V){const G=this.consumeOneOrMore(R.value,R.cur,V),ue=R.value.slice(R.cur,G);return R.cur=G,ue}consumeSpaceForRecord(R){if(R.value[R.cur]!==h)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class le extends re{constructor(){super(...arguments),J(this,"attributes",void 0),J(this,"digested",!1)}extractOneOrMore(R,V,G){const ue=this.consumeOneOrMore(R.attValue,R._cur,V),Ke=R.attValue.slice(R._cur,ue),[jt,Pn]=G||[];if(typeof jt=="number"&&Ke.length<jt)throw new Error("error in length, should be more or equal than ".concat(jt," characters."));if(typeof Pn=="number"&&Ke.length>Pn)throw new Error("error in length, should be less or equal than ".concat(Pn," characters."));return R._cur=ue,Ke}consumeAttributeSpace(R){if(R.attValue[R._cur]!==h)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,V){if(!R.attValue)throw new Error("Nothing to extract from attValue.");for(var G=arguments.length,ue=new Array(G>2?G-2:0),Ke=2;Ke<G;Ke++)ue[Ke-2]=arguments[Ke];const jt=V.call(this,R.attValue,R._cur,...ue),Pn=R.attValue.slice(R._cur,jt);return R._cur=jt,Pn}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,V){if(!R.attValue)throw new Error;for(let G=0;G<V.length;G++)if(V[G]!==R.attValue[R._cur+G])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,P,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,P,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const V=[];for(;!this.atEnd(R);){V.push(this.extractOneOrMore(R,P));try{this.consumeAttributeSpace(R)}catch(G){if(this.atEnd(R))break;throw G}}this.attributes.iceOptions=V}parseFingerprint(R){const V=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:V,fingerprint:G})}parseExtmap(R){const V=this.extractOneOrMore(R,m);let G;this.peekChar(R)==="/"&&(this.extract(R,this.consume,"/"),G=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const ue=this.extract(R,this.consumeTill,h),Ke=j(j({entry:parseInt(V,10)},G&&{direction:G}),{},{extensionName:ue});this.peekChar(R)===h&&(this.consumeAttributeSpace(R),Ke.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(Ke)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const V=this.extract(R,this.consumeTill);if(V!=="active"&&V!=="passive"&&V!=="actpass"&&V!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=V}}class Je extends le{constructor(){super(...arguments),J(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(V){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),V}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const V=this.extract(R,this.consumeToken),G=[];for(;!this.atEnd(R)&&this.peekChar(R)===h;)this.consumeAttributeSpace(R),G.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:V,identificationTag:G})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,x)}parseIdentity(R){const V=this.extractOneOrMore(R,K),G=[];for(;!this.atEnd(R)&&this.peekChar(R)===h;){this.consumeAttributeSpace(R);const ue=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const Ke=this.extractOneOrMore(R,jt=>jt!==h&&D(jt));G.push({name:ue,value:Ke})}this.attributes.identities.push({assertionValue:V,extensions:G})}parseMsidSemantic(R){this.peekChar(R)===h&&this.consumeAttributeSpace(R);const V={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if(this.peekChar(R)==="*"){this.extract(R,this.consume,"*"),V.applyForAll=!0;break}{const G=this.extract(R,this.consumeTill,h);V.identifierList.push(G)}}this.attributes.msidSemantic=V}}class nt extends le{constructor(R){super(),J(this,"attributes",void 0),R.protos.indexOf("RTP")!==-1||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(V){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),V}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const V=this.extractOneOrMore(R,P,[1,32]);this.consumeAttributeSpace(R);const G=this.extractOneOrMore(R,m,[1,5]);this.consumeAttributeSpace(R);const ue=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Ke=this.extractOneOrMore(R,m,[1,10]);this.consumeAttributeSpace(R);const jt=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Pn=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const cs={foundation:V,componentId:G,transport:ue,priority:Ke,connectionAddress:jt,port:Pn,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),cs.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),cs.relPort=this.extract(R,this.consumePort));this.peekChar(R)===h;){this.consumeAttributeSpace(R);const Gs=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),cs.extension[Gs]=this.extractOneOrMore(R,g)}this.attributes.candidates.push(cs)}parseRemoteCandidate(R){const V=[];for(;;){const G=this.extractOneOrMore(R,m,[1,5]);this.consumeAttributeSpace(R);const ue=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Ke=this.extract(R,this.consumePort);V.push({componentId:G,connectionAddress:ue,port:Ke});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(V)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const V=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const ue={encodingName:G,clockRate:this.extractOneOrMore(R,m)};this.atEnd(R)||this.peekChar(R)!=="/"||(this.extract(R,this.consume,"/"),ue.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const Ke=this.attributes.payloads.find(jt=>jt.payloadType===parseInt(V,10));Ke?Ke.rtpMap=ue:this.attributes.payloads.push({payloadType:parseInt(V,10),rtpMap:ue,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const V=this.extractOneOrMore(R,m);this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill,":");let ue;this.peekChar(R)===":"&&(this.extract(R,this.consume,":"),ue=this.extract(R,this.consumeTill));const Ke=this.attributes.ssrcs.find(jt=>jt.ssrcId===parseInt(V,10));Ke?Ke.attributes[G]=ue:this.attributes.ssrcs.push({ssrcId:parseInt(V,10),attributes:{[G]:ue}})}parseFmtp(R){const V=this.extract(R,this.consumeTill,h);this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill),ue={};G.split(";").forEach(jt=>{let[Pn,cs]=jt.split("=");Pn=Nr(Pn).call(Pn);const Gs=typeof cs=="string"?Nr(cs).call(cs):null;typeof Pn=="string"&&Pn.length>0&&(ue[Pn]=Gs)});const Ke=this.attributes.payloads.find(jt=>jt.payloadType===parseInt(V,10));Ke?Ke.fmtp={parameters:ue}:this.attributes.payloads.push({payloadType:parseInt(V,10),rtcpFeedbacks:[],fmtp:{parameters:ue}})}parseFmtParameters(R){const V={},G=this.extract(R,this.consumeTill,"=");R._cur++;const ue=this.extract(R,this.consumeTill,";");for(V[G]=ue;R.attValue[R._cur]===";";){const Ke=this.extract(R,this.consumeTill,"=");R._cur++;const jt=this.extract(R,this.consumeTill,";");V[Ke]=jt}return V}parseRtcpFb(R){let V="";V=this.peekChar(R)==="*"?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,h),this.consumeAttributeSpace(R);const G=this.extract(R,this.consumeTill,h);let ue;if(G==="trr-int")ue={type:G,interval:this.extract(R,this.consumeTill)};else{const Ke={type:G};this.peekChar(R)===h&&(this.consumeAttributeSpace(R),Ke.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===h&&(Ke.additional=this.extract(R,this.consumeTill))),ue=Ke}if(V==="*")this.attributes.rtcpFeedbackWildcards.push(ue);else{const Ke=this.attributes.payloads.find(jt=>jt.payloadType===parseInt(V,10));Ke?Ke.rtcpFeedbacks.push(ue):this.attributes.payloads.push({payloadType:parseInt(V,10),rtcpFeedbacks:[ue]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const V={port:this.extract(R,this.consumePort)};this.peekChar(R)===h&&(this.consumeAttributeSpace(R),V.netType=this.extractOneOrMore(R,y),this.consumeAttributeSpace(R),V.addressType=this.extractOneOrMore(R,y),this.consumeAttributeSpace(R),V.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=V}parseMsid(R){const V={id:this.extractOneOrMore(R,y,[1,64])};this.peekChar(R)===h&&(this.consumeAttributeSpace(R),V.appdata=this.extractOneOrMore(R,y,[1,64])),this.attributes.msids.push(V)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const V=this.extractOneOrMore(R,ue=>C(ue)||m(ue)||ue==="_"||ue==="-");this.consumeAttributeSpace(R);const G={id:V,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===h){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const ue=[];for(;;){const Ke=this.extract(R,this.consumeToken);ue.push(Ke);try{this.extract(R,this.consume,",")}catch{break}}G.payloads=ue,this.peekChar(R)===h&&this.extract(R,this.consume,h)}for(;;){const ue=this.extract(R,this.consumeToken);switch(ue){case"depend":{const Ke={type:ue,rids:this.extract(R,this.consume,"=").split(",")};G.params.push(Ke);break}default:{const Ke={type:ue};this.peekChar(R)==="="&&(this.extract(R,this.consume,"="),Ke.val=this.extract(R,this.consumeTill,";")),G.params.push(Ke)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(G)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,m,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const V=this.extract(R,this.consumeToken),G=[];for(;;)try{this.consumeAttributeSpace(R);const ue=this.extract(R,this.consumeInteger);G.push(parseInt(ue,10))}catch{break}this.attributes.ssrcGroups.push({semantic:V,ssrcIds:G})}}function Fe(oe,R,V){return R in oe?Object.defineProperty(oe,R,{value:V,enumerable:!0,configurable:!0,writable:!0}):oe[R]=V,oe}class Rt{constructor(){Fe(this,"eol",u)}print(R,V){let G="";return V&&(this.eol=V),G+=this.printVersion(R.version),G+=this.printOrigin(R.origin),G+=this.printSessionName(R.sessionName),G+=this.printInformation(R.information),G+=this.printUri(R.uri),G+=this.printEmail(R.emails),G+=this.printPhone(R.phones),G+=this.printConnection(R.connection),G+=this.printBandwidth(R.bandwidths),G+=this.printTimeFields(R.timeFields),G+=this.printKey(R.key),G+=this.printSessionAttributes(R.attributes),G+=this.printMediaDescription(R.mediaDescriptions),G}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let V="";for(const G of R)V+="e=".concat(G).concat(this.eol);return V}printPhone(R){let V="";for(const G of R)V+="e=".concat(G).concat(this.eol);return V}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let V="";for(const G of R)V+="b=".concat(G.bwtype,":").concat(G.bandwidth).concat(this.eol);return V}printTimeFields(R){let V="";for(const G of R){V+="t=".concat(G.time.startTime," ").concat(G.time.startTime).concat(this.eol);for(const ue of G.repeats)V+="r=".concat(ue.repeatInterval," ").concat(ue.typedTimes.join(" ")).concat(this.eol);G.zoneAdjustments&&(V+="z=",V+="z=".concat(G.zoneAdjustments.map(ue=>"".concat(ue.time," ").concat(ue.back?"-":""," ").concat(ue.typedTime)).join(" ")).concat(this.eol),V+=this.eol)}return V}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let V="";for(const G of R)V+="a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol);return V}printMediaDescription(R){let V="";for(const G of R)V+=this.printMedia(G.media),V+=this.printInformation(G.information),V+=this.printConnections(G.connections),V+=this.printBandwidth(G.bandwidths),V+=this.printKey(G.key),V+=this.printMediaAttributes(G);return V}printConnections(R){let V="";for(const G of R)V+=this.printConnection(G);return V}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new _r(this.eol).print(R)}printMediaAttributes(R){return new ie(this.eol).print(R)}}class yt{constructor(R){Fe(this,"eol",void 0),this.eol=R}printIceUfrag(R){return R===void 0?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return R===void 0?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return R===void 0?"":"a=ice-options:".concat(R.join(h)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(V=>"a=fingerprint:".concat(V.hashFunction).concat(h).concat(V.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(V=>"a=extmap:".concat(V.entry).concat(V.direction?"/".concat(V.direction):"").concat(h).concat(V.extensionName).concat(V.extensionAttributes?"".concat(h).concat(V.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return R===void 0?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(V=>"a=".concat(V.attField).concat(V.attValue?":".concat(V.attValue):"").concat(this.eol)).join("")}}class _r extends yt{print(R){let V="";return V+=this.printGroups(R.groups),V+=this.printMsidSemantic(R.msidSemantic),V+=this.printIceLite(R.iceLite),V+=this.printIceUfrag(R.iceUfrag),V+=this.printIcePwd(R.icePwd),V+=this.printIceOptions(R.iceOptions),V+=this.printFingerprints(R.fingerprints),V+=this.printSetup(R.setup),V+=this.printTlsId(R.tlsId),V+=this.printIdentity(R.identities),V+=this.printExtmap(R.extmaps),V+=this.printUnrecognized(R.unrecognized),V}printGroups(R){let V="";return R.length>0&&(V+=R.map(G=>"a=group:".concat(G.semantic).concat(G.identificationTag.map(ue=>"".concat(h).concat(ue)).join("")).concat(this.eol)).join("")),V}printIceLite(R){return R===void 0?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return R.length===0?"":R.map(V=>"a=identity:".concat(V.assertionValue).concat(V.extensions.map(G=>"".concat(h).concat(G.name).concat(G.value?"=".concat(G.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let V="a=msid-semantic:".concat(R.semantic);return R.applyForAll?V+="".concat(h,"*"):R.identifierList.length>0&&(V+=R.identifierList.map(G=>"".concat(h).concat(G))),V+this.eol}}class ie extends yt{print(R){const V=R.attributes;let G="";return G+=this.printRTCP(V.rtcp),G+=this.printIceUfrag(V.iceUfrag),G+=this.printIcePwd(V.icePwd),G+=this.printIceOptions(V.iceOptions),G+=this.printCandidates(V.candidates),G+=this.printRemoteCandidatesList(V.remoteCandidatesList),G+=this.printEndOfCandidates(V.endOfCandidates),G+=this.printFingerprints(V.fingerprints),G+=this.printSetup(V.setup),G+=this.printMid(V.mid),G+=this.printExtmap(V.extmaps),G+=this.printRTPRelated(V),G+=this.printPtime(V.ptime),G+=this.printMaxPtime(V.maxPtime),G+=this.printDirection(V.direction),G+=this.printSSRCGroups(V.ssrcGroups),G+=this.printSSRC(V.ssrcs),G+=this.printRTCPMux(V.rtcpMux),G+=this.printRTCPMuxOnly(V.rtcpMuxOnly),G+=this.printRTCPRsize(V.rtcpRsize),G+=this.printMSId(V.msids),G+=this.printImageattr(V.imageattr),G+=this.printRid(V.rids),G+=this.printSimulcast(V.simulcast),G+=this.printSCTPPort(V.sctpPort),G+=this.printMaxMessageSize(V.maxMessageSize),G+=this.printUnrecognized(V.unrecognized),G}printCandidates(R){return R.map(V=>"a=candidate:".concat(V.foundation).concat(h).concat(V.componentId).concat(h).concat(V.transport).concat(h).concat(V.priority).concat(h).concat(V.connectionAddress).concat(h).concat(V.port).concat(h,"typ").concat(h).concat(V.type).concat(V.relAddr?"".concat(h,"raddr").concat(h).concat(V.relAddr):"").concat(V.relPort?"".concat(h,"rport").concat(h).concat(V.relPort):"").concat(Object.keys(V.extension).map(G=>"".concat(h).concat(G).concat(h).concat(V.extension[G])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(V=>"a=remote-candidates:".concat(V.join(h)).concat(this.eol)).join("")}printEndOfCandidates(R){return R===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const V=R.payloads;let G="";G+=R.rtcpFeedbackWildcards.map(ue=>this.printRTCPFeedback("*",ue)).join("");for(const ue of V)G+=this.printRtpMap(ue.payloadType,ue.rtpMap),G+=this.printFmtp(ue.payloadType,ue.fmtp),G+=ue.rtcpFeedbacks.map(Ke=>this.printRTCPFeedback(ue.payloadType,Ke)).join("");return G}printFmtp(R,V){if(!V)return"";const G=Object.keys(V.parameters);return G.length===1&&V.parameters[G[0]]===null?"a=fmtp:".concat(R).concat(h).concat(G[0]).concat(this.eol):"a=fmtp:".concat(R).concat(h).concat(Object.keys(V.parameters).map(ue=>"".concat(ue,"=").concat(V.parameters[ue])).join(";")).concat(this.eol)}printRtpMap(R,V){return V?"a=rtpmap:".concat(R).concat(h).concat(V.encodingName,"/").concat(V.clockRate).concat(V.encodingParameters?"/".concat(V.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,V){let G="a=rtcp-fb:".concat(R).concat(h),ue=V;return ue.type==="trr-int"?G+="ttr-int".concat(h).concat(ue.interval):(G+="".concat(ue.type),ue.parameter&&(G+="".concat(h).concat(ue.parameter),ue.additional&&(G+="".concat(h).concat(ue.additional)))),G+this.eol}printPtime(R){return R===void 0?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return R===void 0?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return R===void 0?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(V=>Object.keys(V.attributes).map(G=>"a=ssrc:".concat(V.ssrcId.toString(10)).concat(h).concat(G).concat(V.attributes[G]?":".concat(V.attributes[G]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return R===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return R===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return R===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(R===void 0)return"";let V="a=rtcp:".concat(R.port);return R.netType&&(V+="".concat(h).concat(R.netType)),R.addressType&&(V+="".concat(h).concat(R.addressType)),R.address&&(V+="".concat(h).concat(R.address)),V+this.eol}printMSId(R){return R.map(V=>"a=msid:".concat(V.id).concat(V.appdata?"".concat(h).concat(V.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(V=>"a=imageattr:".concat(V).concat(this.eol)).join("")}printRid(R){return R.map(V=>{let G="a=rid:".concat(V.id).concat(h).concat(V.direction);return V.payloads&&(G+="".concat(h,"pt=").concat(V.payloads.join(","))),V.params.length>0&&(G+="".concat(h).concat(V.params.map(ue=>ue.type==="depend"?"depend=".concat(ue.rids.join(",")):"".concat(ue.type,"=").concat(ue.val)).join(";"))),G+this.eol}).join("")}printSimulcast(R){return R===void 0?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return R===void 0?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return R===void 0?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return R===void 0?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(V=>"a=ssrc-group:".concat(V.semantic).concat(V.ssrcIds.map(G=>"".concat(h).concat(G.toString(10))).join("")).concat(this.eol)).join("")}}function he(oe){return new se().parse(oe)}function Te(oe,R){return new Rt().print(oe,R)}}},t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}return n.d=(i,o)=>{for(var c in o)n.o(o,c)&&!n.o(i,c)&&Object.defineProperty(i,c,{enumerable:!0,get:o[c]})},n.o=(i,o)=>Object.prototype.hasOwnProperty.call(i,o),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function ii(e){return wM.parse(e)}function sc(e,t){return wM.print(e,t)}var tee=Ts("Array","keys"),nee=qa,ree=vr,iee=B,see=tee,T0=Array.prototype,oee={DOMTokenList:!0,NodeList:!0},aee=function(e){var t=e.keys;return e===T0||iee(T0,e)&&t===T0.keys||ree(oee,nee(e))?see:t},si=p(aee);function an(e,t,n){return(t=function(i){var o=function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bM(Object(n),!0).forEach(function(i){an(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const IM=new class extends nn{constructor(){super(...arguments),an(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class cee{constructor(t){an(this,"logger",void 0),an(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function R0(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function AM(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const es={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},lg=Date.now(),Sp=e=>{for(const t in es)if(Object.prototype.hasOwnProperty.call(es,t)&&es[t]===e)return t;return"DEFAULT"},S=new class{constructor(){an(this,"proxyServerURL",void 0),an(this,"logLevel",es.DEBUG),an(this,"uploadState","collecting"),an(this,"uploadLogWaitingList",[]),an(this,"uploadLogUploadingList",[]),an(this,"uploadErrorCount",0),an(this,"currentLogID",0),an(this,"url",void 0),an(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[es.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[es.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[es.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[es.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[es.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Ot("UPLOAD_LOG",!0)}disableLogUpload(){Ot("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new cee(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-lg<100)return void setTimeout(()=>{this.log(...t)},Date.now()-lg);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=R0()+" Agora-SDK [".concat(Sp(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const o=R0()+" %cAgora-SDK [".concat(Sp(i),"]:");let c=[];if(!M("USE_NEW_LOG"))switch(i){case es.DEBUG:c=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,c);break;case es.INFO:c=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,c);break;case es.WARNING:c=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,c);break;case es.ERROR:c=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,c)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-lg<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-lg);const i=Math.max(0,Math.min(4,t[0]));t[0]=R0()+" Agora-SDK [".concat(Sp(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!M("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=AM()+" Agora-SDK [".concat(Sp(e),"]:"):n[0]=AM()+" Agora-SDK [".concat(Sp(e),"]:");let o="";n.forEach(c=>{typeof c=="object"&&(c=JSON.stringify(c)),o+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Zi,process_id:M("PROCESS_ID"),payload:JSON.stringify(e)};return co(async()=>{const n=await Yr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(M("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(M("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:e.map(o=>o.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),IM.reportLogUploadError(i),!0},{timeout:M("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:M("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,M("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var OM;function lee(e){return qn(e.reportId,"params.reportId",0,100,!1),qn(e.category,"params.category",0,100,!1),qn(e.event,"params.event",0,100,!1),qn(e.label,"params.label",0,100,!1),Dt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(OM={}).FREE="free",OM.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const dee={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Ln=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Xt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let uee=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function xe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const o=i.value;if(typeof o=="function"){const c=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var l,u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];let m=h;if(e.argsMap)try{m=e.argsMap(this,...h)}catch(E){S.warning(E),m=[]}try{JSON.stringify(m)}catch{S.warning("arguments for method ".concat(c,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const g=(e.report||be).reportApiInvoke(this._sessionId||null,{id:this._clientId||((l=this.store)===null||l===void 0?void 0:l.clientId)||this._ID,name:"".concat(c,".").concat(String(n)),options:m,tag:Jt.TRACER,reportResult:e.reportResult},e.throttleTime);try{const E=o.apply(this,h);return E instanceof ve?E.then(y=>(g.onSuccess(e.reportResult&&y),y)).catch(y=>{throw g.onError(y),y}):(g.onSuccess(e.reportResult&&E),E)}catch(E){throw g.onError(E),E}}}return i}}const be=new class{constructor(){an(this,"baseInfoMap",new Map),an(this,"proxyServer",void 0),an(this,"eventUploadTimer",void 0),an(this,"setSessionIdTimer",void 0),an(this,"url",void 0),an(this,"sids",new Set),an(this,"backupUrl",void 0),an(this,"_appId",void 0),an(this,"_aid",0),an(this,"keyEventUploadPendingItems",[]),an(this,"normalEventUploadPendingItems",[]),an(this,"apiInvokeUploadPendingItems",[]),an(this,"apiInvokeCount",0),an(this,"apiInvokeLoggedCount",0),an(this,"ltsList",[]),an(this,"lastSendNormalEventTime",Date.now()),an(this,"customReportCounterTimer",void 0),an(this,"customReportCount",0),an(this,"extApiInvoke",async e=>{for(const t of e){const n=Ye(Ye({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Jt.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),M("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),M("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,i]=t;return n+i}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,c=!!M("SHOW_REPORT_INVOKER_LOG"),l=!!M("SHOW_REPORT_USER_INVOKER_LOG"),u=c||l&&t.id;u&&(this.apiInvokeLoggedCount+=1);const h=this.apiInvokeLoggedCount;function f(y,I){if(u){let C="[apiInvoke-".concat(h,"]");if(t.id&&(C+="[".concat(t.id,"]")),t.name&&(C+="[".concat(t.name,"]"),t.name===un.JOIN))return S.info("".concat(C," ").concat(y));S.info("".concat(C," ").concat(y),y==="start"?t.options:I||"")}}const m=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});f("start");let g=!1;Xn(t.timeout).then(()=>{g||(this.sendApiInvoke(Ye(Ye({},m()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),f("timeout"))});const E=new ne(k.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:y=>{const I=()=>{if(g)throw E;return g=!0,this.sendApiInvoke(Ye(Ye({},m()),{},{success:!0},t.reportResult&&{result:y})),f("onSuccess"),y};return n?cM(I,t.name+"Success",n,()=>g=!0):I()},onError:y=>{const I=()=>{if(g)throw y;g=!0,this.sendApiInvoke(Ye(Ye({},m()),{},{success:!1,error:y})),f("onFailure",y.toString())};return n?cM(I,t.name+"Error",n,()=>g=!0):I()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const o=Object.assign({},{willUploadConsoleLog:M("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:E0?"global":"oversea",areas:M("AREAS")&&M("AREAS").join(",")},t.extend),{stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:f,clientRole:m}=t,g=Date.now(),E=Ye(Ye({},i),{},{eventType:Ln.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:y0,lts:g,elapse:g-n,extend:JSON.stringify(o),mode:t.mode,process:M("PROCESS_ID"),appType:M("APP_TYPE"),success:!0,version:Zi,stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:f,clientType:pe(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:m,serviceId:M("PROCESS_ID"),extensionID:M("PLUGIN_INFO").join(",")||""});var y;this.send({type:Xt.SESSION,data:E},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye({},i),{},{role:t.role,eventType:Ln.JOIN_CHOOSE_SERVER,lts:o,eventElapse:t.elapse||o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Xt.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye({},i),{},{eventType:Ln.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Xt.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const o=Date.now(),{firstSuccess:c,addr:l,isProxy:u}=t,h=o-n.startTime,f=Ye(Ye({},i),{},{eventType:Ln.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:h,eventElapse:o-t.lts,firstSuccess:c,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:g0(),isABTestSuccess:t.isABTestSuccess?1:0}),m=f.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),c)this.send({type:Xt.JOIN_GATEWAY,data:f},!0);else{let g;if(l)if(u){const y=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),I=l.match(/p=[0-9]{1,6}/g);g={isSuccess:m,gatewayIp:y&&y.length?y[0].split("=")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split("=")[1]:"",isProxy:u?1:0}}else{const y=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),I=l.match(/(:|p=)[0-9]{1,6}/g);g={isSuccess:m,gatewayIp:y&&y.length?y[0].split("//")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split(/:|p=/g)[1]:"",isProxy:u?1:0}}else g={isSuccess:m,gatewayIp:"",port:"",isProxy:u?1:0};delete f.success,delete f.eventType,delete f.firstSuccess,f.vid=Number(f.vid);const E=Object.assign({},f,g,{eventType:Ln.REJOIN_GATEWAY});this.send({type:Xt.RE_JOIN_GATEWAY,data:E},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),o=Ye(Ye({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:Xt.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye({},i),{},{eventType:Ln.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Xt.PUBLISH,data:c},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),l=Ye(Ye({},o),{},{eventType:Ln.SUBSCRIBE,lts:c,eventElapse:t.eventElapse,elapse:c-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?l.peerSuid=t.peerid:l.peer=t.peerid,this.send({type:Xt.SUBSCRIBE,data:l},!0)}wsCompressorInit(e){var t;const n=[...si(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(i);if(!o)return;const c=o.info,l=Date.now(),u=Ye(Ye({},c),{},{eventType:Ln.WS_COMPRESSOR_INIT,lts:l,eventElapse:e.eventElapse,elapse:l-o.startTime,status:e.status?1:2});this.send({type:Xt.WS_COMPRESSOR_INIT,data:u},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=t.peerPubStatusMs-(n.lastJoinSuccessTime||o),l=Ye(Ye({},i),{},{elapse:o-n.startTime,eventType:Ln.XLA_PEER_FIRST_VIDEO_FRAME,lts:o,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:c,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>c?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:Xt.XLA_PEER_FIRST_VIDEO_FRAME,data:l},!0)}firstRemoteVideoDecode(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,l=Date.now(),u=Ye(Ye(Ye({},c),i),{},{elapse:l-o.startTime,eventType:t,lts:l,firstDecodeFrame:Math.max((i.firstFrame||l)-o.startTime,0),apEnd:Math.max(i.apEnd-o.startTime,0),apStart:Math.max(i.apStart-o.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-o.startTime,0),joinGwStart:Math.max(i.joinGwStart-o.startTime,0),pcEnd:Math.max(i.pcEnd-o.startTime,0),pcStart:Math.max(i.pcStart-o.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-o.startTime,0),subscriberStart:Math.max(i.subscriberStart-o.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-o.startTime,0)});this.send({type:n,data:u},!0)}firstRemoteFrame(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,l=Date.now(),u=Ye(Ye(Ye({},c),i),{},{elapse:l-o.startTime,eventType:t,lts:l});this.send({type:n,data:u},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye(Ye({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:Ln.AB_TEST,lts:o});this.send({type:Xt.AB_TEST,data:c},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye(Ye({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:Ln.PC_STATS,lts:o,preallocation:t.preallocation?1:0});this.send({type:Xt.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye(Ye({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Ln.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:Xt.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,l=Date.now(),u=Ye(Ye(Ye({},c),i),{},{eventType:t,lts:l});this.send({type:n,data:u},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye({},i),{},{eventType:Ln.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:Xt.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye({},i),{},{eventType:Ln.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Xt.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye({},i),{},{eventType:Ln.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Xt.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(e){this.proxyServer=e,e?S.debug("reportProxyServerurl: ".concat(e)):S.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Xt.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now();(function(c,l,u){const h=c[l];if(!h||typeof h!="string")return[c];c[l]="";const f=jo(JSON.stringify(c));let m=0;const g=[];let E=0;for(let y=0;y<h.length;y++)E+=h.charCodeAt(y)<=127?1:3,E<=u-f||(g[g.length]=de(de({},c),{},{[l]:h.substring(m,y)}),m=y,E=h.charCodeAt(y)<=127?1:3);return m!==h.length-1&&(g[g.length]=de(de({},c),{},{[l]:h.substring(m)})),g})(Ye(Ye(Ye({},i),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:Xt.WORKER_EVENT,data:c},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye(Ye({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:Xt.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye(Ye({},i),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:Xt.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),c=Ye(Ye(Ye({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:Xt.WEBSOCKET_QUIT,data:c},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>M("CUSTOM_REPORT_LIMIT"))throw new ne(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(o=>({type:Xt.USER_ANALYTICS,data:Ye(Ye({sid:e},o),{},{lts:n})}));try{M("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(o){throw S.error("send custom report message failed",o.toString()),new ne(k.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(e){const t=M("NOT_REPORT_EVENT");if(e.tag&&pe(t)&&pe(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:o,cid:c}=n.info;let l;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ne){const{code:h,message:f}=e.error;l=h||f||e.error.toString()}else l=e.error.toString();const u={invokeId:e.invokeId,sid:e.sid,cname:i,cid:c,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?l:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Xt.API_INVOKE,data:u},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>M("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const c=e.shift();n.length<20?n.push(c):i.push(c)}e.push(...i);for(const c of[...n]){var o;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),cl(o=this.ltsList).call(o,(l,u)=>l-u))}return t||(this.lastSendNormalEventTime=Date.now()),M("ENABLE_EVENT_REPORT")&&n.length&&(M("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((c=>l=>{M("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>M("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-M("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){gn.networkState===Si.OFFLINE&&await ve.race([gn.onlineWaiter,Xn(2*Rn.maxRetryTimeout)]);const t=o=>{let c=new Uint8Array;return o.forEach(l=>{const u=s0(JSON.stringify(l.data)),h=new ArrayBuffer(5),f=(g=>{let E=0;return Object.entries(Xt).forEach(y=>{let[I,C]=y;C===g.type&&(E=uee[I])}),E})(l),m=new DataView(h);m.setUint16(0,u.byteLength,!0),m.setUint8(2,255&f),m.setUint8(3,f>>>8&255),m.setUint8(4,f>>>16&255),c=ZL(c,new Uint8Array(h)),c=ZL(c,u)}),c},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(M("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(M("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await h0(i,{timeout:1e4,data:t(e),headers:Ye(Ye({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(o===1)throw c;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(u=>{const h=u&&u.data.sid&&this.baseInfoMap.get(u.data.sid);return h&&h.info.vid&&+h.info.vid||0})(e[0]),i=n?void 0:this._aid,o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(u=>JSON.stringify(u)),vid:n,aid:i};gn.networkState===Si.OFFLINE&&await ve.race([gn.onlineWaiter,Xn(2*Rn.maxRetryTimeout)]);const c=t?"/events/proto-raws":"/events/messages";let l=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("EVENT_REPORT_DOMAIN"),"&p=").concat(M("STATS_COLLECTOR_PORT"),"&d=").concat(c):"https://".concat(M("EVENT_REPORT_DOMAIN"),":").concat(M("STATS_COLLECTOR_PORT")).concat(c));for(let u=0;u<2;u+=1){u===1&&(l=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(M("STATS_COLLECTOR_PORT"),"&d=").concat(c):"https://".concat(M("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(M("STATS_COLLECTOR_PORT")).concat(c)));try{t?await JZ(l,{timeout:1e4,data:o}):await h0(l,{timeout:1e4,data:o})}catch(h){if(u===1)throw h;continue}return}}createBaseInfo(e,t){const n=Object.assign({},dee);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:Jt.TRACER}).onSuccess()}};IM.on("REPORT_LOG_UPLOAD",e=>{e.networkState=gn.networkState,be.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Jt.TRACER}).onSuccess("logUploadError")});class Q extends ne{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),an(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,S)}throw(){super.throw(S)}}const Jn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ft(){return Jn}function NM(){return"setSinkId"in HTMLAudioElement.prototype&&(!M("RESTRICTION_SET_PLAYBACK_DEVICE")||(_a()||BL())&&!n0())}function dg(){return!Jn.supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&ga()}function C0(e){return!(sn()||WL(87)||dg()||!M("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||M("FORCE_DISABLE_AUTO_SUB")))}function PM(e){return!!M("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||M("FORCE_DISABLE_AUTO_SUB"))}let $n=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function nu(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function mt(e,t,n,i,o){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:o}}function Ds(e,t,n,i,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:o}}function w0(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const hee={"90p":mt(160,90),"90p_1":mt(160,90),"120p":mt(160,120,15,30,65),"120p_1":mt(160,120,15,30,65),"120p_3":mt(120,120,15,30,50),"120p_4":mt(212,120),"180p":mt(320,180,15,30,140),"180p_1":mt(320,180,15,30,140),"180p_3":mt(180,180,15,30,100),"180p_4":mt(240,180,15,30,120),"240p":mt(320,240,15,40,200),"240p_1":mt(320,240,15,40,200),"240p_3":mt(240,240,15,40,140),"240p_4":mt(424,240,15,40,220),"360p":mt(640,360,15,80,400),"360p_1":mt(640,360,15,80,400),"360p_3":mt(360,360,15,80,260),"360p_4":mt(640,360,30,80,600),"360p_6":mt(360,360,30,80,400),"360p_7":mt(480,360,15,80,320),"360p_8":mt(480,360,30,80,490),"360p_9":mt(640,360,15,80,800),"360p_10":mt(640,360,24,80,800),"360p_11":mt(640,360,24,80,1e3),"480p":mt(640,480,15,100,500),"480p_1":mt(640,480,15,100,500),"480p_2":mt(640,480,30,100,1e3),"480p_3":mt(480,480,15,100,400),"480p_4":mt(640,480,30,100,750),"480p_6":mt(480,480,30,100,600),"480p_8":mt(848,480,15,100,610),"480p_9":mt(848,480,30,100,930),"480p_10":mt(640,480,10,100,400),"720p":mt(1280,720,15,120,1130),"720p_auto":mt(1280,720,30,900,3e3),"720p_1":mt(1280,720,15,120,1130),"720p_2":mt(1280,720,30,120,2e3),"720p_3":mt(1280,720,30,120,1710),"720p_5":mt(960,720,15,120,910),"720p_6":mt(960,720,30,120,1380),"1080p":mt(1920,1080,15,120,2080),"1080p_1":mt(1920,1080,15,120,2080),"1080p_2":mt(1920,1080,30,120,3e3),"1080p_3":mt(1920,1080,30,120,3150),"1080p_5":mt(1920,1080,60,120,4780),"1440p":mt(2560,1440,30,120,4850),"1440p_1":mt(2560,1440,30,120,4850),"1440p_2":mt(2560,1440,60,120,7350),"4k":mt(3840,2160,30,120,8910),"4k_1":mt(3840,2160,30,120,8910),"4k_3":mt(3840,2160,60,120,13500)},pee={"480p":Ds(640,480,5),"480p_1":Ds(640,480,5),"480p_2":Ds(640,480,30),"480p_3":Ds(640,480,15),"720p":Ds(1280,720,5),"720p_auto":mt(1280,720,30,900,3e3),"720p_1":Ds(1280,720,5),"720p_2":Ds(1280,720,30),"720p_3":Ds(1280,720,15),"1080p":Ds(1920,1080,5),"1080p_1":Ds(1920,1080,5),"1080p_2":Ds(1920,1080,30),"1080p_3":Ds(1920,1080,15)},fee={"1SL1TL":w0(1,1),"3SL3TL":w0(3,3),"2SL3TL":w0(2,3)};function ks(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},hee[e]):e}function b0(e){return typeof e=="string"?Object.assign({},pee[e]):e}function ug(e){return typeof e=="string"?Object.assign({},fee[e]):e}const mee={speech_low_quality:nu(16e3,!1),speech_standard:nu(32e3,!1,18),music_standard:nu(48e3,!1),standard_stereo:nu(48e3,!0,56),high_quality:nu(48e3,!1,128),high_quality_stereo:nu(48e3,!0,192)};function hg(e){return typeof e=="string"?Object.assign({},mee[e]):e}const ru=[];function DM(e){return kn(e,"mediaSource",["screen","window","application"]),!0}let Re=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),kt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),iu=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),_ee=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),gee=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Sl=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),su=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),ts=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),ou=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Mi=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const I0={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},A0={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},kM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Eee={uplinkNetworkQuality:0,downlinkNetworkQuality:0},LM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let jr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),xi=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Tp=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Tl=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),hr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Bo=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const O0={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let pg=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function lt(e,t,n,i,o){var c,l,u={};return Object.keys(i).forEach(function(h){u[h]=i[h]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Rs(c=EO(l=n.slice()).call(l)).call(c,function(h,f){return f(e,t,h)||h},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0?(Object.defineProperty(e,t,u),null):u}function $(e,t,n){return(t=function(i){var o=function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function MM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MM(Object(n),!0).forEach(function(i){$(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class xM extends nn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Sl.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),$(this,"trackMediaType",void 0),$(this,"_ID",void 0),$(this,"_rtpTransceiver",void 0),$(this,"_lowRtpTransceiver",void 0),$(this,"_hints",[]),$(this,"_isClosed",!1),$(this,"_originMediaStreamTrack",void 0),$(this,"mediaStreamTrack",void 0),$(this,"_external",{}),this._ID=n||Ut(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){pe(ru).call(ru,i)||ru.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||rc(()=>{var n;be.reportApiInvoke(null,{name:un.GET_MEDIA_STREAM_TRACK,options:[],tag:Jt.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===iu.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=ru.indexOf(t);n!==-1&&ru.splice(n,1)}(this),this.emit(su.CLOSED),this.removeAllListeners(Sl.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===iu.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Sl.TRANSCEIVER_UPDATED,t,n)}}class au extends xM{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),$(this,"_enabled",!0),$(this,"_muted",!1),$(this,"_isExternalTrack",!1),$(this,"_isClosed",!1),$(this,"_enabledMutex",void 0),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ur("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(Re.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xt(this,Re.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(su.TRACK_ENDED)}stateCheck(t,n){if(S.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),ao(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new ne(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",S);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new ne(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",S)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ve.resolve([])}}const UM=window.AudioContext||window.webkitAudioContext;let Ui=null;const Nt=new class extends nn{constructor(){super(...arguments),$(this,"prevState",void 0),$(this,"curState",void 0),$(this,"currentTime",void 0),$(this,"currentTimeStuckAt",void 0),$(this,"interruptDetectorTrack",void 0),$(this,"onLocalAudioTrackMute",()=>{S.info("ios15-interruption-start"),this.emit($n.IOS_15_16_INTERRUPTION_START)}),$(this,"onLocalAudioTrackUnmute",async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(Ui&&await Ui.suspend(),this.emit($n.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){S.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){S.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function cu(){if(!Ui){if(function(){if(!UM)return void S.error("your browser is not support web audio");S.info("create audio context");const e=Ft({},M("WEBAUDIO_INIT_OPTIONS"));S.debug("audio context init option:",JSON.stringify(e)),Ui=new UM(e),Nt.curState=Ui.state,Ui.onstatechange=()=>{Nt.prevState=Nt.curState,Nt.curState=Ui?Ui.state:void 0;const{prevState:t,curState:n}=Nt,i=n==="running",o=n==="interrupted",c=t==="running",l=t==="suspended",u=t==="interrupted",h=dt().osVersion;(Sr()||Ns())&&c&&o&&(S.info("ios".concat(h,"-interruption-start")),Nt.emit($n.IOS_INTERRUPTION_START)),(Sr()||Ns())&&(l||u)&&i&&(S.info("ios".concat(h,"-interruption-end")),Nt.emit($n.IOS_INTERRUPTION_END)),t!==n&&Nt.emit($n.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Ui)===null||t===void 0?void 0:t.currentTime;Nt.currentTime!==n?(Nt.currentTimeStuckAt&&(S.debug("AudioContext current time resume at ".concat(n)),Nt.currentTimeStuckAt=void 0),Nt.currentTime=n):(n!==Nt.currentTimeStuckAt&&(be.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Jt.TRACER}).onSuccess(),S.warning("AudioContext current time stuck at ".concat(n))),Nt.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,o=!1,c=!1,l=!1;function u(C){t.state==="running"?h(!1):Sr()||Ns()?t.state==="suspended"&&(h(!0),C&&t.resume().then(f,f)):t.state!=="closed"&&(h(!0),C&&t.resume().then(f,f))}function h(C){if(o!==C){o=C;for(let w=0,D=n;w<D.length;w+=1){const P=D[w];C?window.addEventListener(P,m,{capture:!0,passive:!0}):window.removeEventListener(P,m,{capture:!0,passive:!0})}}}function f(){u(!1)}function m(){u(!0)}function g(C){if(!l)if(i.paused)if(C){let w;E(!1),l=!0;try{w=i.play(),w?w.then(y,y):(i.addEventListener("playing",y),i.addEventListener("abort",y),i.addEventListener("error",y))}catch{y()}}else E(!0);else E(!1)}function E(C){if(c!==C){c=C;for(let w=0,D=n;w<D.length;w++){const P=D[w];C?window.addEventListener(P,I,{capture:!0,passive:!0}):window.removeEventListener(P,I,{capture:!0,passive:!0})}}}function y(){i.removeEventListener("playing",y),i.removeEventListener("abort",y),i.removeEventListener("error",y),l=!1,g(!1)}function I(){g(!0)}if(Sr()){const C=t.createMediaStreamDestination(),w=document.createElement("div");w.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=w.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=C.stream,g(!0)}Nt.on($n.STATE_CHANGE,function(){u(!0)}),u(!1)}(Ui)}(),!Ui)throw new ne(k.NOT_SUPPORTED,"can not create audio context");return Ui}return Ui}function Rl(e){if(function(){if(N0!==null)return N0;const i=cu(),o=i.createBufferSource(),c=i.createGain(),l=i.createGain();o.connect(c),o.connect(l),o.disconnect(c);let u=!1;try{o.disconnect(c)}catch{u=!0}return o.disconnect(),N0=u,u}())return;const t=e.connect,n=e.disconnect;e.connect=(i,o,c)=>{var l;return e._inputNodes||(e._inputNodes=[]),pe(l=e._inputNodes).call(l,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,o,c)):t.call(e,i,o)),e},e.disconnect=(i,o,c)=>{n.call(e),i?ng(e._inputNodes,i):e._inputNodes=[];for(const l of e._inputNodes)t.call(e,l)}}let N0=null;function P0(e,t){let n=!1;const i=1/t;if(M("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*i)}else{const o=cu();let c=o.createGain();c.gain.value=0,c.connect(o.destination);const l=()=>{if(n)return void(c=null);const u=o.createOscillator();u.onended=l,u.connect(c),u.start(0),u.stop(o.currentTime+i),e(o.currentTime)};l()}return()=>{n=!0}}class VM{constructor(){$(this,"context",void 0),$(this,"analyserNode",void 0),$(this,"sourceNode",void 0),this.context=cu(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Sr()||Ns()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let o=0;o<t.length;++o)t[o]=i[o]/128-1}const n=Rs(t).call(t,(i,o)=>i+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{S.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class jM extends nn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),$(this,"outputNode",void 0),$(this,"outputTrack",void 0),$(this,"isPlayed",!1),$(this,"sourceNode",void 0),$(this,"context",void 0),$(this,"audioBufferNode",void 0),$(this,"destNode",void 0),$(this,"audioOutputLevel",0),$(this,"volumeLevelAnalyser",void 0),$(this,"_processedNode",void 0),$(this,"playNode",void 0),$(this,"isDestroyed",!1),$(this,"onNoAudioInput",void 0),$(this,"isNoAudioInput",!1),$(this,"_noAudioInputCount",0),this.context=cu(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Rl(this.outputNode),this.volumeLevelAnalyser=new VM}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Mi.ON_AUDIO_BUFFER,function(i){for(let o=0;o<i.outputBuffer.numberOfChannels;o+=1){const c=i.outputBuffer.getChannelData(o);for(let l=0;l<c.length;l+=1)c[l]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ft().webAudioMediaStreamDest)throw new ne(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&rg(()=>{Nt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Sr()||Ns()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let o=!1;for(let c=0;c<i.length;c++)i[c]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Xn(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class FM extends jM{get isFreeze(){return!1}constructor(t,n,i){var o;if(super(),$(this,"sourceNode",void 0),$(this,"track",void 0),$(this,"clonedTrack",void 0),$(this,"audioElement",void 0),$(this,"isCurrentTrackCloned",!1),$(this,"isRemoteTrack",!1),$(this,"originVolumeLevelAnalyser",void 0),$(this,"rebuildWebAudio",async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),Rl(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),Rl(this.outputNode),this.emit(Mi.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new ne(k.UNEXPECTED_ERROR);this.track=t;const c=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(c),Rl(this.sourceNode),i){const u=i.clone();u.enabled=!0,this.clonedTrack=u,S.debug("create an unmuted track ".concat(u.id," from the original track ").concat(i.id," to get the volume"));const h=this.context.createMediaStreamSource(new MediaStream([u]));Rl(h),this.originVolumeLevelAnalyser=new VM,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;const l=dt();n&&l.os===xn.IOS&&Number((o=l.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(Nt.on($n.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Rl(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Mi.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Nt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),S.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Rl(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function BM(e,t,n){const i=(c,l)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||l:c:l,o={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(o.video.mandatory.maxFrameRate=t.frameRate.max,o.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(o.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function vee(e,t){const n=await WM(e.mediaSource),{sourceId:i,audio:o}=await function(c){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ve((u,h)=>{const f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const g=document.createElement("div");g.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",g.setAttribute("style","height: 12%;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(D);const P=new Error("NotAllowedError");P.name="NotAllowedError",h(P)};let C=l;const w=document.createElement("div");if(l){const P=document.createElement("input");P.setAttribute("type","checkbox");const x=document.createElement("span");P.setAttribute("style","margin-right: 6px;"),x.innerText="Share audio",P.checked=C,P.onchange=()=>{C=P.checked},w.appendChild(P),w.appendChild(x)}y.appendChild(w),y.appendChild(I),m.appendChild(g),m.appendChild(E),m.appendChild(y);const D=document.createElement("div");D.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),D.appendChild(f),D.appendChild(m),document.body.appendChild(D),c.map(P=>{if(P.id){const x=document.createElement("div");x.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let K=P.thumbnail;try{const{width:H}=K.getSize();H>1920&&(K=K.resize({width:1920}))}catch(H){throw H&&H.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),H}x.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+K.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+P.name.replace(/[\u00A0-\u9999<>\&]/g,function(H){return"&#"+H.charCodeAt(0)+";"})+"</span>",x.onclick=()=>{document.body.removeChild(D),u({sourceId:P.id,audio:C})},E.appendChild(x)}})})}(n,t);return await BM(i,e,o)}async function WM(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=eM();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ne(k.ELECTRON_IS_NULL);let i=null;try{var o;i=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new ve((c,l)=>{n.desktopCapturer.getSources({types:t},(u,h)=>{u?l(u):c(h)})}));try{return await i}catch(c){throw new ne(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}const D0=new ur("safari");let GM=!1,HM=!1;async function Vi(e,t){let n=0,i=null;for(;n<2;)try{i=await yee(e,t,n>0);break}catch(o){if(o instanceof ne)throw S.error("[".concat(t,"] ").concat(o.toString())),o;const c=fg(o.name||o.code||o,o.message);if(c.code===k.MEDIA_OPTION_INVALID){S.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Xn(500);continue}throw S.error("[".concat(t,"] ").concat(c.toString())),c}if(!i)throw new ne(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function yee(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ne(k.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=ft(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return S.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(eM())e.screen.sourceId?lu(o,await BM(e.screen.sourceId,e.screen,!!e.screenAudio)):lu(o,await vee(e.screen,!!e.screenAudio));else if(_a()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new ne(k.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const E=await(l=e.screen.extensionId,u=t,new ve((y,I)=>{try{chrome.runtime.sendMessage(l,{getStream:!0},C=>{if(!C||!C.streamId)return S.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),C),void I(new ne(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(C.streamId)})}catch(C){S.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(l,")"),C.toString()),I(new ne(k.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=E,lu(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var c;e.screen.mediaSource&&DM(e.screen.mediaSource);const E={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(c=e.screen.displaySurface)!==null&&c!==void 0?c:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:I,systemAudio:C,preferCurrentTab:w}=e.screen,D={selfBrowserSurface:y,surfaceSwitching:I,systemAudio:C,preferCurrentTab:w};!y&&delete D.selfBrowserSurface,!I&&delete D.surfaceSwitching,!C&&delete D.systemAudio,!w&&delete D.preferCurrentTab,S.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:E,audio:e.screenAudio,controls:D})),lu(o,await navigator.mediaDevices.getDisplayMedia(Ft({video:E,audio:e.screenAudio},D)))}else{if(!sn())throw S.error("[".concat(t,"] This browser does not support screenSharing")),new ne(k.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&DM(e.screen.mediaSource);const E={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};S.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(E))),lu(o,await navigator.mediaDevices.getUserMedia(E))}}var l,u;if(!e.video&&!e.audio)return o;let h={video:e.video,audio:e.audio},f=M("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),h=c0(h,f)}catch{}S.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),dt();let m,g=null;(rr()||Sr()||eg())&&(g=await D0.lock());try{m=await navigator.mediaDevices.getUserMedia(h)}catch(E){throw g&&g(),E}return h.audio&&(GM=!0),h.video&&(HM=!0),lu(o,m),g&&g(),o}function fg(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ne(k.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ne(k.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ne(k.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ne(k.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ne(k.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ne(k.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return S.error("getUserMedia unexpected error",e),new ne(k.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function lu(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],o=t.getVideoTracks()[0],c=t.getAudioTracks()[0];c&&(i&&e.removeTrack(i),e.addTrack(c)),o&&(n&&e.removeTrack(n),e.addTrack(o))}const ji=new class extends nn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Tl.STATE_CHANGE,e),this._state=e)}constructor(){super(),$(this,"_state",Tp.IDLE),$(this,"isAccessMicrophonePermission",!1),$(this,"isAccessCameraPermission",!1),$(this,"lastAccessMicrophonePermission",!1),$(this,"lastAccessCameraPermission",!1),$(this,"checkdeviceMatched",!1),$(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(M("ENUMERATE_DEVICES_INTERVAL")||(tg()||Z_()===xn.HARMONY_OS)&&ga())&&this.updateDevicesInfo()},M("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>S.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ne(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(i);let c=!this.isAccessMicrophonePermission&&e,l=!this.isAccessCameraPermission&&t;o.audio&&(c=!1),o.video&&(l=!1);let u=null,h=null,f=null;if(!n&&(c||l)){if(D0.isLocked&&(S.debug("[device manager] wait GUM lock"),(await D0.lock())(),S.debug("[device manager] GUM unlock")),GM&&(c=!1,this.isAccessMicrophonePermission=!0),HM&&(l=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",e,t,c,l),c&&l){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const g=fg(m.name||m.code||m,m.message);if(g.code===k.PERMISSION_DENIED)throw g;S.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({audio:e})}catch(m){const g=fg(m.name||m.code||m,m.message);if(g.code===k.PERMISSION_DENIED)throw g;S.warning("getUserMedia failed in getDevices",g)}this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({video:t})}catch(m){const g=fg(m.name||m.code||m,m.message);if(g.code===k.PERMISSION_DENIED)throw g;S.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",e,"cam permission",t)}try{const m=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(g=>g.stop()),h&&h.getTracks().forEach(g=>g.stop()),f&&f.getTracks().forEach(g=>g.stop()),u=null,h=null,f=null,m}catch(m){return u&&u.getTracks().forEach(g=>g.stop()),h&&h.getTracks().forEach(g=>g.stop()),f&&f.getTracks().forEach(g=>g.stop()),u=null,h=null,f=null,new ne(k.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new ne(k.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Tp.INITING;try{await this.updateDevicesInfo(),this.state=Tp.INITEND}catch(e){throw S.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Tp.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ne(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=e.find(l=>l.kind==="audioinput"&&l.deviceId==="default"),c=e.find(l=>l.kind==="audiooutput"&&l.deviceId==="default");o&&c?c.groupId===o.groupId?S.debug("[device-check] default input ".concat(o.label," and output ").concat(c.label," is the same group")):S.debug("[device-check] default input ".concat(o.label," and output ").concat(c.label," is not the same group")):S.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(o=>{if(!o.deviceId)return;const c=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((c?c.state:"INACTIVE")!=="ACTIVE"){const l={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),l),n.push(l)}c&&(c.updateAt=t)}),this.deviceInfoMap.forEach((o,c)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state!==Tp.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Tl.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Tl.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Tl.PLAYOUT_DEVICE_CHANGED,o)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(o=>o.kind==="audioinput"),n=e.filter(o=>o.kind==="videoinput"),i={audio:!1,video:!1};for(const o of t)if(o.label&&o.deviceId){i.audio=!0;break}for(const o of n)if(o.label&&o.deviceId){i.video=!0;break}return i}};let k0=!1;const Fi=new class extends nn{constructor(){super(...arguments),$(this,"onAutoplayFailed",void 0),$(this,"onAudioAutoplayFailed",void 0)}};function KM(){if(dt(),!k0){const e=t=>{t.preventDefault(),k0=!1,hp()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};k0=!0,hp()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Fi.onAutoplayFailed?Fi.onAutoplayFailed():Fi.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Fi.emit("autoplay-failed")}}function zM(e,t,n,i){if(!e)return;const o=be.getBaseInfoBySessionId(e);if(!o)return;const c=o.info,l=Date.now(),u=Ft(Ft({},c),{},{vid:c.vid===void 0?0:Number(c.vid),lts:l,elapse:l-o.startTime,cbRegistered:Fi.onAutoplayFailed||Fi.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});be.send({type:Xt.AUTOPLAY_FAILED,data:u},!0)}const See=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],qr=new class{constructor(){$(this,"onAutoplayFailed",void 0),$(this,"elementMap",new Map),$(this,"elementStateMap",new Map),$(this,"elementsNeedToResume",[]),$(this,"sinkIdMap",new Map),$(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,i]=t;const o=this.elementStateMap.get(n),c=i.srcObject.getAudioTracks()[0],l=c&&c.readyState;if(S.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(l," ").concat(e)),l==="live"){if(e)return i.pause(),void i.play();if(Nt.curState==="running")return Xd()?(i.pause(),void i.play()):void(o&&o==="paused"&&i.play())}})}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Nt.on($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Nt.on($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Nt.on($n.STATE_CHANGE,()=>{Sr()&&Nt.prevState==="suspended"&&Nt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new ne(k.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,hr.INIT),this.setVolume(t,n);const c=this.sinkIdMap.get(t);if(c)try{o.setSinkId(c).catch(u=>{S.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){S.warning("[".concat(t,"] set sink id failed"),u.toString())}const l=o.play();l&&l.then&&l.catch(u=>{i&&zM(i,"audio",u.message,t),S.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),rg(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),KM()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){See.forEach(n=>{t.addEventListener(n,i=>{const o=this.elementStateMap.get(e),c=i.type==="pause"?"paused":i.type;if(S.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(c)),i.type==="error"){const l=t==null?void 0:t.error;l&&S.error("[".concat(e,"] media error, code: ").concat(l.code,", message: ").concat(l.message))}this.elementStateMap.set(e,c)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{S.debug("Auto resume audio element success")}).catch(n=>{S.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ve(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{hp()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function ln(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new ne(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",S);for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];const u=i.apply(this,c);return u instanceof ve?new ve((h,f)=>{u.then(h).catch(f)}):u}),n}}class YM extends nn{constructor(t){super(),$(this,"name","VideoProcessorDestination"),$(this,"ID","0"),$(this,"_source",void 0),$(this,"videoContext",void 0),$(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ne(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ne(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(jr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(jr.ON_TRACK,void 0)}}class qM extends nn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"usageRegistry",[]),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await sr(this,xi.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),xt(this,xi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ei(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return S.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),xt(this,xi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ei(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:c}of this.statsRegistry)try{const l=c();t.push({processorID:n,processorName:i,type:o,stats:l})}catch(l){S.error(new ne(k.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof ve&&(i=await i),t.push(Ft(Ft({},i),{},{direction:this.direction}))}catch(i){S.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class XM extends nn{constructor(t){super(),$(this,"name","AudioProcessorDestination"),$(this,"ID","0"),$(this,"inputTrack",void 0),$(this,"inputNode",void 0),$(this,"audioProcessorContext",void 0),$(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ne(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ne(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(jr.ON_TRACK,void 0),this.emit(jr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(jr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(jr.ON_NODE,this.inputNode))}}class JM extends nn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"audioContext",void 0),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"usageRegistry",[]),$(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return sr(this,xi.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),xt(this,xi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ei(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),xt(this,xi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ei(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:c}of this.statsRegistry)try{const l=c();t.push({processorID:n,processorName:i,type:o,stats:l})}catch(l){S.error(new ne(k.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof ve&&(i=await i),t.push(Ft(Ft({},i),{},{direction:this.direction}))}catch(i){S.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class L0 extends nn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),$(this,"context",void 0),$(this,"processSourceNode",void 0),$(this,"outputTrack",void 0),$(this,"processedNode",void 0),$(this,"clonedTrack",void 0),$(this,"outputNode",void 0),this.outputNode=new Tee}setVolume(){}createOutputTrack(){throw new ne(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Tee{disconnect(){}connect(){}}function $M(e){return new ve((t,n)=>{let i=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const c=Sr()?"canplay":"playing";o.addEventListener(c,()=>{const l=o.videoWidth,u=o.videoHeight;!l&&sn()||(i=!0,o.srcObject=null,o.remove(),t([l,u]))}),o.srcObject=new MediaStream([e]),o.play().catch(ig),setTimeout(()=>{i||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function mg(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=ks(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!XL()&&n.frameRate&&(t.frameRate=n.frameRate),BL()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),sn()&&(t.frameRate={ideal:30,max:30}),t}function QM(e){const t={};return XL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,_a()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function ZM(e){const t=QM(e);if(e.encoderConfig){const n=hg(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),tg()&&(t.sampleRate=void 0),t}const Ree=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:o}=e.getMediaStreamTrackSettings();let{frameRate:c=n,width:l=i,height:u=o}=t;if(!c||!l||!u)return;l=Qd(l),u=Qd(u),c=Qd(c);const{max:h,min:f}=function(y,I,C){const w=200*Math.pow(C/15,.6)*Math.pow(y*I/640/360,.75);return{min:Math.floor(w),max:Math.floor(4*w)}}(l,u,c),{bitrateMax:m,bitrateMin:g}=t||{};m||S.debug("calculate bitrate: [w: ".concat(l,", h: ").concat(u,", fps: ").concat(c,"] => [brMax: ").concat(m,", brMin: ").concat(g,"]"));const{maxFramerate:E}=M("ENCODER_CONFIG_LIMIT");return E&&typeof E=="number"&&(c=Math.min(c,E)),{frameRate:c,bitrateMax:m||h,bitrateMin:g||f,scaleResolutionDownBy:1,scale:0}},ex=async(e,t,n)=>await(async(i,o,c)=>{const l=function(f){const m=[];for(let g=0;g<f.length;g+=2)m.push(parseInt(f.slice(g,g+2),16));return Uint8Array.from(m)}(uM(""+o+c)).slice(0,16),u=l.slice(0,12),h=await window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},h,i))})(e.buffer,t,n),M0=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new ve((n,i)=>{t.toBlob(async o=>{if(t.remove(),o){const c=await tx(o);n({buffer:c,width:t.width,height:t.height})}else i(new ne(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},tx=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var nx,rx,ix,sx,ox,ax,cx,lx,dx,ux,hx,px,fx,mx,_x,gx,Ex,vx,rn,yx,Sx,Tx,Rx,Cx,wx,Wo,bx,Ix,Ax,Ox,Nx,Px,Dx,kx,Lx,Mx,xx,Ux,Vx,ar;let dn=(nx=xe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),rx=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),ix=ln(),sx=Zd("LocalAudioTrack","_enabledMutex"),ox=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),ax=ln(),cx=Zd("LocalAudioTrack","_enabledMutex"),lx=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),dx=ln(),ux=ln(),hx=ln(),px=xe({argsMap:e=>[e.getTrackId()]}),fx=ln(),mx=xe({argsMap:e=>[e.getTrackId()]}),_x=ln(),gx=xe({argsMap:e=>[e.getTrackId()]}),Ex=xe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),vx=xe({argsMap:e=>[e.getTrackId()]}),lt((rn=class extends au{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),$(this,"trackMediaType",ou.AUDIO),$(this,"_encoderConfig",void 0),$(this,"_trackSource",void 0),$(this,"metadata",[]),$(this,"_enabled",!0),$(this,"_volume",100),$(this,"_useAudioElement",!0),$(this,"_bypassWebAudio",!1),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_processorDestination",void 0),$(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new L0,M("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),M("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),rr()&&!Ui?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Dt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&qr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,xt(this,Re.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!NM())throw new ne(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");await qr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await xt(this,Re.NEED_ENABLE_TRACK,this),S.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await xt(this,Re.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await xt(this,Re.NEED_MUTE_TRACK,this):await xt(this,Re.NEED_UNMUTE_TRACK,this))}getStats(){return rc(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ki(this,Re.GET_STATS)||Ft({},I0)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Mi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Mi.ON_AUDIO_BUFFER),this._source.on(Mi.ON_AUDIO_BUFFER,n=>e(n))}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?qr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xt(this,Re.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ve.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ne(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(jr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await xt(this,Re.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xt(this,Re.NEED_REPLACE_TRACK,this))}),e.on(jr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(jr.ON_TRACK),e.removeAllListeners(jr.ON_NODE)}bindProcessorContextEvents(e){e.on(xi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(xi.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof L0&&(this._trackSource=new FM(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new JM(this._source.context,this.getTrackId(),"local"),t=new XM(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Mi.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(qr.stop(this.getTrackId()),this._source.play()),xt(this,Re.NEED_REPLACE_MIXING_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[nx],Object.getOwnPropertyDescriptor(rn.prototype,"setVolume"),rn.prototype),lt(rn.prototype,"setPlaybackDevice",[rx,ix],Object.getOwnPropertyDescriptor(rn.prototype,"setPlaybackDevice"),rn.prototype),lt(rn.prototype,"setEnabled",[sx,ox,ax],Object.getOwnPropertyDescriptor(rn.prototype,"setEnabled"),rn.prototype),lt(rn.prototype,"setMuted",[cx,lx,dx],Object.getOwnPropertyDescriptor(rn.prototype,"setMuted"),rn.prototype),lt(rn.prototype,"getStats",[ux],Object.getOwnPropertyDescriptor(rn.prototype,"getStats"),rn.prototype),lt(rn.prototype,"setAudioFrameCallback",[hx],Object.getOwnPropertyDescriptor(rn.prototype,"setAudioFrameCallback"),rn.prototype),lt(rn.prototype,"play",[px,fx],Object.getOwnPropertyDescriptor(rn.prototype,"play"),rn.prototype),lt(rn.prototype,"stop",[mx,_x],Object.getOwnPropertyDescriptor(rn.prototype,"stop"),rn.prototype),lt(rn.prototype,"close",[gx],Object.getOwnPropertyDescriptor(rn.prototype,"close"),rn.prototype),lt(rn.prototype,"pipe",[Ex],Object.getOwnPropertyDescriptor(rn.prototype,"pipe"),rn.prototype),lt(rn.prototype,"unpipe",[vx],Object.getOwnPropertyDescriptor(rn.prototype,"unpipe"),rn.prototype),rn),Rp=(yx=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),Sx=ln(),Tx=Zd("MicrophoneAudioTrack","_enabledMutex"),Rx=xe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Cx=ln(),wx=xe({argsMap:e=>[e.getTrackId()]}),lt((Wo=class extends dn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?hg(t.encoderConfig):{},i,M("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),$(this,"_config",void 0),$(this,"_deviceName","default"),$(this,"_constraints",void 0),$(this,"_originalConstraints",void 0),$(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Xd()||t0())&&Nt.bindInterruptDetectorTrack(this)}async setDevice(e){if(S.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await ji.getDeviceById(e),n={};n.audio=Ft({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Vi(n,this.getTrackId())}catch(o){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Vi({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await ji.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}S.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return S.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),M("AUTO_RESET_AUDIO_ROUTE")&&(Sr()||Ns())){const l=navigator.audioSession;l&&(e||(l.type="playback"),l.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await xt(this,Re.NEED_DISABLE_TRACK,this)}catch(l){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),l.toString()),l}return}const o=Ft({},this._constraints),c=ji.searchDeviceIdByName(this._deviceName);c&&!o.deviceId&&(o.deviceId=c);try{n||(this._enabled=!0);const l=await Vi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),await xt(this,Re.NEED_ENABLE_TRACK,this)}catch(l){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),l.toString()),l}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Xd()||t0())&&Nt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Sr()||Ns())&&this._enabled&&!this._isClosed&&Nt.duringInterruption){const e=async()=>{Nt.off($n.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Nt.on($n.IOS_INTERRUPTION_END,e)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(su.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=ji.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Vi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(xi.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){i(o)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(xi.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[yx,Sx],Object.getOwnPropertyDescriptor(Wo.prototype,"setDevice"),Wo.prototype),lt(Wo.prototype,"setEnabled",[Tx,Rx,Cx],Object.getOwnPropertyDescriptor(Wo.prototype,"setEnabled"),Wo.prototype),lt(Wo.prototype,"close",[wx],Object.getOwnPropertyDescriptor(Wo.prototype,"close"),Wo.prototype),Wo),Cee=(bx=xe({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Ix=ln(),Ax=xe({argsMap:e=>[e.getTrackId()]}),Ox=ln(),Nx=xe({argsMap:e=>[e.getTrackId()]}),Px=ln(),Dx=xe({argsMap:e=>[e.getTrackId()]}),kx=ln(),Lx=xe({argsMap:e=>[e.getTrackId()]}),Mx=ln(),xx=xe({argsMap:e=>[e.getTrackId()]}),Ux=xe({argsMap:e=>[e.getTrackId()]}),Vx=ln(),lt((ar=class extends dn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),$(this,"source",void 0),$(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Mi.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(su.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Dt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[bx,Ix],Object.getOwnPropertyDescriptor(ar.prototype,"startProcessAudioBuffer"),ar.prototype),lt(ar.prototype,"pauseProcessAudioBuffer",[Ax,Ox],Object.getOwnPropertyDescriptor(ar.prototype,"pauseProcessAudioBuffer"),ar.prototype),lt(ar.prototype,"seekAudioBuffer",[Nx,Px],Object.getOwnPropertyDescriptor(ar.prototype,"seekAudioBuffer"),ar.prototype),lt(ar.prototype,"resumeProcessAudioBuffer",[Dx,kx],Object.getOwnPropertyDescriptor(ar.prototype,"resumeProcessAudioBuffer"),ar.prototype),lt(ar.prototype,"stopProcessAudioBuffer",[Lx,Mx],Object.getOwnPropertyDescriptor(ar.prototype,"stopProcessAudioBuffer"),ar.prototype),lt(ar.prototype,"close",[xx],Object.getOwnPropertyDescriptor(ar.prototype,"close"),ar.prototype),lt(ar.prototype,"setAudioBufferPlaybackSpeed",[Ux,Vx],Object.getOwnPropertyDescriptor(ar.prototype,"setAudioBufferPlaybackSpeed"),ar.prototype),ar);class On extends dn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=cu().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Ut(8,"track-mix-")),$(this,"trackList",void 0),$(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(S.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):S.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){S.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}ng(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof On?n.emit(Sl.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class wee extends jM{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Mi.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),$(this,"audioBuffer",void 0),$(this,"sourceNode",void 0),$(this,"startPlayTime",0),$(this,"startPlayOffset",0),$(this,"pausePlayTime",0),$(this,"options",void 0),$(this,"currentLoopCount",0),$(this,"currentPlaybackSpeed",100),$(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const jx=new Map;function Fx(e,t){if(e.length===0||t.length===0)return 1/0;const n=l0(e),i=l0(t);return Math.floor(i/n)}class x0{get rendFrameRate(){const t=Math.max(1,Fx(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:hr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(S.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){$(this,"trackId",void 0),$(this,"config",void 0),$(this,"onFirstVideoFrameDecoded",void 0),$(this,"onFirstVideoFrameRender",void 0),$(this,"onVideoStateChanged",void 0),$(this,"freezeTimeCounterList",[]),$(this,"renderFreezeAccTime",0),$(this,"renderFreezeAccTime2",0),$(this,"isKeepLastFrame",!1),$(this,"isDestroyed",!1),$(this,"timeUpdatedCount",0),$(this,"freezeTime",0),$(this,"playbackTime",0),$(this,"lastTimeUpdatedTime",0),$(this,"autoplayFailed",!1),$(this,"videoTrack",void 0),$(this,"videoElement",void 0),$(this,"cacheVideoElement",void 0),$(this,"internal",!1),$(this,"_render_interframe_delays",[]),$(this,"_render_interframe_delays_sizes",[]),$(this,"_videoState",Bo.VideoStateStopped),$(this,"videoElementCheckInterval",void 0),$(this,"videoElementFreezeTimeout",void 0),$(this,"_videoElementStatus",hr.NONE),$(this,"_isInPage",!0),$(this,"isGettingVideoDimensions",!1),$(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),$(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Nt.curState==="running"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(jL())),YL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),$(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&S.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=hr.PLAYING;break;case"loadeddata":if(this.videoState=Bo.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=hr.CANPLAY;break;case"stalled":this.videoElementStatus=hr.STALLED;break;case"suspend":this.videoElementStatus=hr.SUSPEND;break;case"pause":this.videoElementStatus=hr.PAUSED,Sr()||Ns()||rr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=hr.WAITING;break;case"abort":this.videoElementStatus=hr.ABORT;break;case"ended":this.videoElementStatus=hr.ENDED;break;case"emptied":this.videoElementStatus=hr.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=hr.ERROR,S.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const o=i-this.lastTimeUpdatedTime,c=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Go.lastVisibleTime<Go.lastHiddenTime||c<Go.lastHiddenTime||c<Go.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(o>M("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const l=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(l),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(jL())),YL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Nt.on($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Nt.on($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&zM(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),o)});const i=dt();if((i.name==="Safari"&&Number(i.version)===15||Xd())&&n&&n.then){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return S.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,i.width,i.height),new ve((c,l)=>{i.toBlob(async u=>{if(i.remove(),u){const h=await tx(u);c({buffer:h,width:i.width,height:i.height})}else l(new ne(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await M0(t)}destroy(){this.isDestroyed=!0,Nt.off($n.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Nt.off($n.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Bo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=hr.INIT,!this.videoElementCheckInterval&&(Bx.forEach(c=>{this.videoElement.addEventListener(c,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(c){return c!==document.body&&document.body.contains(c)}(this.videoElement)},1e3),M("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let c;const l=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",l),this.videoElementFreezeTimeout=window.setTimeout(u,M("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Bo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Bo.VideoStateFrozen:document.addEventListener("visibilitychange",l))},h=(f,m)=>{if(this.videoElementStatus===hr.PLAYING){if(c){const y=m.presentationTime-c.presentationTime,I=m.presentedFrames-c.presentedFrames;this._render_interframe_delays_sizes.push(I),this._render_interframe_delays.push(y);const C=l0(this._render_interframe_delays_sizes),w=C-this._render_interframe_delays_sizes[0];if(C>30&&w>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Bo.VideoStateStarting&&(this.videoState=Bo.VideoStateDecoding),this.videoState===Bo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,M("VIDEO_FREEZE_DURATION"))),y<M("VIDEO_FREEZE_DURATION")&&this.videoState===Bo.VideoStateFrozen&&(this.videoState=Bo.VideoStateDecoding),y>M("VIDEO_FREEZE_DURATION")&&Go.lastVisibleTime>=Go.lastHiddenTime&&c.timestamp>Go.lastVisibleTime&&c.timestamp>Go.lastHiddenTime){const D=Math.min(66,Fx(this._render_interframe_delays_sizes,this._render_interframe_delays)),P=Math.max(0,y-(I-1)*D);this.renderFreezeAccTime2+=P>D?P:0,this.renderFreezeAccTime+=y}}c=Ft(Ft({},m),{},{timestamp:f})}else this.isSkipCalcRenderFreezeTime()&&(c=Ft(Ft({},m),{},{timestamp:f}));var g,E;M("ENABLE_VIDEO_FRAME_CALLBACK")&&((g=(E=this.videoElement).requestVideoFrameCallback)===null||g===void 0||g.call(E,h))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),tg()&&!M("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=dt();i.name==="Safari"&&Number(i.version)===15||Xd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,sn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,sn()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(c=>{S.debug("[".concat(this.trackId,"] playback interrupted"),c.toString())})}resetVideoElement(){Bx.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=hr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===hr.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{S.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{S.error(i)}),this.autoplayFailed=!1,hp()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};hp()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),KM()}}const Bx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class U0 extends x0{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),$(this,"container",void 0),$(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await M0(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",M("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Wx,Gx,Hx,Kx,zx,Yx,qx,Xx,Jx,$x,Qx,Zx,e2,t2,n2,r2,i2,s2,o2,a2,c2,l2,d2,u2,h2,p2,f2,m2,rt,_2,g2,E2,v2,y2,S2,T2,R2,Bi;let Wt=(Wx=xe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Gx=ln(),Hx=xe({argsMap:e=>[e.getTrackId()]}),Kx=Zd("LocalVideoTrack","_enabledMutex"),zx=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),Yx=ln(),qx=Zd("LocalVideoTrack","_enabledMutex"),Xx=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),Jx=ln(),$x=xe({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),Qx=ln(),Zx=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),e2=ln(),t2=ln(),n2=xe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),r2=ln(),i2=ln(),s2=ln(),o2=xe({argsMap:e=>[e.getTrackId()]}),a2=ln(),c2=ln(),l2=ln(),d2=ln(),u2=ln(),h2=xe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),p2=xe({argsMap:e=>[e.getTrackId()]}),f2=xe({argsMap:e=>[e.getTrackId()]}),m2=xe({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),rt=class eG extends au{get videoHeight(){if(rr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(rr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==hr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,o,c,l){if(super(t,c),$(this,"trackMediaType",ou.VIDEO),$(this,"_player",void 0),$(this,"isUseScaleResolutionDownBy",!1),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"_encoderConfig",void 0),$(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),$(this,"_optimizationMode",void 0),$(this,"_saveEncodeBitrateRatio",1),$(this,"_videoHeight",void 0),$(this,"_videoWidth",void 0),$(this,"_forceBitrateLimit",void 0),$(this,"_enabled",!0),$(this,"_processorDestination",void 0),$(this,"_processorContext",void 0),rr()){const{width:u,height:h}=t.getSettings();this._videoWidth=u,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=o,this._hints=l||[],n&&this._hints.indexOf(kt.CUSTOM_TRACK)!==-1?this._encoderConfig=$t(n):this._encoderConfig=n,this._hints.indexOf(kt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(JR(gt.CHROME,115)&&Z_().indexOf("Windows")!==-1){const u=function(h,f){if("VideoFrame"in window&&"TransformStream"in window&&ft().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(h),g=new MediaStreamTrackGenerator({kind:"video"});let E,y,I=Date.now();const C=()=>{w&&(clearInterval(w),w=void 0),E&&(E.close(),E=void 0),h.stop(),y=void 0,g.removeEventListener("ended",C)};let w=window.setInterval(()=>{if(y&&E&&Date.now()-I>1e3)try{g.readyState==="live"?y.enqueue(E.clone()):C()}catch{C()}},1e3);const D=new TransformStream({transform:(P,x)=>{g.readyState==="live"?(y=x,I=Date.now(),E===void 0?(E=P,x.enqueue(P.clone())):(x.enqueue(E),E=P)):P.close()}});return g.addEventListener("ended",C),m.readable.pipeThrough(D).pipeTo(g.writable),g}}(t);u&&(S.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}n&&this._hints.indexOf(kt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new qM(this.getTrackId(),"local"),this._processorDestination=new YM(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Ft(Ft(Ft({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new x0(i):this._player=new U0(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(su.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},M("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await xt(this,Re.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await xt(this,Re.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await xt(this,Re.NEED_MUTE_TRACK,this):await xt(this,Re.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),S.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await xt(this,Re.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ne(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=ks(t),M("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=mg({encoderConfig:t});(rr()||Sr()||Ns())&&(i.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const c=new ne(k.UNEXPECTED_ERROR,o.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}}this._encoderConfig=t,this._hints.indexOf(kt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xt(this,Re.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(S)}}getStats(){return rc(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ki(this,Re.GET_STATS)||Ft({},A0)}async setBeautyEffect(t){S.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await M0(t)}async findClosestProfile(){const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:o,height:c,frameRate:l}=this._encoderConfig||{},u=Qd(this._videoWidth||t||o||0),h=Qd(this._videoHeight||n||c||0),f=function(m,g,E){if(!Array.isArray(M("VIDEO_ENCODER_CONFIG_LIST"))||M("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const y=Math.min(m,g);return!(y>=480)&&Ft(Ft({},M("VIDEO_ENCODER_CONFIG_LIST").find(I=>I.height>y)),{},{frameRate:E})}(u,h,Qd(i||l||15));if(f)return S.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(u,"x").concat(h," => ").concat(JSON.stringify(f))),this.setEncoderConfiguration(f)}async setBitrateLimit(t){S.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void S.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await xt(this,Re.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return S.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,S.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){$M(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(ig)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ne(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");S.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=ks(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(kt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xt(this,Re.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:o,bitrateMin:c}=this._encoderConfig;if(c==null||o==null){const{max:l,min:u}=function(h,f,m,g,E){const y=M("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:g,max:E};if(E===void 0){const I=Math.floor(200*Math.pow(m/15,.6)*Math.pow(h*f/640/360,.75));E=y==="STANDARD_BITRATE"?4*I:2*I,g=g??I}else g=g??Math.floor(E/10);return{min:g,max:E}}(t,n,i,c,o);if(this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=l,M("VIDEO_STANDARD_BITRATE_VERSION")&&c==null&&o==null){const[h,f]=function(m,g,E){const y=4*Math.floor(2e5*Math.pow(E/15,.6)*Math.pow(m*g/230400,.75)),I=m*g,C=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),w=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let D=Ei(C).call(C).next().value,P=1;if(C.has(I))D=C.get(I);else{var x;const le=cl(x=Array.from(C.entries())).call(x,(nt,Fe)=>{let[Rt]=nt,[yt]=Fe;return Rt-yt}),Je=le.find(nt=>{let[Fe]=nt;return Fe>I});if(Je){const nt=le.indexOf(Je);if(nt>0){const Fe=le[nt-1],Rt=(I-Fe[0])/(Je[0]-Fe[0]);D=Fe[1]+Rt*(Je[1]-Fe[1])}else D=Je[1]}else D=le[le.length-1][1]}if(w.has(I))P=w.get(I);else{var K;const le=cl(K=Array.from(w.entries())).call(K,(nt,Fe)=>{let[Rt]=nt,[yt]=Fe;return Rt-yt}),Je=le.find(nt=>{let[Fe]=nt;return Fe>I});if(Je){const nt=le.indexOf(Je);if(nt>0){const Fe=le[nt-1],Rt=(I-Fe[0])/(Je[0]-Fe[0]);P=Fe[1]+Rt*(Je[1]-Fe[1])}else P=Je[1]}else P=le[le.length-1][1]}const H=M("VIDEO_NEW_BITRATE_RATIO");H&&H>0&&(D=H/100);const j=Math.floor(y*D),J=Math.floor(65e4*Math.pow(m*g/230400,.5)*Math.pow(E/15,.69));let re=j;const se=M("VIDEO_STANDARD_BITRATE_VERSION");return se&&se>0&&(se===1?re=y:se===2?re=j:se===3&&(re=J)),[Math.floor(re/1e3),P]}(t,n,i);this._encoderConfig.bitrateMax=h,this._encoderConfig.bitrateMin=u?Math.min(u,h):h,this._saveEncodeBitrateRatio=f,S.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else S.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:l}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&l instanceof HTMLElement){const u=QL.checkOneElementVisible(c),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const f=be.reportApiInvoke(null,{tag:Jt.TRACER,name:un.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new ne(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Ft(Ft({},i),ks(t))),i=gl(i);const o=Ut(8,"track-video-cloned-"),c=new eG(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,gl(this._scalabilityMode),this._optimizationMode,o,gl(this._hints));return t&&i&&c.setEncoderConfiguration(i),S.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),c}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new ne(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ne(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(rc(()=>{be.reportApiInvoke(null,{name:un.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Jt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!M("ENABLE_VIDEO_SEI")||!M("ENABLE_ENCODED_TRANSFORM"))return void S.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ne(k.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void S.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const o=i.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"||o==="video/h265"?this.safeEmit("sei-to-send",t):S.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(jr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await xt(this,Re.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xt(this,Re.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(jr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(xi.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(xi.REQUEST_CONSTRAINTS)}},lt(rt.prototype,"play",[Wx,Gx],Object.getOwnPropertyDescriptor(rt.prototype,"play"),rt.prototype),lt(rt.prototype,"stop",[Hx],Object.getOwnPropertyDescriptor(rt.prototype,"stop"),rt.prototype),lt(rt.prototype,"setEnabled",[Kx,zx,Yx],Object.getOwnPropertyDescriptor(rt.prototype,"setEnabled"),rt.prototype),lt(rt.prototype,"setMuted",[qx,Xx,Jx],Object.getOwnPropertyDescriptor(rt.prototype,"setMuted"),rt.prototype),lt(rt.prototype,"setSaveEncodeBitrateRatio",[$x,Qx],Object.getOwnPropertyDescriptor(rt.prototype,"setSaveEncodeBitrateRatio"),rt.prototype),lt(rt.prototype,"setEncoderConfiguration",[Zx,e2],Object.getOwnPropertyDescriptor(rt.prototype,"setEncoderConfiguration"),rt.prototype),lt(rt.prototype,"getStats",[t2],Object.getOwnPropertyDescriptor(rt.prototype,"getStats"),rt.prototype),lt(rt.prototype,"setBeautyEffect",[n2,r2],Object.getOwnPropertyDescriptor(rt.prototype,"setBeautyEffect"),rt.prototype),lt(rt.prototype,"getCurrentFrameData",[i2],Object.getOwnPropertyDescriptor(rt.prototype,"getCurrentFrameData"),rt.prototype),lt(rt.prototype,"getCurrentFrameImage",[s2],Object.getOwnPropertyDescriptor(rt.prototype,"getCurrentFrameImage"),rt.prototype),lt(rt.prototype,"findClosestProfile",[o2,a2],Object.getOwnPropertyDescriptor(rt.prototype,"findClosestProfile"),rt.prototype),lt(rt.prototype,"setBitrateLimit",[c2],Object.getOwnPropertyDescriptor(rt.prototype,"setBitrateLimit"),rt.prototype),lt(rt.prototype,"setOptimizationMode",[l2],Object.getOwnPropertyDescriptor(rt.prototype,"setOptimizationMode"),rt.prototype),lt(rt.prototype,"setScalabiltyMode",[d2],Object.getOwnPropertyDescriptor(rt.prototype,"setScalabiltyMode"),rt.prototype),lt(rt.prototype,"updateMediaStreamTrackResolution",[u2],Object.getOwnPropertyDescriptor(rt.prototype,"updateMediaStreamTrackResolution"),rt.prototype),lt(rt.prototype,"pipe",[h2],Object.getOwnPropertyDescriptor(rt.prototype,"pipe"),rt.prototype),lt(rt.prototype,"unpipe",[p2],Object.getOwnPropertyDescriptor(rt.prototype,"unpipe"),rt.prototype),lt(rt.prototype,"close",[f2],Object.getOwnPropertyDescriptor(rt.prototype,"close"),rt.prototype),lt(rt.prototype,"replaceTrack",[m2],Object.getOwnPropertyDescriptor(rt.prototype,"replaceTrack"),rt.prototype),rt),_g=(_2=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),g2=ln(),E2=Zd("CameraVideoTrack","_enabledMutex"),v2=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),y2=ln(),S2=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),T2=ln(),R2=xe({argsMap:e=>[e.getTrackId()]}),Bi=class tG extends Wt{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,o,c,l){super(t,ks(n.encoderConfig),o,c,l),$(this,"_config",void 0),$(this,"_originalConstraints",void 0),$(this,"_constraints",void 0),$(this,"_enabled",!0),$(this,"_deviceName","default"),$(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Xd()||t0())&&!function(){const u=dt();if(u.os!==xn.IOS||!u.osVersion)return!1;const h=u.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&qL()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=ks(this._config.encoderConfig),Nt.on($n.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Nt.on($n.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(S.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await ji.getDeviceById(t),i={};i.video=Ft({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=await Vi(i,this.getTrackId())}catch(c){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Vi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await ji.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}S.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){S.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Ft(Ft({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Vi(n,this.getTrackId())}catch(o){throw S.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),i=await Vi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Ft({},n.video),S.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Vi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await xt(this,Re.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await xt(this,Re.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ne(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=ks(t),M("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=$t(this._config);i.encoderConfig=t;const o=mg(i);(rr()||Sr()||Ns())&&(o.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const l=new ne(k.UNEXPECTED_ERROR,c.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}this._config=i,this._constraints=o,this._originalConstraints=o,this._encoderConfig=t,this._hints.indexOf(kt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xt(this,Re.NEED_UPDATE_VIDEO_ENCODER,this)}catch(c){return c.throw(S)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Sr()||Ns())&&this._enabled&&!this._isClosed&&Nt.duringInterruption){const t=async()=>{Nt.off($n.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Nt.on($n.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(su.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=ji.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const o=await Vi({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Nt.off($n.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Nt.off($n.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Ft(Ft({},i),ks(t))),i=gl(i);const o=Ut(8,"track-cam-cloned-"),c=new tG(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,gl(Ft(Ft({},this._config),{},{encoderConfig:i})),gl(this._constraints),gl(this._scalabilityMode),this._optimizationMode,o);return t&&i&&c.setEncoderConfiguration(i),S.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),c}bindProcessorContextEvents(){this.processorContext.on(xi.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){i(o)}}),this.processorContext.on(xi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},lt(Bi.prototype,"setDevice",[_2,g2],Object.getOwnPropertyDescriptor(Bi.prototype,"setDevice"),Bi.prototype),lt(Bi.prototype,"setEnabled",[E2,v2,y2],Object.getOwnPropertyDescriptor(Bi.prototype,"setEnabled"),Bi.prototype),lt(Bi.prototype,"setEncoderConfiguration",[S2,T2],Object.getOwnPropertyDescriptor(Bi.prototype,"setEncoderConfiguration"),Bi.prototype),lt(Bi.prototype,"close",[R2],Object.getOwnPropertyDescriptor(Bi.prototype,"close"),Bi.prototype),Bi);function V0(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Ft(Ft({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?S.debug("[".concat(e,"] set content hint to"),n.optimizationMode):S.debug("[".concat(e,"] set content hint failed")))):S.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var C2,w2,b2,I2,ns,A2,O2,N2,P2,D2,k2,Pr;class L2 extends xM{getUserId(){return this._userId}constructor(t,n,i,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(Ut(5,""))),$(this,"_userId",void 0),$(this,"_uintId",void 0),$(this,"_isDestroyed",!1),$(this,"store",void 0),$(this,"processor",void 0),$(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let du=(C2=xe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),w2=xe({argsMap:e=>[e.getTrackId()]}),b2=xe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),I2=xe({argsMap:e=>[e.getTrackId()]}),lt((ns=class extends L2{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==hr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i,o){super(e,t,n,i),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"trackMediaType",ou.VIDEO),$(this,"_videoWidth",void 0),$(this,"_videoHeight",void 0),$(this,"_player",void 0),$(this,"_prePlayer",void 0),$(this,"processorDestination",void 0),$(this,"processorContext",void 0),this._prePlayer=o,this.updateMediaStreamTrackResolution(),this.processorContext=new qM(this.getTrackId(),"remote"),this.processorDestination=new YM(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return rc(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ki(this,Re.GET_STATS)||Ft({},LM)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(ts.PLAY_START),typeof e=="string"){const i=document.getElementById(e);i?e=i:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Ft(Ft({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let i=!1,o=!1;e instanceof HTMLVideoElement?(this._player=new x0(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,o=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new U0(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ts.FIRST_FRAME_DECODED),o&&this.safeEmit(ts.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=c=>{this.safeEmit(ts.VIDEO_STATE_CHANGED,c)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(ts.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},M("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(ts.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){$M(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(ig)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:c}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=QL.checkOneElementVisible(o),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const h=be.reportApiInvoke(null,{tag:Jt.TRACER,name:un.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(n){throw new ne(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(jr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(jr.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Sl.SEI_RECEIVED,e)}}).prototype,"play",[C2],Object.getOwnPropertyDescriptor(ns.prototype,"play"),ns.prototype),lt(ns.prototype,"stop",[w2],Object.getOwnPropertyDescriptor(ns.prototype,"stop"),ns.prototype),lt(ns.prototype,"pipe",[b2],Object.getOwnPropertyDescriptor(ns.prototype,"pipe"),ns.prototype),lt(ns.prototype,"unpipe",[I2],Object.getOwnPropertyDescriptor(ns.prototype,"unpipe"),ns.prototype),ns),uu=(A2=xe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),O2=xe({argsMap:(e,t)=>[e.getTrackId(),t]}),N2=xe({argsMap:e=>[e.getTrackId()]}),P2=xe({argsMap:e=>[e.getTrackId()]}),D2=xe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),k2=xe({argsMap:e=>[e.getTrackId()]}),lt((Pr=class extends L2{get isPlaying(){return this._useAudioElement?qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),$(this,"trackMediaType",ou.AUDIO),$(this,"_source",void 0),$(this,"_useAudioElement",!0),$(this,"_volume",100),$(this,"processorContext",void 0),$(this,"processorDestination",void 0),$(this,"_played",!1),$(this,"_bypassWebAudio",!1),M("DISABLE_WEBAUDIO")?(this._source=new L0,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new FM(e,!0),M("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Mi.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ts.FIRST_FRAME_DECODED)}),this.processorContext=new JM(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new XM(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Mi.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Mi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Mi.ON_AUDIO_BUFFER),this._source.on(Mi.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?qr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!NM())throw new ne(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");await qr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return rc(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ki(this,Re.GET_STATS)||Ft({},kM)}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?qr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(jr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(jr.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(jr.ON_TRACK),this.processorDestination.removeAllListeners(jr.ON_NODE)}}).prototype,"setVolume",[A2],Object.getOwnPropertyDescriptor(Pr.prototype,"setVolume"),Pr.prototype),lt(Pr.prototype,"setPlaybackDevice",[O2],Object.getOwnPropertyDescriptor(Pr.prototype,"setPlaybackDevice"),Pr.prototype),lt(Pr.prototype,"play",[N2],Object.getOwnPropertyDescriptor(Pr.prototype,"play"),Pr.prototype),lt(Pr.prototype,"stop",[P2],Object.getOwnPropertyDescriptor(Pr.prototype,"stop"),Pr.prototype),lt(Pr.prototype,"pipe",[D2],Object.getOwnPropertyDescriptor(Pr.prototype,"pipe"),Pr.prototype),lt(Pr.prototype,"unpipe",[k2],Object.getOwnPropertyDescriptor(Pr.prototype,"unpipe"),Pr.prototype),Pr);const Go=new class extends nn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),$(this,"_lastHiddenTime",0),$(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),S.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class M2 extends nn{constructor(t,n){super(),$(this,"trackMediaType",ou.DATA),$(this,"_version",1),$(this,"_type",3),$(this,"_config",void 0),$(this,"_originDataChannel",void 0),$(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),$(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),$(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return M("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ve((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var o;n(new ne(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new ne(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ne(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[pg.OPEN,pg.CLOSE,pg.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,o]=n;t.removeEventListener(i,o)}),this._datachannelEventMap.clear()}}class bee extends M2{constructor(t){super(t),$(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(i).getUint8(3);if(o!==this.id)return void(M("SHOW_DATASTREAM2_LOG")&&S.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let c=n.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(pg.MESSAGE,c)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Iee extends M2{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function gg(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>__.revokeObjectURL(e),0),new Worker(__.createObjectURL(e))}const x2=71,j0=1,F0=2,B0=1,U2=2;var oc=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(oc||{});function W0(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==x2)return;const i=e.getUint16(1),o=j0+F0+i,c=new Uint8Array(e.byteLength-o);c.set(new Uint8Array(e.buffer,o,e.byteLength-o));const l={m:n,tlvLen:i,tlv:[],frame:c};let u=j0+F0;for(;u<o;){const h=e.getUint8(u),f=e.getUint16(u+B0),m=B0+U2;if(h===oc.AUDIO_LEVEL){let g=e.getUint8(u+m);for(let E=1;E<f;E++)g=g<<8|e.getUint8(u+m+E);l.tlv.push({tag:h,length:f,value:t?127^g>>1:127&g})}else if(h===oc.METADATA||h===oc.AUDIO_64_BIT_PTS){const g=new Uint8Array(f);for(let E=0;E<f;E++)g[E]=e.getUint8(u+m+E);l.tlv.push({tag:h,length:f,value:g})}u+=m+f}return l}const Eg=new Map,vg=127,Cl=1e-10,G0=139/13,yg=new Map;function H0(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let o=0;return yg.has(i)?o=yg.get(i):(o=Math.log(function(l,u){const h=l-u;u<h&&(u=h);let f=1;for(let m=l,g=1;m>u;m--,g++)f=f*m/g;return f}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,yg.set(i,o)),o<Cl&&(o=Cl),o}function V2(e,t,n){const i=t.length,o=e.length/i;let c=!1;for(let l=0,u=0;l<i;l++){let h=0;for(let f=u+o;u<f;u++)e[u]>n&&h++;t[l]!==h&&(t[l]=h,c=!0)}return c}window.cache=yg;let Aee=0;class j2{constructor(t){$(this,"id",void 0),$(this,"immediates",[]),$(this,"lastNonSilence",-1),$(this,"immediateSpeechActivityScore",Cl),$(this,"lastLevelChangedTime",Date.now()),$(this,"levels",[]),$(this,"longs",[]),$(this,"longSpeechActivityScore",Cl),$(this,"mediums",[]),$(this,"mediumSpeechActivityScore",Cl),$(this,"minLevel",0),$(this,"nextMinLevel",0),$(this,"nextMinLevelWindowLength",0),$(this,"energyScore",0),this.id=t||"".concat(Aee++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,i=this.minLevel+G0;let o=!1;for(let c=0;c<t.length;++c){let l=n[c];l<i&&(l=0);const u=Math.floor(l/G0);t[c]!==u&&(t[c]=u,o=!0)}return o}computeLongs(){return V2(this.mediums,this.longs,4)}computeMediums(){return V2(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=H0(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=H0(this.longs[0],10,47),this.longSpeechActivityScore>Cl&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=H0(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(EO(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=t;return t<0&&(i=0),t>vg&&(i=vg),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+G0?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>vg&&(n=vg),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Oee{constructor(t){$(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class K0{constructor(t,n,i){$(this,"isDominant",void 0),$(this,"energyRanking",void 0),$(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=i}}class Nee extends nn{constructor(t){super(),$(this,"dominantId",null),$(this,"lastDecisionTime",0),$(this,"lastLevelChangedTime",0),$(this,"lastLevelIdleTime",0),$(this,"relativeSpeechActivities",[]),$(this,"speakers",new Map),$(this,"enableSilence",!1),$(this,"timeoutToSilenceInterval",0),$(this,"decisionMaker",null),$(this,"loudest",[]),$(this,"numLoudestToTrack",3),$(this,"energyExpireTimeMs",250),$(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const i=Date.now(),o=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const c=o.levelChanged(n,i);return this.updateLoudestList(o,c,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new j2(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,i){const o=t.id===this.dominantId;if(n<0){let h=0;for(;h<this.loudest.length&&this.loudest[h]!==t;)++h;return new K0(o,h,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new K0(o,0,t.energyScore);const c=i-this.energyExpireTimeMs;let l=0;for(;l<this.loudest.length;){const h=this.loudest[l];if(h.getLastLevelChangedTime()<c&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(l,1);else if(h.id!==t.id)++l;else if(this.loudest.splice(l,1),this.loudest.length<this.numLoudestToTrack)break}let u=0;for(;u<this.loudest.length&&!(this.loudest[u].energyScore<t.energyScore);)++u;return u<this.numLoudestToTrack&&(this.loudest.splice(u,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new K0(o,u,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Oee(this),this.decisionMaker.execute())}makeDecision(t){let n=null,i=null;const o=this.speakers.size;let c=null;if(o===0)c=null;else if(o===1){var l;const u=Ei(l=this.speakers).call(l).next().value;this.enableSilence&&u&&(c=u.id,u.evaluateSpeechActivityScores(t),t-u.lastNonSilence>this.timeoutToSilenceInterval&&(c=null))}else{let u=this.dominantId==null?null:this.speakers.get(this.dominantId);if(u==null){const m=this.speakers.entries().next();m.value&&(c=m.value[0],u=m.value[1])}else c=u.id;u!=null&&u.evaluateSpeechActivityScores(t);const h=this.relativeSpeechActivities;let f=2;for(const m of this.speakers.entries()){const[g,E]=m;if(E===u)continue;E.evaluateSpeechActivityScores(t);for(let w=0;w<h.length;++w){const D=u==null?Cl:u.getSpeechActivityScore(w);h[w]=Math.log(E.getSpeechActivityScore(w)/D)}const y=h[0],I=h[1],C=h[2];y>3&&I>2&&C>0&&I>f&&(f=I,c=g)}this.enableSilence&&u!=null&&c===u.id&&t-u.lastNonSilence>this.timeoutToSilenceInterval&&(c=null)}c==null&&!this.enableSilence||c===this.dominantId||(n=this.dominantId,this.dominantId=c,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=n;let o=300-(t-this.lastDecisionTime);return o<=0&&(this.lastDecisionTime=t,this.makeDecision(t),o=300-(Date.now()-t)),o>0&&i>o&&(i=o),i}timeoutIdleLevels(t){const n=[];for(const o of Ei(i=this.speakers).call(i)){var i;const c=t-o.getLastLevelChangedTime();36e5<c&&(this.dominantId==null||o.id!==this.dominantId)?n.push(o.id):300<c&&o.levelTimedOut()}n.forEach(o=>this.speakers.delete(o))}}const hu=new Map;let uo=null,Sg=null;const F2=3;let wl=[];const ho=new Map,Tg=new Map;class Pee{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){$(this,"id",void 0),$(this,"track",void 0),$(this,"score",0),$(this,"active",!0),$(this,"muted",!1),$(this,"timer",0),$(this,"actives",0),$(this,"inactives",0),this.id=t,this.track=n,this.setActive(ho.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const o=[],c=[];return Array.from(Ei(ho).call(ho)).forEach(l=>{l.active?o.push(l):c.push(l)}),{actives:o,inactives:c}}();if(n.length>3){let o;n.forEach(c=>{(!o||o.score>c.score)&&(o=c)}),o&&o.setActive(!1)}if(n.length<3&&i.length>0){let o;i.forEach(c=>{(!o||o.score<c.score)&&c.id!==this.id&&(o=c)}),o&&t&&!this.active&&(o.samples>40&&o.activeRate-this.activeRate>.4?o.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let i;return Array.from(Ei(ho).call(ho)).forEach(o=>{!o.active||o.id===n||o.samples<40||(!i||o.score<i.score)&&(i=o)}),i}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let i;return Array.from(Ei(ho).call(ho)).forEach(o=>{o.active||o.id===n||o.samples<40||(!i||o.score>i.score)&&(i=o)}),i}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Rg;function B2(e){const t=ho.get(e);t&&(ho.delete(e),t.clearTimer())}const Cg=new Map,Dee=new Map,z0="video/h264",Y0="video/h265";function W2(e,t,n){let i=new Uint8Array(e,t,n),o=[],c=0;for(;o.length<n;)c+3<n&&i[c]===0&&i[c+1]===0&&i[c+2]===3&&(i[c+3]===0||i[c+3]===1||i[c+3]===2||i[c+3]===3)?(o.push(i[c],i[c+1],i[c+3]),c+=4):(o.push(i[c]),c++);return new Uint8Array(o)}function G2(e){const t=e.length;let n=[],i=0;for(;i<t;)i+2<t&&e[i]===0&&e[i+1]===0&&(e[i+2]===0||e[i+2]===1||e[i+2]===2||e[i+2]===3)?(n.push(e[i],e[i+1],3,e[i+2]),i+=3):(n.push(e[i]),i++);return new Uint8Array(n)}function H2(e){if(e.length<5)return"";let t=-1;for(let o=0;o<e.length-3;o++){if(e[o]===0&&e[o+1]===0&&e[o+2]===1){t=o;break}if(o<e.length-4&&e[o]===0&&e[o+1]===0&&e[o+2]===0&&e[o+3]===1){t=o;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const i=e[n];return 128&i?"":(i>>1&63)>=32||n+1<e.length&&!(248&e[n+1])?Y0:(31&i)<=31?z0:""}const wg=new Map,Cp=new Map;(function(){const e=dt();Jn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Jn.getStreamFromExtension=e.name===gt.CHROME&&Number(e.version)>34,Jn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Jn.supportMinBitrate=e.name===gt.CHROME||e.name===gt.EDGE,Jn.supportSetRtpSenderParameters=function(){const t=dt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ga()||!(!rr()&&!eg())||t.name===gt.FIREFOX&&Number(t.version)>=64)}(),e.name===gt.SAFARI&&(Number(e.version)>=14?Jn.supportDualStream=!0:Jn.supportDualStream=!1),Jn.webAudioMediaStreamDest=function(){const t=dt();return!(t.name===gt.SAFARI&&Number(t.version)<12)}(),Jn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Jn.supportWebGL=typeof WebGLRenderingContext<"u",Jn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ga()||(Jn.webAudioWithAEC=!0),Jn.supportShareAudio=function(){const t=dt();return(t.os===xn.WIN_10||t.os===xn.WIN_81||t.os===xn.WIN_7||t.os===xn.LINUX||t.os===xn.MAC_OS||t.os===xn.CHROMIUM_OS)&&t.name===gt.CHROME&&Number(t.version)>=74}(),Jn.supportDataChannel=!!(qd(76)||QR(68)||GL(14)),Jn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!sn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Jn.supportWebRTCEncodedTransform=qd(87)||FL()||QR(117),Jn.supportWebRTCInsertableStream=function(){const t=dt();return(t.name===gt.CHROME||t.name===gt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Jn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Jn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,rg(()=>{Jn.supportDualStreamEncoding=function(){const t=dt();return!!M("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&M("CHROME_DUAL_STREAM_USE_ENCODING"))}(),S.debug("browser ua: ",navigator.userAgent),S.info("browser info: ",e),S.info("browser compatibility: ",Jn)})})();const kee=["CHINA","GLOBAL"],K2=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],bl=[],pu=[];function Il(e,t){return!!t&&bl.some(n=>n.uid===e&&n.channelName===t)}function q0(){return pu.length>0}var Lee=s1.forEach,z2=Am("forEach")?[].forEach:function(e){return Lee(this,e,arguments.length>1?arguments[1]:void 0)};It({target:"Array",proto:!0,forced:[].forEach!==z2},{forEach:z2});var Mee=Ts("Array","forEach"),xee=qa,Uee=vr,Vee=B,jee=Mee,X0=Array.prototype,Fee={DOMTokenList:!0,NodeList:!0},Bee=function(e){var t=e.forEach;return e===X0||Vee(X0,e)&&t===X0.forEach||Uee(Fee,xee(e))?jee:t},Wee=p(Bee),Gee=ko,Y2=Lm;It({target:"Object",stat:!0,forced:_(function(){Y2(1)})},{keys:function(e){return Y2(Gee(e))}});var Hee=p(_i.Object.keys),Kee=p(mO),zee=p(gO),Yee=It,q2=xh,qee=qm,Xee=Bn,X2=mS,Jee=Ya,$ee=_n,Qee=kT,Zee=An,ete=Ja,tte=Xk("slice"),nte=Zee("species"),J0=Array,rte=Math.max;Yee({target:"Array",proto:!0,forced:!tte},{slice:function(e,t){var n,i,o,c=$ee(this),l=Jee(c),u=X2(e,l),h=X2(t===void 0?l:t,l);if(q2(c)&&(n=c.constructor,(qee(n)&&(n===J0||q2(n.prototype))||Xee(n)&&(n=n[nte])===null)&&(n=void 0),n===J0||n===void 0))return ete(c,u,h);for(i=new(n===void 0?J0:n)(rte(h-u,0)),o=0;u<h;u++,o++)u in c&&Qee(i,o,c[u]);return i.length=o,i}});var ite=Ts("Array","slice"),ste=B,ote=ite,$0=Array.prototype,ate=function(e){var t=e.slice;return e===$0||ste($0,e)&&t===$0.slice?ote:t},cte=p(ate);function Ce(e,t,n,i,o){var c,l,u,h={};return Wee(c=Hee(i)).call(c,function(f){h[f]=i[f]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=Kee(l=zee(u=cte(n).call(n)).call(u)).call(l,function(f,m){return m(e,t,f)||f},h),o&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(o):void 0,h.initializer=void 0),h.initializer===void 0?(Kk(e,t,h),null):h}let bg=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Q0=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Ls=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Fr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Le=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Bt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Be=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),je=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),wp=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),ot=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Br=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),ze=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function Ig(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw S.error("Invalid Channel Name ".concat(e)),new Q(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Ag(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||$L(e,1,255)))throw new Q(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&S.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let va=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const lte={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Z0={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function eC(e,t){qn(e.url,"".concat(t,".url"),1,1e3,!1),on(e.x)||Dt(e.x,"".concat(t,".x"),0,1e4),on(e.y)||Dt(e.y,"".concat(t,".y"),0,1e4),on(e.width)||Dt(e.width,"".concat(t,".width"),0,1e4),on(e.height)||Dt(e.height,"".concat(t,".height"),0,1e4),on(e.zOrder)||Dt(e.zOrder,"".concat(t,".zOrder"),0,255),on(e.alpha)||Dt(e.alpha,"".concat(t,".alpha"),0,1,!1)}const dte={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let ac=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),tC=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Nn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function J2(e){if(!e.channelName)throw new Q(k.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Q(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&qn(e.token,"info.token",1,2047),Ag(e.uid),Ig(e.channelName),!0}let Wr=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),ya=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),oi=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),fu=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),bt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Wn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),Og=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Un=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Tt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const $2=[Tt.AFRICA,Tt.ASIA,Tt.CHINA,Tt.EUROPE,Tt.GLOBAL,Tt.INDIA,Tt.JAPAN,Tt.NORTH_AMERICA,Tt.OCEANIA,Tt.OVERSEA,Tt.SOUTH_AMERICA];let pr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const Ng={CHINA:{},ASIA:{CODE:pr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:pr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:pr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:pr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:pr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:pr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:pr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:pr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:pr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:pr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:pr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:pr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:pr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};E0&&(Ng.CHINA={CODE:pr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let bp=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function Q2(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class Z2 extends nn{constructor(t,n){super(),O(this,"onICEConnectionStateChange",void 0),O(this,"onConnectionStateChange",void 0),O(this,"onDTLSTransportStateChange",void 0),O(this,"onDTLSTransportError",void 0),O(this,"onICETransportStateChange",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoReceived",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstVideoRender",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"onICECandidateError",void 0),O(this,"getLocalVideoStats",void 0)}}class eU extends Z2{constructor(t,n){super(t,n),O(this,"establishPromise",void 0)}}let Se=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),fr=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Sa=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const tU=["disconnected","failed"];let ae=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),wt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Pe=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ms=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),xs=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Gn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),nU=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Ho=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),rs=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),po=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),mu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),fn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),_u=function(e){return e.ABORT="abort",e}({}),cc=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),ute=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const hte={[bg.ACCESS_POINT]:{[Fr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Fr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Fr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Fr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Fr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Fr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Fr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[bg.UNILBS]:{[Ls.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ls.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ls.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ls.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ls.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ls.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ls.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ls.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ls.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ls.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ls.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ls.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[bg.STRING_UID_ALLOCATOR]:{[Q0.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Q0.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Q0.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function gu(e){const t=hte[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===bg.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const pte={[Le.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Le.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Le.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Le.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Le.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Le.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Le.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Le.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Le.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Le.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Le.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Le.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Le.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Le.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Le.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Le.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Le.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Le.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Le.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Le.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Le.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Le.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Le.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Le.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Le.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Le.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Le.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Le.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Le.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Le.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Le.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Le.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Le.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Le.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Le.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Le.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Le.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Le.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Le.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Le.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Le.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Le.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Le.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Le.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Le.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Le.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Le.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Le.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Le.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Le.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Le.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Le.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Le.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Le.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Le.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Le.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Le.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Le.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Le.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Le.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Le.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Le.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Le.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Le.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Ip(e){return pte[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function rU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function nC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function rC(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:o}=e;if(t){const c=M("JOIN_GATEWAY_FALLBACK_PORT")||443;return c===443?"wss://".concat(i,"/ws/?p=").concat(Number(o)+150):"wss://".concat(i,":").concat(c,"/ws/?p=").concat(Number(o)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(o):"wss://".concat(i,":").concat(o)}const fte=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,mte=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,_te=/wss:\/\/(.+):([0-9]+)\/?/,gte=/wss:\/\/(.[^\/]+)\/?/;let Ete=0;class vte{constructor(t,n){O(this,"id",0),O(this,"store",void 0),O(this,"recordIndex",void 0),O(this,"websockets",[]),O(this,"try443PortDuration",2e3),O(this,"forceCloseWSDuration",5e3),O(this,"try443PortTimeout",null),O(this,"forceCloseTimeout",null),O(this,"isTry443PortFailed",!1),O(this,"isNormalPortFailed",!1),O(this,"useDoubleDomain",!1),O(this,"useProxy",!1),O(this,"startTime",Date.now()),this.id=++Ete,this.try443PortDuration=M("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];S.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...o)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const o=M("GATEWAY_DOMAINS"),c=Date.now(),l=[],u=o.find(E=>{var y;return pe(y=t.host).call(y,E)});u||(this.useDoubleDomain=!1);const h=[];if(this.useDoubleDomain)o.forEach(E=>{h.push(rC(nC(nC({},t),{},{host:t.host.replace(u,E)}),n))});else{const E=nC({},t);if(n&&u){const y=o.find(I=>I!==u);y&&(E.host=E.host.replace(u,y))}h.push(rC(E,n))}try{h.forEach(E=>{const y=new WebSocket(E);y.binaryType="arraybuffer",l.push(y),this.logger("ws is connecting:",y.url)})}catch(E){if(this.logger("ws create failed"),l.forEach(y=>y.close()),l.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new Q(k.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const f=up();this.store&&this.store.recordJoinChannelService({urls:l.map(E=>E.url),service:"gateway"},this.recordIndex),l.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-c,"ms")),this.websockets.forEach(y=>{y!==E&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,f.resolve(E)},E.onclose=y=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-c,"ms state: ").concat(E.readyState));const I=l.every(C=>C.readyState===WebSocket.CLOSED||C.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(I)),I&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),f.reject({code:y.code,reason:Og.A_ROUND_WS_FAILED})):!n&&I&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),g()),n?this.isTry443PortFailed=I:this.isNormalPortFailed=I},E.onmessage=y=>this.logger("".concat(E.url," onmessage: ").concat(y.data))}),this.websockets.push(...l);const m=()=>{this.websockets.forEach(E=>E.readyState!==WebSocket.OPEN&&E.close())},g=()=>{if(f.isResolved)return m();dt().os===xn.MAC_OS&&sn()&&m(),this.createWebSocket(t,!0,!0).then(E=>{f.resolve(E)}).catch(E=>{this.isNormalPortFailed&&f.reject(E),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.forceCloseTimeout=null,m()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,m()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",f.isResolved),this.try443PortTimeout=null,g()},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(t,n,i,o){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(c){let l,u,h;return[,l,u,h]=c.match(fte)||[],l||([,u,h]=c.match(mte)||[]),u&&h||([,u,h]=c.match(_te)||[]),u&&h||([,u]=c.match(gte)||[]),u||S.warning("un-destructible url: ",c),{proxy:l,host:u,port:h||"443"}}(t)),this.recordIndex=o,this.useProxy=!!t.proxy,i&&this.useProxy&&(S.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function iU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class sU extends nn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;pe(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ze.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ze.CONNECTED):this._state==="closed"?this.emit(ze.CLOSED):this._state==="failed"&&this.emit(ze.FAILED))}resetReconnectCount(t){S.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],c=arguments.length>4&&arguments[4]!==void 0&&arguments[4],l=arguments.length>5?arguments[5]:void 0;super(),O(this,"_websocketUrl",null),O(this,"connectionID",0),O(this,"currentURLIndex",0),O(this,"urls",[]),O(this,"_reconnectMode","tryNext"),O(this,"reconnectReason",void 0),O(this,"_initMutex",void 0),O(this,"name",void 0),O(this,"_state","closed"),O(this,"reconnectInterrupter",void 0),O(this,"websocket",void 0),O(this,"retryConfig",void 0),O(this,"reconnectCount",0),O(this,"forceCloseTimeout",5e3),O(this,"onlineReconnectListener",void 0),O(this,"useCompress",void 0),O(this,"tryDoubleDomain",!1),O(this,"use443PortOnly",!1),O(this,"wsInflateLength",0),O(this,"wsDeflateLength",0),O(this,"closeEstablishingWs",()=>{}),O(this,"store",void 0),O(this,"joinGatewayRecordIndex",void 0),this.store=l,this.name=t,this.retryConfig=function(g){for(var E=1;E<arguments.length;E++){var y=arguments[E]!=null?arguments[E]:{};E%2?iU(Object(y),!0).forEach(function(I){O(g,I,y[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(y)):iU(Object(y)).forEach(function(I){Object.defineProperty(g,I,Object.getOwnPropertyDescriptor(y,I))})}return g}({},n),this.useCompress=i,this.tryDoubleDomain=o,this.use443PortOnly=c,this._initMutex=new ur("websocket",l?l.clientId:void 0);const{timeout:u,timeoutFactor:h}=n,f=Math.max(300,Math.floor(3*u/5)),m=Math.max(1.2,Math.floor(8*h)/10);Si.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m),gn.on(Jd.NETWORK_STATE_CHANGE,(g,E)=>{g!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(g)),g===Si.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var o;const c=up(),l=this.urls[this.currentURLIndex];(o=this.store)===null||o===void 0||o.beforeConnect(),function(u){return!(dg()||M("USE_NEW_TOKEN")||!M("ENABLE_PREALLOC_PC")&&(u==null||!u.autoSubscribe||M("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(nU.PRE_CONNECT_PC),this.createWebSocketConnection(l).then(c.resolve).catch(c.reject),this.once(ze.CLOSED,()=>{c.reject(new ne(k.WS_DISCONNECT))}),this.once(ze.CONNECTED,c.resolve),await c.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ne(k.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new ne(k.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=up();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const o=m=>{var g;(g=this.store)===null||g===void 0||g.signalChannelOpen(),S.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},c=async m=>{var g;if(S.debug("[".concat(this.name,"] websocket close ").concat((g=this.websocket)===null||g===void 0?void 0:g.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new ne(k.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const E=ki(this,ze.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,y=await this.reconnectWithAction(E);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return i.reject(new ne(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);i.resolve()}},l=m=>{this.emit(ze.ON_MESSAGE,m)},u=m=>{S.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),M("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=M("GATEWAY_WSS_ADDRESS")),S.debug("[".concat(this.name,"] start connect, url:"),t);const h=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;this._websocketUrl=rC(t);const m=await this.chooseBestWebsocketConnection(t);this.websocket=m,o&&o(this.websocket.url),this.websocket.onclose=c,this.websocket.onmessage=l,this.websocket.onerror=u,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(m){const g=this.state==="closed",E=m instanceof ne,y=E&&m.code===k.WS_ABORT,I=E&&m.code===k.WS_ERR,C=E?m.message:m&&(m.reason||m.toString());S.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(C)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[m]},h),g||I?(i.reject(g?new ne(k.WS_DISCONNECT,"websocket is closed: ".concat(C)):new ne(k.WS_ERR,"init websocket failed: ".concat(C))),I&&S.error("[".concat(this.name,"] init websocket failed: ").concat(C))):c&&c(m)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;S.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||gn.isOnline||!gn.onlineWaiter||(this.onlineReconnectListener=gn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const l=d0(this.reconnectCount,this.retryConfig);S.debug("[".concat(this.name,"] wait ").concat(l,"ms to reconnect websocket, mode: ").concat(t)),await ve.race([Xn(l),this.onlineReconnectListener||new ve(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const o=async(l,u)=>{this.emit(ze.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(l)};try{if(t==="retry")await o(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);S.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await o(this.urls[this.currentURLIndex],t)}else t==="recover"&&(S.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await sr(this,ze.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],t))}catch(l){var c;S.error("[".concat(this.name,"] reconnect failed ").concat(l&&l.toString()));const u=l==null||(c=l.data)===null||c===void 0?void 0:c.desc;return Array.isArray(u)&&pe(u).call(u,"dynamic key expired")?(this.emit(ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class iC extends sU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=up(),o=function(l,u){return new vte(l,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),i.reject(new ne(k.WS_ABORT,"choose best websocket aborted"))};const c=M("GATEWAY_DOMAINS");return S.debug("[choose-best-ws] currentDomain: ",t,", domains: ",c,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Ap extends sU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new ve((i,o)=>{let c=!1;const l=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),l.forEach(I=>{I.onclose=null,I.onopen=null,I.onmessage=null,I.close()}),o(new ne(k.WS_ABORT,"choose best websocket aborted"))};const u=M("GATEWAY_DOMAINS");let h;const f=t.indexOf("?h="),m=u.find(I=>f!==-1?pe(t).call(t,I,f):pe(t).call(t,I));S.debug("[choose-best-ws] currentDomain: ",m,", domains: ",u);let g=!this.tryDoubleDomain||!m;if(!g&&m){var E;const I=Date.now();try{u.forEach(C=>{const w=f===-1?t.replace(m,C):t.substr(0,f)+t.substr(f).replace(m,C),D=new WebSocket(w);D.binaryType="arraybuffer",l.push(D),S.debug("[choose-best-ws] ws is connecting:",D.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(w=>w.close());l.length;)l.pop();g=!0}(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:l.map(C=>C.url),service:"gateway"},n),l.forEach(C=>{C.onopen=()=>{if(c)return;const w=Date.now()-I;S.debug("[choose-best-ws] ws open cost ".concat(w,"ms")),l.filter(D=>D!==C).forEach(D=>{S.debug("[choose-best-ws]close backup websocket: ".concat(D.url)),D.close()}),c=!0,i(C)},C.onclose=w=>{h=w,!c&&(l.find(D=>!(D.readyState===WebSocket.CLOSED||D.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),c=!0,o(h)))},C.onmessage=w=>{S.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(w.data))}}),Xn(this.forceCloseTimeout).then(()=>{l.forEach(C=>{C.readyState!==WebSocket.OPEN&&C.close()})})}if(g){var y;let I;S.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},n);try{I=new WebSocket(t),l.push(I),I.binaryType="arraybuffer"}catch(C){const w=new ne(k.WS_ERR,"init websocket failed! Error: ".concat(C.toString()));return S.error("[".concat(this.name,"]").concat(w)),void o(w)}I.onopen=()=>{i(I)},I.onclose=C=>{o(C)},I.onmessage=C=>{S.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(C.data))},Xn(this.forceCloseTimeout).then(()=>{I&&I.readyState!==WebSocket.OPEN&&I.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class yte extends nn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Bt.CONNECTED?this.emit(Be.WS_CONNECTED):t===Bt.RECONNECTING?this.emit(Be.WS_RECONNECTING,this._websocketReconnectReason):t===Bt.CLOSED&&this.emit(Be.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Bt.CLOSED),O(this,"reconnectToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new pM(5)),O(this,"pingpongTimer",void 0),O(this,"wsInflateDataTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"ortc",void 0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Be.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const c="res-@".concat(o._id);this.emit(c,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===ot.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===ot.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}if(o._type===ot.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Le.ERR_LICENSE_MISSING:this.close(Ct.LICENSE_MISSING);break;case Le.ERR_LICENSE_EXPIRED:this.close(Ct.LICENSE_EXPIRED);break;case Le.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ct.LICENSE_MINUTES_EXCEEDED);break;case Le.ERR_LICENSE_PERIOD_INVALID:this.close(Ct.LICENSE_PERIOD_INVALID);break;case Le.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case Le.ERR_LICENSE_ILLEGAL:this.close(Ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new iC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,M("JOIN_GATEWAY_USE_DUAL_DOMAIN"),M("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Bt.CONNECTED&&this.reconnect("retry",ir.OFFLINE)})}async request(t,n,i,o){const c=Ut(6,""),l={_id:c,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new ve((I,C)=>{if(this.connectionState===Bt.CONNECTED)return I();const w=()=>{this.off(Be.WS_CLOSED,D),I()},D=()=>{this.off(Be.WS_CONNECTED,w),C(new Q(k.WS_ABORT))};this.once(Be.WS_CONNECTED,w),this.once(Be.WS_CLOSED,D),t!==je.PUBLISH&&t!==je.PUBLISH_DATASTREAM&&t!==je.SUBSCRIBE&&t!==je.SUBSCRIBE_DATASTREAM&&t!==je.UNSUBSCRIBE&&t!==je.UNSUBSCRIBE_DATASTREAM&&t!==je.UNPUBLISH&&t!==je.UNPUBLISH_DATASTREAM&&t!==je.CONTROL&&t!==je.RESTART_ICE||this.once(Be.DISCONNECT_P2P,()=>{C(new Q(k.DISCONNECT_P2P))}),t!==je.PUBLISH&&t!==je.RESTART_ICE||this.once(Be.ABORT_P2P_EXECUTION,()=>{C(new Q(k.DISCONNECT_P2P))})});if(this.connectionState!==Bt.CONNECTING&&this.connectionState!==Bt.RECONNECTING||t===je.JOIN||t===je.REJOIN||await h(),this.websocket.sendMessage(l,!0),o)return;const f=new ve((I,C)=>{let w=!1;const D=(x,K)=>{w=!0,I({isSuccess:x==="success",message:K||{}}),this.off(Be.WS_CLOSED,P),this.off(Be.WS_RECONNECTING,P),this.emit(Be.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),D);const P=()=>{C(new Q(k.WS_ABORT,"type: ".concat(t))),this.off(Be.WS_CLOSED,P),this.off(Be.WS_RECONNECTING,P),this.off("res-@".concat(c),D)};this.once(Be.WS_CLOSED,P),this.once(Be.WS_RECONNECTING,P),Xn(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Be.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await f}catch(I){if(this.connectionState===Bt.CLOSED||t===je.LEAVE)throw new Q(k.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():t===je.JOIN||t===je.REJOIN?null:(await h(),await this.request(t,n))}if(m.isSuccess)return m.message;const g=Number(m.message.error_code||m.message.code),E=Ip(g),y=new Q(k.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(m.message.error_str),{code:g,data:m.message,desc:E.desc});return E.action==="success"?m.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(g,", message: ").concat(E.desc,", action: ").concat(E.action)),g===Le.ERR_TOO_MANY_BROADCASTERS?((t===je.JOIN||t===je.REJOIN)&&(this.initError=y,this.close()),y.throw()):E.action==="failed"?y.throw():E.action==="quit"?(this.initError=y,this.close(),y.throw()):(g===Le.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ir.MULTI_IP)):this.reconnect(E.action,ir.SERVER_ERROR),t===je.JOIN||t===je.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ve(i=>{const o=c=>{(!n||n(c))&&(this.off(t,o),i(c))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(wp.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const c=M("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Bt.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},M("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ve((n,i)=>{this.once(Be.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Be.WS_CLOSED,o=>i(this.initError||new Q(k.WS_ABORT,o))),this.connectionState=Bt.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ct.LEAVE,this.connectionState=Bt.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Be.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await sr(this,Be.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(je.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!n)return this.emit(Be.REPORT_JOIN_GATEWAY,Og.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Be.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Q(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=_p(this,Be.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(je.REJOIN,t);return!!n&&(this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(ot.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(ot.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(ot.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(ot.MUTE_AUDIO,{uid:i.uid}):this.emit(ot.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(ot.MUTE_VIDEO,{uid:i.uid}):this.emit(ot.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(ot.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(ot.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(ot.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(ot.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(ot.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(je.DOWNGRADE_CODEC,n)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ip(t.code);if(t.code===28&&"detail"in t&&(S.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Be.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(n.action,ir.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=M("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>M("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ir.TIMEOUT):this.request(je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),M("REPORT_STATS")&&this.send(je.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(wp.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ze.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Be.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ze.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ze.CLOSED,()=>{this.connectionState=Bt.CLOSED}),this.websocket.on(ze.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=Bt.CLOSED}),this.websocket.on(ze.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Bt.CONNECTED?this.connectionState=Bt.RECONNECTING:this.connectionState=Bt.CONNECTING}),this.websocket.on(ze.WILL_RECONNECT,(t,n,i)=>{const o=_p(this,Be.IS_P2P_DISCONNECTED),c=o||t!=="retry";o&&t==="retry"&&(S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=Og.P2P_DISCONNECTED),c&&(S.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Be.REPORT_JOIN_GATEWAY,n||Og.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Be.DISCONNECT_P2P)),i(t)}),this.websocket.on(ze.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ir.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Be.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Q){if(t.code===k.UNEXPECTED_RESPONSE&&t.data.code===Le.ERR_NO_AUTHORIZED)return this.initError=new Q(k.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ct.TOKEN_EXPIRE);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ir.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(ze.REQUEST_NEW_URLS,(t,n)=>{sr(this,Be.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(nU.PRE_CONNECT_PC,()=>{this.emit(Be.PRE_CONNECT_PC)})}}let Ste=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),En=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function oU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Pg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function lc(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(M("TURN_DOMAIN")):(S.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function Dg(e){try{const t=M("GATEWAY_DOMAINS").concat(M("TURN_DOMAIN")).find(n=>pe(e).call(e,n));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return S.debug("serverUrlToIp error, fallback to url",e),e}}function sC(e,t){e.addresses||(e.addresses=[]);const n=function(u,h){if(M("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return u.map(g=>{let{ip:E,port:y}=g;return{address:"".concat(E,":").concat(y)}});const f=M("GATEWAY_DOMAINS");let m=f[1]&&pe(h).call(h,f[1])?1:0;return u.map(g=>{let{domain_prefix:E,port:y,ip:I}=g;if(E)return{address:"".concat(E,".").concat(f[m++%f.length],":").concat(y)};const C=/^[\.\:\d]+$/.test(I),w=C?"".concat(I.replace(/[^\d]/g,"-"),".").concat(f[m++%f.length],":").concat(y):"".concat(I,":").concat(y);return C||S.debug("Cannot recognized as ip address: ".concat(I,", use as host3")),{ip:I,port:y,address:w}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const u=i.split(";");for(let h=0;h<u.length;h++){var o;const f=Nr(o=u[h]).call(o);n[h]&&f&&(n[h].ip6=f)}}const c=e.detail&&e.detail.candidate;let l;if(c){const[u,h]=c.split(":");u&&h&&(l={port:Number(h),ip:u,address:"".concat(u,":").concat(h)})}return{gatewayAddrs:n,apGatewayAddress:l,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ti(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function aU(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Ti(t.width),"x").concat(Ti(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function cU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Op(e,t){let n,i,o;switch(t){case En.CHOOSE_SERVER:i=4096,o="choose server";break;case En.CLOUD_PROXY:i=1048576,o="proxy";break;case En.CLOUD_PROXY_5:i=4194304,o="proxy5";break;case En.CLOUD_PROXY_FALLBACK:i=4194310,o="proxy fallback";break;default:throw new Q(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(c=>{c.buffer&&c.buffer.flag===i&&(n={code:c.buffer.code,addresses:(c.buffer.edges_services||[]).map(l=>Pg(Pg({},l),{},{ticket:c.buffer.cert})),server_ts:e.enter_ts,uid:c.buffer.uid,cid:c.buffer.cid,cname:c.buffer.cname,detail:Pg(Pg({},c.buffer.detail),e.detail),flag:c.buffer.flag,opid:e.opid,cert:c.buffer.cert})}),!n)throw new Q(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function lU(e,t){return await ve.all(e.addresses.map(async n=>({address:lc(n.ip),tcpport:n.port,udpport:n.port,username:t&&M("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():or.username,password:t&&M("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await o0(t.toString()):or.password})))}function oC(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,o=t.videoWidth||n.width;return i&&o?Math.max(Math.min(i,o)/Math.min(Ti(e.height),Ti(e.width)),1):(S.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function dc(e){let{candidateType:t,relayProtocol:n,type:i,address:o,port:c,protocol:l}=e;const u={candidateType:t,relayProtocol:n,protocol:l};if(i!=="local-candidate"){const h=o.split(".");h.length>=4&&(h[1]="*",h[2]="*"),u.address=h.join("."),u.port=c}return u}function Al(e){const t=e.split(":"),n=e.split(/[-.]/),i=pe(e).call(e,"-")?"-":".";let o=e;return t.length>1?n.length>1?(n[1]="**",o=n[0]+i+"**:"+t[t.length-1]):o=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(o=n[0]+i+"**"),o}function kg(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:M("SVC_MODE");if(M("ENABLE_SVC"))return function(t){return t in ag}(e)?e:ag.L1T3}const dU={[Se.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Se.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function Lg(e,t,n){t.forEach(i=>{var o;const c=dU[e].find(u=>{var h;let{key:f}=u;return pe(h=i.extensionName).call(h,f)});if(!c)return;const l=n.find(u=>{let{extensionName:h}=u;return pe(h).call(h,c.key)});l&&pe(o=l.extensionName).call(o,"gdpr_forbidden")&&(i.extensionName=l.extensionName)})}function Eu(e,t){t.forEach(n=>{var i;const o=dU[e].find(c=>{var l;let{key:u}=c;return pe(l=n.extensionName).call(l,u)});pe(i=n.extensionName).call(i,"gdpr_forbidden")&&o&&(n.extensionName=o.extensionName)})}function uU(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||pe(e).call(e,"abs-send-time")}function Mg(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||pe(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function hU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function pU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Np(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:o,filterVideoFec:c,filterAudioFec:l,filterAudioCodec:u,filterVideoCodec:h,unsupportedVideoUplinkCodec:f,unsupportedVideoDownlinkCodec:m}=t,{useXR:g}=n;let E=[],y=[],I=[],C=[],w=!1,D=!1;if(ii(e).mediaDescriptions.forEach(x=>{i&&i!==x.attributes.direction||(x.media.mediaType!=="video"||w||(y=x.attributes.payloads,C=x.attributes.extmaps,w=!0),x.media.mediaType!=="audio"||D||(E=x.attributes.payloads,I=x.attributes.extmaps,D=!0))}),!C||y.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||E.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(x=>{var K;(K=x.rtpMap)!==null&&K!==void 0&&K.clockRate&&(x.rtpMap.clockRate=parseInt(x.rtpMap.clockRate)),g&&x.rtcpFeedbacks.push({type:"rrtr"})}),E.forEach(x=>{var K;(K=x.rtpMap)!==null&&K!==void 0&&K.clockRate&&(x.rtpMap.clockRate=parseInt(x.rtpMap.clockRate)),g&&x.rtcpFeedbacks.push({type:"rrtr"})}),o&&(E=E.filter(x=>{var K;return((K=x.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())!=="rtx"}),y=y.filter(x=>{var K;return((K=x.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())!=="rtx"})),c){const x=y.filter(j=>{var J;return/(red)|(ulpfec)|(flexfec)/i.test(((J=j.rtpMap)===null||J===void 0?void 0:J.encodingName)||"")}),K=hc(x,y).map(j=>j.payloadType),H=[...x.map(j=>j.payloadType),...K];y=y.filter(j=>!pe(H).call(H,j.payloadType))}if(l&&(E=E.filter(x=>{var K;return!/(red)|(ulpfec)|(flexfec)/i.test(((K=x.rtpMap)===null||K===void 0?void 0:K.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(E=E.filter(x=>{var K;return pe(u).call(u,((K=x.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())||"")})),h&&(h==null?void 0:h.length)>0){const x=y.filter(K=>{var H;return pe(h).call(h,((H=K.rtpMap)===null||H===void 0?void 0:H.encodingName.toLowerCase())||"")});y=x.concat(o?[]:hc(x,y))}const P=M("UNSUPPORTED_VIDEO_CODEC");if(P&&P.length>0){const x=y.filter(j=>j.rtpMap&&pe(P).call(P,j.rtpMap.encodingName.toLowerCase())),K=hc(x,y),H=x.concat(K).map(j=>j.payloadType);y=y.filter(j=>!pe(H).call(H,j.payloadType)),S.debug("unsupportedVideoCodec: ".concat(P,", toBeRemoved: ").concat(H))}if(f&&f.length>0&&i==="sendonly"){const x=y.filter(j=>j.rtpMap&&pe(f).call(f,j.rtpMap.encodingName.toLowerCase())),K=hc(x,y),H=x.concat(K).map(j=>j.payloadType);y=y.filter(j=>!pe(H).call(H,j.payloadType)),S.debug("unsupportedVideoUplinkCodec: ".concat(f,", toBeRemoved: ").concat(H))}if(m&&m.length>0&&i==="recvonly"){const x=y.filter(j=>j.rtpMap&&pe(m).call(m,j.rtpMap.encodingName.toLowerCase())),K=hc(x,y),H=x.concat(K).map(j=>j.payloadType);y=y.filter(j=>!pe(H).call(H,j.payloadType)),S.debug("unsupportedVideoDownlinkCodec: ".concat(m,", toBeRemoved: ").concat(H))}return{audioCodecs:E,videoCodecs:y,audioExtensions:I,videoExtensions:C}}function uc(e){const t=ii(e);let n,i;for(const o of t.mediaDescriptions){if(!n){const c=o.attributes.iceUfrag,l=o.attributes.icePwd;if(!c||!l)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:c,icePwd:l}}if(!i){const c=o.attributes.fingerprints;c.length>0&&(i={fingerprints:c})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function fU(e,t){const n=[],i=e.attributes.ssrcGroups.filter(l=>l.semantic==="FID"),o=e.attributes.ssrcGroups.find(l=>l.semantic==="SIM"),c=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(l=>{var u;const h=(u=i.find(f=>f.ssrcIds[0]===l))===null||u===void 0?void 0:u.ssrcIds[1];n.push({ssrcId:l,rtx:t?h:void 0})});else if(i.length>0){const l=i[0].ssrcIds[0],u=i[0].ssrcIds[1];n.push({ssrcId:l,rtx:t?u:void 0})}else{if(c.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:c[0].ssrcId})}return n}function mU(e,t,n){const{cname:i}=e;let o=[];t&&(o=_U(t)),o.length===0&&(o=e.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),S.debug("Using candidates from gateway."));const c={fingerprints:e.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},l={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let u;switch(e.dtlsParameters.role){case"server":u="passive";break;case"client":u="active";break;case"auto":u="actpass"}const h=Ug(e.rtpCapabilities),f=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{f.push({kind:Se.VIDEO,ssrcMsg:[{ssrcId:m.v,rtx:m.v_rtx}],mslabel:"".concat(m.v,"_").concat(m.a)},{kind:Se.AUDIO,ssrcMsg:[{ssrcId:m.a}],mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:c,iceParameters:l,candidates:o,rtpCapabilities:h,setup:u,cname:i,preSSRCs:f}}function _U(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(Al(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(Al(e.ip6),":").concat(e.port)))),t}function Pp(e,t,n){const i=[],o=[];return e.forEach(c=>{let{ssrcId:l,rtx:u}=c;const h=Ut(8,"track-"),f={ssrcId:l,attributes:pU({label:h,mslabel:n=n||Ut(10,""),msid:"".concat(n," ").concat(h)},t&&{cname:t})};if(i.push(f),u!==void 0){const m={ssrcId:u,attributes:pU({label:h,mslabel:n,msid:"".concat(n," ").concat(h)},t&&{cname:t})};i.push(m),o.push({semantic:"FID",ssrcIds:[l,u]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(c=>{let{ssrcId:l}=c;return l})}),{ssrcs:i,ssrcGroups:o}}function vu(e,t){t instanceof dn&&e.attributes.payloads.forEach(n=>{var i;const o=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),o==="opus"&&typeof M("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=M("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const c=t._encoderConfig;c&&(o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(c.bitrate&&!sn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*c.bitrate))),c.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(c.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(c.sampleRate)),c.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Rp&&o==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function aC(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function cC(e,t){var n;if(!(t instanceof Wt&&t._encoderConfig&&t._hints.indexOf(kt.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;ft().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(o=>{var c,l;pe(c=["h264","h265","vp8","vp9","av1"]).call(c,((l=o.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),ft().supportMinBitrate&&!pe(n=t._hints).call(n,kt.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(o=>{var c,l;pe(c=["h264","h265","vp8","vp9","av1"]).call(c,((l=o.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat(M("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function gU(e){if(e.media.mediaType!=="video")return;const t=dt();if(t.name!==gt.SAFARI&&t.os!==xn.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function xg(e,t,n){if(!t)return;let i,o;if(e.media.mediaType==="video"?(i=n.videoExtensions,o=n.videoCodecs):(i=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){const c=i.find(l=>Mg(l.extensionName));if(c){const l=c.extensionName;e.attributes.extmaps.find(h=>Mg(h.extensionName))||e.attributes.extmaps.push({entry:c.entry,extensionName:l}),function(h,f){return f.filter(m=>!!h.find(g=>g.payloadType===m.payloadType&&!!g.rtcpFeedbacks.find(E=>E.type==="transport-cc")))}(o,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>f.type==="transport-cc")||h.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const c=e.attributes.extmaps.findIndex(l=>Mg(l.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){const c=i.find(l=>uU(l.extensionName));if(c){const l=c.extensionName;e.attributes.extmaps.find(h=>h.extensionName===l)||e.attributes.extmaps.push({entry:c.entry,extensionName:l}),function(h,f){return f.filter(m=>!!h.find(g=>g.payloadType===m.payloadType&&!!g.rtcpFeedbacks.find(E=>E.type==="goog-remb")))}(o,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>f.type==="goog-remb")||h.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const c=e.attributes.extmaps.findIndex(l=>uU(l.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}}function EU(e,t,n){if(sn()||e.media.mediaType!=="video"||!(t instanceof Wt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!M("SIMULCAST")||n==="vp9"&&M("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,o=e.attributes.ssrcs[0],c=e.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===o.ssrcId),l={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let u=1;u<i;u++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+u,attributes:$t(o.attributes)}),l.ssrcIds.push(o.ssrcId+u),c&&(e.attributes.ssrcs.push({ssrcId:c.ssrcIds[1]+u,attributes:$t(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+u,c.ssrcIds[1]+u]}));e.attributes.ssrcGroups.unshift(l)}async function vU(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:o,recv:c,sendrecv:l}=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const m=Np(f,u,h,"sendonly"),g=Np(f,u,h,"recvonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Us(m,g,"videoExtensions",E,y,I),Us(m,g,"videoCodecs",E,y,I),Us(m,g,"audioExtensions",E,y,I),Us(m,g,"audioCodecs",E,y,I),M("RAISE_H264_BASELINE_PRIORITY")){const C=[],w=[];if(I.videoCodecs.forEach((D,P)=>{var x;if(((x=D.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"){var K,H;const j=I.videoCodecs[P+1],J=j&&CU(D,j),re=(K=D.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"],se=(H=D.fmtp)===null||H===void 0?void 0:H.parameters["packetization-mode"];!re||re!==M("FIRST_H264_PROFILE_LEVEL_ID")||M("FIRST_PACKETIZATION_MODE")&&se!==M("FIRST_PACKETIZATION_MODE")?J?w.push([D,j]):w.push([D]):J?C.push([D,j]):C.push([D])}}),C.length>0&&w.length>0){S.debug("raising H264 baseline profile priority"),I.videoCodecs.forEach((P,x)=>{var K;if(((K=P.rtpMap)===null||K===void 0?void 0:K.encodingName.toLocaleLowerCase())==="h264"){const H=CU(P,I.videoCodecs[x+1]),j=C.shift()||w.shift()||[];j.length>0&&(H?I.videoCodecs.splice(x,2,...j):I.videoCodecs.splice(x,1,...j))}});const D=y.videoCodecs.filter(P=>{var x,K;return((x=P.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"&&((K=P.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==M("FIRST_H264_PROFILE_LEVEL_ID")});if(D.length>0){const P=hc(D,y.videoCodecs).map(K=>K.payloadType),x=[...D.map(K=>K.payloadType),...P];y.videoCodecs=y.videoCodecs.filter(K=>!pe(x).call(x,K.payloadType))}M("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(P=>{var x,K;return!(((x=P.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"&&((K=P.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==M("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:E,recv:y,sendrecv:I}}return{send:E,recv:y,sendrecv:I}}(e,t,i);try{n.close()}catch{}return{send:o,recv:c,sendrecv:l}}function yU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Np(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Us(e,t,"videoExtensions",n,i,o),Us(e,t,"videoCodecs",n,i,o),Us(e,t,"audioExtensions",n,i,o),Us(e,t,"audioCodecs",n,i,o),M("RAISE_H264_BASELINE_PRIORITY")){const c=o.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]==="42001f");if(c!==-1){const l=o.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(l<c){S.debug("raising H264 baseline profile priority");const u=o.videoCodecs[c];o.videoCodecs.splice(c,1),o.videoCodecs.splice(l,0,u)}l!==-1&&(i.videoCodecs=i.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:o}}function Us(e,t,n,i,o,c){if(n==="videoExtensions"||n==="audioExtensions"){const l=[];return e[n].forEach(u=>{t[n].some((h,f)=>{if(u.entry===h.entry&&u.extensionName===h.extensionName)return l.push(f),!0})?c[n].push(u):i[n].push(u)}),void t[n].forEach((u,h)=>{l.indexOf(h)===-1&&o[n].push(u)})}if(n==="videoCodecs"||n==="audioCodecs"){const l=[];return e[n].forEach(u=>{t[n].some((h,f)=>{if(u.payloadType===h.payloadType&&JSON.stringify(u)===JSON.stringify(h))return l.push(f),!0})?c[n].push(u):i[n].push(u)}),void t[n].forEach((u,h)=>{l.indexOf(h)===-1&&o[n].push(u)})}}function Ug(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,c;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...i.audioCodecs],o.videoCodecs=[...t.videoCodecs,...i.videoCodecs],o.audioExtensions=[...t.audioExtensions,...i.audioExtensions],o.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):o=i,n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...i.audioCodecs],c.videoCodecs=[...n.videoCodecs,...i.videoCodecs],c.audioExtensions=[...n.audioExtensions,...i.audioExtensions],c.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):c=i,{send:o,recv:c}}function yu(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Dp(e,t,n,i){let o=[];if(e===Se.VIDEO){if(M("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(o=t.videoCodecs.filter(c=>{var l;return pe(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,i)&&c&&c.fmtp&&c.fmtp.parameters["profile-level-id"]===M("H264_PROFILE_LEVEL_ID")})),!Array.isArray(o)||o.length===0){let c=[];const l=[],u=[],h=[];if(n.videoCodecs.forEach(f=>{const m=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";pe(m).call(m,i)?c.push(f):pe(m).call(m,"vp9")?l.push(f):pe(m).call(m,"vp8")?u.push(f):pe(m).call(m,"h264")&&h.push(f)}),c.length===0){let f="";l.length!==0?(c=l,f="vp9"):u.length!==0?(c=u,f="vp8"):h.length!==0&&(c=h,f="h264"),S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}c.length!==0&&(o=t.videoCodecs.filter(f=>c.some(m=>m.payloadType===f.payloadType)))}if(o.length===0&&(S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),o=t.videoCodecs),M("USE_PUB_RTX")||M("USE_SUB_RTX")){const c=hc(o,t.videoCodecs);o=[...o,...c]}}else{o=t.audioCodecs.filter(l=>{var u;return pe(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,i)});const c=t.audioCodecs.filter(l=>{var u;return pe(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"red")});o.length===0&&(S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),o=t.audioCodecs.filter(l=>{var u;return pe(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"opus")})),M("ENABLE_AUDIO_RED")&&c.length!==0&&(o=[...c,...o])}return o}function hc(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&pe(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function pc(e,t,n){const i=t.toString(),o=TU(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const c=await e.createAnswer();if(!c.sdp)throw new Error("cannot get answer sdp");let l=c.sdp;l=SU(l,n||{}),o==null||o(l||""),await e.setLocalDescription({type:"answer",sdp:l})}function SU(e,t,n){const i=ii(e),{useXR:o}=t;return i.mediaDescriptions.forEach(c=>{var l;c.attributes.mid&&(Array.isArray(n)&&!pe(n).call(n,c.attributes.mid)||(c.media.mediaType==="audio"&&yu(c),o&&pe(l=["audio","video"]).call(l,c.media.mediaType)&&c.attributes.payloads.forEach(u=>{u.rtcpFeedbacks.findIndex(h=>h.type==="rrtr")===-1&&u.rtcpFeedbacks.push({type:"rrtr"})})))}),sc(i)}function TU(e,t,n,i){if(M("SDP_LOGGING"))return S.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?o=>{TU(o,"answer",n==="local"?"remote":"local",i)}:void 0}function RU(e){const t=M("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>pe(e).call(e,n))}function CU(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function wU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Wi(e,t){return typeof M(e)===t?M(e):void 0}function Tte(){try{const e=M("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?wU(Object(i),!0).forEach(function(o){O(t,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):wU(Object(i)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(i,o))})}return t}({},e)}catch(e){return S.debug("handle gateway attributes failed: ",e),{}}}const bU={};function fc(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&S.debug("install service ".concat(e.name)),bU[e.name]=e}function Ta(e){const t=bU[e];if(!t)throw new ne(k.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function IU(e,t){return Ta("DataStream").create(e,t)}function Vg(){return Ta("InterceptFrame").create()}function AU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Tr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const lC=new Map;class Rte extends nn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Wn.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Wn.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){S.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var i,o,c;super(),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"key",void 0),O(this,"ntpOffset",0),O(this,"signal",void 0),O(this,"role",void 0),O(this,"isPreallocation",void 0),O(this,"isPreSub",void 0),O(this,"inChannelInfo",{joinAt:null,duration:0}),O(this,"spec",void 0),O(this,"_state","DISCONNECTED"),O(this,"_statsCollector",void 0),O(this,"_disconnectedReason",void 0),O(this,"isSignalRecover",!1),O(this,"hasChangeBGPAddress",!1),O(this,"trafficStatsInterval",void 0),O(this,"networkQualityInterval",void 0),O(this,"_joinGatewayStartTime",0),O(this,"_signalTimeout",!1),O(this,"_clientRoleOptions",void 0),O(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(i={spec:Tr(Tr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(o=(c=Ta("P2PChannel")).createSubmodule)===null||o===void 0?void 0:o.call(c,i)):new yte(Tr(Tr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,i){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let c=lC.get(t.cname);if(c||(c=new Map,lC.set(t.cname,c)),this._isProactiveJoin=!0,c.has(t.uid)){const f=new Q(k.UID_CONFLICT);throw be.joinGateway(t.sid,{lts:o,succ:!1,ec:f.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),f}c.set(t.uid,!0),this.joinInfo=t,this.key=n;let l=0;this.joinGatewayStartTime=o;const u=t.proxyServer;try{S.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(l));const f=t.gatewayAddrs.map(m=>{let{address:g}=m;const[E,y]=g.split(":"),I={host:E,port:y};return t.proxyServer&&(I.proxy=t.proxyServer),I});l=(await this.signal.init(f)).uid,S.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(l," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(f){var h;throw S.error("[".concat(this.store.clientId,"] User join failed"),f.toString()),be.joinGateway(t.sid,{lts:o,succ:!1,ec:((h=f.data)===null||h===void 0?void 0:h.desc)||f.code,errorMsg:f.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!u,signalChannel:"0",preload:t.preload}),c.delete(t.uid),this.signal.close(),f}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(f=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),f.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Wn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Wn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Wn.NETWORK_QUALITY,{uplinkNetworkQuality:cU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:cU(this._statsCollector.trafficStats.B_dnq)}):this.emit(Wn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),l}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ct.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Bt.CONNECTED||await function(i,o){return o===1/0?i:ve.race([i,qZ(o)])}(this.signal.request(je.LEAVE,void 0,!0),3e3)}catch(i){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:M("PUB_EXTEND"),twcc:!!M("PUBLISH_TWCC"),rtx:!!M("USE_PUB_RTX")};try{return(await this.signal.request(je.PUBLISH,o,!0))._message}catch(c){if(i&&c.data&&c.data.code===Le.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),c.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw c}}async publishDataChannel(t,n,i){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(o=n.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(je.PUBLISH_DATASTREAM,c,!0)}catch(l){if(i&&l.data&&l.data.code===Le.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),l.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw l}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(je.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){S.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ve.all(t.map(n=>this.signal.request(je.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){S.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!M("SUBSCRIBE_TWCC"),rtx:!!M("USE_SUB_RTX")||void 0,extend:M("SUB_EXTEND"),svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return await this.signal.request(je.PRE_SUBSCRIBE,o,!0)}catch(c){if(i&&c.data&&c.data.code===Le.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),c.toString()),this.presubscribe(t,n,!1);throw c}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!M("SUBSCRIBE_TWCC"),rtx:!!M("USE_SUB_RTX"),extend:M("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return(await this.signal.request(je.SUBSCRIBE,o,!0))._message}catch(c){if(i&&c.data&&c.data.code===Le.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),c.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw c}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const o={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(je.SUBSCRIBE_DATASTREAM,o,!0)}catch(c){if(i&&c.data&&c.data.code===Le.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),c.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw c}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!M("USE_SUB_RTX"),twcc:!!M("SUBSCRIBE_TWCC"),svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return await this.signal.request(je.SUBSCRIBE_STREAMS,i,!0)}catch(o){if(n&&o.data&&o.data.code===Le.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let o=i.frameRate,c=i.width,l=i.height,u=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(u=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,o||(u=!1)),u?{stream_type:0,width:c,height:l,fps:o,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(je.SET_VIDEO_PROFILE,n);S.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(je.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){S.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ve.all(t.map(i=>this.signal.request(je.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){S.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(je.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){S.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(je.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(je.GATEWAY_INFO)}async renewToken(t){await this.signal.request(je.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),M("CLIENT_ROLE_OPTIONS")&&(S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(M("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},M("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),M("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},M("CLIENT_ROLE_OPTIONS")),S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(M("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,o=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0;const c=Object.assign({},n);delete c.delay,delete c.level,await this.signal.request(je.SET_CLIENT_ROLE,Tr(Tr({role:t,level:o,delay:i},c),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(je.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(je.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(je.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(je.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(je.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Tr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(je.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=lC.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:or.username,password:or.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Tr(Tr({},or),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(je.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&rg(()=>{this.emit(Wn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,i;if(!this.joinInfo||!this.key)throw new Q(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let c=M("REPORT_APP_SCENARIO");if(typeof c!="string")try{c=JSON.stringify(c)}catch{c=void 0}var l;c&&c.length>128&&(c=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Wn.UPDATE_GATEWAY_CONFIG),l=this.store.clientId,pe(pu).call(pu,l)||pu.push(l);const u=C0(this.store),h=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),f=PM(this.store),m=Tte(),g=qd(87)||FL()||QR(117),E=(function(){const I=dt();if(I.name!==gt.SAFARI||!I.browserVersion)return!1;const C=I.browserVersion.split(".");return Number(C[0])>18||Number(C[0])===18&&Number(C[1])>=4}()||HL(18,4,!1))&&ZR(18,6,!0)&&this.spec.codec==="h264"&&M("ENABLE_ABSSENDTIME_AS_SENTTS"),y=Tr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Zi,browser:navigator.userAgent,process_id:M("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:M("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:c,attributes:{userAttributes:Tr(Tr({enableEncodedTransform:(!!M("ENABLE_AUDIO_METADATA")||!!M("ENABLE_AUDIO_PTS"))&&g||!!M("ENABLE_AUDIO_TOPN")&&JR(gt.CHROME,87,116)||void 0,enableAudioMetadata:!!M("ENABLE_AUDIO_METADATA")&&g,enableAudioPts:!!M("ENABLE_AUDIO_PTS")&&g,topnSmoothLevel:M("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:M("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:M("TOPN_SWITCH_HOLD_MS"),topnAudioGain:M("TOPN_AUDIO_GAIN"),enablePublishedUserList:M("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:M("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Wi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Wi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Wi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:M("USE_PUB_RTX")===!0||M("USE_SUB_RTX")===!0||void 0,disableFEC:M("DISABLE_FEC"),enableNTPReport:!!M("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:f,enableFulllinkAvSync:!!M("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Wi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!M("FORCE_ENABLE_AUT_CC")||!dg()&&(!!M("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!M("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Wi("USE_XR","boolean"),enableLossbasedBwe:Wi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!M("FORCE_ENABLE_AUT_CC")||!dg()&&(!!M("ENABLE_AUT_CC")||void 0),enableCCFallback:Wi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Wi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Wi("PUBLISH_TWCC","boolean"),enableSubTWCC:Wi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Wi("USE_PUB_RTX","boolean"),enableSubRTX:Wi("USE_SUB_RTX","boolean"),enableSubSVC:M("ENABLE_SVC")?M("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0,enableSvcExtended:M("ENABLE_SVC")&&Array.isArray(M("SVC_EXTENDED"))&&M("SVC_EXTENDED").length!==0?M("SVC_EXTENDED"):void 0},m),{},{audioDuplicate:Wi("ENABLE_AUDIO_RED","boolean")?(i=Wi("AUDIO_DUPLICATE_NUM","number"))!==null&&i!==void 0?i:2:void 0,senttsUsesAbsSendTime:!!E||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,M("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new Q(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Be.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Be.WS_RECONNECTING,t=>{this.joinInfo&&be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||ir.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",be.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Be.WS_CLOSED,t=>{let n;switch(t){case Ct.LEAVE:n=ir.LEAVE;break;case Ct.UID_BANNED:case Ct.IP_BANNED:case Ct.CHANNEL_BANNED:case Ct.SERVER_ERROR:n=ir.SERVER_ERROR;break;case Ct.FALLBACK:n=ir.FALLBACK;break;case Ct.LICENSE_MISSING:case Ct.LICENSE_EXPIRED:case Ct.LICENSE_MINUTES_EXCEEDED:case Ct.LICENSE_PERIOD_INVALID:case Ct.LICENSE_MULTIPLE_SDK_SERVICE:case Ct.LICENSE_ILLEGAL:case Ct.TOKEN_EXPIRE:n=t;break;default:n=ir.NETWORK_ERROR}S.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+ir.NETWORK_ERROR)),this.joinInfo&&be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ct.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Be.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=M("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(S.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void S.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Ot("EVENT_REPORT_DOMAIN",t[1]),Ot("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Ot("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(ot.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Be.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new Q(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,sr(this,Wn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Be.REQUEST_JOIN_INFO,async(t,n,i)=>{var o,c,l;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const u=$t((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if(M("NEW_TURN_MODE")&&u&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var h;let E=u.servers.map(C=>"turnServerURL"in C&&M("USE_TURN_IP")?Tr(Tr({},C),{},{turnServerURL:Dg(C.turnServerURL)}):C),y=(h=u.serversFromGateway)===null||h===void 0?void 0:h.map(C=>M("USE_TURN_IP")?Tr(Tr({},C),{},{turnServerURL:Dg(C.turnServerURL)}):C);const I=this.signal.currentURLIndex;E.length>0&&(E=[E[I%E.length]],u.servers=E),Array.isArray(y)&&y.length>0&&(y=[y[0]],u.serversFromGateway=y),S.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(I))}const{iceParameters:f,dtlsParameters:m,rtpCapabilities:g}=await sr(this,Wn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u,cloudProxyServer:(l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:m,rtpCapabilities:g,version:"2"}}))}catch(E){n(E)}}),this.signal.on(Be.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Be.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let i,o="";var c;t instanceof Q?(i=((c=t.data)===null||c===void 0?void 0:c.desc)||t.code,o=t.message):i=t,be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:o,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Be.IS_P2P_DISCONNECTED,t=>{t(_p(this,Wn.IS_P2P_DISCONNECTED))}),this.signal.on(Be.DISCONNECT_P2P,()=>{this.emit(Wn.DISCONNECT_P2P)}),this.signal.on(Be.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Be.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Be.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Wn.JOIN_RESPONSE,t,n)}),this.signal.on(Be.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const o=this.getCurrentGatewayAddress(),c=$t((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(M("NEW_TURN_MODE")&&c&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var i;let u=c.servers.map(m=>"turnServerURL"in m&&M("USE_TURN_IP")?Tr(Tr({},m),{},{turnServerURL:Dg(m.turnServerURL)}):m),h=(i=c.serversFromGateway)===null||i===void 0?void 0:i.map(m=>M("USE_TURN_IP")?Tr(Tr({},m),{},{turnServerURL:Dg(m.turnServerURL)}):m);const f=this.signal.currentURLIndex;u.length>0&&(u=[u[f%u.length]],c.servers=u),Array.isArray(h)&&h.length>0&&(h=[h[0]],c.serversFromGateway=h),S.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(f,",in pre pc"))}const l=M("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(o&&l){const u=_U(o);this.emit(Wn.PRE_CONNECT_PC,{candidates:u,fingerprint:l,turnServer:c})}}}),this.signal.on(Be.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof M("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(M("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(je.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(je.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw S.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(je.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(je.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw S.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(je.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(o=>o.stream_type===bt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(je.CONTROL,i,!0,!0)}catch(o){throw S.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,n){const i={action:t.find(o=>o.stream_type===bt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(je.CONTROL,i,!0,!0)}catch(o){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(t,n){const i={action:t===Se.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(je.CONTROL,i,!0,!0)}catch(o){throw S.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(t,n){const i={action:t===Se.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(je.CONTROL,i,!0,!0)}catch(o){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(je.RESTART_ICE,n,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||ir.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!M("GATEWAY_WSS_ADDRESS"))return M("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(S.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(je.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let jg=0,dC=0;function fo(e,t,n,i){return new ve((o,c)=>{t.timeout=t.timeout||M("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),jg+=jo(t.data)):n&&(t.data.size?jg+=t.data.size:t.data instanceof FormData?jg+=oM(t.data):jg+=jo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Yr.request(t).then(l=>{typeof l.data=="string"?dC+=jo(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?dC+=l.data.byteLength:dC+=jo(JSON.stringify(l.data)),i&&o({data:l.data,headers:l.headers}),o(l.data)}).catch(l=>{Yr.isCancel(l)?c(new Q(k.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?c(new Q(k.NETWORK_TIMEOUT,l.message)):l.response?c(new Q(k.NETWORK_RESPONSE_ERROR,l.response.status)):c(new Q(k.NETWORK_ERROR,l.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(ie){var he=0;return function(){return he<ie.length?{done:!1,value:ie[he++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(ie,he,Te){return ie==Array.prototype||ie==Object.prototype||(ie[he]=Te.value),ie},i,o=function(ie){ie=[typeof globalThis=="object"&&globalThis,ie,typeof window=="object"&&window,typeof self=="object"&&self,typeof d=="object"&&d];for(var he=0;he<ie.length;++he){var Te=ie[he];if(Te&&Te.Math==Math)return Te}throw Error("Cannot find global object")}(this);function c(ie,he){if(he)e:{var Te=o;ie=ie.split(".");for(var oe=0;oe<ie.length-1;oe++){var R=ie[oe];if(!(R in Te))break e;Te=Te[R]}(he=he(oe=Te[ie=ie[ie.length-1]]))!=oe&&he!=null&&n(Te,ie,{configurable:!0,writable:!0,value:he})}}function l(ie){return(ie={next:ie})[Symbol.iterator]=function(){return this},ie}function u(ie){var he=typeof Symbol<"u"&&Symbol.iterator&&ie[Symbol.iterator];return he?he.call(ie):{next:t(ie)}}if(c("Symbol",function(ie){function he(R,V){this.A=R,n(this,"description",{configurable:!0,writable:!0,value:V})}if(ie)return ie;he.prototype.toString=function(){return this.A};var Te="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",oe=0;return function R(V){if(this instanceof R)throw new TypeError("Symbol is not a constructor");return new he(Te+(V||"")+"_"+oe++,V)}}),c("Symbol.iterator",function(ie){if(ie)return ie;ie=Symbol("Symbol.iterator");for(var he="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Te=0;Te<he.length;Te++){var oe=o[he[Te]];typeof oe=="function"&&typeof oe.prototype[ie]!="function"&&n(oe.prototype,ie,{configurable:!0,writable:!0,value:function(){return l(t(this))}})}return ie}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var h;e:{var f={};try{f.__proto__={a:!0},h=f.a;break e}catch{}h=!1}i=h?function(ie,he){if(ie.__proto__=he,ie.__proto__!==he)throw new TypeError(ie+" is not extensible");return ie}:null}var m=i;function g(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function E(ie){if(ie.m)throw new TypeError("Generator is already running");ie.m=!0}function y(ie,he){return ie.h=3,{value:he}}function I(ie){this.g=new g,this.G=ie}function C(ie,he,Te,oe){try{var R=he.call(ie.g.j,Te);if(!(R instanceof Object))throw new TypeError("Iterator result "+R+" is not an object");if(!R.done)return ie.g.m=!1,R;var V=R.value}catch(G){return ie.g.j=null,ie.g.s(G),w(ie)}return ie.g.j=null,oe.call(ie.g,V),w(ie)}function w(ie){for(;ie.g.h;)try{var he=ie.G(ie.g);if(he)return ie.g.m=!1,{value:he.value,done:!1}}catch(Te){ie.g.v=void 0,ie.g.s(Te)}if(ie.g.m=!1,ie.g.l){if(he=ie.g.l,ie.g.l=null,he.F)throw he.D;return{value:he.return,done:!0}}return{value:void 0,done:!0}}function D(ie){this.next=function(he){return ie.o(he)},this.throw=function(he){return ie.s(he)},this.return=function(he){return function(Te,oe){E(Te.g);var R=Te.g.j;return R?C(Te,"return"in R?R.return:function(V){return{value:V,done:!0}},oe,Te.g.return):(Te.g.return(oe),w(Te))}(ie,he)},this[Symbol.iterator]=function(){return this}}function P(ie,he){return he=new D(new I(he)),m&&ie.prototype&&m(he,ie.prototype),he}if(g.prototype.o=function(ie){this.v=ie},g.prototype.s=function(ie){this.l={D:ie,F:!0},this.h=this.C||this.u},g.prototype.return=function(ie){this.l={return:ie},this.h=this.u},I.prototype.o=function(ie){return E(this.g),this.g.j?C(this,this.g.j.next,ie,this.g.o):(this.g.o(ie),w(this))},I.prototype.s=function(ie){return E(this.g),this.g.j?C(this,this.g.j.throw,ie,this.g.o):(this.g.s(ie),w(this))},c("Array.prototype.entries",function(ie){return ie||function(){return function(he,Te){he instanceof String&&(he+="");var oe=0,R=!1,V={next:function(){if(!R&&oe<he.length){var G=oe++;return{value:Te(G,he[G]),done:!1}}return R=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}(this,function(he,Te){return[he,Te]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var x=function(ie,he){for(var Te=0;Te<ie.length;Te++)he(ie[Te])},K=function(ie){return ie.replace(/\r?\n|\r/g,`\r
`)},H=function(ie,he,Te){return he instanceof Blob?(Te=Te!==void 0?Te+"":typeof he.name=="string"?he.name:"blob",he.name===Te&&Object.prototype.toString.call(he)!=="[object Blob]"||(he=new File([he],Te)),[String(ie),he]):[String(ie),String(he)]},j=function(ie,he){if(ie.length<he)throw new TypeError(he+" argument required, but only "+ie.length+" present.")},J=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,re=J.FormData,se=J.XMLHttpRequest&&J.XMLHttpRequest.prototype.send,le=J.Request&&J.fetch,Je=J.navigator&&J.navigator.sendBeacon,nt=J.Element&&J.Element.prototype,Fe=J.Symbol&&Symbol.toStringTag;Fe&&(Blob.prototype[Fe]||(Blob.prototype[Fe]="Blob"),"File"in J&&!File.prototype[Fe]&&(File.prototype[Fe]="File"));try{new File([],"")}catch{J.File=function(he,Te,oe){return he=new Blob(he,oe||{}),Object.defineProperties(he,{name:{value:Te},lastModified:{value:+(oe&&oe.lastModified!==void 0?new Date(oe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Fe&&Object.defineProperty(he,Fe,{value:"File"}),he}}var Rt=function(ie){return ie.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},yt=function(ie){this.i=[];var he=this;ie&&x(ie.elements,function(Te){if(Te.name&&!Te.disabled&&Te.type!=="submit"&&Te.type!=="button"&&!Te.matches("form fieldset[disabled] *"))if(Te.type==="file"){var oe=Te.files&&Te.files.length?Te.files:[new File([],"",{type:"application/octet-stream"})];x(oe,function(R){he.append(Te.name,R)})}else Te.type==="select-multiple"||Te.type==="select-one"?x(Te.options,function(R){!R.disabled&&R.selected&&he.append(Te.name,R.value)}):Te.type==="checkbox"||Te.type==="radio"?Te.checked&&he.append(Te.name,Te.value):(oe=Te.type==="textarea"?K(Te.value):Te.value,he.append(Te.name,oe))})};if((e=yt.prototype).append=function(ie,he,Te){j(arguments,2),this.i.push(H(ie,he,Te))},e.delete=function(ie){j(arguments,1);var he=[];ie=String(ie),x(this.i,function(Te){Te[0]!==ie&&he.push(Te)}),this.i=he},e.entries=function ie(){var he,Te=this;return P(ie,function(oe){if(oe.h==1&&(he=0),oe.h!=3)return he<Te.i.length?oe=y(oe,Te.i[he]):(oe.h=0,oe=void 0),oe;he++,oe.h=2})},e.forEach=function(ie,he){j(arguments,1);for(var Te=u(this),oe=Te.next();!oe.done;oe=Te.next()){var R=u(oe.value);oe=R.next().value,R=R.next().value,ie.call(he,R,oe,this)}},e.get=function(ie){j(arguments,1);var he=this.i;ie=String(ie);for(var Te=0;Te<he.length;Te++)if(he[Te][0]===ie)return he[Te][1];return null},e.getAll=function(ie){j(arguments,1);var he=[];return ie=String(ie),x(this.i,function(Te){Te[0]===ie&&he.push(Te[1])}),he},e.has=function(ie){j(arguments,1),ie=String(ie);for(var he=0;he<this.i.length;he++)if(this.i[he][0]===ie)return!0;return!1},e.keys=function ie(){var he,Te,oe,R,V=this;return P(ie,function(G){if(G.h==1&&(he=u(V),Te=he.next()),G.h!=3)return Te.done?void(G.h=0):(oe=Te.value,R=u(oe),y(G,R.next().value));Te=he.next(),G.h=2})},e.set=function(ie,he,Te){j(arguments,2),ie=String(ie);var oe=[],R=H(ie,he,Te),V=!0;x(this.i,function(G){G[0]===ie?V&&(V=!oe.push(R)):oe.push(G)}),V&&oe.push(R),this.i=oe},e.values=function ie(){var he,Te,oe,R,V=this;return P(ie,function(G){if(G.h==1&&(he=u(V),Te=he.next()),G.h!=3)return Te.done?void(G.h=0):(oe=Te.value,(R=u(oe)).next(),y(G,R.next().value));Te=he.next(),G.h=2})},yt.prototype._asNative=function(){for(var ie=new re,he=u(this),Te=he.next();!Te.done;Te=he.next()){var oe=u(Te.value);Te=oe.next().value,oe=oe.next().value,ie.append(Te,oe)}return ie},yt.prototype._blob=function(){var ie="----formdata-polyfill-"+Math.random(),he=[],Te="--"+ie+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(oe,R){return typeof oe=="string"?he.push(Te+Rt(K(R))+`"\r
\r
`+K(oe)+`\r
`):he.push(Te+Rt(K(R))+'"; filename="'+Rt(oe.name)+`"\r
Content-Type: `+(oe.type||"application/octet-stream")+`\r
\r
`,oe,`\r
`)}),he.push("--"+ie+"--"),new Blob(he,{type:"multipart/form-data; boundary="+ie})},yt.prototype[Symbol.iterator]=function(){return this.entries()},yt.prototype.toString=function(){return"[object FormData]"},nt&&!nt.matches&&(nt.matches=nt.matchesSelector||nt.mozMatchesSelector||nt.msMatchesSelector||nt.oMatchesSelector||nt.webkitMatchesSelector||function(ie){for(var he=(ie=(this.document||this.ownerDocument).querySelectorAll(ie)).length;0<=--he&&ie.item(he)!==this;);return-1<he}),Fe&&(yt.prototype[Fe]="FormData"),se){var _r=J.XMLHttpRequest.prototype.setRequestHeader;J.XMLHttpRequest.prototype.setRequestHeader=function(ie,he){_r.call(this,ie,he),ie.toLowerCase()==="content-type"&&(this.B=!0)},J.XMLHttpRequest.prototype.send=function(ie){ie instanceof yt?(ie=ie._blob(),this.B||this.setRequestHeader("Content-Type",ie.type),se.call(this,ie)):se.call(this,ie)}}le&&(J.fetch=function(ie,he){return he&&he.body&&he.body instanceof yt&&(he.body=he.body._blob()),le.call(this,ie,he)}),Je&&(J.navigator.sendBeacon=function(ie,he){return he instanceof yt&&(he=he._asNative()),Je.call(this,ie,he)}),J.FormData=yt}})();const kp=()=>{const e=M("AREAS");return e.length===0&&e.push(Tt.GLOBAL),Rs(e).call(e,(t,n,i)=>{const o=OU(n);return o?i===0?o:"".concat(t,",").concat(o):t},"")},OU=e=>e===Tt.OVERSEA?"".concat(pr.ASIA,",").concat(pr.EUROPE,",").concat(pr.AFRICA,",").concat(pr.NORTH_AMERICA,",").concat(pr.SOUTH_AMERICA,",").concat(pr.OCEANIA):pr[e],Cte=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=Ng[n],o=Object.keys(i);o&&o.map(c=>{c!=="CODE"&&(t[c]=t[c].concat(i[c]))})}),t},Fg={GLOBAL:{ASIA:[Tt.CHINA,Tt.JAPAN,Tt.INDIA,Tt.KOREA,Tt.HKMC],EUROPE:[],NORTH_AMERICA:[Tt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Bg=Object.keys(Fg[Tt.GLOBAL]),uC=[Tt.CHINA,Tt.NORTH_AMERICA,Tt.EUROPE,Tt.ASIA,Tt.JAPAN,Tt.INDIA,Tt.OCEANIA,Tt.SOUTH_AMERICA,Tt.AFRICA,Tt.KOREA,Tt.HKMC,Tt.US],wte=function(e,t){let n=[];if(pe(e).call(e,Tt.GLOBAL)){const c=[Tt.GLOBAL,Tt.OVERSEA],l=Object.keys(Ng);if(t===Tt.GLOBAL)throw new Q(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Tt.CHINA)n=[Tt.OVERSEA];else if(o=t,pe(Bg).call(Bg,o)){const u=(i=t,Fg[Tt.GLOBAL][i]||[]),h=[...c,t,...u];n=l.filter(f=>!pe(h).call(h,f))}else if(function(u){let h=!1;return Bg.forEach(f=>{var m;pe(m=Fg[Tt.GLOBAL][f]).call(m,u)&&(h=!0)}),h}(t)){const u=function(f){let m;return Bg.forEach(g=>{var E;pe(E=Fg[Tt.GLOBAL][g]).call(E,f)&&(m=g)}),m}(t),h=[...c,u,t];n=l.filter(f=>!pe(h).call(h,f))}else n=e;n=function(u){const h=[];return uC.forEach(f=>{pe(u).call(u,f)&&h.push(f)}),h.concat(u.filter(f=>!pe(uC).call(uC,f)))}(n)}else n=e;var i,o;return n};function NU(e){var t,n;if(!e&&pe(t=M("AREAS")).call(t,Tt.EXTENSIONS))return S.debug("update area from ap : reset"),void hC(kee,!0);if(!pe(n=M("AREAS")).call(n,Tt.GLOBAL)||!e)return;let i=Ng.EXTENSIONS;i&&(i={CODE:OU(Tt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},S.debug("update area from ap success: ".concat(e,",config is "),i),Ot("AREAS",[Tt.EXTENSIONS],!0),Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?Ot(o,i[o][0]):Ot(o,i[o])}))}function hC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=be.reportApiInvoke(null,{name:un.SET_AREA,options:e,tag:Jt.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(c=>{if(!pe($2).call($2,c))throw new Q(k.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:c,excludedArea:l}=e;if(!c)throw new Q(k.INVALID_PARAMS,"area code is needed");let u=c;typeof c=="string"&&(u=[c]),i=l?wte(u,l):u}if(!t){if(lo.AREAS){const c=new Q(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(c),void S.warning("setArea is prohibited because of config-distribute")}if(pe(i).call(i,Tt.GLOBAL)&&M("AREAS")===Tt.EXTENSIONS){const c=new Q(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void S.warning("setArea is prohibited because of ap extensions")}}Ot("AREAS",i,t);const o=Cte(i);Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Ot(c,o[c][0]):Ot(c,o[c])}),S.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function PU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ko(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let pC=1;function bte(e,t,n,i,o){pC+=1;const c={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:pC,requestId:pC,version:Zi,cname:n.cname},l={service_name:t,json_body:JSON.stringify(c)};let u,h,f=e[0];return co(async()=>{u=Date.now();const m=await fo(f,{data:l,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-u,m.code!==0){const y=new Q(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:h});throw S.error(y.toString()),y}const g=JSON.parse(m.json_body);if(g.code!==200){const y=new Q(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(g.code,", reason: ").concat(g.reason),{code:g.code,responseTime:h});throw S.error(y.toString()),y}if(!g.servers||g.servers.length===0){const y=new Q(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:g.code,responseTime:h});throw S.error(y.toString()),y}const E=function(y,I){return{addressList:y.servers.map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(M("WORKER_DOMAIN"),":").concat(C.wss,"?serviceName=").concat(encodeURIComponent(I))),workerToken:y.workerToken,vid:y.vid}}(g,t);return M("LIVE_STREAMING_ADDRESS")&&(E.addressList=M("LIVE_STREAMING_ADDRESS")instanceof Array?M("LIVE_STREAMING_ADDRESS"):[M("LIVE_STREAMING_ADDRESS")]),Ko(Ko({},E),{},{responseTime:h})},(m,g)=>(be.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:g===0,responseTime:h,serverIp:e[g%e.length]}),!1),(m,g)=>(be.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:h,serverIp:e[g%e.length]}),!!(m.code!==k.OPERATION_ABORTED&&m.code!==k.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(f=e[(g+1)%e.length],!0)),o)}let fC=1;function DU(e,t,n,i){let{url:o,areaCode:c}=e;const{clientId:l,sid:u}=t,h=Date.now();let f;const m=t.role,[g,E]=_C(t,c,[En.CHOOSE_SERVER]);let y=gn.networkState;return co(async()=>{y&&gn.networkState===Si.OFFLINE&&gn.onlineWaiter&&await ve.race([gn.onlineWaiter,Xn(i&&i.maxRetryTimeout||Rn.maxRetryTimeout)]),y=gn.networkState;const{data:I,headers:C}=await fo(o,{data:g,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=C.http3==="1"?1:-1,be.reportResourceTiming(o,u),LU(I,o,t,h,[En.CHOOSE_SERVER],f);const w=Op(I,En.CHOOSE_SERVER);return mC(w),sC(w,o)},I=>(I&&be.joinChooseServer(u,{role:m,lts:h,succ:!0,csAddr:o,opid:E,serverList:I.gatewayAddrs.map(C=>C.address),ec:null,cid:I.cid.toString(),uid:I.uid.toString(),csIp:I.csIp,unilbsServerIds:[En.CHOOSE_SERVER].toString(),isHttp3:f,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:I.res.detail&&I.res.detail[38]}),!1),I=>I.code!==k.OPERATION_ABORTED&&(I.code===k.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(be.joinChooseServer(u,{role:m,lts:h,succ:!1,csAddr:o,serverList:null,opid:E,ec:I.code,csIp:I.data&&I.data.csIp,unilbsServerIds:[En.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:f,corssRegionTagReq:t.apRequestDetail}),S.warning("[".concat(l||"sid-".concat(u.slice(0,6)),"] Choose server network error, retry"),I),!0)),i)}function kU(e,t,n,i){let o,{url:c,areaCode:l,serviceIds:u}=e;const h=Date.now(),f=t.role,[m,g]=_C(t,l,u);let E;return co(async()=>{E&&gn.networkState===Si.OFFLINE&&gn.onlineWaiter&&await ve.race([gn.onlineWaiter,Xn(i&&i.maxRetryTimeout||Rn.maxRetryTimeout)]),E=gn.networkState;const{data:y,headers:I}=await fo(c,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=I.http3==="1"?1:-1,be.reportResourceTiming(c,t.sid),LU(y,c,t,h,u,o);const C=Op(y,En.CHOOSE_SERVER),w=Op(y,t.cloudProxyServer==="proxy5"?En.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?En.CLOUD_PROXY:En.CLOUD_PROXY_FALLBACK),D=performance.getEntriesByName(c),P=D[D.length-1];let x;return P&&(x={name:P.name,protocol:"nextHopProtocol"in P?P.nextHopProtocol:"",dnscost:"domainLookupEnd"in P&&"domainLookupStart"in P&&typeof P.domainLookupEnd=="number"&&typeof P.domainLookupStart=="number"?P.domainLookupEnd-P.domainLookupStart:-1,tcpTlsCost:"connectEnd"in P&&"connectStart"in P&&typeof P.connectEnd=="number"&&typeof P.connectStart=="number"?P.connectEnd-P.connectStart:-1,reqCost:"requestStart"in P&&typeof P.requestStart=="number"&&"responseEnd"in P&&typeof P.responseEnd=="number"?P.responseEnd-P.requestStart:-1,handleCost:"leave_ts"in y&&"enter_ts"in y&&typeof y.leave_ts=="number"&&typeof y.enter_ts=="number"?y.leave_ts-y.enter_ts:-1}),mC(C),{gatewayInfo:sC(C,c),proxyInfo:w,url:c,resourceTimingInfo:x}},y=>(y.gatewayInfo&&be.joinChooseServer(t.sid,{role:f,lts:h,succ:!0,csAddr:c,serverList:y.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:g,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38],resourceTimingInfo:y.resourceTimingInfo?JSON.stringify(y.resourceTimingInfo):void 0}),y.proxyInfo&&be.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:c,turnServerAddrList:y.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1),y=>y.code!==k.OPERATION_ABORTED&&(y.code===k.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(be.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:c,turnServerAddrList:null,errorCode:y.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:E})}),S.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),y),!0)),i)}const LU=(e,t,n,i,o,c)=>{const{sid:l,clientId:u,cloudProxyServer:h}=n,f=[],m=g=>{g.flag===4096?be.joinChooseServer(l,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:g.error.message,csIp:g.error.data&&g.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail}):g.flag!==1048576&&g.flag!==4194304&&g.flag!==4194310||be.joinWebProxyAP(l,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:g.error.code,eventType:h,unilbsServerIds:o.toString()})};if(e.response_body.forEach(g=>{const E=g.buffer.code;if(g.uri===23&&E===0&&!g.buffer.edges_services)if(g.buffer.flag===4194310)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),g.buffer.edges_services=[];else{const y={error:new Q(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:g.buffer.flag};f.push(y),m(y)}if(E!==0){const y=gu(E),I={error:new Q(k.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:e.detail[502]}),flag:g.buffer.flag};g.buffer.flag===4194310?S.warning(I.error.toString()):f.push(I),m(I)}}),f.length)throw S.warning("[".concat(u||"sid-".concat(l.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(f.map(g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message,", retry: ").concat(g.error.data.retry)).join(" | "))),new Q(k.CAN_NOT_GET_GATEWAY_SERVER,f.map(g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message)).join(" | "),{retry:!!f.find(g=>g.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(g=>{var E;return g==null||(E=g.error)===null||E===void 0||(E=E.data)===null||E===void 0?void 0:E.desc}).filter(g=>!!g))]})},mC=e=>{var t,n,i,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Q(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(M("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?NU(e.detail[23].toLowerCase()):NU()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const l=e.detail[19],u=l==null?void 0:l.split(";");for(let h=0;h<u.length;h++){var c;const f=Nr(c=u[h]).call(c);e.addresses[h]&&u&&(e.addresses[h].fingerprint=f)}}if(M("GATEWAY_ADDRESS")&&M("GATEWAY_ADDRESS").length>0){S.debug("assign gateway address to",M("GATEWAY_ADDRESS"));const l=M("GATEWAY_ADDRESS").map(u=>{var h,f;const m=(h=(f=e.addresses.find(g=>g.ip===u.ip&&g.port===u.port))===null||f===void 0?void 0:f.fingerprint)!==null&&h!==void 0?h:"";return{ip:u.ip,port:u.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}});e.addresses=l}},Ite=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=gu(n.buffer.code);throw new Q(k.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",t),new Q(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},_C=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),o=e.role==="host"?"1":e.role==="audience"?"2":void 0,c={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ko(Ko(Ko({6:e.stringUid,11:t,12:M("USE_NEW_TOKEN")?"1":void 0},o?{17:o}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};c.request_bodies.forEach(u=>{e.multiIP&&e.multiIP.gateway_ip&&(u.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const l=new FormData;return l.append("request",JSON.stringify(c)),[l,i]},Ate=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(c=>({ip:c.ip,port:c.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(i)),[o,n]};let Su=0;function Tu(e){return ve.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Lp=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:o,promisesCollector:c}=e,l=0;const u=t;let h,f=0;const m=async()=>{const g=(()=>{const E=l*u,y=E+u;return n.slice(E,y).map(i)})();c&&c.push(...g);try{h=await Tu(g)}catch(E){if(f+=u,l++,!(f>=n.length))return void await m();o(E)}g.forEach(E=>E.cancel())};return await m(),h},MU=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const o=t.length;let c=0;const l=async()=>{const u=n(t.shift());try{return await u}catch(h){if(c++,c>=o||i!=null&&i(h))throw h;return l()}};return l()};async function Ote(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],o=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],c=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],l=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new ve((h,f)=>{let m;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:E=>{E.close(),clearTimeout(m),h(!0)},error:E=>{clearTimeout(m),h(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const g=[t,n,i,o,c,l];for(let E=0;E<g.length;E++){const y=new EncodedVideoChunk({type:E==0?"key":"delta",timestamp:33333*E,duration:33333,data:new Uint8Array(g[E])});try{await e.decode(y)}catch{return void h(!1)}}})(),m=setTimeout(()=>{h(!1)},5e3)})}async function gC(e,t,n,i){return{gatewayInfo:await async function(c,l,u,h){let f=null;const m=[],g=async()=>{const y=M("WEBCS_DOMAIN").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(w=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:kp()})),I=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(w=>w.url)}),C=await Lp({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:w=>(S.debug("[".concat(c.clientId,"] Connect to choose_server:"),w.url),DU(w,c,l,u)),allFailedhandler:w=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},I),C},E=async()=>{if(await Xn(1e3),f!==null)return f;const y=M("WEBCS_DOMAIN_BACKUP_LIST").map(w=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:kp()})),I=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(w=>w.url)}),C=await Lp({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:w=>(S.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),w.url),DU(w,c,l,u)),allFailedhandler:w=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},I),C};try{return f=await Tu([g(),E()]),m.length&&m.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),f}catch(y){throw y[0]}}(e,t,n,i)}}async function xU(e,t,n,i,o){const c=e.cloudProxyServer;if(c==="disabled"){if(e.useLocalAccessPoint)return await gC(e,t,n,o);if(M("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:E,proxyInfo:y}=await jU(e,t,n,o);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:E};const I=y.map(C=>({turnServerURL:C.address,tcpport:C.tcpport||or.tcpport,udpport:C.udpport||or.udpport,username:C.username||or.username,password:C.password||or.password,forceturn:!1,security:!0}));if(o.useP2P){var l;const C=(l=e.uid)!==null&&l!==void 0?l:E.uid,w="glb:".concat(C.toString()),D=await o0(w),P=y.map(x=>({turnServerURL:x.address,tcpport:x.tcpport||or.tcpport,udpport:x.udpport||or.udpport,username:w,password:D,forceturn:!1,security:!0}));I.push(...P)}return e.turnServer={mode:"manual",servers:I},{gatewayInfo:E}}return await gC(e,t,n,o)}const{proxyInfo:u,gatewayInfo:h}=await jU(e,t,n,o),f={gatewayInfo:h},m=u.map(E=>({turnServerURL:E.address,tcpport:c==="proxy3"?void 0:E.tcpport?E.tcpport:or.tcpport,udpport:c==="proxy4"?void 0:E.udpport?E.udpport:or.udpport,username:E.username||or.username,password:E.password||or.password,forceturn:c!=="proxy4",security:c==="proxy5"}));if(o.useP2P){var g;const E=(g=e.uid)!==null&&g!==void 0?g:h.uid,y="glb:".concat(E.toString()),I=await o0(y),C=u.map(w=>({turnServerURL:w.address,tcpport:c==="proxy3"?void 0:w.tcpport||or.tcpport,udpport:c==="proxy4"?void 0:w.udpport||or.udpport,username:y,password:I,forceturn:c!=="proxy4",security:c==="proxy5"}));m.push(...C)}return e.turnServer={mode:"manual",servers:m},S.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(c)),f}async function UU(e,t,n,i,o){const c=M("ACCOUNT_REGISTER").slice(0,M("AJAX_REQUEST_CONCURRENT"));let l=[];l=t.proxyServer?c.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):c.map(h=>"https://".concat(h,"/api/v1"));const u=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:l});try{const h=await async function(f,m,g,E,y){const I=Date.now(),C={sid:g.sid,opid:10,appid:g.appId,string_uid:m};let w=f[0];const D=await co(()=>fo(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:C,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(P,x)=>{if(P.code===0){if(P.uid<=0||P.uid>=Math.pow(2,32))throw S.error("Invalid Uint Uid ".concat(m," => ").concat(P.uid),P),be.reqUserAccount(C.sid,{lts:I,success:!1,serverAddr:w,stringUid:C.string_uid,uid:P.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:C}),new Q(k.INVALID_UINT_UID_FROM_STRING_UID);return be.reqUserAccount(C.sid,{lts:I,success:!0,serverAddr:w,stringUid:C.string_uid,uid:P.uid,errorCode:null,extend:C}),!1}const K=gu(P.code);return K.retry&&(w=f[(x+1)%f.length]),be.reqUserAccount(C.sid,{lts:I,success:!1,serverAddr:w,stringUid:C.string_uid,uid:P.uid,errorCode:K.desc,extend:C}),K.retry},(P,x)=>P.code!==k.OPERATION_ABORTED&&(be.reqUserAccount(C.sid,{lts:I,success:!1,serverAddr:w,stringUid:C.string_uid,uid:null,errorCode:P.code,extend:C}),w=f[(x+1)%f.length],!0),y);if(D.code!==0){const P=gu(D.code);throw new Q(k.UNEXPECTED_RESPONSE,P.desc)}return D}(l,e,t,n,i);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},u),h.uid}catch(h){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},u),h}}async function Nte(e,t,n){const i=M("ACCOUNT_REGISTER");let o=[];o=t.proxyServer?i.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):i.map(c=>"https://".concat(c,"/api/v1"));try{return await MU({referenceList:o,asyncMapHandler:l=>async function(u,h,f,m){const g=Date.now(),E={sid:f.sid,opid:10,appid:f.appId,string_uid:h};try{const y=await fo(u+"".concat(u.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){const I=gu(y.code);throw new Q(k.UNEXPECTED_RESPONSE,"preload sua error:".concat(I.desc),I)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new Q(k.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:g,url:u,req:E,uid:y.uid,elapse:Date.now()-g}}catch(y){throw y}}(l,e,t,n),closeFn:l=>l.code===k.OPERATION_ABORTED||l.code===k.UNEXPECTED_RESPONSE&&!l.data.retry})}catch(c){throw c}}async function Pte(e,t,n){const i=M("CDS_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),o=i.map(h=>function(f,m,g,E){const y=dt(),I={flag:64,cipher_method:0,features:Ko(Ko(Ko(Ko(Ko({install_id:g0(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:Zi,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:Ste.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return co(()=>fo(f,{data:I,timeout:1e3,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,C=>C.code!==k.OPERATION_ABORTED,E)}(h,e,t,n));let c=null,l=null,u={};try{c=await Tu(o)}catch(h){if(h.code===k.OPERATION_ABORTED)throw h;l=h}if(o.forEach(h=>h.cancel()),be.reportApiInvoke(e.sid,{name:un.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:c}}).onSuccess(),c&&c.test_tags)try{u=function(h){if(!h.test_tags)return{};const f=h.test_tags,m=Object.keys(f),g={};return m.forEach(E=>{var y;const I=Nr(y=E.slice(4)).call(y),C=JSON.parse(f[E]),w=C[1];g[I]={tag:C[0]||"",value:w}}),g}(c)}catch{}return u}async function VU(e,t){const n=M("WEBCS_DOMAIN").concat(M("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:kp(),serviceIds:[En.CHOOSE_SERVER,En.CLOUD_PROXY_FALLBACK]}));try{return await MU({referenceList:n,asyncMapHandler:o=>async function(c,l,u){let h,{url:f,areaCode:m,serviceIds:g}=c;const E=Date.now(),[y,I]=_C(l,m,g);let C=gn.networkState;try{C&&gn.networkState===Si.OFFLINE&&gn.onlineWaiter&&await ve.race([gn.onlineWaiter,Xn(Rn.maxRetryTimeout)]),C=gn.networkState;const{data:w,headers:D}=await fo(f,{data:y,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=D.http3==="1"?1:-1,(H=>{const j=[];if(H.response_body.forEach(J=>{const re=J.buffer.code;if(J.uri===23&&re===0&&!J.buffer.edges_services)if(J.buffer.flag===4194310)J.buffer.edges_services=[];else{const se={error:new Q(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:H.detail[502]}),flag:J.buffer.flag};j.push(se)}if(re!==0){const se=gu(re),le={error:new Q(k.CAN_NOT_GET_GATEWAY_SERVER,se.desc,{desc:se.desc,retry:se.retry,csIp:H.detail[502]}),flag:J.buffer.flag};J.buffer.flag===4194310?S.warning(le.error.toString()):j.push(le)}}),j.length)throw new Q(k.CAN_NOT_GET_GATEWAY_SERVER,j.map(J=>"flag: ".concat(J.flag,", message: ").concat(J.error.message)).join(" | "),{retry:!!j.find(J=>J.error.data.retry),csIp:H.detail[502],desc:[...new Set(j.map(J=>{var re;return J==null||(re=J.error)===null||re===void 0||(re=re.data)===null||re===void 0?void 0:re.desc}).filter(J=>!!J))]})})(w);const x=Op(w,En.CHOOSE_SERVER),K=Op(w,En.CLOUD_PROXY_FALLBACK);return mC(x),{gatewayInfo:sC(x,f),proxyInfo:K,opid:I,requestTime:E,url:f,isHttp3:h,elapse:Date.now()-E}}catch(w){throw w}}(o,e,t),closeFn:o=>o.code===k.OPERATION_ABORTED||o.code===k.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(i){throw i}}async function jU(e,t,n,i){const o=M("PROXY_SERVER_TYPE3"),c=(y,I,C)=>{let w=C||o;return Array.isArray(w)&&(w=I%2==0&&o[1]||o[0]),"https://".concat(w,"/ap/?url=").concat(y)};let l=null;const u=[],h=async()=>{const y=M("WEBCS_DOMAIN").slice(0,M("AJAX_REQUEST_CONCURRENT")).map((w,D)=>{let P;return P=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(w,"/api/v2/transpond/webrtc?v=2"),D,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):c("".concat(w,"/api/v2/transpond/webrtc?v=2"),D),{url:P,areaCode:kp(),serviceIds:[En.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?En.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?En.CLOUD_PROXY:En.CLOUD_PROXY_FALLBACK]}}),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(w=>w.url)}),C=await Lp({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:w=>(S.debug("[".concat(e.clientId,"] Connect to choose_server:"),w.url),kU(w,e,t,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),C},f=async()=>{if(await Xn(1e3),l!==null)return l;const y=M("WEBCS_DOMAIN_BACKUP_LIST").map((w,D)=>{let P;return P=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(w,"/api/v2/transpond/webrtc?v=2"),D,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):c("".concat(w,"/api/v2/transpond/webrtc?v=2"),D),{url:P,areaCode:kp(),serviceIds:[En.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?En.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?En.CLOUD_PROXY:En.CLOUD_PROXY_FALLBACK]}}),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(w=>w.url)}),C=await Lp({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:w=>(S.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),w.url),kU(w,e,t,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),C};let m,g,E;try{({gatewayInfo:m,proxyInfo:g,url:E}=await Tu([h(),f()]))}catch(y){throw y[0]}if(u.length&&u.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!m||!g)throw new Q(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=E,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&E){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(E)[1];pe(o).call(o,y)&&(e.proxyServer=y,S.setProxyServer(y),be.setProxyServer(y))}return l={gatewayInfo:m,proxyInfo:await lU(g,m.uid)},l}async function Dte(e,t,n){const i=M("UAP_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")),o=i.map(c=>function(l,u,h,f){const m={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:Zi,cname:u.cname,uid:u.uid.toString(),requestId:fC,seq:fC};fC+=1;const g={service_name:"tele_channel",json_body:JSON.stringify(m)};return co(async()=>{const E=await fo(l,{data:g,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const I=new Q(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw S.error(I.toString()),I}const y=JSON.parse(E.json_body);if(y.code!==200){const I=new Q(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw S.error(I.toString()),I}if(!y.servers||y.servers.length===0){const I=new Q(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(I.toString()),I}return{vid:y.vid,workerToken:y.workerToken,addressList:(M("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(M("WORKER_DOMAIN"),":").concat(I.wss))}},void 0,E=>!!(E.code!==k.OPERATION_ABORTED&&E.code!==k.UNEXPECTED_RESPONSE||E.data&&E.data.retry),f)}(c,e,t,n));try{const c=await Tu(o);return o.forEach(l=>l.cancel()),c}catch(c){throw c[0]}}async function kte(e,t,n){let i=null;const o=[],c=async l=>{const u=M(l?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return l&&(await Xn(1e3),i!==null)?i:await Lp({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:h=>(S.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(l?"backup":""," choose_server:"),h),function(f,m,g,E){const[y]=Ate(m,[En.CHOOSE_SERVER]);let I=gn.networkState;return co(async()=>{I&&gn.networkState===Si.OFFLINE&&gn.onlineWaiter&&await ve.race([gn.onlineWaiter,Xn(E&&E.maxRetryTimeout||Rn.maxRetryTimeout)]),I=gn.networkState;const C=await fo(f,{data:y,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0);return Ite(C,f)},()=>!1,C=>C.code!==k.OPERATION_ABORTED&&(C.code===k.UPDATE_TICKET_FAILED?C.data.retry:(S.warning("[".concat(m.clientId,"] update ticket network error, retry"),C),!0)),E)}(h,e,t,n)),allFailedhandler:h=>{throw h[0]},promisesCollector:o})};try{return i=await Tu([c(!1),c(!0)]),o.length&&o.forEach(l=>l.cancel&&typeof l.cancel=="function"&&l.cancel()),i}catch(l){throw l[0]}}function FU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function EC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Lte extends nn{get isSuccess(){return!!this.configs}constructor(t,n){super(),O(this,"configs",void 0),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"cancelToken",void 0),O(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),O(this,"interval",void 0),O(this,"mutex",void 0),O(this,"mutableParamsRead",!1),O(this,"configCache",{}),O(this,"limit_bitrate",void 0),this.mutex=new ur("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),M("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},M("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,be.reportApiInvoke(null,{options:void 0,name:un.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Jt.TRACER}).onSuccess(JSON.stringify(lo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await Pte(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",JSON.stringify(t));const i=function(o){var c;const l=cl(c=Object.keys(o).filter(f=>/^webrtc_ng_global_parameter/.test(f))).call(c);for(let f=0;f<l.length;f++)for(let m=l.length-1;m>f;m--){const g=l[m],E=o[g].value;if(typeof E.__priority=="number"){const y=E.__priority,I=l[m-1],C=o[I].value;if(typeof C.__priority=="number"){if(!(y>C.__priority))continue;{const w=g;l[m]=l[m-1],l[m-1]=w}}else{const w=g;l[m]=l[m-1],l[m-1]=w}}}const u=Date.now();let h={};return l.forEach(f=>{const m=o[f].value.__expires;m&&m<=u||(h[f]=o[f])}),h}(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const o=new Q(k.NETWORK_RESPONSE_ERROR,i);S.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){Q2(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(bp.UPDATE_BITRATE_LIMIT,t):this.emit(bp.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&EC({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},i=Object.keys(t),o=[];i.forEach(c=>{const l=t[c].value;n[c]=l;const u=l.__id;if(u&&this.configCache[c]&&this.configCache[c].__id===u)return;const h=l.__type,f=t[c].value,m=t[c].tag;let g=0;h?h===TM.REALTIME&&(g=1):Object.keys(f).some(E=>Object.prototype.hasOwnProperty.call(S0,E)||!q0()&&Object.prototype.hasOwnProperty.call(cg,E)?(g=1,!0):void 0),o.push({tag:m,isApplied:g,feature:c,params:JSON.stringify(l)})}),o.forEach(c=>{let{tag:l,feature:u,params:h,isApplied:f}=c;this.store.sessionId&&be.abTest(this.store.sessionId,{intSucc:1,isApplied:f,tag:l,feature:u,params:h,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){S.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(o){const c={};return Object.keys(o).forEach(l=>{const u=o[l].value,h=u.__expires,f=u.__type;Object.keys(u).forEach(m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(c,m)||(c[m]=EC(EC({value:u[m]},h&&{expires:h}),f&&{type:f}))})}),c}(t);try{var i;const o=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,o&&Q2(o)&&this.handleBitrateLimit(o),this.limit_bitrate=o,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(u){try{const h=Date.now();Object.keys(u).forEach(f=>{const{value:m,type:g,expires:E}=u[f];E&&E<=h||((g===TM.REALTIME||Object.prototype.hasOwnProperty.call(S0,f))&&(lo[f]=m,qt[f]=m,S.debug("Update realtime parameters from config distribute",f,m)),g||q0()||!Object.prototype.hasOwnProperty.call(cg,f)||(lo[f]=m,qt[f]=m,S.debug("Update gateway parameters from config distribute",f,m)))})}catch(h){S.error("Error update config immediately: ".concat(u),h.message)}}(n);const c=JSON.stringify(n),l=window.btoa(c);window.localStorage.setItem("websdk_ng_global_parameter",l),S.debug("Caching global parameters ".concat(c))}catch(o){S.error("Error caching global parameters:",o.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(qt,i)){const{value:o,expires:c}=t[i];if(c&&c<=n)return;(function(l,u){try{return typeof l=="object"&&typeof u=="object"&&JSON.stringify(l)===JSON.stringify(u)}catch{return!1}})(qt[i],o)||(lo[i]=o,qt[i]=o,this.emit(bp.UPDATE_CLIENT_ROLE_OPTIONS,o),S.debug("Updating client role options: ".concat(JSON.stringify(o))))}})}catch(n){S.error("Error handling global parameter config:",n.message)}}}class Mte extends nn{constructor(){super(...arguments),O(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(M("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(!o)return;o.result.push(i);const c=t==="VIDEO_ENCODE_FAILED"?M("ENCODE_EXCEPTION_TIMES"):5;if(o.result.length>=c){var l;const u=pe(l=o.result).call(l,!0);o.isPrevNormal&&!u&&this.emit("exception",vC[t],t,n),!o.isPrevNormal&&u&&this.emit("exception",vC[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=u,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof On&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Ti(n._encoderConfig.frameRate));const o=t.captureFrameRate;return!i||!o||!(i>10&&o<5||i<10&&i>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||pe(n=M("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof On&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const vC={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},mr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function BU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ol(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Mp{constructor(t){O(this,"store",void 0),O(this,"onStatsException",void 0),O(this,"onUploadPublishDuration",void 0),O(this,"onStatsChanged",void 0),O(this,"onVideoCodecChanged",void 0),O(this,"localStats",new Map),O(this,"remoteStats",new Map),O(this,"updateStatsInterval",void 0),O(this,"trafficStats",void 0),O(this,"trafficStatsPeerList",[]),O(this,"uplinkStats",void 0),O(this,"exceptionMonitor",void 0),O(this,"p2pChannel",void 0),O(this,"scalabilityMode",ag.L1T1),O(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Mte,this.exceptionMonitor.on("exception",(n,i,o)=>{this.onStatsException&&this.onStatsException(n,i,o)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ae.LocalAudioTrack)||Ol({},I0)}getLocalVideoTrackStats(){return this.localStats.get(ae.LocalVideoTrack)||Ol({},A0)}getRemoteAudioTrackStats(t){const n=(c,l)=>{if(!this.trafficStats)return l;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===c);return u&&(l.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),l},i={};if(t){var o;const c=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;c&&(i[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{audioStats:u}]=c;u&&(i[l]=n(l,u))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{networkStats:l}]=o;l&&(n[c]=l)});return n}getRemoteVideoTrackStats(t){const n=(c,l)=>{if(!this.trafficStats)return l;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===c);return u&&(l.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),l},i={};if(t){var o;const c=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;c&&(i[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{videoStats:u}]=c;u&&(i[l]=n(l,u))});return i}getRTCStats(){let t=0,n=0,i=0,o=0;const c=this.localStats.get(ae.LocalAudioTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(ae.LocalVideoTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);const u=this.localStats.get(ae.LocalVideoLowTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:m,videoStats:g}=f;m&&(i+=m.receiveBytes,o+=m.receiveBitrate),g&&(i+=g.receiveBytes,o+=g.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const o=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),c=o!=null&&o.videoSSRC?mr.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,l=o!=null&&o.audioSSRC?mr.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,c>l?c:l),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&S.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const o=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,c=!i||n.framesDecodeCount>i.framesDecodeCount;return o||!c}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,o]=n;switch(i){case ae.LocalVideoTrack:case ae.LocalVideoLowTrack:{const u=o,h=Ol({},A0),f=t.getStats(),m=t.getLocalMedia(i);if(f){const g=f.videoSend.find(E=>E.ssrc===(m==null?void 0:m.ssrcs[0].ssrcId));if(g){const E=t.getLocalVideoSize(),y=t.getEncoderConfig(ae.LocalVideoTrack);var c;(g.codec==="H264"||g.codec==="H265"||g.codec==="VP8"||g.codec==="VP9"||g.codec==="AV1X"||g.codec==="AV1")&&(h.codecType=g.codec,(u==null?void 0:u.codecType)!==g.codec&&((c=this.onVideoCodecChanged)===null||c===void 0||c.call(this,g.codec.toLocaleLowerCase()))),h.sendBytes=g.bytes,h.sendBitrate=u?8*Math.max(0,h.sendBytes-u.sendBytes):0,g.inputFrame?(h.captureFrameRate=g.inputFrame.frameRate,h.captureResolutionHeight=g.inputFrame.height,h.captureResolutionWidth=g.inputFrame.width):E&&(h.captureResolutionWidth=E.width,h.captureResolutionHeight=E.height),g.sentFrame?(h.sendFrameRate=g.sentFrame.frameRate,h.sendResolutionHeight=g.sentFrame.height,h.sendResolutionWidth=g.sentFrame.width):E&&(h.sendResolutionWidth=E.width,h.sendResolutionHeight=E.height),g.avgEncodeMs&&(h.encodeDelay=g.avgEncodeMs),y&&y.bitrateMax?h.targetSendBitrate=1e3*y.bitrateMax:g.targetBitrate&&(h.targetSendBitrate=g.targetBitrate),h.sendPackets=g.packets,h.sendPacketsLost=g.packetsLost,h.sendJitterMs=g.jitterMs,h.sendRttMs=g.rttMs,h.totalDuration=u?u.totalDuration+1:1,h.totalFreezeTime=u?u.totalFreezeTime:0,this.isLocalVideoFreeze(g)&&(h.totalFreezeTime+=1),g.scalabilityMode&&this.scalabilityMode!==g.scalabilityMode&&(S.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(g.scalabilityMode)),this.scalabilityMode=g.scalabilityMode)}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(i,h),((u==null?void 0:u.sendResolutionWidth)!==h.sendResolutionWidth||(u==null?void 0:u.sendResolutionHeight)!==h.sendResolutionHeight)&&((l=this.onStatsChanged)===null||l===void 0||l.call(this,"resolution",{width:h.sendResolutionWidth,height:h.sendResolutionHeight})),h&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,h);break}case ae.LocalAudioTrack:{const u=o,h=Ol({},I0),f=t.getStats(),m=t.getLocalMedia(i);if(f){const g=f.audioSend.find(E=>E.ssrc===(m==null?void 0:m.ssrcs[0].ssrcId));if(g){if(g.codec!=="opus"&&g.codec!=="aac"&&g.codec!=="PCMU"&&g.codec!=="PCMA"&&g.codec!=="G722"||(h.codecType=g.codec),g.inputLevel)h.sendVolumeLevel=Math.round(32767*g.inputLevel);else{const E=t.getLocalAudioVolume();E&&(h.sendVolumeLevel=Math.round(32767*E))}h.sendBytes=g.bytes,h.sendPackets=g.packets,h.sendPacketsLost=g.packetsLost,h.sendJitterMs=g.jitterMs,h.sendRttMs=g.rttMs,h.sendBitrate=u?8*Math.max(0,h.sendBytes-u.sendBytes):0}}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ae.LocalAudioTrack,h),h&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,h);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,o;let[c,{videoStats:l,audioStats:u,videoPcStats:h}]=n;const f=u,m=l,g=h,E=Ol({},kM),y=Ol({},LM),I=Ol({},Eee),{audioTrack:C,videoTrack:w,audioSSRC:D,videoSSRC:P}=t.getRemoteMedia(c);let x;x=this.store.useP2P?t.getStats(!0):t.getStats();const K=(i=x)===null||i===void 0?void 0:i.audioRecv.find(re=>re.ssrc===D),H=(o=x)===null||o===void 0?void 0:o.videoRecv.find(re=>re.ssrc===P),j=this.trafficStats&&this.trafficStats.peer_delay.find(re=>re.peer_uid===c);if(K&&(K.codec!=="opus"&&K.codec!=="aac"&&K.codec!=="PCMU"&&K.codec!=="PCMA"&&K.codec!=="G722"||(E.codecType=K.codec),K.outputLevel?E.receiveLevel=Math.round(32767*K.outputLevel):C&&(E.receiveLevel=Math.round(32767*C.getVolumeLevel())),E.receiveBytes=K.bytes,E.receivePackets=K.packets,E.receivePacketsLost=K.packetsLost,E.receivePacketsDiscarded=K.packetsDiscarded,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=f?8*Math.max(0,E.receiveBytes-f.receiveBytes):0,E.totalDuration=f?f.totalDuration+1:1,E.totalFreezeTime=f?f.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=K.jitterBufferMs,E.totalDuration>10&&Mp.isRemoteAudioFreeze(C)&&(E.totalFreezeTime+=1)),H){var J;H.codec!=="H264"&&H.codec!=="H265"&&H.codec!=="VP8"&&H.codec!=="VP9"&&H.codec!=="AV1X"&&H.codec!=="AV1"||(y.codecType=H.codec),y.receiveBytes=H.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,y.renderFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,H.outputFrame&&(y.renderFrameRate=H.outputFrame.frameRate),H.receivedFrame?(y.receiveFrameRate=H.receivedFrame.frameRate,y.receiveResolutionHeight=H.receivedFrame.height,y.receiveResolutionWidth=H.receivedFrame.width):w&&(y.receiveResolutionHeight=w._videoHeight||0,y.receiveResolutionWidth=w._videoWidth||0),H.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(H.framesRateFirefox)),y.receivePackets=H.packets,y.receivePacketsLost=H.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);const re=m?m.totalFreezeTime:0,se=m?m.totalDuration:0;y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=(J=H.totalFreezesDuration)!==null&&J!==void 0?J:re||0,y.receiveDelay=H.jitterBufferMs||0;const le=!!P&&t.getRemoteVideoIsReady(P);H.totalFreezesDuration===void 0&&w&&le&&Mp.isRemoteVideoFreeze(w,H,g)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-re)/(y.totalDuration-se),1))}j&&(E.end2EndDelay=j.B_ad,y.end2EndDelay=j.B_vd,E.transportDelay=j.B_ed,y.transportDelay=j.B_ed,E.currentPacketLossRate=j.B_ealr4/100,y.currentPacketLossRate=j.B_evlr4/100,I.uplinkNetworkQuality=j.B_punq?j.B_punq:0,I.downlinkNetworkQuality=j.B_pdnq?j.B_pdnq:0),this.remoteStats.set(c,{audioStats:E,videoStats:y,videoPcStats:H,networkStats:I}),C&&this.exceptionMonitor.setRemoteAudioStats(C,E),w&&this.exceptionMonitor.setRemoteVideoStats(w,y)})}}class WU{constructor(){O(this,"destChannelMediaInfos",new Map),O(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){J2(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){J2(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Ig(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function GU(e){if(!(e instanceof WU))return new Q(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new Q(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new Q(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class mc{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){O(this,"uid",void 0),O(this,"_uintid",void 0),O(this,"_trust_in_room_",!0),O(this,"_trust_audio_enabled_state_",!0),O(this,"_trust_video_enabled_state_",!0),O(this,"_trust_audio_mute_state_",!0),O(this,"_trust_video_mute_state_",!0),O(this,"_audio_muted_",!1),O(this,"_video_muted_",!1),O(this,"_audio_enabled_",!0),O(this,"_video_enabled_",!0),O(this,"_audio_added_",!1),O(this,"_video_added_",!1),O(this,"_is_pre_created",!1),O(this,"_video_pre_subscribed",!1),O(this,"_audio_pre_subscribed",!1),O(this,"_trust_video_stream_added_state_",!0),O(this,"_trust_audio_stream_added_state_",!0),O(this,"_audioTrack",void 0),O(this,"_videoTrack",void 0),O(this,"_dataChannels",[]),O(this,"_audioSSRC",void 0),O(this,"_videoSSRC",void 0),O(this,"_audioOrtc",void 0),O(this,"_videoOrtc",void 0),O(this,"_cname",void 0),O(this,"_rtxSsrcId",void 0),O(this,"_videoMid",void 0),O(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function HU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function yC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Wg="9",SC=2e4,Gg=4e4;function KU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Ru=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Ru||{});const Hg=new Map;function zU(e,t,n,i){let{scale:o}=e;if(o===0&&i===Ru.UP||o>=t.length-1&&i===Ru.DOWN)return e;let c=Ra(Ra({},e),{},{scale:i===Ru.DOWN?++o:--o});switch(n){case"maintain-framerate":c=Ra(Ra({},c),t[o].motion);break;case"maintain-resolution":c=Ra(Ra({},c),t[o].detail);break;case"balanced":c=Ra(Ra({},c),t[o].balanced)}return c}function YU(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:qU(t)};Hg.set(e,n)}else Hg.delete(e)}function qU(e){const t=Ra({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:o,bitrateMin:c}=t,{MIN_FRAME_RATE:l,MAX_THRESHOLD_FRAMERATE:u,MAX_SCALE:h,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:g,BWE_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:I,BALANCE_BITRATE_FACTOR:C,BALANCE_FRAMERATE_FACTOR:w,BALANCE_RESOLUTION_FACTOR:D,MOTION_RESOLUTION_FACTOR:P,MOTION_BITRATE_FACTOR:x,DETAIL_FRAMERATE_FACTOR:K,DETAIL_BITRATE_FACTOR:H}=v0,j=Math.min(t.frameRate,u),J=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(E,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(y,1)*j),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c}}];for(let re=1;re<=h;re++){const se={bwe_up:Math.round(Math.pow(g,re)*n),bwe_down:Math.round(Math.pow(E,re+1)*n),fps_up:Math.round(Math.pow(I,re)*j),fps_down:Math.round(Math.pow(y,re+1)*j)},le={scaleResolutionDownBy:o/Math.pow(D,re),frameRate:Math.max(Math.round(Math.pow(w,re)*i),l),bitrateMax:Math.max(Math.round(Math.pow(C,re)*n),m),bitrateMin:Math.max(Math.round(Math.pow(C,re)*c),f)},Je={scaleResolutionDownBy:o/Math.pow(P,re),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(x,re)*n),m),bitrateMin:Math.max(Math.round(Math.pow(x,re)*c),f)},nt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(K,re)*i),l),bitrateMax:Math.max(Math.round(Math.pow(H,re)*n),m),bitrateMin:Math.max(Math.round(Math.pow(H,re)*c),f)};J.push({scale:re,threshold:se,balanced:le,motion:Je,detail:nt})}return J}function xte(e,t,n,i,o,c){const l=Hg.get(e)||{overUse:0,underUse:0,adaptationList:qU(o)},{adaptationList:u}=l;Hg.set(e,l);const{OVERUSE_TIMES_THRESHOLD:h,UNDERUSE_TIMES_THRESHOLD:f}=v0,{scale:m}=i;let g,E;return typeof t=="number"&&t>0&&function(y,I,C,w){if(I>=C.length)return!1;let{threshold:{fps_down:D}}=C[I];return M("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(D=C[0].threshold.fps_down),y<D}(t,m,u,c)&&(l.overUse++,E=Ep.CPU,l.overUse>h)||typeof n=="number"&&n>0&&function(y,I,C){if(I>=C.length)return!1;const{threshold:{bwe_down:w}}=C[I];return y<w}(n,m,u)&&(l.overUse++,E=Ep.BANDWIDTH,l.overUse>h)?(l.overUse=0,l.underUse=0,g=zU(i,u,c,Ru.DOWN),[g,E]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(y,I,C,w){if(I===0)return;let{threshold:{fps_up:D}}=C[I];return M("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(D=C[1].threshold.fps_up),y>D}(t,m,u,c)&&function(y,I,C){if(I===0)return;const{threshold:{bwe_up:w}}=C[I];return y>w}(n,m,u)&&(l.underUse++,l.underUse>f&&(l.overUse=0,l.underUse=0,g=zU(i,u,c,Ru.UP),g.scale===0&&(E=Ep.NONE))),[g,E])}function XU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function TC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Kg=new Map;function zg(e,t){const n=Kg.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),Kg.delete(e)}t.qualityLimitationReason=Ep.NONE,YU(e)}function Ute(e,t){var n;let i;switch(t){case ae.LocalAudioTrack:i=bt.Audio;break;case ae.LocalVideoTrack:i=pe(n=e._hints).call(n,kt.SCREEN_TRACK)?bt.Screen:bt.High;break;case ae.LocalVideoLowTrack:i=bt.Low}return i}function RC(e){const t=ft();if(e.some(n=>n._bypassWebAudio))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function CC(e,t){RC(e);const n=new On;return e.forEach(i=>n.addAudioTrack(i)),n}const Vte=!ft().supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&ga();function Yg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return Vte?(n={spec:t,store:e},Ta("PlanBConnection").create(n)):new is(t,e)}function wC(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function JU(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(mp(e.turnServer.servers))return!1;if(M("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var ut;function $U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function mo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$U(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let is=(ut=class Kl extends eU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return pe(n=Object.keys(yp)).call(n,t)}))]}constructor(t,n){super(t,n),O(this,"id",Ut(5,"connection-")),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"forceTurn",!1),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"transportEventReceiver",void 0),O(this,"statsFilter",void 0),O(this,"extension",{useXR:M("USE_XR")}),O(this,"localCapabilities",void 0),O(this,"remoteCodecs",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"isPreallocation",!1),O(this,"preMediaMap",new Map),O(this,"dataStreamChannelMap",new Map),O(this,"establishPromise",void 0),O(this,"recoveredDataChannelIds",[]),O(this,"currentDataChannelId",1),O(this,"supportAV1RtpSpec",!1),O(this,"mutex",void 0),O(this,"qualityLimitationReason",Ep.NONE),O(this,"isFirstConnected",!1),this.store=n,this.forceTurn=JU(t),this.mutex=new ur("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Kl.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=_0(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const c=this.remoteSDP.toString();o==null||o(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=uc(i.sdp),c=await vU({filterRTX:!M("USE_PUB_RTX")&&!M("USE_SUB_RTX"),filterVideoFec:M("FILTER_VIDEO_FEC"),filterAudioFec:M("FILTER_AUDIO_FEC"),filterVideoCodec:M("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:M("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:M("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Ug(c),this.initialOffer=i,M("ENABLE_SVC")&&this.store.codec=="av1"){const u=await async function(){try{const h=new RTCPeerConnection;h.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:ag.L1T3}]});const f=await h.createOffer();if(!f.sdp)return void h.close();const m=ii(f.sdp).mediaDescriptions[0];if(!m)return;const g=m.attributes.extmaps.find(E=>E.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return h.close(),g}catch{return}}();var t;u&&(this.supportAV1RtpSpec=!0,(t=c.send)===null||t===void 0||t.videoExtensions.push(u))}let l;return i.sdp&&RU(i.sdp)&&(l=$t(c),(n=l).send&&(Eu(Se.VIDEO,n.send.videoExtensions),Eu(Se.AUDIO,n.send.audioExtensions)),n.recv&&(Eu(Se.VIDEO,n.recv.videoExtensions),Eu(Se.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(Eu(Se.VIDEO,n.sendrecv.videoExtensions),Eu(Se.AUDIO,n.sendrecv.audioExtensions))),mo(mo({},o),{},{rtpCapabilities:l||c,offerSDP:i.sdp})}catch(i){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&RU(this.initialOffer.sdp)&&(n=t.rtpCapabilities,i=this.localCapabilities,n.send&&(Lg(Se.VIDEO,n.send.videoExtensions,i.send.videoExtensions),Lg(Se.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(Lg(Se.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),Lg(Se.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return $t(this._localCapabilities)}get rtpCapabilities(){return $t(this._rtpCapabilities)}get candidates(){return $t(this._candidates)}get iceParameters(){return $t(this._iceParameters)}get dtlsParameters(){return $t(this._dtlsParameters)}constructor(h){let f=arguments.length>1&&arguments[1]!==void 0&&arguments[1],m=arguments.length>2&&arguments[2]!==void 0&&arguments[2];O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_originCandidates",void 0),O(this,"_iceParameters",void 0),O(this,"_isUseExtmapAllowMixed",void 0),O(this,"_isUseLocalCodecs",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),O(this,"useLocalCodecsMids",[]),O(this,"preloadSsrcs",[]),O(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=f,this._isUseLocalCodecs=m,h=$t(h);const{iceParameters:g,dtlsParameters:E,candidates:y,rtpCapabilities:I,setup:C,localCapabilities:w,cname:D}=h;this._rtpCapabilities=I,this._candidates=y,this._originCandidates=$t(y),this._iceParameters=g,this._dtlsParameters=E,this._localCapabilities=w,this.setup=C,this.cname=D,[this.sessionDesc]=this.updateRemoteRTPCapabilities(I),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(h){return h.length===this.preloadSsrcs.length&&h.every(f=>{var m;return pe(m=this.preloadSsrcs).call(m,f)})}preloadRemoteMedia(h){let f=0;const m=[],g=[];for(;h>0;){const E=[yC({ssrcId:Gg+f},M("USE_SUB_RTX")?{rtx:Gg+f+1}:{})],y="".concat(Gg+f,"_").concat(SC+f),{ssrcs:I,ssrcGroups:C}=Pp(E,this.cname,M("SYNC_GROUP")?y:void 0),w=this.preCreateOrRecycleSendMedia("video",I,C,void 0),D=[{ssrcId:SC+f}],P="".concat(Gg+f,"_").concat(SC+f),{ssrcs:x,ssrcGroups:K}=Pp(D,this.cname,M("SYNC_GROUP")?P:void 0),H=this.preCreateOrRecycleSendMedia("audio",x,K,void 0);h--,f+=2,m.push(w,H),g.push(I[0].ssrcId,x[0].ssrcId)}return this.useLocalCodecsMids.push(...m),this.preloadSsrcs=g,{mids:m,preSSRCs:g,isAvailable:!0}}preCreateOrRecycleSendMedia(h,f,m,g){const E=this.rtpCapabilities.send.videoCodecs,y=this._isUseLocalCodecs||E.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;S.debug("create or recycle send media without remote rtp capabilities, ssrcs ",f[0].ssrcId);const I=h===Se.VIDEO?y.videoCodecs:y.audioCodecs,C=h===Se.VIDEO?y.videoExtensions:y.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let D={media:{mediaType:h,port:Wg,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:I,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};return D=this.mungSendMediaDesc(D,g),this.sessionDesc.mediaDescriptions.push(D),this.updateBundleMids(),w}toString(){return sc(this.sessionDesc)}send(h,f,m,g){const{ssrcs:E,ssrcGroups:y}=Pp(f,this.cname,M("SYNC_GROUP")?m:void 0),I=this.findPreloadMediaDesc(E);if(I){if(sn()&&this.firefoxSsrcMidMap.set(E[0].ssrcId,I.attributes.mid),g&&(g.twcc||g.remb)){const C=this.sessionDesc.mediaDescriptions.indexOf(I);return this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(I,g),{mid:I.attributes.mid,needExchangeSDP:!0}}return{mid:I.attributes.mid,needExchangeSDP:!1}}{const C=this.findAvailableMediaIndex(h,E);let w;return C===-1||C===1&&(rr()||function(){const D=dt();return!(D.name!==gt.CHROME||!D.osVersion)&&Number(D.version)<=90}()||M("ENABLE_ENCODED_TRANSFORM")&&_a())||C===0&&!function(D){const P=dt();return!(P.name!==gt.FIREFOX||!P.osVersion)&&Number(P.version)===D}(138)&&M("USE_SUB_RTX")||zL()?(w=this.createOrRecycleSendMedia(h,E,y,"sendonly",g),this.updateBundleMids()):(w=$t(this.sessionDesc.mediaDescriptions[C]),w.attributes.direction="sendonly",w.attributes.ssrcs=E,w.attributes.ssrcGroups=y,this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(w,g)),sn()&&this.firefoxSsrcMidMap.set(E[0].ssrcId,w.attributes.mid),{mid:w.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:h,needExchangeSDP:f}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:h.attributes.mid,needExchangeSDP:f}}batchSend(h){const f=h.map(E=>{let{kind:y,ssrcMsg:I,mslabel:C}=E;return this.send(y,I,C)}),m=[];let g=!1;return f.forEach(E=>{let{mid:y,needExchangeSDP:I}=E;I&&(g=!0),m.push(y)}),{mids:m,needExchangeSDP:g}}stopSending(h){const f=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&h.indexOf(m.attributes.mid)!==-1);if(f.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");f.forEach(m=>{m.attributes.mid==="0"||sn()||zL()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")}),this.updateBundleMids()}mute(h){const f=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!f)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));f.attributes.direction="inactive"}unmute(h){const f=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!f)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));f.attributes.direction="sendonly"}muteRemote(h){const f=this.sessionDesc.mediaDescriptions.filter(m=>pe(h).call(h,m.attributes.mid||""));if(f.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");f.forEach(m=>{m.attributes.direction="inactive"})}unmuteRemote(h){const f=this.sessionDesc.mediaDescriptions.filter(m=>pe(h).call(h,m.attributes.mid||""));if(f.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");f.forEach(m=>{m.attributes.direction="recvonly"})}receive(h,f,m,g){h.forEach((E,y)=>{this.createOrRecycleRecvMedia(E,[],"recvonly",f,m,g[y])}),this.updateBundleMids()}stopReceiving(h){const f=this.sessionDesc.mediaDescriptions.filter(m=>h.indexOf(m.attributes.mid)!==-1);if(f.length!==h.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");f.forEach(m=>{m.media.port="0",m.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(h){const f=this.sessionDesc||ii((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=h;let g=!1;const E=this.rtpCapabilities.send,y=this.localCapabilities.send,I=this.localCapabilities.recv,C=I.videoCodecs,w=I.audioCodecs,D=I.videoExtensions,P=I.audioExtensions;for(const j of f.mediaDescriptions){var x;if(j.attributes.direction!=="sendonly"||typeof j.attributes.mid!="string"||!pe(x=this.useLocalCodecsMids).call(x,j.attributes.mid)){if(g=!0,j.attributes.iceUfrag=this._iceParameters.iceUfrag,j.attributes.icePwd=this._iceParameters.icePwd,j.attributes.fingerprints=this._dtlsParameters.fingerprints,j.attributes.candidates=this._candidates,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video")if(this._isUseLocalCodecs&&j.attributes.direction==="sendonly"){var K;j.media.fmts=C.map(re=>re.payloadType.toString(10)),j.attributes.payloads=C,j.attributes.extmaps=D;const J=j.attributes.mid;typeof J!="string"||pe(K=this.useLocalCodecsMids).call(K,J)||this.useLocalCodecsMids.push(J)}else if(E.videoCodecs.length===0){const J=y.videoCodecs.filter(re=>{var se,le;return(se=re.rtpMap)===null||se===void 0?void 0:pe(le=se.encodingName.toLowerCase()).call(le,"vp8")})||[y.videoCodecs[0]];j.media.fmts=J.map(re=>re.payloadType.toString(10)),j.attributes.payloads=J,j.attributes.extmaps=[]}else j.media.fmts=E.videoCodecs.map(J=>J.payloadType.toString(10)),j.attributes.payloads=E.videoCodecs,j.attributes.extmaps=E.videoExtensions;if(j.media.mediaType==="audio")if(this._isUseLocalCodecs&&j.attributes.direction==="sendonly"){var H;j.media.fmts=w.map(re=>re.payloadType.toString(10)),j.attributes.payloads=w,j.attributes.extmaps=P;const J=j.attributes.mid;typeof J!="string"||pe(H=this.useLocalCodecsMids).call(H,J)||this.useLocalCodecsMids.push(J)}else if(E.audioCodecs.length===0){const J=y.audioCodecs.filter(re=>{var se,le;return(se=re.rtpMap)===null||se===void 0?void 0:pe(le=se.encodingName.toLowerCase()).call(le,"opus")})||[y.audioCodecs[0]];j.media.fmts=J.map(re=>re.payloadType.toString(10)),j.attributes.payloads=J,j.attributes.extmaps=[]}else j.media.fmts=E.audioCodecs.map(J=>J.payloadType.toString(10)),j.attributes.payloads=E.audioCodecs,j.attributes.extmaps=E.audioExtensions,yu(j)}}return this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1,[this.sessionDesc,g]}updateCandidates(h){const f=this._originCandidates.filter(g=>g.transport==="udp"),m=[];if(f.forEach(g=>{m.push(yC(yC({},g),{},{foundation:"tcpcandidate",priority:Number(g.priority)-1+"",transport:"tcp",port:Number(g.port)+90+""}))}),f.length!==0){switch(h){case fr.TCP_RELAY:this._candidates=m;break;case fr.UDP_TCP_RELAY:case fr.RELAY:this._candidates=[...f,...m];break;default:this._candidates=f}for(const g of this.sessionDesc.mediaDescriptions)g.attributes.candidates=this.candidates}}restartICE(h){h=$t(h),this._iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.iceUfrag=h.iceUfrag,f.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const f=[];for(let m=0;m<h;m++)f.push((this.currentMidIndex+m+1).toString(10));return f}findAvailableMediaIndex(h,f){return this.sessionDesc.mediaDescriptions.findIndex(m=>{const g=m.media.mediaType===h&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(sn()){if(g){const E=this.firefoxSsrcMidMap.get(f[0].ssrcId);return!(E||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!E||E!==m.attributes.mid)}return!1}return g})}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const h="".concat(this.currentMidIndex),f={media:{mediaType:"application",port:Wg,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(h),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(f),{mediaDesc:f,needExchangeSDP:!0}}createOrRecycleRecvMedia(h,f,m,g,E,y){const I=h._mediaStreamTrack.kind,C=this.rtpCapabilities.recv,w=Dp(I,C,this.localCapabilities.send,I===Se.VIDEO?g:E),D=I===Se.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;const P="".concat(this.currentMidIndex);let x={media:{mediaType:I,port:Wg,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.map(H=>H.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:D,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:w,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(P)}};x=this.mungRecvMediaDsec(x,h,y);const K=this.findFirstClosedMedia(I);if(K){const H=this.sessionDesc.mediaDescriptions.indexOf(K);this.sessionDesc.mediaDescriptions[H]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}updateRemoteDtlsParameters(h){const f=new Set(this._dtlsParameters.fingerprints.map(E=>E.fingerprint)),m=new Set(h.map(E=>E.fingerprint));let g=!1;f.size!==m.size&&(g=!0);for(const E of f)m.has(E)||(g=!0);return g}updateRemoteCodec(h,f,m){const g=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(x=>x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||"").filter(x=>{var K;return pe(K=Object.keys(yp)).call(K,x)}))],E=new Set(f);if(g.every(x=>E.has(x)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(f)),!1;const y=this._rtpCapabilities.recv.videoCodecs.filter(x=>f.some(K=>{var H;return pe(H=x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||"").call(H,K)}));if(y.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(g," codecs: ").concat(f)),!1;const I=[...new Set(y.map(x=>x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||""))];let C;if(S.debug("updateRemoteCodec, from ".concat(g," to ").concat(I)),h.length===0)C=this.sessionDesc.mediaDescriptions.filter(x=>x.media.mediaType==="video"&&x.attributes.direction==="recvonly");else if(C=this.sessionDesc.mediaDescriptions.filter(x=>x.attributes.mid&&x.media.mediaType==="video"&&pe(h).call(h,x.attributes.mid)&&x.attributes.direction==="recvonly"),C.length!==h.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(h,", codecs: ").concat(f)),!1;if(M("USE_PUB_RTX")||M("USE_SUB_RTX")){const x=hc(y,this.rtpCapabilities.recv.videoCodecs);y.push(...x)}this._rtpCapabilities.recv.videoCodecs=y;const w=this.localCapabilities.send,D=this.rtpCapabilities.recv,P=Dp(Se.VIDEO,D,w,m);return C.forEach(x=>{const K=P.map(H=>H.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(x.attributes.mid,", from"),x.attributes.payloads,"to",P),x.attributes.payloads=P,x.media.fmts=K}),!0}createOrRecycleSendMedia(h,f,m,g,E){const y=this.rtpCapabilities.send.videoCodecs,I=this._isUseLocalCodecs||y.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,C=h===Se.VIDEO?I.videoCodecs:I.audioCodecs,w=h===Se.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;const D="".concat(this.currentMidIndex);let P={media:{mediaType:h,port:Wg,protos:["UDP","TLS","RTP","SAVPF"],fmts:C.map(K=>K.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:w,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:C,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:g,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(D)}};P=this.mungSendMediaDesc(P,E);const x=this.findFirstClosedMedia(h);if(x){const K=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[K]=P}else this.sessionDesc.mediaDescriptions.push(P);return P}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(h=>h.media.port!=="0").map(h=>h.attributes.mid)}mungRecvMediaDsec(h,f,m){const g=$t(h);return aC(g),vu(g,f),cC(g,f),gU(g),xg(g,m,this.localCapabilities.send),g}mungSendMediaDesc(h,f){const m=$t(h);return xg(m,f,this.localCapabilities.recv),yu(m),m}updateRecvMedia(h,f){const m=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===h);if(m!==-1){const g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],f);this.sessionDesc.mediaDescriptions[m]=g}}bumpMid(h){this.currentMidIndex+=h}findFirstClosedMedia(h){return this.sessionDesc.mediaDescriptions.find(f=>sn()?f.media.port==="0"&&f.media.mediaType===h:f.media.port==="0")}findPreloadMediaDesc(h){return this.sessionDesc.mediaDescriptions.find(f=>{var m;return((m=f.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===h[0].ssrcId})}getSSRC(h){var f;return(f=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h))===null||f===void 0?void 0:f.attributes.ssrcs}}(mo(mo({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!M("ENABLE_PRE_SUB_WITH_PRE_PC")||!M("PRE_USE_LOCAL_CODECS"))&&C0(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString(),c=SU(this.initialOffer.sdp,this.extension),l=this.logSDPExchange(c||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),l==null||l(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),C0(this.store))if(t.preallocation&&M("ENABLE_PRE_SUB_WITH_PRE_PC")){const h=M("PRE_SUB_NUM"),{mids:f,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(h);await pc(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(f,m)}else{const{preSSRCs:h=[]}=t,f=h.map(g=>g.ssrcMsg[0].ssrcId);if(h.length===0)return;const{mids:m}=this.remoteSDP.batchSend(h.map(g=>Object.assign({},g)));await pc(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(m,f)}}catch(o){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(o.toString()))}var n,i}presetMedia(t,n){t.forEach((i,o)=>{this.peerConnection.getTransceivers().forEach(c=>{if(c.mid!=null&&i===c.mid&&c.receiver.track){const l=c.receiver.track;let u;l.kind==="video"&&M("ENABLE_PRE_RENDER")&&(u=new U0({trackId:"track-".concat(l.kind,"-unknown-").concat(this.store.clientId,"_").concat(Ut(5,""))},!0),u.updateVideoTrack(l),u.onFirstVideoFrameRender=()=>{var h;const f=this.preMediaMap.get(n[o]);f&&(f.firstVideoRender=Date.now()),(h=this.onFirstVideoRender)===null||h===void 0||h.call(this,n[o])},u.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[o],{mid:i,track:l,player:u,transceiver:c})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const l=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||l}const{preSSRCs:o=[]}=t,c=o.map(l=>l.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(c)){const l=[],u=[];if(Array.from(this.preMediaMap.entries()).every(h=>{let[f,{mid:m,player:g,track:E}]=h;return l.push(m),u.push(f),this.preMediaMap.delete(f),g&&g.destroy(),!0}),l.length>0&&(this.remoteSDP.stopSending(l),await pc(this.peerConnection,this.remoteSDP,this.extension),S.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),be.reportApiInvoke(this.store.sessionId,{name:un.PRELOAD_MEDIA_FAILED,options:[o,u],tag:Jt.TRACER}).onSuccess()),o.length>0){const{mids:h}=this.remoteSDP.batchSend(o.map(f=>Object.assign({},f)));await pc(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(c)),this.presetMedia(h,c)}}n?(await pc(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):S.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var o=this;return Qi(function*(){const c=yield pt(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[],u=kg();t.forEach(w=>{const D=o.peerConnection.addTransceiver(w._mediaStreamTrack,mo({direction:"sendonly"},w.trackMediaType==="video"&&o.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));l.push(D),w._updateRtpTransceiver(D)}),sn()&&M("SIMULCAST")===!0&&(yield pt(o.applySimulcastForFirefox(l,t)));const h=yield pt(o.peerConnection.createOffer()),f=o.remoteSDP.predictReceivingMids(t.length),m=o.mungSendOfferSDP(h.sdp,t,f),g=ii(m),E=f.map(w=>{const D=g.mediaDescriptions.find(P=>P.attributes.mid===w);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return fU(D,M("USE_PUB_RTX"))});let y;try{y=yield E}catch(w){y=[],o.remoteSDP.receive(t,n,i,y);const D=o.remoteSDP.toString();throw yield pt(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield pt(o.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield pt(o.stopSending(f,!0)),w}o.remoteSDP.receive(t,n,i,y);const I=o.remoteSDP.toString(),C=o.logSDPExchange(m,"offer","local","send");return yield pt(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield pt(o.applySimulcastEncodings(l,t)),yield pt(o.applySendEncodings(l,t)),C==null||C(I),yield pt(o.peerConnection.setRemoteDescription({type:"answer",sdp:I})),l.map((w,D)=>{const P=f[D];return{localSSRC:E[D],id:P,transceiver:w}})}catch(l){throw l instanceof ne?l:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")S.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:M("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(c=>{c._updateOriginDataChannel(i)});const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),S.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else S.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof ne?i:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof ne?n:new ne(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(h=>{var f;zg(this.id+h.mid,this),h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();l==null||l(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,n,i,o);l&&(await pc(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}}catch(c){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await pc(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(o=>{const c=this.peerConnection.getTransceivers().find(l=>l.mid===o);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:o,transceiver:c}})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(c=>{Array.from(this.preMediaMap.entries()).some(l=>{let[u,{mid:h,player:f}]=l;if(h===c)return this.preMediaMap.delete(u),f&&f.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const c=this.remoteSDP.toString();o==null||o(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(l,u)=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString();o==null||o(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Qi(function*(){const i=yield pt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=ft().supportPCSetConfiguration,c=M("FORCE_TURN_TCP")||n.forceTurn;if(t===fr.RELAY&&!o)return;if(o&&!c){const g=t===fr.RELAY?"relay":"all",E=n.peerConnection.getConfiguration();E.iceTransportPolicy!==g&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(g,"]")),E.iceTransportPolicy=g,n.peerConnection.setConfiguration(E))}n.remoteSDP.updateCandidates(t);const l=yield pt(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=uc(l.sdp),{remoteIceParameters:h}=yield u.iceParameters;n.remoteSDP.restartICE(h);const f=n.remoteSDP.toString(),m=n.logSDPExchange(l.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield pt(n.peerConnection.setLocalDescription(l)),m==null||m(f),yield pt(n.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(o){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(fr.TCP_RELAY),await pc(this.peerConnection,this.remoteSDP,this.extension)}catch(n){S.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{zg(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return mo(mo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const c=this.remoteSDP.toString(),l=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),l==null||l(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?sn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:mo(mo({},Fo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:mo(mo({},Fo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"",c=Al(t.url||"");S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(c||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},M("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(mp(t.turnServer.servers)?n.iceServers=t.turnServer.servers:M("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(M("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Kl.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Kl.newTurnServerConfigToIceServers(t.turnServer.servers)),M("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Kl.turnServerConfigToIceServers(t.turnServer.servers)),M("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Kl.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),M("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),M("ENABLE_ENCODED_TRANSFORM")&&ft().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(lc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!M("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const o=M("NEW_TURN_MODE");o===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(lc(i.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(lc(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair()||{};if(o&&c){const l=o.address+":"+o.port,u=c.address+":"+c.port;S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Al(l)),", remote ").concat(JSON.stringify(Al(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,o;if(n||(n=this.peerConnection.getSenders().find(w=>w.track===t._mediaStreamTrack)),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ft().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},l={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}const u=function(C,w){return C.getTransceivers().find(D=>D.sender.track===w||D.receiver.track===w)}(this.peerConnection,t._mediaStreamTrack),h=Ree(t);if(function(C){var w;return!(!M("ENABLE_AG_ADAPTATION")||!(C instanceof _g||pe(w=C._hints).call(w,kt.CUSTOM_TRACK))||!M("FORCE_SUPPORT_AG_ADAPTATION")&&!(HL(14,0,!1)&&KL(17,4)||GL(14)&&ZR(17,4,!0)))}(t)&&u&&n&&h&&this.getLocalVideoStats&&pe(i=["vp8","vp9"]).call(i,this.store.codec)){var f;const C=c.degradationPreference||(pe(f=t._hints).call(f,kt.CUSTOM_TRACK)?M("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(w,D,P,x,K,H){if(zg(w,P),K(D),x!=="balanced"&&x!=="maintain-framerate"&&x!=="maintain-resolution")return;let j=-1;YU(w,D);const J=window.setInterval(()=>{const se=Kg.get(w);if(!M("ENABLE_AG_ADAPTATION")||!se)return zg(w,P),void K(D);const le=H();if(le.sendPackets>0&&le.OutgoingAvailableBandwidth>0){if(j===-1)return void(j=Date.now());if(Date.now()-j<1e3)return;const Je=le.sendFrameRate,nt=le.OutgoingAvailableBandwidth,[Fe,Rt]=xte(w,Je,nt,se.adaptationConfig,D,x);Rt&&(P.qualityLimitationReason=Rt),Fe&&se.adaptationConfig.scale!==Fe.scale&&(S.debug("[".concat(w,"] applyAdaptation: ").concat(P.qualityLimitationReason,`
           sendFps `).concat(Je,", bwe ").concat(nt,", switch from ").concat(se.adaptationConfig.scale," to ").concat(Fe.scale," ")),se.adaptationConfig=TC(TC({},se.adaptationConfig),Fe),K(Fe))}},M("CHECK_LOCAL_STATS_INTERVAL")),re=TC({},D);Kg.set(w,{timer:J,adaptationConfig:re,originConfig:D,adaptationFunc:K}),S.debug("[".concat(w,"] start adaptation, originConfig: ").concat(JSON.stringify(D),", degradationPreference: ").concat(x))})(this.id+u.mid,h,this,C,w=>{n&&this.updateAdaptation(n,w)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;const{bitrateMax:C,frameRate:w,scaleResolutionDownBy:D}=t._encoderConfig;C&&(l.maxBitrate=1e3*C),(pe(m=t._hints).call(m,kt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(w&&(l.maxFramerate=Ti(w)),D&&D>=1&&(l.scaleResolutionDownBy=D))}const{maxFramerate:g}=M("ENCODER_CONFIG_LIMIT");if(g&&typeof g=="number"&&(l.maxFramerate=l.maxFramerate?Math.min(l.maxFramerate,g):g),M("DSCP_TYPE")&&ga()){var E;const C=M("DSCP_TYPE");pe(E=["very-low","low","medium","high"]).call(E,C)&&(l.networkPriority=C)}const y=n.getParameters(),I=(o=y.encodings)===null||o===void 0?void 0:o[0];sn()&&!I&&(c.encodings=[l]),I&&Object.assign(I,l),Object.assign(y,c),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await n.setParameters(y),await async function(C,w,D){try{var P;if(!ft().supportSetRtpSenderParameters||!function(J){return J==="vp9"||J==="av1"}(C)||!M("ENABLE_SVC"))return;const x={},K={},H=w.getParameters(),j=(P=H.encodings)===null||P===void 0?void 0:P[0];K.scalabilityMode=kg(D),j&&Object.assign(j,K),Object.assign(H,x),await w.setParameters(H),S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(H.encodings)))}catch(x){S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",x)}}(this.store.codec,n,M("SVC_MODE"))}async updateAdaptation(t,n){var i,o;if(!t)return S.debug("[updateAdaptation] no rtpSender found");if(!ft().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const c={},{bitrateMax:l,frameRate:u,scaleResolutionDownBy:h}=n;l&&(c.maxBitrate=1e3*l),u&&(c.maxFramerate=Ti(u)),h&&h>=1&&pe(i=["vp8","vp9"]).call(i,this.store.codec)&&(c.scaleResolutionDownBy=h);const f=t.getParameters(),m=(o=f.encodings)===null||o===void 0?void 0:o[0];m&&Object.assign(m,c),Object.assign(f,{});try{await t.setParameters(f),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(g){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",g):S.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],c=n[i];c instanceof Wt&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,o.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const o=ii(t);return n.forEach((c,l)=>{const u=i[l],h=o.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(vu(h,c),EU(h,c,this.store.codec))}),sc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let h=0;h<t.length;h++){var i,o,c,l,u;const f=t[h],m=n[h];if(m instanceof Wt&&!pe(i=m._hints).call(i,kt.LOW_STREAM)&&(o=m._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const g={},E={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const y=f.sender.getParameters();await f.sender.setParameters(Object.assign(y,g))}}}async applySimulcastEncodings(t,n){if(!sn()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof Wt&&this.isVP8Simulcast(o)){const c=t[i],l={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=c.sender.getParameters();await c.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var n,i,o,c,l;return!!(t instanceof Wt&&M("SIMULCAST")&&this.store.codec==="vp8"&&!pe(n=t._hints).call(n,kt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(M("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(ft().supportPCSetConfiguration){const n=Kl.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ce(ut.prototype,"updateRemoteRTPCapabilities",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"updateRemoteRTPCapabilities"),ut.prototype),Ce(ut.prototype,"connect",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"connect"),ut.prototype),Ce(ut.prototype,"updateRemoteConnect",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"updateRemoteConnect"),ut.prototype),Ce(ut.prototype,"createDataChannels",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"createDataChannels"),ut.prototype),Ce(ut.prototype,"receive",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"receive"),ut.prototype),Ce(ut.prototype,"batchReceive",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"batchReceive"),ut.prototype),Ce(ut.prototype,"stopReceiving",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"stopReceiving"),ut.prototype),Ce(ut.prototype,"muteRemote",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"muteRemote"),ut.prototype),Ce(ut.prototype,"unmuteRemote",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"unmuteRemote"),ut.prototype),Ce(ut.prototype,"muteLocal",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"muteLocal"),ut.prototype),Ce(ut.prototype,"unmuteLocal",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"unmuteLocal"),ut.prototype),Ce(ut.prototype,"close",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"close"),ut.prototype),Ce(ut.prototype,"updateEncoderConfig",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"updateEncoderConfig"),ut.prototype),Ce(ut.prototype,"updateSendParameters",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"updateSendParameters"),ut.prototype),Ce(ut.prototype,"replaceTrack",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"replaceTrack"),ut.prototype),Ce(ut.prototype,"updateAdaptation",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"updateAdaptation"),ut.prototype),Ce(ut.prototype,"getRemoteSSRC",[Xr],Object.getOwnPropertyDescriptor(ut.prototype,"getRemoteSSRC"),ut.prototype),ut);function Xr(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,c=await o.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},n}function bC(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Ti(t.width),i.height=Ti(t.height);const o=Ti(t.framerate||15);document.body.append(n),document.body.append(i);let c=e._mediaStreamTrack;n.srcObject=new MediaStream([c]),n.play();const l=i.getContext("2d");if(!l)throw new Q(k.UNEXPECTED_ERROR,"can not get canvas context");const u=ft(),h=i.captureStream(u.supportRequestFrame?0:o).getVideoTracks()[0];h.canvas||(h.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,g=n.videoHeight/m,E=i.width*g;Math.abs(E-i.height)>=2&&(S.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(E)),i.height=E)}l.drawImage(n,0,0,i.width,i.height),h.requestFrame&&h.requestFrame(),c!==e._mediaStreamTrack&&(c=e._mediaStreamTrack,n.srcObject=new MediaStream([c]))},i.stopCapture=P0(()=>i.startCapture&&i.startCapture(),o);const f=h.stop;return h.stop=()=>{f.call(h),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),S.debug("clean low stream renderer")},h}var QU=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(QU||{}),_o=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(_o||{}),He=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(He||{}),Qn=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(Qn||{}),Jr=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Jr||{}),qg=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(qg||{});const Nl=1e3,Xg=6,xp=3,jte=Math.max(Xg,xp,60);function Me(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function ZU(e){const t={[Jr.CONN_TYPE]:0,[Jr.RTT]:e.rtt,[Jr.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Jr.CONN_TYPE]=1),n==="tcp"&&(t[Jr.CONN_TYPE]=3),n==="tls"&&(t[Jr.CONN_TYPE]=4);break}case"srflx":t[Jr.CONN_TYPE]=2;break;case"unknown":t[Jr.CONN_TYPE]=5;break;default:t[Jr.CONN_TYPE]=0}return t}function eV(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class tV extends nn{constructor(t){super(),O(this,"store",void 0),O(this,"uploadWRTCStatsTimer",void 0),O(this,"uploadOutboundDenoiserStatsTimer",void 0),O(this,"uploadExtStatsTimer",void 0),O(this,"uploadExtUsageStatsTimer",void 0),O(this,"uploadInboundExtStatsTimer",void 0),O(this,"requestStats",void 0),O(this,"requestTransportStats",void 0),O(this,"requestLocalMedia",void 0),O(this,"requestRemoteMedia",void 0),O(this,"requestAllTracks",void 0),O(this,"requestVideoIsReady",void 0),O(this,"requestUploadStats",void 0),O(this,"requestUpload",void 0),O(this,"uploadOutboundStarted",!1),O(this,"uploadInboundStarted",!1),O(this,"uploadTransportStarted",!1),O(this,"uploadBaseStatsStarted",!1),O(this,"uploadExtensionUsageStarted",!1),O(this,"lastRecvStats",void 0),O(this,"lastSendStats",void 0),O(this,"lastRefRecvStats",void 0),O(this,"lastRefSendStats",void 0),O(this,"lastNormalRecvStats",void 0),O(this,"lastNormalSendStats",void 0),O(this,"lastExtendStats",{}),O(this,"needUploadStats",{}),O(this,"needUploadRenderFreezeTime",!0),O(this,"lastUploadCompensateTime",-1),O(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%xp==0,i=t%Xg==0,o=t%60==0;let c,l;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(l=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!l&&this.uploadInboundStarted&&(l=this.requestStats(!0)),c||l){var u;const h={};if(this.uploadTransportStarted&&c){const m=this.getTransportStats(c,l,n);m&&(h.misc=[m])}if(this.uploadOutboundStarted&&c){const m=this.getOutboundStats(c,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,o);m&&(h.outbound=[m])}if(this.uploadInboundStarted&&l){this.uploadCompensateStats(t);const m=this.getInboundStats(l,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);m&&(h.inbound=m)}const f=(u=this.requestTransportStats)===null||u===void 0?void 0:u.call(this).connectState;f&&(Array.isArray(h.misc)?h.misc[0]&&h.misc[0].addition&&(h.misc[0].addition[qg.RTC_PEER_CONNECTION_STATE]=m0[f]):h.misc=[{addition:{[qg.RTC_PEER_CONNECTION_STATE]:m0[f]}}]),this.needUploadStats.sendType&&(Array.isArray(h.outbound)&&h.outbound[0]&&h.outbound[0].high&&(h.outbound[0].high[QU.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(h)}this.lastRecvStats=l,this.lastSendStats=c,i&&(this.lastNormalRecvStats=l,this.lastNormalSendStats=c),n&&(this.lastRefRecvStats=l,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const o=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(o&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[qg.RTC_PEER_CONNECTION_STATE]:m0[o.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===jte+1&&(t=1)},Nl)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%xp==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const o=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*o;const c=this.requestStats(!0);new Array(o).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const l={};if(this.uploadInboundStarted&&c){const u=this.requestRemoteMedia()||[],h=[];u.forEach(f=>{let[m,g]=f;const E={peer:m.uid};if(m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)&&g.has(Se.VIDEO)&&m.videoTrack){const y=function(I,C,w){if(!C.videoRecv.find(P=>P.ssrc===I))return;const D={};if(w&&w._player){const P=w._player,{renderFreezeAccTime2:x,videoElementStatus:K}=P;if(Go.visibility==="visible"&&K===hr.PLAYING&&ft().supportRequestVideoFrameCallback){const H=Math.min(6e3,x);P.renderFreezeAccTime2=Math.max(0,x-H),Me(D,_o.Video_Render_Freeze_Time_Render2,H),M("USE_NEW_RENDER_FREEZE_TIME")&&Me(D,_o.Video_Render_Freeze_Time_Render,H)}}return D}(m._videoSSRC,c,m.videoTrack);y&&(E.video=y)}E.video&&h.push(E)}),h.length>0&&(l.inbound=h,this.requestUploadStats(l))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[Jr.RTT]:t.rtt,[Jr.CONN_TYPE]:void 0,[Jr.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const o=ZU(t);if(this.store.useP2P){if(n){const c=ZU(n);o[Jr.CONN_TYPE]+=c[Jr.CONN_TYPE]<<3}o[Jr.CONN_TYPE]+=110}else o[Jr.CONN_TYPE]+=100;return{addition:o}}getOutboundStats(t,n,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||l.length===0)return;let u,h,f;return l.forEach(m=>{let[g,{track:E,ssrcs:y}]=m;switch(g){case ae.LocalVideoLowTrack:case ae.LocalVideoTrack:if(g===ae.LocalVideoTrack){var I;const C=function(x,K,H,j,J,re){const se=K.videoSend.find(Fe=>Fe.ssrc===x);if(!se)return;const le={},{sentFrame:Je,inputFrame:nt}=se;if(j&&(Me(le,_o.Video_Send_Qp_Sum,se.qpSumPerFrame),nt&&Je)){const Fe=nt.frameRate,Rt=Je.frameRate;le[_o.Video_Send_Freeze]=function(yt,_r){let ie=!0;return ie=!(yt<=5)&&(yt<=10?_r<3:yt<=20?_r<4:_r<5),ie}(Fe,Rt)?1:0}if(J){switch(Je&&(Me(le,He.Video_Send_Height,Je.height),Me(le,He.Video_Send_Width,Je.width),Me(le,He.Video_Send_Frame_Rate,Je.frameRate)),le[He.Video_Send_Disabled]=H._originMediaStreamTrack&&!H._originMediaStreamTrack.enabled||H._mediaStreamTrack&&!H._mediaStreamTrack.enabled?1:0,se.adaptionChangeReason){case"none":le[He.Video_Send_Adaptation]=0;break;case"cpu":le[He.Video_Send_Adaptation]=1;break;case"bandwidth":le[He.Video_Send_Adaptation]=2;break;case"other":le[He.Video_Send_Adaptation]=3}let Fe=0;se.adaptionChangeReason&&(Fe+=eV(se.adaptionChangeReason)),K.qualityLimitationReason&&(Fe+=eV(K.qualityLimitationReason)<<3),le[He.Video_Send_Adaptation]=Fe,le[He.Video_Send_Player_Status]=O0[H._player?H._player.videoElementStatus:"uninit"],Me(le,He.Video_Send_Nacks,se.nacksCount),Me(le,He.Video_Send_Plis,se.plisCount),Me(le,He.Video_Send_Firs,se.firsCount),Me(le,He.Video_Send_Avg_Encode,se.avgEncodeMs),Me(le,He.Video_Send_Huge_Frame_Sent,se.hugeFramesSent),Me(le,He.Video_Send_Bytes_Retransmit,se.retransmittedBytesSent),Me(le,He.Video_Send_Packages_Retransmit,se.retransmittedPacketsSent),Me(le,He.Video_Send_Key_Frames_Encoded,se.keyFramesEncoded);const Rt=J.videoSend.find(yt=>yt.ssrc===x);if(Rt){let yt=Nl*xp;Rt.timestamp&&se.timestamp&&(yt=se.timestamp-Rt.timestamp),Rt.packets!=null&&se.packets!=null&&Me(le,He.Video_Send_Package_Rate,1e3*(se.packets-Rt.packets)/yt),se.packetsLost!=null&&Rt.packetsLost!=null&&Me(le,He.Video_Send_Package_Lost,se.packetsLost-Rt.packetsLost),Rt.bytes!=null&&se.bytes!=null&&Me(le,He.Video_Send_Bitrate,8*(se.bytes-Rt.bytes)/yt)}}return le}(y[0].ssrcId,t,E,n,i),w=E.__className__==="CameraVideoTrack"?3:pe(I=E._hints).call(I,kt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==w||c)&&(this.needUploadStats={sendType:w},this.lastExtendStats.sendType=w);const D=E&&function(x,K,H,j){const J=K.videoSend.find(se=>se.ssrc===x);if(!J)return null;const re={};if(j){const se=J.inputFrame,le=se&&se.height||H.videoHeight||0,Je=se&&se.width||H.videoWidth||0,nt=se&&se.frameRate||0;Me(re,He.Video_Capture_Height,le),Me(re,He.Video_Capture_Width,Je),Me(re,He.Video_Capture_Frame_Rate,nt)}return re}(y[0].ssrcId,t,E,!!i),P=function(x,K){const H={};return K&&(Me(H,He.Video_Send_Retransmit,x.bitrate.retransmit),Me(H,He.Video_Send_Target_Encoded,x.bitrate.targetEncoded),Me(H,He.Video_Send_Actual_Encoded,x.bitrate.actualEncoded),Me(H,He.Video_Send_Transmit,x.bitrate.transmit),Me(H,He.Video_Send_Bandwidth,x.sendBandwidth)),H}(t,!!i);h=Object.assign({},C,D,P)}else f=function(C,w,D,P,x){const K=w.videoSend.find(j=>j.ssrc===C);if(!K)return;const H={};if(P){const j=K.sentFrame;j&&(Me(H,He.Video_Send_Low_Height,j.height),Me(H,He.Video_Send_Low_Width,j.width),Me(H,He.Video_Send_Low_Frame_Rate,j.frameRate));const J=P.videoSend.find(re=>re.ssrc===C);if(J){let re=Nl*Xg;J.timestamp&&K.timestamp&&(re=K.timestamp-J.timestamp),J.packets!=null&&K.packets!=null&&Me(H,He.Video_Send_Low_Package_Rate,1e3*(K.packets-J.packets)/re),K.packetsLost!=null&&J.packetsLost!=null&&Me(H,He.Video_Send_Low_Package_Lost,K.packetsLost-J.packetsLost),J.bytes!=null&&K.bytes!=null&&Me(H,He.Video_Send_Low_Bitrate,8*(K.bytes-J.bytes)/re)}}return H}(y[0].ssrcId,t,0,i);break;case ae.LocalAudioTrack:u=E&&function(C,w,D,P,x,K){const H=w.audioSend.find(J=>J.ssrc===C);if(!H)return;const j={};if(x){j[He.Audio_Send_Disabled]=D._originMediaStreamTrack&&!D._originMediaStreamTrack.enabled||D._mediaStreamTrack&&!D._mediaStreamTrack.enabled?1:0;const J=100*D._source.getAccurateVolumeLevel(),re=H.inputLevel;if(re!=null){const le=Math.ceil(50*Math.log10(100*re+1));Me(j,He.Audio_Send_Level,le)}Me(j,He.Audio_Capture_PCM_Level,J),Me(j,He.Audio_Send_AEC_Return_Loss,H.aecReturnLoss),Me(j,He.Audio_Send_AEC_Return_Loss_Enhancement,H.aecReturnLossEnhancement),Me(j,He.Audio_Send_Bytes_Retransmit,H.retransmittedBytesSent),Me(j,He.Audio_Send_Packages_Retransmit,H.retransmittedPacketsSent),j[He.Audio_Send_Freeze]=0;const se=x.audioSend.find(le=>le.ssrc===C);if(se){let le=Nl*Xg;se.timestamp&&H.timestamp&&(le=H.timestamp-se.timestamp),se.bytes!=null&&H.bytes!=null&&Me(j,He.Audio_Send_Bitrate,8*(H.bytes-se.bytes)/le),se.packets!=null&&H.packets!=null&&Me(j,He.Audio_Send_Package_Rate,1e3*(H.packets-se.packets)/le)}}return j}(y[0].ssrcId,t,E,0,i)}}),{high:h,low:f,audio:u}}getInboundStats(t,n,i,o){if(!this.requestRemoteMedia)return;const c=this.requestRemoteMedia()||[],l=[];return c.forEach(u=>{let[h,f]=u;const m={peer:h.uid};if(f.has(Se.VIDEO)&&h.videoTrack){const g=h._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(h._videoSSRC)||!1,E=h.videoTrack?function(y,I,C,w,D,P,x,K){const H=I.videoRecv.find(Fe=>Fe.ssrc===y);if(!H)return;const j={},{receivedFrame:J,outputFrame:re,decodeFrameRate:se}=H;Me(j,Qn.Video_Render_Frame_Rate_Decode,se),H.framesRateFirefox&&Me(j,Qn.Video_Recv_Frame_Rate,H.framesRateFirefox),J&&Me(j,Qn.Video_Recv_Frame_Rate,J.frameRate),Me(j,Qn.Video_Recv_Frame_Dropped,H.framesDroppedCount),Me(j,Qn.Video_Recv_Bytes_Retransmit,H.retransmittedBytesReceived),Me(j,Qn.Video_Recv_Packages_Retransmit,H.retransmittedPacketsReceived),Me(j,Qn.Video_Recv_Packages_Discarded,H.packetsDiscarded),Me(j,Qn.Video_Recv_Avg_Decode,H.avgDecodeMs),Me(j,Qn.Video_Recv_Avg_Processing_Delay,H.avgProcessingDelayMs),Me(j,Qn.Video_Recv_Avg_Assembly_Time,H.avgFramesAssembledFromMultiplePacketsMs),Me(j,Qn.Video_Recv_Avg_Inter_Frame_Delay,H.avgInterFrameDelayMs),Me(j,Qn.Video_Recv_Key_Frames_Decoded,H.keyFramesDecoded);const le=K&&K.videoRecv.find(Fe=>Fe.ssrc===y);if(le){const Fe=I.timestamp-K.timestamp||Nl;H.packetsLost!=null&&le.packetsLost!=null&&Me(j,Qn.Video_Recv_Package_Lost,H.packetsLost-le.packetsLost),le.bytes!=null&&H.bytes!=null&&Me(j,Qn.Video_Recv_Bitrate,8*(H.bytes-le.bytes)/Fe),le.packets!=null&&H.packets!=null&&Me(j,Qn.Video_Recv_Package_Rate,1e3*(H.packets-le.packets)/Fe)}const Je=P&&P.videoRecv.find(Fe=>Fe.ssrc===y);if(Je&&(Me(j,_o.Video_Recv_Qp_Sum,H.qpSumPerFrame),j[_o.Video_Recv_Freeze]=w&&Mp.isRemoteVideoFreeze(C,H,Je)?1:0),x){var nt;const Fe=x.videoRecv.find(yt=>yt.ssrc===y);J?(Me(j,He.Video_Recv_Height,J.height),Me(j,He.Video_Recv_Width,J.width)):C&&(Me(j,He.Video_Recv_Height,C._videoHeight||0),Me(j,He.Video_Recv_Width,C._videoWidth||0)),re&&Me(j,He.Video_Recv_Frame_Rate_Output,re.frameRate);const Rt=(nt=C._player)===null||nt===void 0?void 0:nt.rendFrameRate.toFixed(0);if(Rt&&Me(j,He.Video_Render_Frame_Rate_Render,+Rt),Me(j,He.Video_Recv_Jitter_Buffer,H.jitterBufferMs),Me(j,He.Video_Recv_Current_Delay,H.currentDelayMs),Me(j,He.Video_Recv_Firs,H.firsCount),Me(j,He.Video_Recv_Nacks,H.nacksCount),Me(j,He.Video_Recv_Plis,H.plisCount),C){j[He.Video_Recv_Disabled]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1;const yt=C._player;if(yt){const{freezeTimeCounterList:_r,renderFreezeAccTime:ie,renderFreezeAccTime2:he,videoElementStatus:Te}=yt;if(_r&&_r.length>0&&Me(j,_o.Video_Render_Freeze_Time,_r.splice(0,1)[0]),D&&Go.visibility==="visible"&&Te===hr.PLAYING&&ft().supportRequestVideoFrameCallback){const oe=Math.min(6e3,he);yt.renderFreezeAccTime2=Math.max(0,he-oe),Me(j,_o.Video_Render_Freeze_Time_Render2,oe);const R=Math.min(6e3,ie);yt.renderFreezeAccTime=Math.max(0,ie-R),Me(j,_o.Video_Render_Freeze_Time_Render,M("USE_NEW_RENDER_FREEZE_TIME")?oe:R)}if(typeof H.totalFreezesDuration=="number"){const oe=Fe&&Fe.totalFreezesDuration?H.totalFreezesDuration-Fe.totalFreezesDuration:H.totalFreezesDuration;Me(j,He.Video_Render_Freeze_Duration,1e3*oe)}}}if(j[He.Video_Recv_Player_Status]=O0[C._player?C._player.videoElementStatus:"uninit"],Fe&&H.totalInterFrameDelay!==void 0&&H.totalSquaredInterFrameDelay!==void 0&&Fe.totalInterFrameDelay!==void 0&&Fe.totalSquaredInterFrameDelay!==void 0){const yt=H.totalInterFrameDelay-Fe.totalInterFrameDelay,_r=H.totalSquaredInterFrameDelay-Fe.totalSquaredInterFrameDelay,ie=H.framesDecodeCount-Fe.framesDecodeCount,he=yt/ie*1e3,Te=Math.round(1e3*Math.sqrt((_r-Math.pow(yt,2)/ie)/ie));!isNaN(Te)&&he+Te>Math.max(3*he,he+150)&&(j[He.Video_Recv_I_Frame_Delay]=Te)}}return j}(h._videoSSRC,t,h.videoTrack,g===!0,this.needUploadRenderFreezeTime,n,i,o):void 0;E&&(m.video=E)}if(f.has(Se.AUDIO)&&h.audioTrack){const g=h.audioTrack?function(E,y,I,C,w,D){const P=y.audioRecv.find(j=>j.ssrc===E);if(!P)return;const x={};Me(x,Qn.Audio_Recv_Jitter,P.jitterMs),Me(x,Qn.Audio_Recv_Bytes_Retransmit,P.retransmittedBytesReceived),Me(x,Qn.Audio_Recv_Packages_Retransmit,P.retransmittedPacketsReceived),Me(x,Qn.Audio_Recv_Packages_Discarded,P.packetsDiscarded),Me(x,Qn.Audio_Recv_Avg_Processing_Delay,P.avgProcessingDelayMs);const K=D&&D.audioRecv.find(j=>j.ssrc===E);if(K){const j=Nl;P.packets!=null&&K.packets!=null&&Me(x,Qn.Audio_Recv_Package_Rate,1e3*(P.packets-K.packets)/j),P.packetsLost!=null&&K.packetsLost!=null&&Me(x,Qn.Audio_Recv_Package_Lost,P.packetsLost-K.packetsLost)}if(C){const{receivedFrames:j,droppedFrames:J}=P;j!=null&&J!=null&&(x[_o.Audio_Recv_Freeze]=(H=j)===0||100*J/H>20?1:0)}var H;if(w){const j=100*I._source.getAccurateVolumeLevel(),J=P.outputLevel;if(J!=null){const se=Math.ceil(50*Math.log10(100*J+1));Me(x,He.Audio_Render_Level,se)}Me(x,He.Audio_Recv_PCM_Level,j),I&&(x[He.Audio_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),Me(x,He.Audio_Recv_Jitter_Buffer,P.jitterBufferMs),Me(x,He.Audio_Recv_Current_Delay,P.jitterBufferMs),x[He.Audio_Recv_Player_Status]=O0[qr.getPlayerState(I.getTrackId())];const re=w.audioRecv.find(se=>se.ssrc===E);if(re){re.bytes!=null&&P.bytes!=null&&Me(x,He.Audio_Recv_Bitrate,8*(P.bytes-re.bytes)/(Nl*xp));const se=P.concealedSamples-re.concealedSamples;se>0&&Me(x,He.Audio_Recv_Concealed_Samples,se);const le=P.totalSamplesReceived-re.totalSamplesReceived;le>0&&Me(x,He.Audio_Recv_Total_Samples_Received,le);const Je=P.freezeSamples80-re.freezeSamples80;Je>0&&Me(x,He.Audio_Render_Freeze_Samples_80ms,Je);const nt=P.freezeSamples200-re.freezeSamples200;nt>0&&Me(x,He.Audio_Render_Freeze_Samples_200ms,nt);const Fe=P.freezeMs80-re.freezeMs80;Me(x,He.Audio_Render_Freeze_Time_80ms,Fe<0?0:Fe);const Rt=P.freezeMs200-re.freezeMs200;Me(x,He.Audio_Render_Freeze_Time_200ms,Rt<0?0:Rt)}}return x}(h._audioSSRC,t,h.audioTrack,n,i,o):void 0;g&&(m.audio=g)}(m.video||m.audio)&&l.push(m)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof Rp);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(wp.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(Se.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),i.has(Se.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:M("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let o=[];const c=this.requestAllTracks&&this.requestAllTracks()||[];for(const f of c)!f.muted&&f.enabled&&(o=o.concat(await f.getProcessorUsage()));const l=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[f,m]of l)m.has(Se.VIDEO)&&f.videoTrack&&(o=o.concat(await f.videoTrack.getProcessorUsage())),m.has(Se.AUDIO)&&f.audioTrack&&(o=o.concat(await f.audioTrack.getProcessorUsage()));if(o.length===0)return;i.details=function(f,m){const g={};for(const{id:C,value:w,level:D,direction:P}of f){var E;const x=(E=m.get(C))!==null&&E!==void 0?E:0,K=w===2?x+M("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:x;var y,I;m.set(C,K),g[C]?(w===2&&(g[C].value=w),D>g[C].level&&(g[C].level=D),P==="remote"&&(g[C].remoteUidCount+=1),g[C].totalTs=(y=m.get(C))!==null&&y!==void 0?y:0):g[C]={value:w,level:D,remoteUidCount:P==="local"?0:1,totalTs:(I=m.get(C))!==null&&I!==void 0?I:0}}return Object.keys(g).map(C=>{const{level:w,value:D,totalTs:P}=g[C];return{id:C,level:w,value:D,totalTs:P}})}(o,t);const u=Date.now(),h=u>n?u:n+1;this.requestUpload&&this.requestUpload(wp.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:h})},M("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Fte=M("ICE_RESTART_INTERVAL");let Jg=new Map,Cu=new Map,_c=[fr.UDP_TCP_RELAY,fr.TCP_RELAY,fr.RELAY],IC=M("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ft().supportPCSetConfiguration;function nV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Jg.get(e.id);n&&(window.clearTimeout(n),Jg.delete(e.id));const i=Cu.get(e.id);t&&i&&i.index===_c.length-1&&(S.debug("[".concat(e.id,"] reset ICE restart policy")),Cu.delete(e.id))}function rV(e,t,n){if(Jg.size===0&&Cu.size===0&&(Array.isArray(M("RESTART_SEQUENCE"))&&M("RESTART_SEQUENCE").length>0&&!function(u,h){if(u.length!==h.length)return!1;for(let f=0;f<u.length;f+=1){const m=u[f];if(u.filter(g=>g===m).length!==h.filter(g=>g===m).length)return!1}return!0}(_c,M("RESTART_SEQUENCE"))&&(_c=M("RESTART_SEQUENCE").filter(u=>{var h;if(pe(h=Object.values(fr)).call(h,u))return!0}),S.debug("use reconnection policy from config distribution, queues: ".concat(_c.join(" => ")))),IC=M("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ft().supportPCSetConfiguration),_c.length===0)return void n();let i,{index:o=0,type:c}=Cu.get(e.id)||{};if(IC&&c===fr.RELAY)return void n();let l=c&&o>=_c.length-1;if(IC)c=fr.RELAY;else{if(l)return void n();c?(o++,c=_c[o]):(c=_c[0],o=0)}S.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(c,", index: ").concat(o)),t(c),Cu.set(e.id,{index:o,type:c}),i=window.setTimeout(()=>rV(e,t,n),Fte),Jg.set(e.id,i)}var it;function iV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function zo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iV(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function sV(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=WR,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new $g(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function $g(e){function t(n){if(Object(n)!==n)return ve.reject(new TypeError(n+" is not an object."));var i=n.done;return ve.resolve(n.value).then(function(o){return{value:o,done:i}})}return $g=function(n){this.s=n,this.n=n.next},$g.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?ve.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?ve.reject(n):t(i.apply(this.s,arguments))}},new $g(e)}let Up=(it=class extends nn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Pe.StateChange,t,this._state)}constructor(e,t){super(),O(this,"isPlanB",void 0),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"connection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"remoteDataChannelMap",new Map),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"pendingLocalDataChannels",[]),O(this,"pendingRemoteDataChannels",[]),O(this,"statsCollector",void 0),O(this,"shouldForwardP2PCreation",void 0),O(this,"iceFailedCount",0),O(this,"dtlsFailedCount",0),O(this,"mutex",void 0),O(this,"_state",wt.Disconnected),O(this,"_pcStatsUploadType",M("NEW_ICE_RESTART")?Sa.FIRST_CONNECTION:Sa.OLD_FIRST_CONNECTION),O(this,"_isStartRestartIce",!1),O(this,"_restartTimer",void 0),O(this,"_isTryConnecting",!1),O(this,"_iceError",null),O(this,"_forceTurn",!1),O(this,"_isWaitPcToRePub",!1),O(this,"handleMuteLocalTrack",async(n,i,o)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==wt.Connected)return void o(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void i();const u=l.find(f=>f[0]==="videoLowTrack");if(u){const f=u[1];this.store.enableInstantMuteRestore?(f.track._originMediaStreamTrack.enabled=!1,S.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):f.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?S.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(l.map(f=>{let[,{id:m}]=f;return m}));const h=this.createMuteMessage(l);await xt(this,Pe.RequestMuteLocal,h),i()}catch(l){o(l)}finally{c()}}),O(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==wt.Connected)return void o(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const l=this.filterTobeUnmutedTracks(n);if(l.length===0)return void i();const u=l.find(f=>f[0]==="videoLowTrack");if(u){const f=u[1];if(this.store.enableInstantMuteRestore)f.track._originMediaStreamTrack.enabled=!0,S.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(f.track._originMediaStreamTrack.stop(),!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){const m=n._mediaStreamTrack.clone();f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}else{const m=bC(n,_p(this,Pe.RequestLowStreamParameter));f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}await new ve((m,g)=>{this.handleReplaceTrack(f.track,m,g,!0)})}}this.store.enableInstantMuteRestore?S.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(l.map(f=>{let[,{id:m}]=f;return m}));const h=this.createUnmuteMessage(l);await xt(this,Pe.RequestUnmuteLocal,h),i()}catch(l){o(l)}finally{c()}}),O(this,"handleUpdateVideoEncoder",async(n,i,o,c)=>{let l;c||(l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const h=this.localTrackMap.get(ae.LocalVideoTrack);if(!this.connection||!h||h.track!==n||this.state!==wt.Connected)return void i();const{id:f,track:m}=h;await this.connection.updateSendParameters(f,m),await this.connection.updateEncoderConfig(f,m),this.emit(Pe.UpdateVideoEncoder,m),i()}catch(h){o(h)}finally{var u;(u=l)===null||u===void 0||u()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,o)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const l=this.localTrackMap.get(ae.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==wt.Connected)return void i();const{id:u,track:h}=l;await this.connection.updateSendParameters(u,h),i()}catch(l){o(l)}finally{c()}}),O(this,"handleReplaceMixingTrack",async(n,i,o,c)=>{if(!this.connection||this.state!==wt.Connected)return void i();const l=CC([n]);let u;S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),typeof c=="boolean"&&c||(u=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,l),i()}catch(f){o(f)}finally{var h;(h=u)===null||h===void 0||h()}}),O(this,"handleReplaceTrack",async(n,i,o,c)=>{let l;S.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(l=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;const f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:g}]=m;return n===g});if(!this.connection||!f||this.state!==wt.Connected)return void i();if(await((u=this.connection)===null||u===void 0?void 0:u.replaceTrack(n,f[1].id)),this.isPlanB){const m=f[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(f[0],m)}if(f[0]===ae.LocalVideoTrack&&!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){const m=this.localTrackMap.get(ae.LocalVideoLowTrack);if(m){const g=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=g,m.track._originMediaStreamTrack=g,await new ve((E,y)=>{this.handleReplaceTrack(m.track,E,y,!0)})}}i()}catch(f){o(f)}finally{var h;(h=l)===null||h===void 0||h()}}),O(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new tV(this.store),this.bindStatsUploaderEvents(),this.mutex=new ur("P2PChannel-mutex",this.store.clientId),this.isPlanB=!ft().supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&ga(),this.shouldForwardP2PCreation=M("FORWARD_P2P_CREATION")&&ft().supportPCSetConfiguration&&n0(),this.shouldForwardP2PCreation&&(this.connection=Yg(this.store),this.emit(Pe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=wt.New,this._forceTurn=JU(e),S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Yg(this.store,e),this.emit(Pe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=M("NEW_ICE_RESTART")?Sa.FIRST_CONNECTION:Sa.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===wt.Connected){if(this.connection instanceof is&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),be.reportApiInvoke(this.store.sessionId,{name:un.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Jt.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Pe.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=wt.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(o=>{var c;let[l]=o;return pe(c=[ae.LocalVideoLowTrack,ae.LocalVideoTrack]).call(c,l)}),n=t.map(o=>{let[,{id:c}]=o;return c}),i=t.map(o=>{let[c]=o;return c});if(this.connection instanceof is){if(be.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!pe(e).call(e,this.store.codec)){const o=["vp9","vp8","h264"].find(c=>pe(e).call(e,c));o&&(this.store.codec=o,S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(o,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof is&&this.connection.peerConnectionState!=="closed"&&pe(e=[wt.New,wt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==wt.Connected){if(this.state===wt.Disconnected)throw new ne(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var i;pe(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var i=this;return Qi(function*(){const o=yield pt(i.mutex.lock("From P2PChannel.publish"));try{var c;const l=i.connection&&pe(c=["disconnected","failed"]).call(c,i.connection.peerConnectionState);if(!i.connection||i.state!==wt.Connected||l){if(i.state===wt.Disconnected)throw new ne(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const h=e.filter(f=>i.pendingLocalTracks.indexOf(f)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(h),void(l&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,mr.markPublishStart(i.store.clientId,i.store.pubId);const u=i.filterTobePublishedTracks(e,t,n);if(u.length===0)return void(yield pt(i.tryToUnmuteAudio(e)));yield*G_(sV(i.doPublish(i.connection,u)))}finally{o()}})()}doPublish(e,t){var n=this;return Qi(function*(){t.forEach(E=>{let{track:y,type:I}=E;const C=Date.now();n.store.publish(y.getTrackId(),I===ae.LocalAudioTrack?"audio":"video",C)}),n.bindLocalTrackEvents(t);const i=t.map(E=>{let{track:y}=E;return y}),o=yield pt(e.send(i,n.store.codec,n.store.audioCodec)),c=(yield pt(o.next())).value,l=n.createGatewayPublishMessage(t,c);let u;try{u=yield l}catch(E){throw o.throw(E),(E==null?void 0:E.code)===k.WS_ABORT&&t.forEach(y=>{let{track:I}=y;n.pendingLocalTracks.indexOf(I)===-1&&n.pendingLocalTracks.push(I)}),n.unbindLocalTrackEvents(t),E}const h=n.mapPubResToRemoteConfig(l,u,i),f=(yield pt(o.next(h))).value;if(n.state===wt.Disconnected)throw new ne(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");M("ENABLE_VIDEO_SEI");const m=M("ENABLE_ENCODED_TRANSFORM"),g=M("ENABLE_AUDIO_METADATA");i.forEach(async E=>{const y=E.getRTCRtpTransceiver();if(!y||!m)return;const{interceptLocalVideoFrame:I,interceptLocalAudioFrame:C}=Vg();E.trackMediaType===Se.VIDEO?await I(y.sender,E):E.trackMediaType===Se.AUDIO&&await C(y.sender,{metadata:g?()=>{const w=E.metadata.shift();return w&&w.value}:void 0})}),t.forEach(E=>{let{type:y}=E;n.statsCollector.addLocalStats(y)}),n.assignLocalTracks(t,f),n.statsUploader.startUploadOutboundStats(),t.forEach(E=>{let{track:y,type:I}=E;const C=Date.now();n.store.publish(y.getTrackId(),I===ae.LocalAudioTrack?"audio":"video",void 0,C)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof Wt))return S.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,o=function(c,l){const u={};return c.height&&c.width&&(u.scaleResolutionDownBy=oC(c,l)),u.maxFramerate=c.framerate?Ti(c.framerate):void 0,u.maxBitrate=c.bitrate?1e3*c.bitrate:void 0,u}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==ae.LocalVideoLowTrack||!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding)o.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{const c=i._originMediaStreamTrack;if(!c.canvas)return S.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(l,u){const h=l.canvas;u.width&&(h.width=Ti(u.width)),u.height&&(h.height=Ti(u.height)),u.framerate&&(h.stopCapture&&h.stopCapture(),h.stopCapture=P0(()=>{!h.startCapture&&h.stopCapture&&h.stopCapture(),h.startCapture&&h.startCapture()},Ti(u.framerate)))})(c,e)}o.maxBitrate!=null&&(i._encoderConfig.bitrateMax=o.maxBitrate/1e3),o.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=o.maxFramerate:i._encoderConfig.frameRate={max:o.maxFramerate}),S.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return Qi(function*(){if(!t.connection||t.state!==wt.Connected)return;const n=yield pt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(ae.LocalVideoTrack);if(!o)throw new ne(k.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ae.LocalVideoLowTrack))throw new ne(k.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const c=[{track:t.getLowVideoTrack(o.track,e),type:ae.LocalVideoLowTrack}];if(yield*G_(sV(t.doPublish(t.connection,c))),o.track.muted||!o.track.enabled){var i;const l=(i=t.localTrackMap.get(ae.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;l!==void 0&&(yield pt(t.connection.muteLocal([l])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await sr(this,Pe.RequestRePublish,this.pendingLocalTracks),this.emit(Pe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await sr(this,Pe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==Se.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==Se.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await sr(this,Pe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Se.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Pe.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==wt.Connected)return void e.forEach(i=>{const o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==wt.Connected)return void e.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==wt.Connected)return;const e=this.localTrackMap.get(ae.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ae.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[o,{track:c}]=i;return{type:o,track:c}})),t.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==wt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(i=>{var o;return!((o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(i=>{var o;this.remoteDataChannelMap.has(e)?(o=this.remoteDataChannelMap.get(e))===null||o===void 0||o.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const c=this.pendingRemoteDataChannels.findIndex(l=>{let{user:u,id:h}=l;return u.uid===e.uid&&h===i.id});c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),n.map(i=>i.id)}async subscribe(e,t,n,i,o){var c;if(!this.connection||this.state!==wt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let l,u,h,f;const m=this.connection.getPreMedia(n);if(m)S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),h=m.transceiver,l=m.track,u=m.mid,f=m.player,m.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:m.firstVideoRender});else if(o){const y=o.find(C=>{let{stream_type:w}=C;return w===t});if(!y)throw new ne(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const I=await this.connection.receive(t,y.ssrcs,String(e._uintid),y.attributes);this.connection instanceof is&&(h=I.transceiver),l=I.track,u=I.id}else{const y=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);this.connection instanceof is&&(h=y.transceiver),l=y.track,u=y.id}if(t===Se.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new uu(l,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new du(l,e.uid,e._uintid,this.store,f),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(ts.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(ts.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),f?e._videoTrack.once(ts.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(ts.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack)),h&&M("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:y,interceptRemoteAudioFrame:I}=Vg();t==Se.VIDEO?await y(h.receiver,{onSei:M("ENABLE_VIDEO_SEI")&&(C=>{var w;return(w=e._videoTrack)===null||w===void 0?void 0:w._onSei(C)})}):t==Se.AUDIO&&await I(h.receiver,{enableTopn:!!M("ENABLE_AUDIO_TOPN"),enableMetadata:!!M("ENABLE_AUDIO_METADATA"),enablePts:!!M("ENABLE_AUDIO_PTS"),onMetadata:C=>{this.safeEmit(Pe.AudioMetadata,C)},onPts:C=>{this.safeEmit(Pe.AudioPts,C)}})}const g=this.remoteUserMap.get(e);g?g.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex(y=>{let{user:I,kind:C}=y;return I.uid===e.uid&&t===C});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Pe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==wt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(o=>{var c;let{user:l,mediaType:u}=o;return!((c=this.remoteUserMap.get(l))!==null&&c!==void 0&&c.has(u))});const t=[],n=new Map;e.forEach(o=>{if(!this.connection)return;const c=this.connection.getPreMedia(o.ssrcId);if(c){const{track:l,mid:u,transceiver:h,player:f}=c;n.set(o.ssrcId,{track:l,id:u,transceiver:h,player:f})}else t.push(o)});const i=await this.connection.batchReceive(t.map(o=>{let{user:c,mediaType:l,ssrcId:u,rtxSsrcId:h}=o;return{kind:l,ssrcMsg:[{ssrcId:u,rtx:h}],mslabel:String(c._uintid)}}));t.forEach((o,c)=>{n.set(o.ssrcId,i[c])});for(const{user:o,mediaType:c,ssrcId:l}of e){const u=n.get(l);if(!u)return void S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(c,", ").concat(l));const{track:h,id:f,transceiver:m,player:g}=u;if(m&&M("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:C}=Vg();c==Se.VIDEO?await I(m.receiver,{onSei:M("ENABLE_VIDEO_SEI")&&(w=>{var D;return(D=o._videoTrack)===null||D===void 0?void 0:D._onSei(w)})}):c==Se.AUDIO&&await C(m.receiver,{enableTopn:!!M("ENABLE_AUDIO_TOPN"),enableMetadata:!!M("ENABLE_AUDIO_METADATA"),enablePts:!!M("ENABLE_AUDIO_PTS"),onMetadata:w=>{this.safeEmit(Pe.AudioMetadata,w)},onPts:w=>{this.safeEmit(Pe.AudioPts,w)}})}if(c===Se.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(h):(o._audioTrack=new uu(h,o.uid,o._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),m&&o._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(h):(o._videoTrack=new du(h,o.uid,o._uintid,this.store,g),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),m&&o._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(o,o._videoTrack)),M("ENABLE_VIDEO_SEI")&&m){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:C}=Vg();c==Se.VIDEO?await I(m.receiver,{onSei:w=>{var D;(D=o._videoTrack)===null||D===void 0||D._onSei(w)}}):c==Se.AUDIO&&await C(m.receiver)}const E=this.remoteUserMap.get(o);E?E.set(c,f):this.remoteUserMap.set(o,new Map([[c,f]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();const y=this.pendingRemoteTracks.findIndex(I=>{let{user:C,kind:w}=I;return C.uid===o.uid&&c===w});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(Pe.MediaReconnectEnd,o.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(i.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===wt.Connected||n||i.forEach(l=>{let{kind:u}=l;var h;if(u===Se.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===Se.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==wt.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(l=>{let[,{id:u}]=l;return u}));const c=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach(l=>{let[u,{kind:h}]=l;var f,m;if(h===Se.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Se.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),n||((m=u._videoTrack)===null||m===void 0||m._destroy(),u._videoTrack=void 0);else if(h===Se.AUDIO){var g;this.unbindRemoteTrackEvents(u._audioTrack),!n&&((g=u._audioTrack)===null||g===void 0||g._destroy(),u._audioTrack=void 0)}}),c}async unsubscribeDataChannel(e,t){if(t.forEach(o=>{const c=this.pendingRemoteDataChannels.findIndex(l=>l.id===o.id);c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(o=>{o._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(o=>{i&&i.delete(o.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(o=>o.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:c}of e){const l=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:f}=u;return c!==void 0?h.uid===o.uid&&c===f:h.uid===o.uid});l.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),t=t.concat(l)}if(!this.connection||this.state!==wt.Connected)return void t.forEach(o=>{let{user:c,kind:l}=o;var u;if(l===Se.AUDIO)(u=c._audioTrack)===null||u===void 0||u._destroy(),c._audioTrack=void 0;else if(l===Se.VIDEO){var h;(h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0}});const n=Rs(e).call(e,(o,c)=>{let{user:l,mediaType:u}=c;const h=this.filterTobeUnSubscribedTracks(l,u);return o.concat(h)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:c}]=o;return c}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(o=>{let[c,{kind:l}]=o;var u,h;if(l===Se.VIDEO&&c._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Se.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),(h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0;else if(l===Se.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),(f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==wt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Se.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(ae.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(ae.LocalAudioTrack);if((t==null?void 0:t.track)instanceof On){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==ae.LocalAudioTrack}).filter(i=>{let[o]=i;return!(e&&o===ae.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ae.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,o){if(e){const l=this.localTrackMap.get(ae.LocalAudioTrack),u=i?this.localTrackMap.get(ae.LocalVideoLowTrack):this.localTrackMap.get(ae.LocalVideoTrack);be.publish(this.store.sessionId,{eventElapse:mr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(kt.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var c;n||(n=[]);const l=n.find(h=>h instanceof dn),u=i?(c=this.localTrackMap.get(ae.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(h=>h instanceof Wt);be.publish(this.store.sessionId,{eventElapse:mr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(kt.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,i){const o=i===Se.VIDEO?n._videoSSRC:n._audioSSRC;o&&be.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Se.VIDEO,audio:i===Se.AUDIO,peerid:n.uid,subscribeRequestid:o,p2pid:this.store.p2pId,eventElapse:mr.measureFromSubscribeStart(this.store.clientId,o),preSsrc:this.isPreSubScribe(o)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ur("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Yg(this.store),this.emit(Pe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ae.LocalAudioTrack);if((e==null?void 0:e.track)instanceof On){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=wt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ae.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ae.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Wt||t&&t.track instanceof dn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(si(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ae.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=cl(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=wt.Reconnecting,M("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Yg(this.store),this.emit(Pe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ae.LocalVideoTrack:pe(t=i._hints).call(t,kt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ae.LocalAudioTrack:i instanceof On?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ae.LocalVideoLowTrack:}}),this.emit(Pe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(si(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Pe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(si(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:o}=n;if((e instanceof mc?e.uid:e)===i.uid&&o===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((e instanceof mc?e.uid:e)===i.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Qi(function*(){if(!t.connection||t.state!==wt.Connected)return;const n=yield pt(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield pt(t.connection.restartICE(e));const c=yield pt(i.next());if(c.done)return;const l=c.value,u=yield l;switch(wC(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case fr.UDP_TCP_RELAY:t._pcStatsUploadType=Sa.UDP_TCP_RESTART;break;case fr.TCP_RELAY:t._pcStatsUploadType=Sa.TCP_RESTART;break;case fr.RELAY:t._pcStatsUploadType=Sa.RELAY_RESTART;break;default:t._pcStatsUploadType=Sa.OLD_RESTART}t._isTryConnecting=!0,i.next(u)}catch(c){var o;(o=i)===null||o===void 0||o.throw(c)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ae.LocalVideoTrack),n=this.localTrackMap.get(ae.LocalAudioTrack),i=e.videoSend.find(y=>y.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),o=e.audioSend.find(y=>y.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!o)return 1;const c=ki(this,Pe.NeedSignalRTT),l=i?i.rttMs:void 0,u=o?o.rttMs:void 0,h=l&&u?(l+u)/2:l||u,f=(h&&c?(h+c)/2:h||c)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,g=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,E=t==null?void 0:t.track;if(E&&E._encoderConfig&&E._hints.indexOf(kt.SCREEN_TRACK)===-1){const y=E._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(y&&I){const C=(1e3*y-I)/(1e3*y);return K2[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,c=i._videoSSRC,l=e.audioRecv.find(I=>I.ssrc===o),u=e.videoRecv.find(I=>I.ssrc===c);if(!l&&!u)return void(t+=1);const h=ki(this,Pe.NeedSignalRTT),f=e.rtt,m=(f&&h?(f+h)/2:f||h)||0,g=l?l.jitterMs:void 0,E=e.recvPacketLossRate;let y=.7*E*100/50+.3*m/1500;g&&(y=.6*E*100/50+.2*m/1500+.2*g/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ve((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(S.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==wt.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return e===l});if(!i)return;const o=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:o}]),this.bindLocalTrackEvents([{track:t,type:o}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const c=i[1];c.id=t._mediaStreamTrack.id,this.localTrackMap.set(o,c)}if(o===ae.LocalVideoTrack&&!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){const c=this.localTrackMap.get(ae.LocalVideoLowTrack);if(c){const l=e._mediaStreamTrack.clone();c.track._originMediaStreamTrack.stop(),c.track._mediaStreamTrack=l,c.track._originMediaStreamTrack=l,await new ve((u,h)=>{this.handleReplaceTrack(c.track,u,h,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],o=this.getAllTracks();e=$d(e=e.filter(h=>o.indexOf(h)===-1));let c,l=!1;const u=this.localTrackMap.get(ae.LocalAudioTrack);for(const h of e){if(h instanceof Wt&&(this.localTrackMap.has(ae.LocalVideoTrack)||l?new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:h,type:ae.LocalVideoTrack}),l=!0),t)){const f=this.getLowVideoTrack(h,n);i.push({track:f,type:ae.LocalVideoLowTrack})}if(h instanceof dn)if(u){const f=u.track;if(f instanceof On)RC([h]),f.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0);else{const m=CC([f,h]);S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(f,m)}}else c instanceof On?(RC([h]),c.addAudioTrack(h)):c||!h._useAudioElement&&ft().webAudioMediaStreamDest&&!h._bypassWebAudio?c=CC(c?[h,c]:[h]):c=h}return c&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(c.getTrackId(),"]")),i.push({track:c,type:ae.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=$d(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof dn){const o=this.localTrackMap.get(ae.LocalAudioTrack);if(!o)continue;o.track instanceof On?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(t.push([ae.LocalAudioTrack,o]),o.track.close())):t.push([ae.LocalAudioTrack,o])}if(i instanceof Wt){const o=this.localTrackMap.get(ae.LocalVideoTrack);if(!o)continue;t.push([ae.LocalVideoTrack,o]);const c=this.localTrackMap.get(ae.LocalVideoLowTrack);c&&t.push([ae.LocalVideoLowTrack,c])}}return t}filterTobePublishedDataChannels(e){return e=(e=$d(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=$d(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ae.LocalVideoTrack:n.addListener(Re.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Re.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Re.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Re.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ae.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ae.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof On?e.trackList.forEach(n=>{n.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Re.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Re.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Re.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ae.LocalVideoTrack:n.off(Re.GET_STATS,this.handleGetLocalVideoStats),n.off(Re.GET_RTC_STATS,this.handleGetRTCStats),n.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Re.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Re.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ae.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ae.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof On?e.trackList.forEach(t=>{t.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Re.GET_STATS,this.handleGetLocalAudioStats),t.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Re.GET_STATS,this.handleGetLocalAudioStats),e.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Re.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof du&&t.addListener(Re.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof uu&&t.addListener(Re.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Re.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Se.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Se.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var o;let c,l,{track:u,type:h}=n;switch(h){case ae.LocalAudioTrack:c=bt.Audio,l={dtx:u instanceof Rp&&u._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ae.LocalVideoTrack:c=pe(o=u._hints).call(o,kt.SCREEN_TRACK)?bt.Screen:bt.High,l=zo(zo({},aU(u)),{},{codec:this.store.codec,svc_mode:kg()});break;case ae.LocalVideoLowTrack:c=bt.Low,l=zo(zo({},aU(u)),{},{codec:this.store.codec,svc_mode:kg()})}return{stream_type:c,attributes:l,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=t;switch(o){case ae.LocalVideoTrack:i=pe(n=c._hints).call(n,kt.SCREEN_TRACK)?bt.Screen:bt.High;break;case ae.LocalAudioTrack:i=bt.Audio;break;case ae.LocalVideoLowTrack:i=bt.Low}return{stream_type:i,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:o,type:c}=n;this.localTrackMap.set(c,{track:o,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Pe.PeerConnectionStateChange,t),t==="connecting"&&e instanceof is&&!sn()&&M("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},M("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof is&&nV(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Sa.DISCONNECTED_OR_FAILED,ki(this,Pe.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(o=>o.getTrackId()),i=this.pendingLocalDataChannels.map(o=>"dc_".concat(o.id));be.reportApiInvoke(this.store.sessionId,{name:un.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:Jt.TRACER}).onSuccess(),this.republish()}if(M("NEW_ICE_RESTART")&&e instanceof is&&!sn()&&!this._forceTurn){if(pe(tU).call(tU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=o=>{wC(e)&&(S.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(o)),ki(this,Pe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Pe.RequestRestartICE,o))},i=()=>{wC(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),S.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Pe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{rV(e,n,i)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&M("ICE_RESTART")&&ki(this,Pe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Pe.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Pe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Pe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Jt.TRACER}).onSuccess(),this.emit(Pe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(si(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(ts.FIRST_FRAME_DECODED),be.firstRemoteFrame(this.store.sessionId,Ln.FIRST_AUDIO_DECODE,Xt.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:mr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(si(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);i&&be.firstRemoteFrame(this.store.sessionId,Ln.FIRST_AUDIO_RECEIVED,Xt.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:mr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{var o;const c=Array.from(si(o=this.remoteUserMap).call(o)).find(l=>l._videoSSRC===t);c&&this.store.firstVideoFrameDecoded(c.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoRender=t=>{var n;const i=Array.from(si(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i))},e.onFirstVideoReceived=t=>{var n;const i=Array.from(si(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),be.firstRemoteFrame(this.store.sessionId,Ln.FIRST_VIDEO_RECEIVED,Xt.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:mr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(Pe.ConnectionTypeChange,i),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(dc(n))," -> ").concat(JSON.stringify(dc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(dc(n))," -> ").concat(JSON.stringify(dc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return zo(zo({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof is&&function(t){Cu.delete(t.id),nV(t)}(e),e.close(),this.emit(Pe.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ae.LocalAudioTrack);if(e instanceof dn&&(n==null?void 0:n.track)instanceof On)return n.track.isActive||t.push([ae.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(i&&(t.push(i),i[0]===ae.LocalVideoTrack)){const o=this.localTrackMap.get(ae.LocalVideoLowTrack);o&&t.push([ae.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ae.LocalAudioTrack);if(e instanceof dn&&(n==null?void 0:n.track)instanceof On)return n.track.isActive&&t.push([ae.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(i)if(i[0]===ae.LocalVideoTrack){t.push(i);const o=this.localTrackMap.get(ae.LocalVideoLowTrack);o&&t.push([ae.LocalVideoLowTrack,o])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=t;switch(o){case ae.LocalAudioTrack:i=bt.Audio;break;case ae.LocalVideoTrack:i=pe(n=c._hints).call(n,kt.SCREEN_TRACK)?bt.Screen:bt.High;break;case ae.LocalVideoLowTrack:i=bt.Low}return{stream_type:i,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=t;switch(o){case ae.LocalAudioTrack:i=bt.Audio;break;case ae.LocalVideoTrack:i=pe(n=c._hints).call(n,kt.SCREEN_TRACK)?bt.Screen:bt.High;break;case ae.LocalVideoLowTrack:i=bt.Low}return{stream_type:i,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const o=i.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(i.entries()).forEach(o=>{let[c,l]=o;n.push([e,{kind:c,id:l}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var o;(o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:o,id:c}]=n;switch(o){case Se.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Se.VIDEO,ssrcId:i._videoSSRC}));case Se.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Se.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:o}]=n;if(t.has(i)){let c=t.get(i);o===Se.VIDEO?c|=Un.Video:c|=Un.Audio,t.set(i,c)}else o===Se.VIDEO?t.set(i,Un.Video):t.set(i,Un.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,o]=n;return{stream_id:i.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ae.LocalVideoTrack),n=this.localTrackMap.get(ae.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ve((i,o)=>{this.handleUpdateVideoEncoder(t.track,i,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ve((i,o)=>{this.handleUpdateVideoEncoder(n.track,i,o,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof is&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof is&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((i,o)=>{var c;let{stream_type:l}=i;const u=(c=t.find(h=>{let{stream_type:f}=h;return l===f}))===null||c===void 0?void 0:c.attributes;if(u&&M("DISABLE_SCREEN_SHARE_REMB")){const h=n[o]._hints;(pe(h).call(h,kt.SCREEN_TRACK)||pe(h).call(h,kt.SCREEN_LOW_TRACK))&&(u.remb=!1,S.debug("disable remb for screen share, hints:",h))}return u})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof dn){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(c=>{let[,{id:l}]=c;return l})));const o=this.createUnmuteMessage(i);return void await xt(this,Pe.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Pe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Pe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Xn(d0(this.dtlsFailedCount,Rn)),this.emit(Pe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await sr(this,Pe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Pe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ae.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Wt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Wt).length>1)throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof dn).length>1&&(e.some(t=>t instanceof dn&&t._bypassWebAudio)||!ft().webAudioMediaStreamDest))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Wt&&this.pendingLocalTracks.some(n=>n instanceof Wt))throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof dn&&this.pendingLocalTracks.some(n=>n instanceof dn)&&(!ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof dn&&n._bypassWebAudio)))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding,o=zo(zo({},{width:160,height:120,framerate:15,bitrate:50}),t);let c;c=i?e._mediaStreamTrack.clone():bC(e,o);const l=Ut(8,"track-low-"),u=new Wt(c,zo(zo({},i&&{scaleResolutionDownBy:oC(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,l);return u.on(Sl.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,iu.LOW_STREAM)}),u._hints.push(kt.LOW_STREAM),pe(n=e._hints).call(n,kt.SCREEN_TRACK)&&u._hints.push(kt.SCREEN_LOW_TRACK),e.on("sei-to-send",h=>{u.emit("sei-to-send",h)}),e.addListener(Re.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof is){var o,c,l,u;const h=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:m,peerConnectionState:g}=this.connection,{local:E,remote:y}=await this.connection.getSelectedCandidatePair();be.pcStats(this.store.sessionId,{startTime:h,eventElapse:e-h||0,iceconnectionsate:f,dtlsstate:m,connectionstate:g,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(o=E==null?void 0:E.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(c=E.candidateType)!==null&&c!==void 0?c:"",selectedLocalCandidateAddress:"".concat(E.address,":").concat(E.port),selectedRemoteCandidateProtocol:(l=y.protocol)!==null&&l!==void 0?l:"",selectedRemoteCandidateType:(u=y.candidateType)!==null&&u!==void 0?u:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(m=>m.userId===e.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:o}=n;if(i&&o)return;const{subscribeEnd:c,firstPreRender:l,peerPublishDuration:u,peerPubStatusMs:h}=n;let{firstRender:f=0}=n;if(c&&(f||l)&&u&&h){n.isInternalUpload=!0;const{playEnd:m}=n;m&&(n.isExternalUpload=!0);const{firstPreRender:g=0}=n;f=g||f;const E=e.videoTrack,y={peer:e._uintid,width:(E==null?void 0:E._videoWidth)||0,height:(E==null?void 0:E._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:u,peerPubStatusMs:h,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:g||0,firstRender:m?Math.max(f,m):Math.max(f,c),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:PM(this.store)};be.firstXLAPeerFirstVideoFrame(this.store.sessionId,y)}}reportVideoFirstFrameDecoded(e,t,n,i){var o;const c=Array.from(si(o=this.remoteUserMap).call(o)).find(l=>l._videoSSRC===e);if(c){i||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===c.uid&&h.type==="video");be.firstRemoteVideoDecode(this.store.sessionId,Ln.FIRST_VIDEO_DECODE,Xt.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:mr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:i?1:0,firstFrame:(u==null?void 0:u.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const o=i.get(t);if(!o)return!1;const c=await this.connection.getRemoteSSRC(o);return c!==void 0&&c!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ae.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,iu.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ce(it.prototype,"startP2PConnection",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"startP2PConnection"),it.prototype),Ce(it.prototype,"connect",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"connect"),it.prototype),Ce(it.prototype,"updateRemoteRTPCapabilities",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"updateRemoteRTPCapabilities"),it.prototype),Ce(it.prototype,"publishDataChannel",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"publishDataChannel"),it.prototype),Ce(it.prototype,"unpublish",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"unpublish"),it.prototype),Ce(it.prototype,"unpublishDataChannel",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"unpublishDataChannel"),it.prototype),Ce(it.prototype,"unpublishLowStream",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"unpublishLowStream"),it.prototype),Ce(it.prototype,"subscribeDataChannel",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"subscribeDataChannel"),it.prototype),Ce(it.prototype,"subscribe",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"subscribe"),it.prototype),Ce(it.prototype,"massSubscribe",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"massSubscribe"),it.prototype),Ce(it.prototype,"unsubscribe",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"unsubscribe"),it.prototype),Ce(it.prototype,"unsubscribeDataChannel",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"unsubscribeDataChannel"),it.prototype),Ce(it.prototype,"massUnsubscribe",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"massUnsubscribe"),it.prototype),Ce(it.prototype,"muteRemote",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"muteRemote"),it.prototype),Ce(it.prototype,"unmuteRemote",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"unmuteRemote"),it.prototype),Ce(it.prototype,"hasRemoteMediaWithLock",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"hasRemoteMediaWithLock"),it.prototype),Ce(it.prototype,"disconnectForReconnect",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"disconnectForReconnect"),it.prototype),Ce(it.prototype,"updateBitrateLimit",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"updateBitrateLimit"),it.prototype),Ce(it.prototype,"remoteMediaSsrcChanged",[Dr],Object.getOwnPropertyDescriptor(it.prototype,"remoteMediaSsrcChanged"),it.prototype),it);function Dr(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,c=await o.lock("From P2PChannel.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},n}function oV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function aV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oV(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Bte=Date.now(),Wte=20,AC=new Map,Qg=new Map;async function cV(e){const t=AC.get(e),n=Array.isArray(t)&&t[t.length-1],i=Qg.get(e);if(!n)return void(i.isSyncing=!1);const o={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const c=n.sendTs-i.firstSendTs,l=c-(Date.now()-i.firstRecvTs);l>0&&(i.firstRecvTs=Date.now()-c);let u=n.mediaDelay+l;u<=0?(t.pop(),lV(n.context,o),u=0):u=Math.min(u,Wte),setTimeout(()=>t.length&&cV(e),u)}function lV(e,t){e.safeEmit(st.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Gte(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return lV(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),o=AC.get(i)||[],c=o.findIndex(f=>e.sendTs>=f.sendTs),l=aV(aV({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});c===-1?o.push(l):o.splice(c,0,l),AC.set(i,o);let u=!1;var h;Qg.has(i)?u=!((h=Qg.get(i))===null||h===void 0||!h.isSyncing):Qg.set(i,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||cV(i)}const Hte=dt().name;function dV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function uV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dV(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const wu="websdk_ng_cache_parameter",Kte=M("MAX_PRELOAD_ASYNC_LENGTH"),zte=1e4,Pl=new Map,Dl=[];let OC=null,NC=0,PC=0;const Zg=new Map,Yte=function(e,t){const n=[];let i=0;const o=async()=>{const c=n.shift();c&&await c(),n.length>0&&i<t?o():i--};return async function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return new ve(async(h,f)=>{n.push(async()=>{try{const m=await e(...l);h(m)}catch(m){f(m)}}),i<t&&(i++,o())})}}(hV,Kte),DC=Yr.CancelToken.source();async function hV(e,t,n,i,o,c){try{if(!M("ENABLE_PRELOAD"))return;if(!ft().supportWebCrypto)return void rc(()=>{S.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ne(k.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&qn(n,"token",1,2047),qn(e,"appid",1,2047),Ig(t),i&&Ag(i);const l=vl();S.debug("preload channel ".concat(t,", uid is ").concat(i));const u={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:l,proxyServer:o};let h,f;typeof i=="string"?(u.stringUid=i,[f,h]=await ve.all([Nte(i,{sid:l,appId:e},DC.token),VU(uV(uV({},u),{},{token:n||e,uid:0}),DC.token)]),u.uid=f.uid,h.gatewayInfo.uid=u.uid,h.gatewayInfo.res.uid=u.uid):(c&&(u.stringUid=c),h=await VU(u,DC.token));const m={sid:l,appId:e,cname:t,token:n||e,uid:u.stringUid||i,intUid:u.uid||h.gatewayInfo.uid,stringUid:u.stringUid,ts:Date.now(),sua:f,ap:h};await async function(g){let E;try{g.uid&&fV({appId:g.appId,cname:g.cname,token:g.token,uid:g.uid,stringUid:g.stringUid});const y=EV(g),I=await async function(w,D){try{const P=await window.crypto.subtle.importKey("raw",iM(D),"AES-GCM",!1,["encrypt"]),x=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},P,El(window.btoa(JSON.stringify(w))));return ic(new Uint8Array(x))}catch{return}}(g,g.token||g.appId);if(!I)return;E=gV(wu);const C=E?JSON.parse(E):[];C.push({[y]:I}),C.length>M("AP_CACHE_NUM")&&C.shift(),eE(wu,JSON.stringify(C))}catch(y){S.warn("Error caching server parameters:",y.message),eE(wu,"")}}(m),NC++}catch(l){throw PC++,function(u){OC||(OC=window.setTimeout(()=>{let f="";Zg.forEach((m,g)=>{f+="".concat(g,": ").concat(m," ;")}),be.reportApiInvoke(null,{name:un.PRELOAD,options:{success:NC,failed:PC,err:f}}).onError(u),NC=0,PC=0,Zg.clear(),OC=null},zte));const h=Zg.get(u.code)||0;Zg.set(u.code,h+1)}(l),l}}async function pV(e){try{if(M("AP_REQUEST_DETAIL")||M("ENABLE_ROLE_SELECT_EDGE"))return;const t=fV(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(i,o){try{const c=await window.crypto.subtle.importKey("raw",iM(o),"AES-GCM",!1,["decrypt"]),l=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},c,El(i));return JSON.parse(window.atob(ic(new Uint8Array(l))))}catch{return}}(t,e.token||e.appId);if(!n||!function(i,o){return i.cname===o.cname&&i.appId===o.appId&&i.token===o.token?o.stringUid?i.stringUid===o.stringUid:typeof o.uid=="number"?i.uid===o.uid:i.uid==o.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<M("AP_CACHE_LIFETIME"))return n}catch(t){S.warn("Error get preloadInfo",t.message)}}function fV(e){let t;try{if(t=gV(wu),!t)return;const n=JSON.parse(t),i=EV(e),o=function(l,u){for(let h=l.length-1;h>=0;h--)if(u(l[h]))return h;return-1}(n,l=>i in l);if(o===-1)return;const c=n.splice(o,1)[0];return eE(wu,JSON.stringify(n)),c[i]}catch(n){S.warn("Error delete preload info: ".concat(t),n.message),eE(wu,"")}}function kC(e){if(e){let t=Pl.get(e);t&&(window.clearTimeout(t),t=null,Pl.delete(e)),pe(Dl).call(Dl,e)||e.cloudProxyServer!=="disabled"||Dl.push(e)}if(Pl.size<M("AP_CACHE_NUM")&&Dl.length>0){const t=Dl.shift();Pl.set(t,window.setTimeout(async()=>{const{appId:n,cname:i,token:o,stringUid:c,uid:l,proxyServer:u}=t;try{await Yte(n,i,o,l,u,c),Pl.has(t)&&kC(t)}catch(h){S.warn("update preload failed",h.message),mV(t)}},M("AP_UPDATE_INTERVAL")))}}function mV(e){const t=Dl.indexOf(e);t!==-1&&Dl.splice(t,1);let n=Pl.get(e);n&&(window.clearTimeout(n),n=null,Pl.delete(e),kC())}function _V(e,t){const n=e.sua,i=e.ap;t&&n&&be.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),be.reportResourceTiming(e.ap.url,e.sid),be.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(o=>o.ip).join(","),eventType:"disabled",unilbsServerIds:[En.CHOOSE_SERVER,En.CLOUD_PROXY_FALLBACK].toString()}),be.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(o=>o.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[En.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function gV(e){return window.atob(window.localStorage.getItem(e)||"")}function eE(e,t){window.localStorage.setItem(e,window.btoa(t))}function EV(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),uM(t)}function qte(e){let t=function(){const n=$te.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let o=n.appId;o!==void 0&&(vn(i,10),gc(i,o));let c=n.cid;c!==void 0&&(vn(i,16),vn(i,c));let l=n.cname;l!==void 0&&(vn(i,26),gc(i,l));let u=n.deviceId;u!==void 0&&(vn(i,34),gc(i,u));let h=n.elapse;h!==void 0&&(vn(i,40),Ec(i,h));let f=n.fileSize;f!==void 0&&(vn(i,48),Ec(i,bu(f)));let m=n.height;m!==void 0&&(vn(i,56),Ec(i,bu(m)));let g=n.jpg;g!==void 0&&(vn(i,66),vn(i,g.length),yV(i,g));let E=n.networkType;E!==void 0&&(vn(i,72),Ec(i,bu(E)));let y=n.osType;y!==void 0&&(vn(i,80),Ec(i,bu(y)));let I=n.requestId;I!==void 0&&(vn(i,90),gc(i,I));let C=n.sdkVersion;C!==void 0&&(vn(i,98),gc(i,C));let w=n.sequence;w!==void 0&&(vn(i,104),Ec(i,bu(w)));let D=n.sid;D!==void 0&&(vn(i,114),gc(i,D));let P=n.timestamp;P!==void 0&&(vn(i,120),Ec(i,P));let x=n.uid;x!==void 0&&(vn(i,128),vn(i,x));let K=n.vid;K!==void 0&&(vn(i,136),vn(i,K));let H=n.width;H!==void 0&&(vn(i,144),Ec(i,bu(H)));let j=n.service;j!==void 0&&(vn(i,152),vn(i,j));let J=n.callbackData;J!==void 0&&(vn(i,162),vn(i,J.length),yV(i,J));let re=n.ticket;re!==void 0&&(vn(i,170),gc(i,re));let se=n.vendorConfigs;se!==void 0&&(vn(i,178),gc(i,se))}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function Xte(e){return function(n){let i={};e:for(;!Qte(n);){let o=Vp(n);switch(o>>>3){case 0:break e;case 1:i.code=Vp(n);break;case 2:i.msg=SV(n,Vp(n));break;case 3:i.requestId=SV(n,Vp(n));break;case 4:i.timestamp=Zte(n,!1);break;default:Jte(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Jte(e,t){switch(t){case 0:for(;128&Vs(e););break;case 2:LC(e,Vp(e));break;case 5:LC(e,4);break;case 1:LC(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function bu(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let $te=[];function LC(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Qte(e){return e.offset>=e.limit}function tE(e,t){let n=e.bytes,i=e.offset,o=e.limit,c=i+t;if(c>n.length){let l=new Uint8Array(2*c);l.set(n),e.bytes=l}return e.offset=c,c>o&&(e.limit=c),i}function vV(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function yV(e,t){let n=tE(e,t.length);e.bytes.set(t,n)}function SV(e,t){let n=vV(e,t),i=String.fromCharCode,o=e.bytes,c="",l="";for(let u=0;u<t;u++){let h,f,m,g,E=o[u+n];128&E?(224&E)==192?u+1>=t?l+=c:(h=o[u+n+1],(192&h)!=128?l+=c:(g=(31&E)<<6|63&h,g<128?l+=c:(l+=i(g),u++))):(240&E)==224?u+2>=t?l+=c:(h=o[u+n+1],f=o[u+n+2],(49344&(h|f<<8))!=32896?l+=c:(g=(15&E)<<12|(63&h)<<6|63&f,g<2048||g>=55296&&g<=57343?l+=c:(l+=i(g),u+=2))):(248&E)==240?u+3>=t?l+=c:(h=o[u+n+1],f=o[u+n+2],m=o[u+n+3],(12632256&(h|f<<8|m<<16))!=8421504?l+=c:(g=(7&E)<<18|(63&h)<<12|(63&f)<<6|63&m,g<65536||g>1114111?l+=c:(g-=65536,l+=i(55296+(g>>10),56320+(1023&g)),u+=3))):l+=c:l+=i(E)}return l}function gc(e,t){let n=t.length,i=0;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}vn(e,i);let o=tE(e,i),c=e.bytes;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?c[o++]=u:(u<2048?c[o++]=u>>6&31|192:(u<65536?c[o++]=u>>12&15|224:(c[o++]=u>>18&7|240,c[o++]=u>>12&63|128),c[o++]=u>>6&63|128),c[o++]=63&u|128)}}function Vs(e){return e.bytes[vV(e,1)]}function TV(e,t){let n=tE(e,1);e.bytes[n]=t}function Vp(e){let t,n=0,i=0;do t=Vs(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function vn(e,t){for(t>>>=0;t>=128;)TV(e,127&t|128),t>>>=7;TV(e,t)}function Zte(e,t){let n,i=0,o=0,c=0;return n=Vs(e),i=127&n,128&n&&(n=Vs(e),i|=(127&n)<<7,128&n&&(n=Vs(e),i|=(127&n)<<14,128&n&&(n=Vs(e),i|=(127&n)<<21,128&n&&(n=Vs(e),o=127&n,128&n&&(n=Vs(e),o|=(127&n)<<7,128&n&&(n=Vs(e),o|=(127&n)<<14,128&n&&(n=Vs(e),o|=(127&n)<<21,128&n&&(n=Vs(e),c=127&n,128&n&&(n=Vs(e),c|=(127&n)<<7))))))))),{low:i|o<<28,high:o>>>4|c<<24,unsigned:t}}function Ec(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,c=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,l=tE(e,c),u=e.bytes;switch(c){case 10:u[l+9]=o>>>7&1;case 9:u[l+8]=c!==9?128|o:127&o;case 8:u[l+7]=c!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=c!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=c!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=c!==5?128|i:127&i;case 4:u[l+3]=c!==4?n>>>21|128:n>>>21&127;case 3:u[l+2]=c!==3?n>>>14|128:n>>>14&127;case 2:u[l+1]=c!==2?n>>>7|128:n>>>7&127;case 1:u[l]=c!==1?128|n:127&n}}const RV={},CV={},nE=4294967296,ene=nE*nE,wV=ene/2;IV(0,!0);const bV=IV(0),tne=jp(0,-2147483648,!1),nne=jp(-1,2147483647,!1);function IV(e,t){let n,i,o;return t?(o=0<=(e>>>=0)&&e<256)&&(i=CV[e],i)?i:(n=jp(e,0,!0),o&&(CV[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(i=RV[e],i)?i:(n=jp(e,e<0?-1:0,!1),o&&(RV[e]=n),n)}function jp(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function AV(e,t){if(isNaN(e))return bV;{if(e<=-wV)return tne;if(e+1>=wV)return nne}return e<0?bV:jp(e%nE|0,e/nE|0,t)}function OV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class MC extends nn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(po.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),O(this,"name","AgoraRTCImageModeration"),O(this,"_connectionState",rs.CONNECTING),O(this,"_sequence",0),O(this,"_moderationStartTime",void 0),O(this,"_workerConnection",void 0),O(this,"_workerMessageLengthLimit",void 0),O(this,"_qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Yr.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"_moderationInterval",void 0),O(this,"_moderationTimer",null),O(this,"_moderationMode",1),O(this,"_quality",1),O(this,"_qualityTimer",null),O(this,"_ticket",void 0),O(this,"_moderationIntervalMinimum",void 0),O(this,"_uploadFailedNum",0),O(this,"_uploadNum",0),O(this,"_uploadTimer",null),O(this,"_extraInfo",void 0),O(this,"_vendor",""),O(this,"_encoder",new TextEncoder),O(this,"_moderationId",void 0),O(this,"inspectImage",()=>{if(this.connectionState!==rs.CONNECTED)throw new Q(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===rs.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ut(5,"image-moderation-"),this._workerMessageLengthLimit=M("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=M("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=M("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ap("worker-"+this._moderationId,Rn),this.on(po.STATE_CHANGE,(i,o)=>{S.debug("[".concat(this._moderationId,"] Moderation operation :").concat(mu[i]," ").concat(o||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(po.STATE_CHANGE,mu.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new ve((o,c)=>{this.on(po.CONNECTION_STATE_CHANGE,(l,u)=>{l===rs.CONNECTED&&o()}),this.requestAP(t,i,n).then(l=>{this.connectWorker(l)}).catch(l=>{c(l)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),S.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===rs.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const o=M("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),c=await function(h,f,m,g){let{appId:E,areaCode:y,cname:I,sid:C,token:w,uid:D}=f;Su++;const P="moderation_plugin",x={service_name:P,json_body:JSON.stringify({appId:E,areaCode:y,cname:I,command:"allocateEdge",requestId:Su,seq:Su,sid:C,appToken:w,ts:Date.now(),uid:D+""})};let K,H,j=h[0];return co(async()=>{K=Date.now();const J=await fo(j,{data:x,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(H=Date.now()-K,J.code!==0){const le=new Q(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+J.code,{retry:!0,responseTime:H});throw S.error(le.toString()),le}const re=JSON.parse(J.json_body);if(re.code!==200){const le=new Q(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(re.code,", reason: ").concat(re.reason),{code:re.code,responseTime:H});throw S.error(le.toString()),le}if(!re.servers||!Array.isArray(re.servers)||re.servers.length===0){const le=new Q(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:re.code,responseTime:H});throw S.error(le.toString()),le}if(!re.servers.some(le=>!!le.wss)){const le=new Q(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:re.code,responseTime:H});throw S.error(le.toString()),le}const se=M("IMAGE_MODERATION_WORKER_HOST");return{addressList:re.servers.map(le=>{let{address:Je,wss:nt}=le;if(Je&&nt)return"wss://".concat(Je.replace(/\./g,"-"),".").concat(se,":").concat(nt,"/moderation")}).filter(le=>!!le),workerToken:re.workerToken,vid:re.vid,ticket:re.appTicket,responseTime:H}},(J,re)=>(be.apworkerEvent(C,{success:!0,sc:200,serviceName:P,responseDetail:JSON.stringify(J.addressList),firstSuccess:re===0,responseTime:H,serverIp:h[re%h.length]}),!1),(J,re)=>(be.apworkerEvent(C,{success:!1,sc:J.data&&J.data.code||200,serviceName:P,responseTime:H,serverIp:h[re%h.length]}),!!(J.code!==k.OPERATION_ABORTED&&J.code!==k.UNEXPECTED_RESPONSE||J.data&&J.data.retry)&&(j=h[(re+1)%h.length],!0)),g)}(o,t,n,i);this.emit(po.STATE_CHANGE,mu.AP_CONNECTED);const{addressList:l,ticket:u}=c;return this._ticket=u,l}async connectWorker(t){this.emit(po.STATE_CHANGE,mu.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(ze.CONNECTED,async()=>{this.emit(po.STATE_CHANGE,mu.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=rs.CONNECTED}),this._workerConnection.on(ze.CLOSED,()=>{this.connectionState=rs.CLOSED}),this._workerConnection.on(ze.FAILED,()=>{this.connectionState=rs.CLOSED}),this._workerConnection.on(ze.RECONNECTING,()=>{this.connectionState=this.connectionState===rs.CONNECTED?rs.RECONNECTING:rs.CONNECTING}),this._workerConnection.on(ze.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=Xte(new Uint8Array(t.data));M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,S.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{be.reportApiInvoke(this._connectInfo.sid||null,{name:un.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Jt.TRACER}).onError(new Q(k.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},M("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else S.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ze.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(ze.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=ki(this,po.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:o,cid:c,vid:l,sid:u,uid:h}=n;const f=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),g=await ex(m,i,o),E=this._sequence+"-"+c+"-"+h+"-"+f+"-"+Ut(12,""),y={appId:i,cid:c,cname:o,deviceId:"",elapse:MC.intToLong(Number(f-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:g,networkType:6,osType:7,requestId:E,sdkVersion:"4.24.0",sequence:this._sequence,sid:u,timestamp:AV(f),uid:h,vid:l,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;const I=qte(y);if(I.byteLength<this._workerMessageLengthLimit){if(M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const C=function(w){for(var D=1;D<arguments.length;D++){var P=arguments[D]!=null?arguments[D]:{};D%2?OV(Object(P),!0).forEach(function(x){O(w,x,P[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(P)):OV(Object(P)).forEach(function(x){Object.defineProperty(w,x,Object.getOwnPropertyDescriptor(P,x))})}return w}({},y);delete C.jpg,S.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(C))}return I}{const C=this.quality*this._qualityRatio;return this.quality=C,await this.generateRequestData(t,{appId:i,cname:o,cid:c,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Yr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=rs.CLOSED,this.emit(po.STATE_CHANGE,mu.CLOSED)}}function NV(e){if(Dt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Q(k.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Q(k.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const rne={name:"ImageModeration",create:function(e){let{config:t}=e;return NV(t),new MC(t)}};var PV,DV,kV,LV,MV,xV,UV,VV,jV,FV,BV,WV,GV,HV,KV,zV,YV,qV,XV,JV,$V,QV,ZV,ej,tj,nj,rj,ij,sj,oj,aj,cj,lj,dj,uj,hj,pj,fj,mj,_j,gj,ye;function Ej(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function js(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ej(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ej(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}ur.setLogger(S);let ine=(PV=xe(),DV=xe({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof au))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),kV=xe({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==ou.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),LV=xe({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),MV=xe({argsMap:(e,t,n)=>[t,n]}),xV=xe({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return[i==null?void 0:i.uid,o]})}),UV=xe({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),VV=xe({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return{uid:i==null?void 0:i.uid,mediaType:o}})}),jV=xe(),FV=xe(),BV=xe(),WV=xe(),GV=xe(),HV=xe(),KV=xe(),zV=xe(),YV=xe(),qV=xe(),XV=xe(),JV=xe(),$V=xe(),QV=xe(),ZV=xe(),ej=xe({argsMap:(e,t)=>[t]}),tj=xe(),nj=xe(),rj=xe(),ij=xe(),sj=xe(),oj=xe(),aj=xe(),cj=xe(),lj=xe({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),dj=xe(),uj=xe(),hj=xe(),pj=xe(),fj=xe(),mj=xe(),_j=xe({reportResult:!0}),gj=xe(),ye=class extends nn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),O(this,"store",void 0),O(this,"_uid",void 0),O(this,"_channelName",void 0),O(this,"_uintUid",void 0),O(this,"_users",[]),O(this,"_config",void 0),O(this,"_clientId",void 0),O(this,"_appId",void 0),O(this,"_sessionId",null),O(this,"_key",void 0),O(this,"_rtmConfig",{}),O(this,"_joinInfo",void 0),O(this,"_gateway",void 0),O(this,"_statsCollector",void 0),O(this,"_configDistribute",void 0),O(this,"_leaveMutex",void 0),O(this,"_publishMutex",void 0),O(this,"_renewTokenMutex",void 0),O(this,"_subscribeMutex",void 0),O(this,"_encryptionMode","none"),O(this,"_encryptionSecret",null),O(this,"_encryptionSalt",null),O(this,"_encryptDataStream",!1),O(this,"_encryptDataStreamKey",null),O(this,"_encryptDataStreamIv",null),O(this,"_proxyServer",void 0),O(this,"_turnServer",{servers:[],mode:"auto"}),O(this,"_cloudProxyServerMode","disabled"),O(this,"_isDualStreamEnabled",!1),O(this,"_defaultStreamFallbackType",void 0),O(this,"_lowStreamParameter",void 0),O(this,"_streamFallbackTypeCacheMap",new Map),O(this,"_remoteStreamTypeCacheMap",new Map),O(this,"_axiosCancelSource",Yr.CancelToken.source()),O(this,"_audioVolumeIndicationInterval",void 0),O(this,"_networkQualityInterval",void 0),O(this,"_userOfflineTimeout",void 0),O(this,"_streamRemovedTimeout",void 0),O(this,"_liveTranscodeStreamingClient",void 0),O(this,"_liveRawStreamingClient",void 0),O(this,"_channelMediaRelayClient",void 0),O(this,"_networkQualitySensitivity","normal"),O(this,"_p2pChannel",void 0),O(this,"_useLocalAccessPoint",!1),O(this,"_setLocalAPVersion",void 0),O(this,"_joinAndNotLeaveYet",!1),O(this,"_numberOfJoinCount",0),O(this,"_joinResponse",null),O(this,"_remoteDefaultVideoStreamType",void 0),O(this,"_inspect",void 0),O(this,"_moderation",void 0),O(this,"_license",void 0),O(this,"_pendingPublishedUsers",[]),O(this,"ntpAlignErrorCount",0),O(this,"remoteInboundOffset",0),O(this,"_peerConnectionState",void 0),O(this,"_handleLocalTrackEnable",(o,c,l)=>{this.publish(o,!1).then(c).catch(l)}),O(this,"_handleLocalTrackDisable",(o,c,l)=>{this.unpublish(o).then(c).catch(l)}),O(this,"_handleUserOnline",o=>{if(M("BLOCK_LOCAL_CLIENT")&&Il(o.uid,this.channelName))return void S.debug("[".concat(o.uid,"] will be ignored in local"));this.isStringUID&&typeof o.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const c=this._users.find(l=>l.uid===o.uid);if(c)c._trust_in_room_=!0,c._is_pre_created&&(c._is_pre_created=!1,this.safeEmit(st.USER_JOINED,c));else{const l=new mc(o.uid,o.uint_id||o.uid);this._users.push(l),S.debug("[".concat(this._clientId,"] user online"),o.uid),this.store.firstVideoFrameDecoded(l.uid,{userJoinNotify:Date.now()}),this.safeEmit(st.USER_JOINED,l)}}),O(this,"_handleUserOffline",o=>{if(M("BLOCK_LOCAL_CLIENT")&&Il(o.uid,this.channelName))return;const c=this._users.find(l=>l.uid===o.uid);c&&(this._handleRemoveStream(o),this._handleRemoveDataChannels(o),c._audio_pre_subscribed||c._video_pre_subscribed?c._is_pre_created=!0:ng(this._users,c),this._remoteStreamTypeCacheMap.delete(c.uid),this._streamFallbackTypeCacheMap.delete(c.uid),S.debug("[".concat(this._clientId,"] user offline"),o.uid,"reason:",o.reason),this.safeEmit(st.USER_LEAVED,c,o.reason))}),O(this,"_handleAddAudioOrVideoStream",(o,c,l,u,h,f,m,g)=>{if(M("BLOCK_LOCAL_CLIENT")&&Il(c,this.channelName))return;const E=this._users.find(I=>I.uid===c);if(!E)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(o)),this.store.subscribe(E.uid,o,void 0,void 0,void 0,Date.now()),o==="video"&&this.store.firstVideoFrameDecoded(E.uid,{videoAddNotify:Date.now()});const y=o==="audio"?E.hasAudio:E.hasVideo;if(E._uintid||(E._uintid=f||c),o==="audio"?E._trust_audio_stream_added_state_=!0:E._trust_video_stream_added_state_=!0,o==="audio"?(E._audio_added_=!0,l!==void 0&&(E._audioSSRC=l),u!==void 0&&(E._cname=u),m&&(E._audioOrtc=m)):(E._video_added_=!0,l!==void 0&&(E._videoSSRC=l),u!==void 0&&(E._cname=u),g!==void 0&&(E._rtxSsrcId=g),m&&(E._videoOrtc=m)),(o==="audio"?E.hasAudio:E.hasVideo)&&!y&&(S.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published ").concat(o)),this.safeEmit(st.USER_PUBLISHED,E,o)),o==="video"?be.onGatewayStream(this._sessionId,Ln.ON_ADD_VIDEO_STREAM,Xt.ON_ADD_VIDEO_STREAM,{peer:f||c,ssrc:E._videoSSRC}):be.onGatewayStream(this._sessionId,Ln.ON_ADD_AUDIO_STREAM,Xt.ON_ADD_AUDIO_STREAM,{peer:f||c,ssrc:E._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(E,o,l).then(I=>{if(I&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(E.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Up))return this._p2pChannel.unsubscribe(E,o,!0).then(()=>this._subscribe(E,o,!0).catch(C=>{S.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(E,o)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(E.uid," after reconnect.")),this._subscribe(E,o,!0).catch(I=>{S.error("[".concat(this._clientId,"] resubscribe error"),I.toString())})),o==="video"&&!rr()&&!Sr()){const I=this._getEncodingName(h);(I==null?void 0:I.toLocaleLowerCase())==yp.av1&&Ote().then(C=>{C||this._gateway.downgradeCodec(I)})}}),O(this,"_handleRemoveStream",o=>{if(M("BLOCK_LOCAL_CLIENT")&&Il(o.uid,this.channelName))return;const c=this._users.find(u=>u.uid===o.uid);if(!c)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug("[".concat(this._clientId,"] stream removed with uid ").concat(o.uid));let l=()=>{};c.hasAudio&&c.hasVideo?l=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(st.USER_UNPUBLISHED,c,"audio"),S.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(st.USER_UNPUBLISHED,c,"video")}:c.hasVideo?l=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(st.USER_UNPUBLISHED,c,"video")}:c.hasAudio&&(l=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(st.USER_UNPUBLISHED,c,"audio")}),c._video_pre_subscribed||c._audio_pre_subscribed||(c._trust_audio_stream_added_state_=!0,c._trust_video_stream_added_state_=!0,c._audio_added_=!1,c._video_added_=!1,this._p2pChannel instanceof Up&&this._p2pChannel.unsubscribe(c).then(u=>{if(u)return this._gateway.unsubscribe(u,c.uid)}),c._audioSSRC=void 0,c._videoSSRC=void 0,c._audioOrtc=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),be.onGatewayStream(this._sessionId,Ln.ON_REMOVE_STREAM,Xt.ON_REMOVE_STREAM,{peer:o.uint_id||o.uid}),l()}),O(this,"_handleSetStreamLocalEnable",(o,c,l)=>{if(M("BLOCK_LOCAL_CLIENT")&&Il(c,this.channelName))return;const u=this._users.find(m=>m.uid===c);if(!u)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug("[".concat(this._clientId,"] local ").concat(o," ").concat(l?"enabled":"disabled"," with uid ").concat(c));const h=o==="audio"?u.hasAudio:u.hasVideo;if(o==="audio"){u._trust_audio_enabled_state_=!0;const m=u._audio_enabled_;if(u._audio_enabled_=l,u._audio_enabled_===m)return;{const g=u._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(c,", msg: ").concat(g)),this.safeEmit(st.USER_INFO_UPDATED,c,g)}}else{u._trust_video_enabled_state_=!0;const m=u._video_enabled_;if(u._video_enabled_=l,u._video_enabled_===m)return;{const g=u._video_enabled_?"enable-local-video":"disable-local-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(g)),this.safeEmit(st.USER_INFO_UPDATED,c,g)}}const f=o==="audio"?u.hasAudio:u.hasVideo;return h!==f?!h&&f?(S.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(o)),void this.safeEmit(st.USER_PUBLISHED,u,o)):(o==="video"&&u._videoTrack&&u._videoTrack._destroy(),o==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,o),S.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(o)),void this.safeEmit(st.USER_UNPUBLISHED,u,o)):void 0}),O(this,"_handleMuteStream",(o,c,l)=>{if(M("BLOCK_LOCAL_CLIENT")&&Il(o,this.channelName))return;S.debug("[".concat(this._clientId,"] receive mute message"),o,c,l);const u=this._users.find(m=>m.uid===o);if(!u)return void S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o));const h=c==="audio"?u.hasAudio:u.hasVideo;if(c==="audio"){u._trust_audio_mute_state_=!0;const m=u._audio_muted_;if(u._audio_muted_=l,u._audio_muted_===m)return;{const g=u._audio_muted_?"mute-audio":"unmute-audio";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(g)),this.safeEmit(st.USER_INFO_UPDATED,o,g)}}else{u._trust_video_mute_state_=!0;const m=u._video_muted_;if(u._video_muted_=l,u._video_muted_===m)return;{const g=u._video_muted_?"mute-video":"unmute-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(g)),this.safeEmit(st.USER_INFO_UPDATED,o,g)}}const f=c==="audio"?u.hasAudio:u.hasVideo;if(h!==f){if(!h&&f)return(c==="audio"?u._audioSSRC:u._videoSSRC)?(S.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(c)),void this.safeEmit(st.USER_PUBLISHED,u,c)):void S.warning("[".concat(this._clientId,"] remote user ").concat(o," receive ").concat(c," unmute message  before add stream message, ").concat(c," SSRC doesn't exist yet."));c==="video"&&u._videoTrack&&!u._video_pre_subscribed&&u._videoTrack._destroy(),c==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,c),S.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(c)),this.safeEmit(st.USER_UNPUBLISHED,u,c)}}),O(this,"_handleP2PLost",async o=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),o),parseInt(o.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("[".concat(this._clientId,"] P2PLost stream not found"),o)}),O(this,"_handleTokenWillExpire",()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(st.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),O(this,"_handleBeforeUnload",o=>{o.type==="beforeunload"&&o.returnValue!==void 0&&o.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),O(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(st.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const o={downlinkNetworkQuality:0,uplinkNetworkQuality:0};o.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),o.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(st.NETWORK_QUALITY,o)}),O(this,"_handleP2PAddAudioOrVideoStream",(o,c,l,u)=>{const h=this._users.find(m=>m.uid===c);if(!h)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(o)),this.store.subscribe(h.uid,o,void 0,void 0,void 0,Date.now());const f=o==="audio"?h.hasAudio:h.hasVideo;o==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,o==="audio"?(h._audio_added_=!0,l!==void 0&&(h._audioSSRC=l),u!==void 0&&(h._audioMid=u)):(h._video_added_=!0,l!==void 0&&(h._videoSSRC=l),u!==void 0&&(h._videoMid=u)),(o==="audio"?h.hasAudio:h.hasVideo)&&!f&&(S.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(o)),this.safeEmit(st.USER_PUBLISHED,h,o)),this._p2pChannel.hasPendingRemoteMedia(h,o)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,o,!0).catch(m=>{S.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=e,this._clientId=t||Ut(5,"client-"),this.store=new class{constructor(o,c,l,u){We(this,"state",void 0),this.state={codec:o,audioCodec:c,mode:l,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:yl.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(o){this.state=function(c,l){switch(l.type){case Ge.SET_SESSION_ID:return de(de({},c),{},{sessionId:l.sessionId});case Ge.SET_P2P_ID:return de(de({},c),{},{p2pId:l.p2pId});case Ge.SET_UID:return de(de({},c),{},{uid:l.uid});case Ge.SET_INT_UID:return de(de({},c),{},{intUid:l.intUid});case Ge.SET_PUB_ID:return de(de({},c),{},{pubId:l.pubId});case Ge.KEY_METRIC_CLIENT_CREATED:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{clientCreated:l.metric})});case Ge.KEY_METRIC_JOIN_START:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{joinStart:l.metric})});case Ge.KEY_METRIC_PRELOAD_START:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{preloadStart:l.metric})});case Ge.KEY_METRIC_PRELOAD_END:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{preloadEnd:l.metric})});case Ge.KEY_METRIC_JOIN_END:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{joinEnd:l.metric})});case Ge.KEY_METRIC_REQUEST_AP_START:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{requestAPStart:l.metric})});case Ge.KEY_METRIC_REQUEST_AP_END:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{requestAPEnd:l.metric})});case Ge.KEY_METRIC_REQUEST_SUA_END:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{requestSUAEnd:l.metric})});case Ge.KEY_METRIC_BEFORE_CONNECT:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{beforeConnect:l.metric})});case Ge.KEY_METRIC_PEER_RECEIVER:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{peerReceiver:l.metric})});case Ge.KEY_METRIC_SIGNAL_CONNECTED:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{signalConnected:l.metric})});case Ge.KEY_METRIC_JOIN_REQ:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{joinReq:l.metric})});case Ge.KEY_METRIC_JOIN_REP:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{joinRep:l.metric})});case Ge.KEY_METRIC_JOIN_GATEWAY_START:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{joinGatewayStart:l.metric})});case Ge.KEY_METRIC_JOIN_GATEWAY_END:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{joinGatewayEnd:l.metric})});case Ge.KEY_METRIC_PEER_CONNECTION_START:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{peerConnectionStart:l.metric})});case Ge.KEY_METRIC_PEER_CONNECTION_END:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{peerConnectionEnd:l.metric})});case Ge.KEY_METRIC_DESCRIPTION_START:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{descriptionStart:l.metric})});case Ge.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{signalChannelOpen:l.metric})});case Ge.KEY_METRIC_ICE_CONNECTION_END:return de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{iceConnectionEnd:l.metric})});case Ge.KEY_METRIC_PUBLISH:{const u=c.keyMetrics.publish,h=u.findIndex(f=>f.trackId===l.metric.trackId);return h!==-1?(u[h]=de(de({},u[h]),l.metric),de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{publish:[...u]})})):de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{publish:[...c.keyMetrics.publish,l.metric]})})}case Ge.KEY_METRIC_SUBSCRIBE:{const u=c.keyMetrics.subscribe,h=u.findIndex(f=>f.userId===l.metric.userId&&f.type===l.metric.type);return h!==-1?(u[h]=de(de({},u[h]),l.metric),de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{subscribe:[...u]})})):de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{subscribe:[...c.keyMetrics.subscribe,l.metric]})})}case Ge.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const u=c.keyMetrics.firstVideoFrameDecoded,h=u.findIndex(f=>f.userId===l.metric.userId);return h!==-1?(u[h]=de(de({},u[h]),l.metric),de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{firstVideoFrameDecoded:[...u]})})):de(de({},c),{},{keyMetrics:de(de({},c.keyMetrics),{},{firstVideoFrameDecoded:[...c.keyMetrics.firstVideoFrameDecoded,l.metric]})})}case Ge.RESET_FIRST_VIDEO_FRAME_DECODED:return c.keyMetrics.firstVideoFrameDecoded=[],c;case Ge.SET_CLOUD_PROXY_SERVER_MODE:return c.cloudProxyServerMode=l.mode,c;case Ge.RECORD_JOIN_CHANNEL_SERVICE:return typeof l.index!="number"?c.joinChannelServiceRecords=[...c.joinChannelServiceRecords,l.record]:(c.joinChannelServiceRecords[l.index]=de(de({},c.joinChannelServiceRecords[l.index]),l.record),c.joinChannelServiceRecords=[...c.joinChannelServiceRecords]),c;case Ge.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return c.joinChannelServiceRecords=[],c;case Ge.RESET_KEY_METRICS:return c.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},c;case Ge.SET_USE_P2P:return de(de({},c),{},{useP2P:l.val});case Ge.SET_TRANSPORT_TYPE:return de(de({},c),{},{p2pTransport:l.val});default:return c}}(this.state,o)}set autoSubscribe(o){this.state.autoSubscribe=o}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(o){this.state.enableInstantMuteRestore=o}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(o){this.dispatch({type:Ge.SET_SESSION_ID,sessionId:o})}get sessionId(){return this.state.sessionId}set cid(o){this.state.cid=o}get cid(){return this.state.cid}set codec(o){this.state.codec=o}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(o){this.dispatch({type:Ge.SET_P2P_ID,p2pId:o})}get p2pId(){return this.state.p2pId}set dcId(o){this.dispatch({type:Ge.SET_DC_ID,dcId:o})}get dcId(){return this.state.dcId}set uid(o){this.dispatch({type:Ge.SET_UID,uid:o})}get uid(){return this.state.uid}set intUid(o){this.dispatch({type:Ge.SET_INT_UID,intUid:o})}get intUid(){return this.state.intUid}set pubId(o){this.dispatch({type:Ge.SET_PUB_ID,pubId:o})}get pubId(){return this.state.pubId}set cloudProxyServerMode(o){this.dispatch({type:Ge.SET_CLOUD_PROXY_SERVER_MODE,mode:o})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(o){this.dispatch({type:Ge.SET_USE_P2P,val:o})}get useP2P(){return this.state.useP2P}set p2pTransport(o){this.dispatch({type:Ge.SET_TRANSPORT_TYPE,val:o})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(o){this.state.hasStartJoinChannel=o}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(o){this.state.isABTestSuccess=o}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Ge.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ge.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Ge.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Ge.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Ge.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ge.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ge.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Ge.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Ge.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Ge.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Ge.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Ge.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Ge.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ge.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ge.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ge.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ge.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(o,c){this.dispatch({type:Ge.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:de({userId:o},c)})}descriptionStart(){this.dispatch({type:Ge.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ge.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ge.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(o,c,l,u){this.dispatch({type:Ge.KEY_METRIC_PUBLISH,metric:de(de({trackId:o,type:c},l&&{publishStart:l}),u&&{publishEnd:u})})}subscribe(o,c,l,u,h,f,m){this.dispatch({type:Ge.KEY_METRIC_SUBSCRIBE,metric:de(de(de(de(de({userId:o,type:c},l&&{subscribeStart:l}),u&&{subscribeEnd:u}),h&&{firstFrame:h}),f&&{streamAdded:f}),m&&{firstDecoded:m})})}massSubscribe(o,c,l,u){o.forEach(h=>{this.dispatch({type:Ge.KEY_METRIC_SUBSCRIBE,metric:de(de(de({userId:h.userId,type:h.type},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),u&&{firstFrame:u})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(o,c){o.service==="gateway"&&Array.isArray(o.urls)&&(o.urls=o.urls.map(l=>l.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof c!="number"?(this.dispatch({type:Ge.RECORD_JOIN_CHANNEL_SERVICE,record:de(de({},o),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(c<0||c>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ge.RECORD_JOIN_CHANNEL_SERVICE,record:o,index:c}),c)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ge.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ge.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Ge.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new ur("client-leave",this._clientId),this._publishMutex=new ur("client-publish",this._clientId),this._renewTokenMutex=new ur("client-renewtoken",this._clientId),this._subscribeMutex=new ur("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),S.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Zi," build: ").concat(y0,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{a0(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(o){S.warning("[".concat(this._clientId,"] ").concat(o.toString()))}var i;this._statsCollector=new Mp(this.store),this._statsCollector.onStatsException=(o,c,l)=>{S.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(o,", msg: ").concat(c,", uid: ").concat(l)),o===vC.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(u=>{u instanceof _g&&M("ENABLE_ENCODE_EXCEPTION")&&u.findClosestProfile()}),this.safeEmit(st.EXCEPTION,{code:o,msg:c,uid:l})},this._statsCollector.onUploadPublishDuration=(o,c,l,u)=>{const h=this._users.find(f=>f.uid===o);h&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(h._uintid,{peerPublishDuration:l,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(h)),be.peerPublishStatus(this._sessionId,{subscribeElapse:u,audioPublishDuration:c,videoPublishDuration:l,peer:h._uintid}))},this._statsCollector.onVideoCodecChanged=o=>{if(M("VIDEO_STANDARD_BITRATE_VERSION")&&(o==="av1"||o==="h265"||o==="h264")){const c=this.localTracks.find(l=>l instanceof Wt);c&&c._saveEncodeBitrateRatio!==1&&c.setSaveEncodeBitrateRatio(o==="h264"?M("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Rte(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Rn,httpRetryConfig:e.httpRetryConfig||Rn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Lte(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},Ta("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Up(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,o){let c=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],l=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ot("JOIN_GATEWAY_USE_443PORT_ONLY",c),Ot("JOIN_GATEWAY_USE_DUAL_DOMAIN",l);const u=this._gateway.signal.websocket;return u instanceof iC&&(u.use443PortOnly=c,u.tryDoubleDomain=l),async function(h,f,m){$_.get(h)||$_.set(h,[]),Q_.get(h)||Q_.set(h,f),Vo.get(h)||Vo.set(h,0);const g=$_.get(h),E=Q_.get(h);if(!g||!E)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Vo.get(h)===E){const D=up();g.push(D),await D.promise}Vo.set(h,Vo.get(h)+1);for(var y=arguments.length,I=new Array(y>3?y-3:0),C=3;C<y;C++)I[C-3]=arguments[C];const w=await m(...I);return Vo.set(h,Vo.get(h)-1),Vo.get(h)===E-1&&g.length>0&&(g[0].resolve(),g.shift()),Vo.get(h)===0&&($_.set(h,[]),Q_.set(h,0),Vo.set(h,0)),w}("client.join",M("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,o)}async join(e,t,n,i,o){const c=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const l=(sg||sg||(sg=(window.location.protocol.split(":")[0]||"").toUpperCase(),sg))==="HTTPS",u=fM()?window.isSecureContext:"Browser Not Support";(!fM()&&!l||!window.isSecureContext)&&S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let h;be.setAppId(e);try{if(!n&&n!==null)throw new Q(k.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&qn(n,"token",1,2047),qn(e,"appid",1,2047),Ig(t),i&&Ag(i),o)if(typeof o=="string")qn(o,"optionalInfo",1,256),h=o;else{if(typeof o!="object")throw new Q(k.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:w,enableInstantMuteRestore:D}=o;w&&(ao(w,"autoSubscribe"),S.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(w)),this.store.autoSubscribe=w),D&&(ao(D,"enableInstantMuteRestore"),S.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(D)),this.store.enableInstantMuteRestore=D)}}}catch(w){throw be.reportApiInvoke(vl(),{name:un.JOIN,options:[e,t,n,i],states:{isHttps:l,isSecureContext:u},tag:Jt.TRACER}).onError(w),w}if(this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const w=new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw be.reportApiInvoke(vl(),{name:un.JOIN,options:[e,t,n,i],states:{isHttps:l,isSecureContext:u},tag:Jt.TRACER}).onError(w),w}this._gateway.state="CONNECTING",this.store.preloadStart();const f=await pV({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const m=(f==null?void 0:f.sid)||vl();S.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(c)),this._sessionId||(this._sessionId=m,this.store.sessionId=this._sessionId);const g=be.reportApiInvoke(m,{id:this._clientId,name:un.JOIN,options:[e,t,n,i],states:{isHttps:l,isSecureContext:u},tag:Jt.TRACER}),E=js(js(js({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:h,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!f},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:M("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(E.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(E.stringUid=i,this._uintUid?(E.uid=this._uintUid,this._uintUid=void 0):E.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(E.aesmode=this._encryptionMode,E.aespassword=await(async w=>{const D=function(H){const j=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),J=new Uint8Array(new ArrayBuffer(j.length));for(let re=0;re<j.length;re+=1)J[re]=j.charCodeAt(re);return J}(),P=await window.crypto.subtle.importKey("spki",D,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),x=s0(w),K=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},P,x);return function(H){let j="";for(let J=0;J<H.length;J+=1)j+=String.fromCharCode(H[J]);return window.btoa(j)}(new Uint8Array(K))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(E.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const w=new TextEncoder,D=M("USE_PURE_ENCRYPTION_MASTER_KEY")?w.encode(E.appId+this._encryptionSecret+this._encryptionSecret):w.encode(E.appId+E.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(P,x,K){const H=await window.crypto.subtle.importKey("raw",x,"PBKDF2",!1,["deriveBits","deriveKey"]),j=P==="aes-128-gcm2"?128:256,J=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:CM,hash:"SHA-256",salt:K},H,j+ZZ);return new Uint8Array(J).subarray(j/8)}(this._encryptionMode,D,El(this._encryptionSalt)),this._encryptDataStreamKey=await async function(P,x,K){const H=await window.crypto.subtle.importKey("raw",x,"PBKDF2",!1,["deriveBits","deriveKey"]),j=P==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:CM,hash:"SHA-256",salt:K},H,{name:"AES-GCM",length:j},!0,["encrypt","decrypt"])}(this._encryptionMode,D,El(this._encryptionSalt))}else u?S.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):S.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,S.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:E.stringUid});const y=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&y===this._sessionId&&be.joinChannelTimeout(this._sessionId,5)},5e3);try{var I;let w;const D=E.cloudProxyServer;if(pe(I=["proxy3","proxy4","proxy5"]).call(I,D)){const j=M("PROXY_SERVER_TYPE3");Array.isArray(j)?E.proxyServer=j[0]:E.proxyServer=j}if(be.setProxyServer(E.proxyServer),S.setProxyServer(E.proxyServer),this.store.requestAPStart(),f){if(S.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(E.stringUid?", ".concat(E.stringUid," => ").concat(f.intUid):""," ")),E.stringUid&&!E.uid&&(E.uid=f.intUid),w={gatewayInfo:f.ap.gatewayInfo},M("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&E.turnServer.mode==="auto")if(f.ap.proxyInfo.addresses.length===0)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const j=(await lU(f.ap.proxyInfo,f.ap.gatewayInfo.uid)).map(J=>({turnServerURL:J.address,tcpport:J.tcpport||or.tcpport,udpport:J.udpport||or.udpport,username:J.username||or.username,password:J.password||or.password,forceturn:!1,security:!0}));E.turnServer={mode:"manual",servers:j}}_V(f,E.stringUid)}else{if(E.stringUid&&!E.uid){let j;[j,w]=await ve.all([UU(E.stringUid,E,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn,this.store).finally(()=>{this.store.requestSUAEnd()}),xU(E,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),S.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(E.stringUid," => ").concat(j)),E.uid=j,w.gatewayInfo.uid=j,w.gatewayInfo.res.uid=j}else w=await xU(E,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(E,this._axiosCancelSource.token),this._configDistribute.on(bp.UPDATE_BITRATE_LIMIT,j=>{this._p2pChannel.updateBitrateLimit(j)}),this._configDistribute.on(bp.UPDATE_CLIENT_ROLE_OPTIONS,j=>{this._setClientRoleOptions(j)})},0),this._key=n||e;const P=w.gatewayInfo,x=E.uid?E.uid:P.uid;this._joinInfo=js(js({},E),{},{cid:P.cid,uid:x,vid:P.vid,apResponse:P.res,apGatewayAddress:P.apGatewayAddress,uni_lbs_ip:P.uni_lbs_ip,gatewayAddrs:P.gatewayAddrs}),this.store.intUid=x,this.store.cid=P.cid;const K=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));g.onSuccess(K),this._appId=e,this._channelName=E.cname,this._uid=K,this.store.uid=K,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(rr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const H=E.stringUid?"string uid: ".concat(E.stringUid,",uid: ").concat(E.uid):"uid: ".concat(this._uid);return S.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(H)),setTimeout(()=>{S.startUpload()},5e3),this.store.joinEnd(),C=this,pe(bl).call(bl,C)||bl.push(C),this._cloudProxyServerMode==="disabled"&&ft().supportWebCrypto&&M("ENABLE_PRELOAD")&&kC(this._joinInfo),K}catch(w){const D=Array.isArray(w)?w[0]:w;throw D&&D.code===k.OPERATION_ABORTED?S.warning("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),D):S.error("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),D),D.code!==k.OPERATION_ABORTED&&this._numberOfJoinCount===c&&(this._gateway.state="DISCONNECTED",this._reset()),g.onError(D),D}var C}_joinGateway(){if(!this._joinInfo||!this._key)throw new Q(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!M("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(rr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=bl.indexOf(t);n!==-1&&bl.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Ct.LEAVE),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof au))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Q(k.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new Q(k.INVALID_OPERATION,"audience can not publish stream");for(const o of n){if(!(o instanceof au))throw new Q(k.INVALID_PARAMS,"parameter is not local track");if(!o._enabled&&t)throw new Q(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()))}S.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(o=>{const c=this._configDistribute.getBitrateLimit();o instanceof Wt&&c&&o.setBitrateLimit(c.uplink)});try{await this._publishHighStream(n),S.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))))}catch(o){throw S.error("[".concat(this._clientId,"] publish error"),o.toString()),o}finally{i()}}async _publishDataChannel(e){if(e==null)throw new Q(k.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Dt(e.id,"id",0,65535,!0),ao(e.ordered,"ordered"),qn(e.metadata,"metadata",0,512),S.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id)!==-1)throw new Q(k.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Q(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&M("FORCE_TURN")&&!M("TURN_ENABLE_TCP")&&!M("TURN_ENABLE_UDP"))throw new Q(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(o){return IU(o,!1)}(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Q(k.CREATE_DATACHANNEL_ERROR);try{await ve.all(i.map(o=>this._uid&&this._gateway.publishDataChannel(this._uid,o,!0))),await n._waitTillOpen()}catch(o){if(o.code!==k.DISCONNECT_P2P)throw o}}return S.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw S.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Q(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof au))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);S.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(fn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),S.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(o=>"".concat(o.getTrackId()))))}}catch(i){throw S.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),S.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),S.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(n){throw S.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof mc)){const i=this.remoteUsers.find(o=>o.uid===e);if(!i)throw new Q(k.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(kn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Q(k.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Q(k.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Se.AUDIO,i=t===Se.VIDEO,o=await this._subscribeMutex.lock();try{const{ssrcId:c,ortc:l,rtxSsrcId:u,cname:h,uint_id:f}=await this._gateway.presubscribe(e,t,!0);if(c==null)throw new Q(k.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(E=>E.uid===e);m||(m=new mc(e,f||e),m._is_pre_created=!0,this._users.push(m)),h&&(m._cname=h),m._uintid||(m._uintid=f||e),n&&(m._audioSSRC=c,m._audio_pre_subscribed=!0,l&&(m._audioOrtc=l)),i&&(m._videoSSRC=c,m._video_pre_subscribed=!0,l&&(m._videoOrtc=l),u!=null&&(m._rtxSsrcId=u)),S.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(c)),await this._p2pChannel.subscribe(m,t,c,u,l);const g=n?m._audioTrack:m._videoTrack;if(!g)throw new Q(k.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),i&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),g}catch(c){throw S.error("[".concat(this._clientId,"] presub user ").concat(e," error"),c),c}finally{o()}}async _subscribeDataChannel(e,t){var n;if(Dt(t,"channelId",0,65535,!0),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e))throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Q(k.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Q(k.INVALID_REMOTE_USER,"user is not published");const o=(n=e._dataChannels)===null||n===void 0?void 0:n.find(u=>u.id===t);if(!o)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Q(k.REMOTE_USER_IS_NOT_PUBLISHED);const c=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const u=await this._p2pChannel.subscribeDataChannel(e,[o]);if(u&&pe(u).call(u,o.id))try{var l;if(typeof o._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Q(k.CREATE_DATACHANNEL_ERROR);const h={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(l=o.metadata)!==null&&l!==void 0?l:""};await this._gateway.subscribeDataChannel(e.uid,h,!0),await o._waitTillOpen()}catch(h){if((h==null?void 0:h.code)!==k.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),h;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{c()}}async _p2pSubscribe(e,t,n){if(kn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){const c=new Q(k.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){const c=new Q(k.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const c=new Q(k.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}const o=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const l=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,l,u)}catch(l){throw l}S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(l=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});const c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new Q(k.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{o()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(kn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){const f=new Q(k.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){const f=new Q(k.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const f=new Q(k.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?Se.AUDIO:Se.VIDEO,ssrcId:o};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const h=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==o&&(o=m,c=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?Se.AUDIO:Se.VIDEO,ssrcId:o}),mr.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,o,l,c);try{this._p2pChannel.isPreSubScribe(o)||await this._gateway.subscribe(e.uid,u,!0)}catch(g){if((g==null?void 0:g.code)!==k.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),g;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m==null?void 0:m.code,e,t),m}S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new Q(k.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),f}catch(f){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{h()}}async massSubscribe(e){if(Ea(e,"subscribeList"),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(u=>{let{user:h,mediaType:f}=u;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(f)}).join("; ")));const o=(e=[...e]).map(u=>{let{user:h,mediaType:f}=u;return{user:h,mediaType:f}}),c=await this._p2pChannel.globalLock();try{var l;for(let h=e.length-1;h>=0;h--){const f=e[h],{user:m,mediaType:g}=f;if(kn(g,"mediaType",["audio","video"]),!m){const C=new Q(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===m)){const C=new Q(k.INVALID_REMOTE_USER,"user is not in the channel");S.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),o[h].error=C,e.splice(h,1);continue}if(g==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||g==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const C=new Q(k.REMOTE_USER_IS_NOT_PUBLISHED);S.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(g,", remote user is not published")),o[h].error=C,e.splice(h,1);continue}const y=Un.Video|Un.LwoVideo,I=n.get(m);if(I){if(g==="video"?I&y:I&Un.Audio){e.splice(h,1),S.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(g," twice"));continue}n.set(m,I|(g==="video"?y:Un.Audio))}else n.set(m,g==="video"?y:Un.Audio)}for(let h=e.length-1;h>=0;h--){const f=e[h],{user:m,mediaType:g}=f,E=Un.Video|Un.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,g)){await this._p2pChannel.unmuteRemoteNoLock(m,g);const y=n.get(m);n.set(m,g==="video"?y^E:y^Un.Audio),e.splice(h,1)}}this.store.massSubscribe(e.map(h=>({userId:h.user.uid,type:h.mediaType})),t);let u=Rs(l=Array.from(n.entries())).call(l,(h,f)=>{let[m,g]=f;if(g===0)return h;const E={stream_id:m.uid,stream_type:g};return g&Un.Audio&&(E.audio_ssrc=m._audioSSRC),g&Un.Video&&(E.video_ssrc=m._videoSSRC),h.push(E),h},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:m,mediaType:g}=f;return{user:m,mediaType:g,ssrcId:g===Se.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:g===Se.VIDEO?m._rtxSsrcId:void 0}}));const h=new Map;if(u=u.filter(f=>f.video_ssrc&&!this._p2pChannel.isPreSubScribe(f.video_ssrc)||f.audio_ssrc&&!this._p2pChannel.isPreSubScribe(f.audio_ssrc)||!f.video_ssrc&&!f.audio_ssrc),u.length>0){const f=await this._gateway.subscribeAll(u,!0);((f==null?void 0:f.users)||[]).forEach(m=>{let{stream_id:g,video_error_code:E,audio_error_code:y,error_code:I}=m;(E||y||I)&&h.set(g,{video_error_code:E,audio_error_code:y,error_code:I})})}if(Array.from(h.entries()).length>0){const f=[];Array.from(h.entries()).forEach(m=>{let[g,E]=m;const y=this.remoteUsers.find(I=>I.uid===g);if(y){let I;E.error_code||E.video_error_code&&E.audio_error_code?I=void 0:E.video_error_code?I=Se.VIDEO:E.audio_error_code&&(I=Se.AUDIO),f.push({user:y,mediaType:I})}}),f.length>0&&await this._p2pChannel.massUnsubscribeNoLock(f)}for(const f of o){const m=h.get(f.user.uid);if(m){const g=m.error_code||f.mediaType==="audio"&&m.audio_error_code||f.mediaType==="video"&&m.video_error_code;if(g){const E=Ip(g);S.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(E.desc)),f.error=new Q(k.SUBSCRIBE_FAILED,"code ".concat(g,": ").concat(E.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(o.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),o.forEach(f=>{var m;be.subscribe(this.store.sessionId,{succ:!!f.error,ec:((m=f.error)===null||m===void 0?void 0:m.code)||null,video:f.mediaType===Se.VIDEO,audio:f.mediaType===Se.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===Se.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(f.user._videoSSRC)},!0)}),S.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:m,mediaType:g}=f;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(g)}).join("; "))),o}catch(h){throw await this._p2pChannel.massUnsubscribeNoLock(e),h}}finally{c(),i()}}async unsubscribe(e,t,n){if(!(e instanceof mc)){const c=this.remoteUsers.find(l=>l.uid===e);if(!c)throw new Q(k.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&kn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Q(k.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const o=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const c=await this._p2pChannel.unsubscribe(e,t);c&&await this._gateway.unsubscribe(c,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&ng(this._users,e),S.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===k.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{o()}}async _unsubscribeDataChannel(e,t){if(t&&Dt(t,"id",0,65535,!0),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){const o=new Q(k.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let i;if(typeof t=="number"){const o=e._dataChannels.find(c=>c.id===t);o&&(i=[o])}else i=e._dataChannels;if(i===void 0){const o=new Q(k.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(o=>o.id)));try{const o=await this._p2pChannel.unsubscribeDataChannel(e,i);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),S.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===k.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(Ea(e,"unsubscribeList"),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");S.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:o}=e[n];if(!i){const u=new Q(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(kn(o,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===i)){S.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const l=Un.Video|Un.LwoVideo;if(t.has(i)){const u=t.get(i);let h;switch(o){case"video":h=u&l;break;case"audio":h=u&Un.Audio;break;default:h=u&(Un.Audio|l)}if(h){S.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(i,u|Un.Audio):o==="video"&&t.set(i,u|l):t.set(i,u|Un.Audio|l)}else o?o==="audio"?t.set(i,Un.Audio):o==="video"&&t.set(i,l):t.set(i,Un.Audio|l)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),S.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join()))}catch(n){if(n.code===k.DISCONNECT_P2P)return void S.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw S.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new ne(k.INVALID_PARAMS);on(n.width)||r0(n.width,"streamParameter.width"),on(n.height)||r0(n.height,"streamParameter.height"),on(n.framerate)||r0(n.framerate,"streamParameter.framerate"),on(n.bitrate)||Dt(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ae.LocalVideoLowTrack)}async enableDualStream(){if(!ft().supportDualStream)throw be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Q(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Q(k.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Q(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ae.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){kn(i,"role",["audience","host"])}(e),t&&a0(t),this.mode==="rtc"||this.mode==="p2p")throw S.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Q(k.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Q(k.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Q(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&M("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",ir.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),S.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&a0(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{S.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(qn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Q(k.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,be.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer),S.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Q(k.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(k.INVALID_OPERATION,"You have already set the proxy")}if(mp(e))return this._turnServer={servers:e,mode:"original-manual"},void S.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>nM(n)),this._turnServer={servers:e,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Q(k.INVALID_OPERATION,"you should set license before join channel");if(qn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Q(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,S.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Q(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Q(k.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Q(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new Q(k.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Q(k.INVALID_OPERATION,"Stop proxy server after leave channel");be.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Q(k.INVALID_PARAMS,"accessPoints is required.");Ea(e.accessPoints.serverList,"accessPoints.serverList"),qn(e.accessPoints.domain,"accessPoints.domain");const t=(E,y)=>{Dt(E,y,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");M("CLOSE_AFB_FOR_LOCAL_AP")&&(Ot("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ot("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,c=e.accessPoints.serverList.map(E=>i.test(E)?"".concat(E.replace(/\./g,"-"),".").concat(o):E),l=c.map(E=>"".concat(E,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ot("WEBCS_DOMAIN",l),Ot("WEBCS_DOMAIN_BACKUP_LIST",l),Ot("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Ea(e.report.hostname,"report.hostname"),Ot("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Ot("EVENT_REPORT_DOMAIN",c[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",c[1]||c[0]));let u=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),u=e.report.port),Ot("STATS_COLLECTOR_PORT",u),e.report?Ot("ENABLE_EVENT_REPORT",!0):Ot("ENABLE_EVENT_REPORT",!1);let h="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Ea(e.log.hostname,"log.hostname"),h=e.log.hostname[0]):h=c[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),Ot("LOG_UPLOAD_SERVER","".concat(h,":").concat(f));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Ea(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=c;let g=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),g=e.cds.port),Ot("CDS_AP",m.map(E=>"".concat(E,":").concat(g))),e.cds?Ot("ENABLE_CONFIG_DISTRIBUTE",!0):Ot("ENABLE_CONFIG_DISTRIBUTE",!1),S.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Ea(e,"serverList"),qn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ot("WEBCS_DOMAIN",e),Ot("WEBCS_DOMAIN_BACKUP_LIST",e),Ot("GATEWAY_DOMAINS",[t]),Ot("EVENT_REPORT_DOMAIN",e[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Ot("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),S.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(kn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw S.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else S.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){kn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw S.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){kn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw S.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(c){kn(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),qn(t,"secret");const o=["aes-128-gcm2","aes-256-gcm2"];if(pe(o).call(o,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new Q(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Q(k.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(ao(i,"encryptDataStream"),!pe(o).call(o,e))throw new Q(k.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=ic(n))}async renewToken(e){if(qn(e,"token",1,2047),!this._key||!this._joinInfo)throw new Q(k.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(M("USE_NEW_TOKEN")){S.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await kte(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else S.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});S.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,S.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?S.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(st.VOLUME_INDICATOR,e)},M("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Q(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Q(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Q(k.LIVE_STREAMING_TASK_CONFLICT);const n=t?va.TRANSCODE:va.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(va.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new Q(k.INVALID_PARAMS,"can not find live streaming url to stop");await ve.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){GU(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){GU(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Up&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Q(k.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const o=new TextEncoder;e.payload=o.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&pe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(o,c,l){var u;const h=Rs(u=Array.from(l)).call(u,(C,w)=>C+w,0),f={serverTs:0,seq:eee++,length:l.length,checkSum:h},m=new Uint8Array(dM(h,2)),g=new ArrayBuffer(tu),E=new DataView(g);E.setUint32(0,f.serverTs),E.setUint16(4,f.seq),E.setUint16(6,f.length),E.setUint16(8,f.checkSum);const y=16-l.length%16;l=sM(l,new Uint8Array(y));const I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:RM,additionalData:m},c,l);return sM(new Uint8Array(g),new Uint8Array(I))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Q(k.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(je.DATA_STREAM,{payload:ic(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Bte},!n)}sendMetadata(e){if(!this._joinInfo)throw new Q(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Q(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(je.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ic(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(lee),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"can not send custom report, not joined");await be.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(M("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{pe(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){kn(t.spatialLayer,"spatialLayer",[0,1,2,3]),kn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(ao(t,"apRTM"),Dt(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,S.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(S.debug("[".concat(this._clientId,"] reset client")),function(e){const t=pu.indexOf(e);t!==-1&&pu.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Yr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&mV(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&be.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ur("client-publish",this._clientId),this._subscribeMutex=new ur("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||vl();e?S.debug("[".concat(this._clientId,"] new Session ").concat(i)):S.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const o=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,be.addSid(i);const c={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:o,clientRole:this.role==="audience"?2:1};be.sessionInit(this._sessionId,js({cname:t.channel,appid:t.appId},c)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Q(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&M("FORCE_TURN")&&!M("TURN_ENABLE_TCP")&&!M("TURN_ENABLE_UDP"))throw new Q(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(fn.PUBLISH,i,!0)}catch(o){throw n.throw(o),o}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(c){if(c.code!==k.DISCONNECT_P2P)throw n.throw(c),c}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof Wt&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig).catch(c=>{S.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===k.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Q(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(k.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(c){if(c.code!==k.DISCONNECT_P2P)throw n.throw(c),c}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===k.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Q(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Ta("LiveStreaming").create(i));var i;return n.onLiveStreamError=(o,c)=>{be.reportApiInvoke(this._sessionId,{name:un.ON_LIVE_STREAM_ERROR,options:[o,c],tag:Jt.TRACER}).onSuccess(),this.safeEmit(st.LIVE_STREAMING_ERROR,o,c)},n.onLiveStreamWarning=(o,c)=>{be.reportApiInvoke(this._sessionId,{name:un.ON_LIVE_STREAM_WARNING,options:[o,c],tag:Jt.TRACER}).onSuccess(),this.safeEmit(st.LIVE_STREAMING_WARNING,o,c)},n.on(tC.REQUEST_WORKER_MANAGER_LIST,(o,c,l)=>{if(!this._joinInfo)return l(new Q(k.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(u,h,f,m){const g=M("UAP_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(E=>h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(E+"/api/v1?action=uap"):"https://".concat(E,"/api/v1?action=uap"));return await bte(g,u,h,f,m)})(o,this._joinInfo,this._axiosCancelSource.token,Rn).then(c).catch(l)}),n};return e===va.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Q(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Ta("ChannelMediaRelay").create(e));i.on("state",o=>{o===oi.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(st.CHANNEL_MEDIA_RELAY_STATE,o)}),i.on("event",o=>{this.safeEmit(st.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(o,c)=>{var l;o==="resolution"&&((l=this._channelMediaRelayClient)===null||l===void 0||l.setVideoProfile(c))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,o=[];if(t){const c=[];this._users.forEach(l=>{l._dataChannels.forEach(u=>{n.every(h=>h.uid!==l._uintid||h.stream_id!==u.id)&&c.push({uid:l._uintid,stream_id:u.id,ordered:u.ordered,max_retrans_times:u.maxRetransmits,metadata:u.metadata})})}),c.length>0&&this._handleUpdateDataChannel({added:[],deleted:c})}Array.isArray(n)&&n.length>0&&n.forEach(c=>{const{uid:l,stream_id:u,ordered:h,max_retrans_times:f,metadata:m}=c,g=this._users.find(E=>E._uintid===l);if(!g)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(S.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(l)),pe(o).call(o,g)||o.push(g),g._uintid||(g._uintid=l),g._dataChannels.findIndex(E=>E.id===c.stream_id)===-1){const E={id:u,ordered:!!h,maxRetransmits:f,metadata:m},y=function(I){return IU(I,!0)}(E);g._dataChannels.push(y),S.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published datachannel")),t||this.safeEmit(st.USER_PUBLISHED,g,"datachannel",E)}this._p2pChannel.hasPendingRemoteDataChannel(g,c.stream_id)&&(S.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(g.uid," after reconnect.")),this._subscribeDataChannel(g,c.stream_id).catch(E=>{S.error("[".concat(this._clientId,"] resubscribe datachannel error"),E.toString())}))}),t&&(this.safeEmit(st.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(c=>{const{uid:l,stream_id:u}=c,h=this._users.find(m=>m._uintid===l);if(!h)return void S.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const f=h._dataChannels.find(m=>m.id===c.stream_id);f&&(S.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(l)),this._p2pChannel.unsubscribeDataChannel(h,[f]).then(m=>{if(h._dataChannels=h._dataChannels.filter(g=>g!==f),m)return this._gateway.unsubscribeDataChannel(m,h.uid)}),S.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(st.USER_UNPUBLISHED,h,"datachannel",f._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const o of n){var i;if(o.payloadType===e)return o==null||(i=o.rtpMap)===null||i===void 0?void 0:i.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){S.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(st.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Wn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void S.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(i=>{const{value:o,type:c,expires:l}=t[i];l&&l<=n||c||q0()||!Object.prototype.hasOwnProperty.call(cg,i)||(lo[i]=o,qt[i]=o,S.debug("Update gateway parameters from config distribute",i,o))})}catch(t){S.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Wn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Wn.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===Ct.FALLBACK)return;const o=()=>{this.safeEmit(st.CONNECTION_STATE_CHANGE,e,t,n)};if(be.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:un.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Jt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),S.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(l=>{l._trust_in_room_=!1,l._trust_audio_enabled_state_=!1,l._trust_video_enabled_state_=!1,l._trust_audio_mute_state_=!1,l._trust_video_mute_state_=!1,l._trust_audio_stream_added_state_=!1,l._trust_video_stream_added_state_=!1,l._is_pre_created||(l._audio_pre_subscribed||(l._audioSSRC=void 0,l._audioOrtc=void 0),l._video_pre_subscribed||(l._videoSSRC=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),l._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var c;this._streamFallbackTypeCacheMap.forEach((l,u)=>{this._gateway.setStreamFallbackOption(u,l).catch(h=>{S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((l,u)=>{this._gateway.setRemoteVideoStreamType(u,l).catch(h=>{S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),this._remoteDefaultVideoStreamType!==void 0&&((c=this._joinInfo)===null||c===void 0?void 0:c.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{S.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(l=>{S.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(l))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(l=>!l._trust_in_room_).forEach(l=>{S.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(l.uid)),this._handleUserOffline({uid:l.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(l=>{l._trust_audio_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,Se.AUDIO,!1)),l._trust_video_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,Se.VIDEO,!1)),l._trust_audio_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(l.uid)),this._handleSetStreamLocalEnable("audio",l.uid,!0)),l._trust_video_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(l.uid)),this._handleSetStreamLocalEnable("video",l.uid,!0)),l._trust_video_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(l.uid)),this._handleResetAddStream(l,"video")),l._trust_audio_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(l.uid)),this._handleResetAddStream(l,"audio")),l._video_added_||l._audio_added_||(S.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(l.uid)),this._handleRemoveStream({uid:l.uid,uint_id:l._uintid}))}))},1e3))}o()}),this._gateway.on(Wn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new Q(k.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await pV(js(js({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,_V(i),this._joinInfo.preload=!0):(n=await gC(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const o=[];n.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:l}=c;const[u,h]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:u,port:h}):o.push({host:u,port:h})}),e(o)}catch(n){t(n)}}),this._gateway.on(Wn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(st.NETWORK_QUALITY,e)}),this._gateway.on(Wn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(st.STREAM_TYPE_CHANGED,e,t),be.reportApiInvoke(this._sessionId,{name:un.STREAM_TYPE_CHANGE,options:[e,t],tag:Jt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Wn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Wn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}}),this._gateway.on(Wn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:S.debug("no attributes in joinResponse");const i=mU(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(Wn.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:i}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:c,cid:l}=this._joinInfo.apResponse,u="".concat(l,"_").concat(c);if(u.length<4||u.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var o;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(c),icePwd:"".concat(l,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=M("FINGERPRINT"))!==null&&o!==void 0?o:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(h){h.code&&h.code===k.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ot.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ot.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ot.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(ot.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(ot.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(ot.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ot.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ot.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ot.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Se.AUDIO,!0)),this._gateway.signal.on(ot.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Se.AUDIO,!1)),this._gateway.signal.on(ot.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Se.VIDEO,!0)),this._gateway.signal.on(ot.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Se.VIDEO,!1)),this._gateway.signal.on(ot.RECEIVE_METADATA,e=>{const t=El(e.metadata);this.safeEmit(st.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(ot.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=El(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&pe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<tu)throw new Q(k.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(tu));n=await async function(c,l,u){const h=u.subarray(0,tu),f=h.slice(8,tu),m=(f[0]<<8)+f[1],g=(h[6]<<8)+h[7],E=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:RM,additionalData:new Uint8Array(dM(m,2))},l,u.subarray(tu));return new Uint8Array(E).subarray(0,g)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const o=this._p2pChannel.getStats(),c=this.remoteUsers.find(u=>u.uid===e.uid),l=o==null?void 0:o.audioRecv.find(u=>u.ssrc===(c==null?void 0:c._audioSSRC));i=l==null?void 0:l.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),Gte(js(js({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ot.ON_CRYPT_ERROR,()=>{rc(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(st.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ot.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ct.TOKEN_EXPIRE),this.safeEmit(st.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ot.ON_STREAM_FALLBACK_UPDATE,e=>{S.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(st.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ot.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),S.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(ot.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(ot.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Be.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case je.PUBLISH:{if(!t)return;const o=t.ortc;if(o){var n,i;const c=o.some(h=>{let{stream_type:f}=h;return f===bt.Audio}),l=o.some(h=>{let{stream_type:f}=h;return f!==bt.Audio}),u=o.some(h=>{let{stream_type:f}=h;return f===bt.Screen||f===bt.ScreenLow});t.state==="offer"&&be.publish(this._joinInfo.sid,{eventElapse:mr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:c,video:l,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:u,audioName:c?(n=o.find(h=>{let{stream_type:f}=h;return f===bt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:l?(i=o.find(h=>{let{stream_type:f}=h;return f!==bt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case je.SUBSCRIBE:t&&be.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:t.stream_type===Se.AUDIO,video:t.stream_type===Se.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:mr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(ot.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(ot.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;M("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!Il(i.string_id||i.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let o=this._users.find(m=>m._uintid===i.stream_id);o?o._trust_in_room_=!0:(o=new mc(i.string_id||i.stream_id,i.stream_id),this._users.push(o),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.getListeners(st.PUBLISHED_USER_LIST).length===0&&(S.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(st.USER_JOINED,o)));const c=Un.Audio&i.stream_type,l=(Un.Video|Un.LwoVideo)&i.stream_type,u=(65280&i.stream_type)!=0,h=c&&o.hasAudio,f=l&&o.hasVideo;l&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=i.video_ssrc,o._rtxSsrcId=i.video_rtx),c&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=i.audio_ssrc),c&&!h&&this.getListeners(st.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(st.USER_PUBLISHED,o,"audio")),l&&!f&&this.getListeners(st.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(st.USER_PUBLISHED,o,"video")),(c&&!h||l&&!f||u)&&t.push(o),l&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),c&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(S.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{S.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(st.PUBLISHED_USER_LIST).length>0?M("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(S.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(st.PUBLISHED_USER_LIST,t)):S.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(ot.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Up&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var i;return pe(i=Object.keys(yp)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(ot.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(fn.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(o=>{const{kind:c,ssrcs:l,mid:u,isMuted:h}=o;this._handleP2PAddAudioOrVideoStream(c,i,l[0].ssrcId,u);const f=this._users.find(m=>m.uid===i);return f&&this.store.useP2P?this._p2pChannel.mockSubscribe(f,c,l[0].ssrcId,u).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,c,!!h)})}),this._gateway.signal.on(fn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(o){n(o)}}),this._gateway.signal.on(Be.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(fn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:o}=e,c=this._users.find(l=>l.uid===o);if(!c)return S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void t();try{i.forEach(async l=>{let{stream_type:u}=l;const h=u===bt.Audio?Se.AUDIO:Se.VIDEO;await this._p2pChannel.unsubscribe(c,h),this._handleMuteStream(o,h,!0)}),t()}catch(l){n(l)}}}),this._gateway.signal.on(fn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case cc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Se.VIDEO,!0);break;case cc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Se.AUDIO,!0);break;case cc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Se.VIDEO,!1);break;case cc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Se.AUDIO,!1)}}),this._gateway.signal.on(fn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:o}=e;i!==Br.SEND_ONLY||o?t(await this._p2pChannel.restartICE(i,o)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}}),this._gateway.signal.on(fn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Pe.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(fn.RESTART_ICE,e,i===Br.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Pe.LocalCandidate,e=>{this._gateway.sendExtensionMessage(fn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Pe.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(fn.CONTROL,e,!0),t()}catch(i){n(i)}}),this._p2pChannel.on(Pe.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===k.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Pe.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===k.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Pe.StateChange,(e,t)=>{t===wt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Pe.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(st.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Pe.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===k.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Pe.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===k.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Pe.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Pe.RequestRePublishDataChannel,(e,t,n)=>{ve.all(e.map(async i=>{const o=await this._p2pChannel.publishDataChannel([i]);try{o.forEach(c=>{this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)})}catch(c){if(c.code!==k.DISCONNECT_P2P)throw c}})).then(t).catch(n)}),this._p2pChannel.on(Pe.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:o}of e)o===Se.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Pe.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Pe.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Pe.MediaReconnectStart,e=>{this.safeEmit(st.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Pe.MediaReconnectEnd,e=>{this.safeEmit(st.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Pe.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Pe.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let o;try{o=await this._gateway.restartICE({iceParameters:i})}catch(l){return void t.throw(l)}const{iceParameters:c}=function(l){const u=l.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}}(o);await t.next({remoteIceParameters:c})}),this._p2pChannel.on(Pe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Pe.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:c}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),l=mU(o,c);await this._p2pChannel.connect(l),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Pe.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Pe.P2PLost,()=>{this.safeEmit(st.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Pe.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Pe.ConnectionTypeChange,e=>{this.safeEmit(st.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Pe.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Pe.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Pe.AudioMetadata,e=>{this.safeEmit(st.AUDIO_METADATA,e)}),this._p2pChannel.on(Pe.AudioPts,e=>{this.safeEmit(st.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Ta("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:o,sid:c,token:l,uid:u,cid:h,vid:f}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:o,sid:c,token:l,uid:u,cid:h,vid:f?Number(f):0},Rn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(Gn.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(st.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Ms.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(st.CONTENT_INSPECT_ERROR,new Q(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Gn.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===k.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return S.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(st.CONTENT_INSPECT_RESULT,t,n)}),e.on(Gn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(ao(e,"enabled"),e){if(!t)throw new Q(k.INVALID_PARAMS,"config is required");if(NV(t),!this._joinInfo)throw new Q(k.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},Ta("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:o,cname:c,sid:l,token:u,uid:h,cid:f,vid:m}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:l,token:u,uid:h,cid:f,vid:m?Number(m):0},Rn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new Q(k.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(po.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(st.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===rs.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Q(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(po.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){kn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Q(k.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,S.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return S.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ao(e,"enabled"),Ot("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ce(ye.prototype,"leave",[PV],Object.getOwnPropertyDescriptor(ye.prototype,"leave"),ye.prototype),Ce(ye.prototype,"publish",[DV],Object.getOwnPropertyDescriptor(ye.prototype,"publish"),ye.prototype),Ce(ye.prototype,"unpublish",[kV],Object.getOwnPropertyDescriptor(ye.prototype,"unpublish"),ye.prototype),Ce(ye.prototype,"subscribe",[LV],Object.getOwnPropertyDescriptor(ye.prototype,"subscribe"),ye.prototype),Ce(ye.prototype,"presubscribe",[MV],Object.getOwnPropertyDescriptor(ye.prototype,"presubscribe"),ye.prototype),Ce(ye.prototype,"massSubscribe",[xV],Object.getOwnPropertyDescriptor(ye.prototype,"massSubscribe"),ye.prototype),Ce(ye.prototype,"unsubscribe",[UV],Object.getOwnPropertyDescriptor(ye.prototype,"unsubscribe"),ye.prototype),Ce(ye.prototype,"massUnsubscribe",[VV],Object.getOwnPropertyDescriptor(ye.prototype,"massUnsubscribe"),ye.prototype),Ce(ye.prototype,"setLowStreamParameter",[jV],Object.getOwnPropertyDescriptor(ye.prototype,"setLowStreamParameter"),ye.prototype),Ce(ye.prototype,"enableDualStream",[FV],Object.getOwnPropertyDescriptor(ye.prototype,"enableDualStream"),ye.prototype),Ce(ye.prototype,"disableDualStream",[BV],Object.getOwnPropertyDescriptor(ye.prototype,"disableDualStream"),ye.prototype),Ce(ye.prototype,"setClientRole",[WV],Object.getOwnPropertyDescriptor(ye.prototype,"setClientRole"),ye.prototype),Ce(ye.prototype,"_setClientRoleOptions",[GV],Object.getOwnPropertyDescriptor(ye.prototype,"_setClientRoleOptions"),ye.prototype),Ce(ye.prototype,"setProxyServer",[HV],Object.getOwnPropertyDescriptor(ye.prototype,"setProxyServer"),ye.prototype),Ce(ye.prototype,"setTurnServer",[KV],Object.getOwnPropertyDescriptor(ye.prototype,"setTurnServer"),ye.prototype),Ce(ye.prototype,"setLicense",[zV],Object.getOwnPropertyDescriptor(ye.prototype,"setLicense"),ye.prototype),Ce(ye.prototype,"startProxyServer",[YV],Object.getOwnPropertyDescriptor(ye.prototype,"startProxyServer"),ye.prototype),Ce(ye.prototype,"stopProxyServer",[qV],Object.getOwnPropertyDescriptor(ye.prototype,"stopProxyServer"),ye.prototype),Ce(ye.prototype,"setLocalAccessPointsV2",[XV],Object.getOwnPropertyDescriptor(ye.prototype,"setLocalAccessPointsV2"),ye.prototype),Ce(ye.prototype,"setLocalAccessPoints",[JV],Object.getOwnPropertyDescriptor(ye.prototype,"setLocalAccessPoints"),ye.prototype),Ce(ye.prototype,"setRemoteDefaultVideoStreamType",[$V],Object.getOwnPropertyDescriptor(ye.prototype,"setRemoteDefaultVideoStreamType"),ye.prototype),Ce(ye.prototype,"setRemoteVideoStreamType",[QV],Object.getOwnPropertyDescriptor(ye.prototype,"setRemoteVideoStreamType"),ye.prototype),Ce(ye.prototype,"setStreamFallbackOption",[ZV],Object.getOwnPropertyDescriptor(ye.prototype,"setStreamFallbackOption"),ye.prototype),Ce(ye.prototype,"setEncryptionConfig",[ej],Object.getOwnPropertyDescriptor(ye.prototype,"setEncryptionConfig"),ye.prototype),Ce(ye.prototype,"renewToken",[tj],Object.getOwnPropertyDescriptor(ye.prototype,"renewToken"),ye.prototype),Ce(ye.prototype,"enableAudioVolumeIndicator",[nj],Object.getOwnPropertyDescriptor(ye.prototype,"enableAudioVolumeIndicator"),ye.prototype),Ce(ye.prototype,"startLiveStreaming",[rj],Object.getOwnPropertyDescriptor(ye.prototype,"startLiveStreaming"),ye.prototype),Ce(ye.prototype,"setLiveTranscoding",[ij],Object.getOwnPropertyDescriptor(ye.prototype,"setLiveTranscoding"),ye.prototype),Ce(ye.prototype,"stopLiveStreaming",[sj],Object.getOwnPropertyDescriptor(ye.prototype,"stopLiveStreaming"),ye.prototype),Ce(ye.prototype,"startChannelMediaRelay",[oj],Object.getOwnPropertyDescriptor(ye.prototype,"startChannelMediaRelay"),ye.prototype),Ce(ye.prototype,"updateChannelMediaRelay",[aj],Object.getOwnPropertyDescriptor(ye.prototype,"updateChannelMediaRelay"),ye.prototype),Ce(ye.prototype,"stopChannelMediaRelay",[cj],Object.getOwnPropertyDescriptor(ye.prototype,"stopChannelMediaRelay"),ye.prototype),Ce(ye.prototype,"sendCustomReportMessage",[lj],Object.getOwnPropertyDescriptor(ye.prototype,"sendCustomReportMessage"),ye.prototype),Ce(ye.prototype,"pickSVCLayer",[dj],Object.getOwnPropertyDescriptor(ye.prototype,"pickSVCLayer"),ye.prototype),Ce(ye.prototype,"setRTMConfig",[uj],Object.getOwnPropertyDescriptor(ye.prototype,"setRTMConfig"),ye.prototype),Ce(ye.prototype,"enableContentInspect",[hj],Object.getOwnPropertyDescriptor(ye.prototype,"enableContentInspect"),ye.prototype),Ce(ye.prototype,"disableContentInspect",[pj],Object.getOwnPropertyDescriptor(ye.prototype,"disableContentInspect"),ye.prototype),Ce(ye.prototype,"setImageModeration",[fj],Object.getOwnPropertyDescriptor(ye.prototype,"setImageModeration"),ye.prototype),Ce(ye.prototype,"setP2PTransport",[mj],Object.getOwnPropertyDescriptor(ye.prototype,"setP2PTransport"),ye.prototype),Ce(ye.prototype,"getJoinChannelServiceRecords",[_j],Object.getOwnPropertyDescriptor(ye.prototype,"getJoinChannelServiceRecords"),ye.prototype),Ce(ye.prototype,"setPublishAudioFilterEnabled",[gj],Object.getOwnPropertyDescriptor(ye.prototype,"setPublishAudioFilterEnabled"),ye.prototype),ye);class Fp{constructor(t,n){O(this,"id",0),O(this,"element",void 0),O(this,"peerPair",void 0),O(this,"context",void 0),O(this,"audioPlayerElement",void 0),O(this,"audioTrack",void 0),Fp.count+=1,this.id=Fp.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,o)=>{const c=o==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(c),i.iceGatheringState==="complete"?i.localDescription:new ve(l=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&l(i.localDescription)}})},n=async(i,o)=>await i.setRemoteDescription(o);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(i){throw new Q(k.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new Q(k.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new Q(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var vj,rE;O(Fp,"count",0);const sne=window.AudioContext||window.webkitAudioContext,one=new(vj=xe({report:be}),Ce((rE=class{constructor(){O(this,"units",[]),O(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new sne);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Fp(e,this.context),this.units.push(t)),t.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return dt().name!==gt.SAFARI}}).prototype,"processExternalMediaAEC",[vj],Object.getOwnPropertyDescriptor(rE.prototype,"processExternalMediaAEC"),rE.prototype),rE);function yj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Sj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yj(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const xC=window||document;function Tj(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!xC)return;const n=Cn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=o=>{if(!(o&&o.blockedURI&&(Cn.onSecurityPolicyViolation||Cn.getListeners(Ho.SECURITY_POLICY_VIOLATION).length>0)))return;const c=o.blockedURI;M("CSP_DETECTED_HOSTNAME_LIST").some(l=>pe(c).call(c,l))&&(Cn.onSecurityPolicyViolation&&typeof Cn.onSecurityPolicyViolation=="function"&&Cn.onSecurityPolicyViolation(o),Cn.getListeners(Ho.SECURITY_POLICY_VIOLATION).length>0&&Cn.safeEmit(Ho.SECURITY_POLICY_VIOLATION,o))};n&&xC.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Cn.getListeners(Ho.SECURITY_POLICY_VIOLATION).length>0)&&xC.addEventListener("securitypolicyviolation",i),Cn._cspEventHandlerPointer=i}var ane=B,cne=rL,Rj=RegExp.prototype,lne=function(e){return e===Rj||ane(Rj,e)?cne(e):e.flags},kr=p(lne);function Iu(e){let t=e.length;for(;--t>=0;)e[t]=0}const UC=256,Cj=286,Bp=30,Wp=15,VC=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),iE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),dne=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wj=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ca=new Array(576);Iu(Ca);const Gp=new Array(60);Iu(Gp);const Hp=new Array(512);Iu(Hp);const Kp=new Array(256);Iu(Kp);const jC=new Array(29);Iu(jC);const sE=new Array(Bp);function FC(e,t,n,i,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=o,this.has_stree=e&&e.length}let bj,Ij,Aj;function BC(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Iu(sE);const Oj=e=>e<256?Hp[e]:Hp[256+(e>>>7)],zp=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Gi=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,zp(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Yo=(e,t,n)=>{Gi(e,n[2*t],n[2*t+1])},Nj=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},Pj=(e,t,n)=>{const i=new Array(16);let o,c,l=0;for(o=1;o<=Wp;o++)l=l+n[o-1]<<1,i[o]=l;for(c=0;c<=t;c++){let u=e[2*c+1];u!==0&&(e[2*c]=Nj(i[u]++,u))}},Dj=e=>{let t;for(t=0;t<Cj;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Bp;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},kj=e=>{e.bi_valid>8?zp(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Lj=(e,t,n,i)=>{const o=2*t,c=2*n;return e[o]<e[c]||e[o]===e[c]&&i[t]<=i[n]},WC=(e,t,n)=>{const i=e.heap[n];let o=n<<1;for(;o<=e.heap_len&&(o<e.heap_len&&Lj(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!Lj(t,i,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=i},Mj=(e,t,n)=>{let i,o,c,l,u=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+u++],i+=(255&e.pending_buf[e.sym_buf+u++])<<8,o=e.pending_buf[e.sym_buf+u++],i===0?Yo(e,o,t):(c=Kp[o],Yo(e,c+UC+1,t),l=VC[c],l!==0&&(o-=jC[c],Gi(e,o,l)),i--,c=Oj(i),Yo(e,c,n),l=iE[c],l!==0&&(i-=sE[c],Gi(e,i,l)));while(u<e.sym_next);Yo(e,256,t)},GC=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,c=t.stat_desc.elems;let l,u,h,f=-1;for(e.heap_len=0,e.heap_max=573,l=0;l<c;l++)n[2*l]!==0?(e.heap[++e.heap_len]=f=l,e.depth[l]=0):n[2*l+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=f<2?++f:0,n[2*h]=1,e.depth[h]=0,e.opt_len--,o&&(e.static_len-=i[2*h+1]);for(t.max_code=f,l=e.heap_len>>1;l>=1;l--)WC(e,n,l);h=c;do l=e.heap[1],e.heap[1]=e.heap[e.heap_len--],WC(e,n,1),u=e.heap[1],e.heap[--e.heap_max]=l,e.heap[--e.heap_max]=u,n[2*h]=n[2*l]+n[2*u],e.depth[h]=(e.depth[l]>=e.depth[u]?e.depth[l]:e.depth[u])+1,n[2*l+1]=n[2*u+1]=h,e.heap[1]=h++,WC(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,g)=>{const E=g.dyn_tree,y=g.max_code,I=g.stat_desc.static_tree,C=g.stat_desc.has_stree,w=g.stat_desc.extra_bits,D=g.stat_desc.extra_base,P=g.stat_desc.max_length;let x,K,H,j,J,re,se=0;for(j=0;j<=Wp;j++)m.bl_count[j]=0;for(E[2*m.heap[m.heap_max]+1]=0,x=m.heap_max+1;x<573;x++)K=m.heap[x],j=E[2*E[2*K+1]+1]+1,j>P&&(j=P,se++),E[2*K+1]=j,K>y||(m.bl_count[j]++,J=0,K>=D&&(J=w[K-D]),re=E[2*K],m.opt_len+=re*(j+J),C&&(m.static_len+=re*(I[2*K+1]+J)));if(se!==0){do{for(j=P-1;m.bl_count[j]===0;)j--;m.bl_count[j]--,m.bl_count[j+1]+=2,m.bl_count[P]--,se-=2}while(se>0);for(j=P;j!==0;j--)for(K=m.bl_count[j];K!==0;)H=m.heap[--x],H>y||(E[2*H+1]!==j&&(m.opt_len+=(j-E[2*H+1])*E[2*H],E[2*H+1]=j),K--)}})(e,t),Pj(n,f,e.bl_count)},xj=(e,t,n)=>{let i,o,c=-1,l=t[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)o=l,l=t[2*(i+1)+1],++u<h&&o===l||(u<f?e.bl_tree[2*o]+=u:o!==0?(o!==c&&e.bl_tree[2*o]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,c=o,l===0?(h=138,f=3):o===l?(h=6,f=3):(h=7,f=4))},Uj=(e,t,n)=>{let i,o,c=-1,l=t[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),i=0;i<=n;i++)if(o=l,l=t[2*(i+1)+1],!(++u<h&&o===l)){if(u<f)do Yo(e,o,e.bl_tree);while(--u!=0);else o!==0?(o!==c&&(Yo(e,o,e.bl_tree),u--),Yo(e,16,e.bl_tree),Gi(e,u-3,2)):u<=10?(Yo(e,17,e.bl_tree),Gi(e,u-3,3)):(Yo(e,18,e.bl_tree),Gi(e,u-11,7));u=0,c=o,l===0?(h=138,f=3):o===l?(h=6,f=3):(h=7,f=4)}};let Vj=!1;const jj=(e,t,n,i)=>{Gi(e,0+(i?1:0),3),kj(e),zp(e,n),zp(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var une=e=>{Vj||((()=>{let t,n,i,o,c;const l=new Array(16);for(i=0,o=0;o<28;o++)for(jC[o]=i,t=0;t<1<<VC[o];t++)Kp[i++]=o;for(Kp[i-1]=o,c=0,o=0;o<16;o++)for(sE[o]=c,t=0;t<1<<iE[o];t++)Hp[c++]=o;for(c>>=7;o<Bp;o++)for(sE[o]=c<<7,t=0;t<1<<iE[o]-7;t++)Hp[256+c++]=o;for(n=0;n<=Wp;n++)l[n]=0;for(t=0;t<=143;)Ca[2*t+1]=8,t++,l[8]++;for(;t<=255;)Ca[2*t+1]=9,t++,l[9]++;for(;t<=279;)Ca[2*t+1]=7,t++,l[7]++;for(;t<=287;)Ca[2*t+1]=8,t++,l[8]++;for(Pj(Ca,287,l),t=0;t<Bp;t++)Gp[2*t+1]=5,Gp[2*t]=Nj(t,5);bj=new FC(Ca,VC,257,Cj,Wp),Ij=new FC(Gp,iE,0,Bp,Wp),Aj=new FC(new Array(0),dne,0,19,7)})(),Vj=!0),e.l_desc=new BC(e.dyn_ltree,bj),e.d_desc=new BC(e.dyn_dtree,Ij),e.bl_desc=new BC(e.bl_tree,Aj),e.bi_buf=0,e.bi_valid=0,Dj(e)},hne=(e,t,n,i)=>{let o,c,l=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(u=>{let h,f=4093624447;for(h=0;h<=31;h++,f>>>=1)if(1&f&&u.dyn_ltree[2*h]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(h=32;h<UC;h++)if(u.dyn_ltree[2*h]!==0)return 1;return 0})(e)),GC(e,e.l_desc),GC(e,e.d_desc),l=(u=>{let h;for(xj(u,u.dyn_ltree,u.l_desc.max_code),xj(u,u.dyn_dtree,u.d_desc.max_code),GC(u,u.bl_desc),h=18;h>=3&&u.bl_tree[2*wj[h]+1]===0;h--);return u.opt_len+=3*(h+1)+5+5+4,h})(e),o=e.opt_len+3+7>>>3,c=e.static_len+3+7>>>3,c<=o&&(o=c)):o=c=n+5,n+4<=o&&t!==-1?jj(e,t,n,i):e.strategy===4||c===o?(Gi(e,2+(i?1:0),3),Mj(e,Ca,Gp)):(Gi(e,4+(i?1:0),3),((u,h,f,m)=>{let g;for(Gi(u,h-257,5),Gi(u,f-1,5),Gi(u,m-4,4),g=0;g<m;g++)Gi(u,u.bl_tree[2*wj[g]+1],3);Uj(u,u.dyn_ltree,h-1),Uj(u,u.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),Mj(e,e.dyn_ltree,e.dyn_dtree)),Dj(e),i&&kj(e)},pne=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Kp[n]+UC+1)]++,e.dyn_dtree[2*Oj(t)]++),e.sym_next===e.sym_end),fne=e=>{Gi(e,2,3),Yo(e,256,Ca),(t=>{t.bi_valid===16?(zp(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},mne={_tr_init:une,_tr_stored_block:jj,_tr_flush_block:hne,_tr_tally:pne,_tr_align:fne},Yp=(e,t,n,i)=>{let o=65535&e|0,c=e>>>16&65535|0,l=0;for(;n!==0;){l=n>2e3?2e3:n,n-=l;do o=o+t[i++]|0,c=c+o|0;while(--l);o%=65521,c%=65521}return o|c<<16|0};const _ne=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Gr=(e,t,n,i)=>{const o=_ne,c=i+n;e^=-1;for(let l=i;l<c;l++)e=e>>>8^o[255&(e^t[l])];return-1^e},kl={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},oE={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:gne,_tr_stored_block:HC,_tr_flush_block:Ene,_tr_tally:vc,_tr_align:vne}=mne,{Z_NO_FLUSH:yc,Z_PARTIAL_FLUSH:yne,Z_FULL_FLUSH:Sne,Z_FINISH:Fs,Z_BLOCK:Fj,Z_OK:$r,Z_STREAM_END:Bj,Z_STREAM_ERROR:qo,Z_DATA_ERROR:Tne,Z_BUF_ERROR:KC,Z_DEFAULT_COMPRESSION:Rne,Z_FILTERED:Cne,Z_HUFFMAN_ONLY:aE,Z_RLE:wne,Z_FIXED:bne,Z_DEFAULT_STRATEGY:Ine,Z_UNKNOWN:Ane,Z_DEFLATED:cE}=oE,zC=286,One=30,Nne=19,Pne=2*zC+1,Dne=15,Ll=258,Xo=262,Au=42,Ml=113,qp=666,xl=(e,t)=>(e.msg=kl[t],t),Wj=e=>2*e-(e>4?9:0),Sc=e=>{let t=e.length;for(;--t>=0;)e[t]=0},kne=e=>{let t,n,i,o=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=o?n-o:0;while(--t);t=o,i=t;do n=e.prev[--i],e.prev[i]=n>=o?n-o:0;while(--t)};let Tc=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ss=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},os=(e,t)=>{Ene(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ss(e.strm)},hn=(e,t)=>{e.pending_buf[e.pending++]=t},Xp=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},YC=(e,t,n,i)=>{let o=e.avail_in;return o>i&&(o=i),o===0?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),n),e.state.wrap===1?e.adler=Yp(e.adler,t,o,n):e.state.wrap===2&&(e.adler=Gr(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)},Gj=(e,t)=>{let n,i,o=e.max_chain_length,c=e.strstart,l=e.prev_length,u=e.nice_match;const h=e.strstart>e.w_size-Xo?e.strstart-(e.w_size-Xo):0,f=e.window,m=e.w_mask,g=e.prev,E=e.strstart+Ll;let y=f[c+l-1],I=f[c+l];e.prev_length>=e.good_match&&(o>>=2),u>e.lookahead&&(u=e.lookahead);do if(n=t,f[n+l]===I&&f[n+l-1]===y&&f[n]===f[c]&&f[++n]===f[c+1]){c+=2,n++;do;while(f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&c<E);if(i=Ll-(E-c),c=E-Ll,i>l){if(e.match_start=t,l=i,i>=u)break;y=f[c+l-1],I=f[c+l]}}while((t=g[t&m])>h&&--o!=0);return l<=e.lookahead?l:e.lookahead},Ou=e=>{const t=e.w_size;let n,i,o;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Xo)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),kne(e),i+=t),e.strm.avail_in===0)break;if(n=YC(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=Tc(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=Tc(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Xo&&e.strm.avail_in!==0)},Hj=(e,t)=>{let n,i,o,c=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,l=0,u=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>o&&(n=o),n<c&&(n===0&&t!==Fs||t===yc||n!==i+e.strm.avail_in)))break;l=t===Fs&&n===i+e.strm.avail_in?1:0,HC(e,0,0,l),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ss(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(YC(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(l===0);return u-=e.strm.avail_in,u&&(u>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=u&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-u,e.strm.next_in),e.strstart),e.strstart+=u,e.insert+=u>e.w_size-e.insert?e.w_size-e.insert:u),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),l?4:t!==yc&&t!==Fs&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(YC(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,c=o>e.w_size?e.w_size:o,i=e.strstart-e.block_start,(i>=c||(i||t===Fs)&&t!==yc&&e.strm.avail_in===0&&i<=o)&&(n=i>o?o:i,l=t===Fs&&e.strm.avail_in===0&&n===i?1:0,HC(e,e.block_start,n,l),e.block_start+=n,ss(e.strm)),l?3:1)},qC=(e,t)=>{let n,i;for(;;){if(e.lookahead<Xo){if(Ou(e),e.lookahead<Xo&&t===yc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Tc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Xo&&(e.match_length=Gj(e,n)),e.match_length>=3)if(i=vc(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Tc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Tc(e,e.ins_h,e.window[e.strstart+1]);else i=vc(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(os(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Fs?(os(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(os(e,!1),e.strm.avail_out===0)?1:2},Nu=(e,t)=>{let n,i,o;for(;;){if(e.lookahead<Xo){if(Ou(e),e.lookahead<Xo&&t===yc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Tc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Xo&&(e.match_length=Gj(e,n),e.match_length<=5&&(e.strategy===Cne||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,i=vc(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=o&&(e.ins_h=Tc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(os(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=vc(e,0,e.window[e.strstart-1]),i&&os(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=vc(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Fs?(os(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(os(e,!1),e.strm.avail_out===0)?1:2};function Jo(e,t,n,i,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=o}const Jp=[new Jo(0,0,0,0,Hj),new Jo(4,4,8,4,qC),new Jo(4,5,16,8,qC),new Jo(4,6,32,32,qC),new Jo(4,4,16,16,Nu),new Jo(8,16,32,32,Nu),new Jo(8,16,128,128,Nu),new Jo(8,32,128,256,Nu),new Jo(32,128,258,1024,Nu),new Jo(32,258,258,4096,Nu)];function Lne(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=cE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Pne),this.dyn_dtree=new Uint16Array(2*(2*One+1)),this.bl_tree=new Uint16Array(2*(2*Nne+1)),Sc(this.dyn_ltree),Sc(this.dyn_dtree),Sc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Dne+1),this.heap=new Uint16Array(2*zC+1),Sc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*zC+1),Sc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const $p=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Au&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Ml&&t.status!==qp?1:0},Kj=e=>{if($p(e))return xl(e,qo);e.total_in=e.total_out=0,e.data_type=Ane;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Au:Ml,e.adler=t.wrap===2?0:1,t.last_flush=-2,gne(t),$r},zj=e=>{const t=Kj(e);return t===$r&&(n=>{n.window_size=2*n.w_size,Sc(n.head),n.max_lazy_match=Jp[n.level].max_lazy,n.good_match=Jp[n.level].good_length,n.nice_match=Jp[n.level].nice_length,n.max_chain_length=Jp[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},Yj=(e,t,n,i,o,c)=>{if(!e)return qo;let l=1;if(t===Rne&&(t=6),i<0?(l=0,i=-i):i>15&&(l=2,i-=16),o<1||o>9||n!==cE||i<8||i>15||t<0||t>9||c<0||c>bne||i===8&&l!==1)return xl(e,qo);i===8&&(i=9);const u=new Lne;return e.state=u,u.strm=e,u.status=Au,u.wrap=l,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=t,u.strategy=c,u.method=n,zj(e)};var Mne=(e,t)=>{if($p(e)||t>Fj||t<0)return e?xl(e,qo):qo;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===qp&&t!==Fs)return xl(e,e.avail_out===0?KC:qo);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ss(e),e.avail_out===0)return n.last_flush=-1,$r}else if(e.avail_in===0&&Wj(t)<=Wj(i)&&t!==Fs)return xl(e,KC);if(n.status===qp&&e.avail_in!==0)return xl(e,KC);if(n.status===Au&&n.wrap===0&&(n.status=Ml),n.status===Au){let o=cE+(n.w_bits-8<<4)<<8,c=-1;if(c=n.strategy>=aE||n.level<2?0:n.level<6?1:n.level===6?2:3,o|=c<<6,n.strstart!==0&&(o|=32),o+=31-o%31,Xp(n,o),n.strstart!==0&&(Xp(n,e.adler>>>16),Xp(n,65535&e.adler)),e.adler=1,n.status=Ml,ss(e),n.pending!==0)return n.last_flush=-1,$r}if(n.status===57){if(e.adler=0,hn(n,31),hn(n,139),hn(n,8),n.gzhead)hn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),hn(n,255&n.gzhead.time),hn(n,n.gzhead.time>>8&255),hn(n,n.gzhead.time>>16&255),hn(n,n.gzhead.time>>24&255),hn(n,n.level===9?2:n.strategy>=aE||n.level<2?4:0),hn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(hn(n,255&n.gzhead.extra.length),hn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Gr(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(hn(n,0),hn(n,0),hn(n,0),hn(n,0),hn(n,0),hn(n,n.level===9?2:n.strategy>=aE||n.level<2?4:0),hn(n,3),n.status=Ml,ss(e),n.pending!==0)return n.last_flush=-1,$r}if(n.status===69){if(n.gzhead.extra){let o=n.pending,c=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+c>n.pending_buf_size;){let u=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+u),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>o&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex+=u,ss(e),n.pending!==0)return n.last_flush=-1,$r;o=0,c-=u}let l=new Uint8Array(n.gzhead.extra);n.pending_buf.set(l.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending+=c,n.gzhead.hcrc&&n.pending>o&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let o,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-c,c)),ss(e),n.pending!==0)return n.last_flush=-1,$r;c=0}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,hn(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-c,c)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let o,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-c,c)),ss(e),n.pending!==0)return n.last_flush=-1,$r;c=0}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,hn(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=Gr(e.adler,n.pending_buf,n.pending-c,c))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ss(e),n.pending!==0))return n.last_flush=-1,$r;hn(n,255&e.adler),hn(n,e.adler>>8&255),e.adler=0}if(n.status=Ml,ss(e),n.pending!==0)return n.last_flush=-1,$r}if(e.avail_in!==0||n.lookahead!==0||t!==yc&&n.status!==qp){let o=n.level===0?Hj(n,t):n.strategy===aE?((c,l)=>{let u;for(;;){if(c.lookahead===0&&(Ou(c),c.lookahead===0)){if(l===yc)return 1;break}if(c.match_length=0,u=vc(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,u&&(os(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,l===Fs?(os(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(os(c,!1),c.strm.avail_out===0)?1:2})(n,t):n.strategy===wne?((c,l)=>{let u,h,f,m;const g=c.window;for(;;){if(c.lookahead<=Ll){if(Ou(c),c.lookahead<=Ll&&l===yc)return 1;if(c.lookahead===0)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(f=c.strstart-1,h=g[f],h===g[++f]&&h===g[++f]&&h===g[++f])){m=c.strstart+Ll;do;while(h===g[++f]&&h===g[++f]&&h===g[++f]&&h===g[++f]&&h===g[++f]&&h===g[++f]&&h===g[++f]&&h===g[++f]&&f<m);c.match_length=Ll-(m-f),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(u=vc(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(u=vc(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),u&&(os(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,l===Fs?(os(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(os(c,!1),c.strm.avail_out===0)?1:2})(n,t):Jp[n.level].func(n,t);if(o!==3&&o!==4||(n.status=qp),o===1||o===3)return e.avail_out===0&&(n.last_flush=-1),$r;if(o===2&&(t===yne?vne(n):t!==Fj&&(HC(n,0,0,!1),t===Sne&&(Sc(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ss(e),e.avail_out===0))return n.last_flush=-1,$r}return t!==Fs?$r:n.wrap<=0?Bj:(n.wrap===2?(hn(n,255&e.adler),hn(n,e.adler>>8&255),hn(n,e.adler>>16&255),hn(n,e.adler>>24&255),hn(n,255&e.total_in),hn(n,e.total_in>>8&255),hn(n,e.total_in>>16&255),hn(n,e.total_in>>24&255)):(Xp(n,e.adler>>>16),Xp(n,65535&e.adler)),ss(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?$r:Bj)},xne=(e,t)=>{let n=t.length;if($p(e))return qo;const i=e.state,o=i.wrap;if(o===2||o===1&&i.status!==Au||i.lookahead)return qo;if(o===1&&(e.adler=Yp(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){o===0&&(Sc(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(t.subarray(n-i.w_size,n),0),t=h,n=i.w_size}const c=e.avail_in,l=e.next_in,u=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Ou(i);i.lookahead>=3;){let h=i.strstart,f=i.lookahead-2;do i.ins_h=Tc(i,i.ins_h,i.window[h+3-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--f);i.strstart=h,i.lookahead=2,Ou(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,i.wrap=o,$r},Qp={deflateInit:(e,t)=>Yj(e,t,cE,15,8,Ine),deflateInit2:Yj,deflateReset:zj,deflateResetKeep:Kj,deflateSetHeader:(e,t)=>$p(e)||e.state.wrap!==2?qo:(e.state.gzhead=t,$r),deflate:Mne,deflateEnd:e=>{if($p(e))return qo;const t=e.state.status;return e.state=null,t===Ml?xl(e,Tne):$r},deflateSetDictionary:xne,deflateInfo:"pako deflate (from Nodeca project)"};const Une=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var lE={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)Une(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,o=e.length;i<o;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,o=0,c=e.length;i<c;i++){let l=e[i];n.set(l,o),o+=l.length}return n}};let qj=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{qj=!1}const Zp=new Uint8Array(256);for(let e=0;e<256;e++)Zp[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Zp[254]=Zp[254]=1;var ef={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,o,c,l=e.length,u=0;for(o=0;o<l;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<l&&(i=e.charCodeAt(o+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),o++)),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(u),c=0,o=0;c<u;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<l&&(i=e.charCodeAt(o+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?t[c++]=n:n<2048?(t[c++]=192|n>>>6,t[c++]=128|63&n):n<65536?(t[c++]=224|n>>>12,t[c++]=128|n>>>6&63,t[c++]=128|63&n):(t[c++]=240|n>>>18,t[c++]=128|n>>>12&63,t[c++]=128|n>>>6&63,t[c++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,o;const c=new Array(2*n);for(o=0,i=0;i<n;){let l=e[i++];if(l<128){c[o++]=l;continue}let u=Zp[l];if(u>4)c[o++]=65533,i+=u-1;else{for(l&=u===2?31:u===3?15:7;u>1&&i<n;)l=l<<6|63&e[i++],u--;u>1?c[o++]=65533:l<65536?c[o++]=l:(l-=65536,c[o++]=55296|l>>10&1023,c[o++]=56320|1023&l)}}return((l,u)=>{if(u<65534&&l.subarray&&qj)return String.fromCharCode.apply(null,l.length===u?l:l.subarray(0,u));let h="";for(let f=0;f<u;f++)h+=String.fromCharCode(l[f]);return h})(c,o)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+Zp[e[n]]>t?n:t}},Xj=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Jj=Object.prototype.toString,{Z_NO_FLUSH:Vne,Z_SYNC_FLUSH:jne,Z_FULL_FLUSH:Fne,Z_FINISH:Bne,Z_OK:dE,Z_STREAM_END:Wne,Z_DEFAULT_COMPRESSION:Gne,Z_DEFAULT_STRATEGY:Hne,Z_DEFLATED:Kne}=oE;function uE(e){this.options=lE.assign({level:Gne,method:Kne,chunkSize:16384,windowBits:15,memLevel:8,strategy:Hne},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xj,this.strm.avail_out=0;let n=Qp.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==dE)throw new Error(kl[n]);if(t.header&&Qp.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?ef.string2buf(t.dictionary):Jj.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=Qp.deflateSetDictionary(this.strm,i),n!==dE)throw new Error(kl[n]);this._dict_set=!0}}function zne(e,t){const n=new uE(t);if(n.push(e,!0),n.err)throw n.msg||kl[n.err];return n.result}uE.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let o,c;if(this.ended)return!1;for(c=t===~~t?t:t===!0?Bne:Vne,typeof e=="string"?n.input=ef.string2buf(e):Jj.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(c===jne||c===Fne)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(o=Qp.deflate(n,c),o===Wne)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),o=Qp.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===dE;if(n.avail_out!==0){if(c>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},uE.prototype.onData=function(e){this.chunks.push(e)},uE.prototype.onEnd=function(e){e===dE&&(this.result=lE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Yne={deflate:zne};const hE=16209;var qne=function(e,t){let n,i,o,c,l,u,h,f,m,g,E,y,I,C,w,D,P,x,K,H,j,J,re,se;const le=e.state;n=e.next_in,re=e.input,i=n+(e.avail_in-5),o=e.next_out,se=e.output,c=o-(t-e.avail_out),l=o+(e.avail_out-257),u=le.dmax,h=le.wsize,f=le.whave,m=le.wnext,g=le.window,E=le.hold,y=le.bits,I=le.lencode,C=le.distcode,w=(1<<le.lenbits)-1,D=(1<<le.distbits)-1;e:do{y<15&&(E+=re[n++]<<y,y+=8,E+=re[n++]<<y,y+=8),P=I[E&w];t:for(;;){if(x=P>>>24,E>>>=x,y-=x,x=P>>>16&255,x===0)se[o++]=65535&P;else{if(!(16&x)){if(!(64&x)){P=I[(65535&P)+(E&(1<<x)-1)];continue t}if(32&x){le.mode=16191;break e}e.msg="invalid literal/length code",le.mode=hE;break e}K=65535&P,x&=15,x&&(y<x&&(E+=re[n++]<<y,y+=8),K+=E&(1<<x)-1,E>>>=x,y-=x),y<15&&(E+=re[n++]<<y,y+=8,E+=re[n++]<<y,y+=8),P=C[E&D];n:for(;;){if(x=P>>>24,E>>>=x,y-=x,x=P>>>16&255,!(16&x)){if(!(64&x)){P=C[(65535&P)+(E&(1<<x)-1)];continue n}e.msg="invalid distance code",le.mode=hE;break e}if(H=65535&P,x&=15,y<x&&(E+=re[n++]<<y,y+=8,y<x&&(E+=re[n++]<<y,y+=8)),H+=E&(1<<x)-1,H>u){e.msg="invalid distance too far back",le.mode=hE;break e}if(E>>>=x,y-=x,x=o-c,H>x){if(x=H-x,x>f&&le.sane){e.msg="invalid distance too far back",le.mode=hE;break e}if(j=0,J=g,m===0){if(j+=h-x,x<K){K-=x;do se[o++]=g[j++];while(--x);j=o-H,J=se}}else if(m<x){if(j+=h+m-x,x-=m,x<K){K-=x;do se[o++]=g[j++];while(--x);if(j=0,m<K){x=m,K-=x;do se[o++]=g[j++];while(--x);j=o-H,J=se}}}else if(j+=m-x,x<K){K-=x;do se[o++]=g[j++];while(--x);j=o-H,J=se}for(;K>2;)se[o++]=J[j++],se[o++]=J[j++],se[o++]=J[j++],K-=3;K&&(se[o++]=J[j++],K>1&&(se[o++]=J[j++]))}else{j=o-H;do se[o++]=se[j++],se[o++]=se[j++],se[o++]=se[j++],K-=3;while(K>2);K&&(se[o++]=se[j++],K>1&&(se[o++]=se[j++]))}break}}break}}while(n<i&&o<l);K=y>>3,n-=K,y-=K<<3,E&=(1<<y)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<l?l-o+257:257-(o-l),le.hold=E,le.bits=y};const pE=15,Xne=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Jne=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),$ne=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Qne=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var tf=(e,t,n,i,o,c,l,u)=>{const h=u.bits;let f,m,g,E,y,I,C=0,w=0,D=0,P=0,x=0,K=0,H=0,j=0,J=0,re=0,se=null;const le=new Uint16Array(16),Je=new Uint16Array(16);let nt,Fe,Rt,yt=null;for(C=0;C<=pE;C++)le[C]=0;for(w=0;w<i;w++)le[t[n+w]]++;for(x=h,P=pE;P>=1&&le[P]===0;P--);if(x>P&&(x=P),P===0)return o[c++]=20971520,o[c++]=20971520,u.bits=1,0;for(D=1;D<P&&le[D]===0;D++);for(x<D&&(x=D),j=1,C=1;C<=pE;C++)if(j<<=1,j-=le[C],j<0)return-1;if(j>0&&(e===0||P!==1))return-1;for(Je[1]=0,C=1;C<pE;C++)Je[C+1]=Je[C]+le[C];for(w=0;w<i;w++)t[n+w]!==0&&(l[Je[t[n+w]]++]=w);if(e===0?(se=yt=l,I=20):e===1?(se=Xne,yt=Jne,I=257):(se=$ne,yt=Qne,I=0),re=0,w=0,C=D,y=c,K=x,H=0,g=-1,J=1<<x,E=J-1,e===1&&J>852||e===2&&J>592)return 1;for(;;){nt=C-H,l[w]+1<I?(Fe=0,Rt=l[w]):l[w]>=I?(Fe=yt[l[w]-I],Rt=se[l[w]-I]):(Fe=96,Rt=0),f=1<<C-H,m=1<<K,D=m;do m-=f,o[y+(re>>H)+m]=nt<<24|Fe<<16|Rt|0;while(m!==0);for(f=1<<C-1;re&f;)f>>=1;if(f!==0?(re&=f-1,re+=f):re=0,w++,--le[C]==0){if(C===P)break;C=t[n+l[w]]}if(C>x&&(re&E)!==g){for(H===0&&(H=x),y+=D,K=C-H,j=1<<K;K+H<P&&(j-=le[K+H],!(j<=0));)K++,j<<=1;if(J+=1<<K,e===1&&J>852||e===2&&J>592)return 1;g=re&E,o[g]=x<<24|K<<16|y-c|0}}return re!==0&&(o[y+re]=C-H<<24|64<<16|0),u.bits=x,0};const{Z_FINISH:$j,Z_BLOCK:Zne,Z_TREES:fE,Z_OK:Ul,Z_STREAM_END:ere,Z_NEED_DICT:tre,Z_STREAM_ERROR:Bs,Z_DATA_ERROR:Qj,Z_MEM_ERROR:Zj,Z_BUF_ERROR:nre,Z_DEFLATED:eF}=oE,mE=16180,_E=16190,wa=16191,XC=16192,JC=16194,gE=16199,EE=16200,$C=16206,Hn=16209,tF=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function rre(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Vl=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<mE||t.mode>16211?1:0},nF=e=>{if(Vl(e))return Bs;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=mE,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ul},rF=e=>{if(Vl(e))return Bs;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,nF(e)},iF=(e,t)=>{let n;if(Vl(e))return Bs;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Bs:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,rF(e))},sF=(e,t)=>{if(!e)return Bs;const n=new rre;e.state=n,n.strm=e,n.window=null,n.mode=mE;const i=iF(e,t);return i!==Ul&&(e.state=null),i};let QC,ZC,oF=!0;const ire=e=>{if(oF){QC=new Int32Array(512),ZC=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(tf(1,e.lens,0,288,QC,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;tf(2,e.lens,0,32,ZC,0,e.work,{bits:5}),oF=!1}e.lencode=QC,e.lenbits=9,e.distcode=ZC,e.distbits=5},aF=(e,t,n,i)=>{let o;const c=e.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new Uint8Array(c.wsize)),i>=c.wsize?(c.window.set(t.subarray(n-c.wsize,n),0),c.wnext=0,c.whave=c.wsize):(o=c.wsize-c.wnext,o>i&&(o=i),c.window.set(t.subarray(n-i,n-i+o),c.wnext),(i-=o)?(c.window.set(t.subarray(n-i,n),0),c.wnext=i,c.whave=c.wsize):(c.wnext+=o,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=o))),0};var sre=(e,t)=>{let n,i,o,c,l,u,h,f,m,g,E,y,I,C,w,D,P,x,K,H,j,J,re=0;const se=new Uint8Array(4);let le,Je;const nt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Vl(e)||!e.output||!e.input&&e.avail_in!==0)return Bs;n=e.state,n.mode===wa&&(n.mode=XC),l=e.next_out,o=e.output,h=e.avail_out,c=e.next_in,i=e.input,u=e.avail_in,f=n.hold,m=n.bits,g=u,E=h,J=Ul;e:for(;;)switch(n.mode){case mE:if(n.wrap===0){n.mode=XC;break}for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(2&n.wrap&&f===35615){n.wbits===0&&(n.wbits=15),n.check=0,se[0]=255&f,se[1]=f>>>8&255,n.check=Gr(n.check,se,2,0),f=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=Hn;break}if((15&f)!==eF){e.msg="unknown compression method",n.mode=Hn;break}if(f>>>=4,m-=4,j=8+(15&f),n.wbits===0&&(n.wbits=j),j>15||j>n.wbits){e.msg="invalid window size",n.mode=Hn;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&f?16189:wa,f=0,m=0;break;case 16181:for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(n.flags=f,(255&kr(n))!==eF){e.msg="unknown compression method",n.mode=Hn;break}if(57344&kr(n)){e.msg="unknown header flags set",n.mode=Hn;break}n.head&&(n.head.text=f>>8&1),512&kr(n)&&4&n.wrap&&(se[0]=255&f,se[1]=f>>>8&255,n.check=Gr(n.check,se,2,0)),f=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}n.head&&(n.head.time=f),512&kr(n)&&4&n.wrap&&(se[0]=255&f,se[1]=f>>>8&255,se[2]=f>>>16&255,se[3]=f>>>24&255,n.check=Gr(n.check,se,4,0)),f=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&kr(n)&&4&n.wrap&&(se[0]=255&f,se[1]=f>>>8&255,n.check=Gr(n.check,se,2,0)),f=0,m=0,n.mode=16184;case 16184:if(1024&kr(n)){for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}n.length=f,n.head&&(n.head.extra_len=f),512&kr(n)&&4&n.wrap&&(se[0]=255&f,se[1]=f>>>8&255,n.check=Gr(n.check,se,2,0)),f=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&kr(n)&&(y=n.length,y>u&&(y=u),y&&(n.head&&(j=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(c,c+y),j)),512&kr(n)&&4&n.wrap&&(n.check=Gr(n.check,i,y,c)),u-=y,c+=y,n.length-=y),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&kr(n)){if(u===0)break e;y=0;do j=i[c+y++],n.head&&j&&n.length<65536&&(n.head.name+=String.fromCharCode(j));while(j&&y<u);if(512&kr(n)&&4&n.wrap&&(n.check=Gr(n.check,i,y,c)),u-=y,c+=y,j)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&kr(n)){if(u===0)break e;y=0;do j=i[c+y++],n.head&&j&&n.length<65536&&(n.head.comment+=String.fromCharCode(j));while(j&&y<u);if(512&kr(n)&&4&n.wrap&&(n.check=Gr(n.check,i,y,c)),u-=y,c+=y,j)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&kr(n)){for(;m<16;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(4&n.wrap&&f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Hn;break}f=0,m=0}n.head&&(n.head.hcrc=kr(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=wa;break;case 16189:for(;m<32;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}e.adler=n.check=tF(f),f=0,m=0,n.mode=_E;case _E:if(n.havedict===0)return e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,n.hold=f,n.bits=m,tre;e.adler=n.check=1,n.mode=wa;case wa:if(t===Zne||t===fE)break e;case XC:if(n.last){f>>>=7&m,m-=7&m,n.mode=$C;break}for(;m<3;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}switch(n.last=1&f,f>>>=1,m-=1,3&f){case 0:n.mode=16193;break;case 1:if(ire(n),n.mode=gE,t===fE){f>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Hn}f>>>=2,m-=2;break;case 16193:for(f>>>=7&m,m-=7&m;m<32;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Hn;break}if(n.length=65535&f,f=0,m=0,n.mode=JC,t===fE)break e;case JC:n.mode=16195;case 16195:if(y=n.length,y){if(y>u&&(y=u),y>h&&(y=h),y===0)break e;o.set(i.subarray(c,c+y),l),u-=y,c+=y,h-=y,l+=y,n.length-=y;break}n.mode=wa;break;case 16196:for(;m<14;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(n.nlen=257+(31&f),f>>>=5,m-=5,n.ndist=1+(31&f),f>>>=5,m-=5,n.ncode=4+(15&f),f>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Hn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}n.lens[nt[n.have++]]=7&f,f>>>=3,m-=3}for(;n.have<19;)n.lens[nt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,le={bits:n.lenbits},J=tf(0,n.lens,0,19,n.lencode,0,n.work,le),n.lenbits=le.bits,J){e.msg="invalid code lengths set",n.mode=Hn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;re=n.lencode[f&(1<<n.lenbits)-1],w=re>>>24,D=re>>>16&255,P=65535&re,!(w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(P<16)f>>>=w,m-=w,n.lens[n.have++]=P;else{if(P===16){for(Je=w+2;m<Je;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(f>>>=w,m-=w,n.have===0){e.msg="invalid bit length repeat",n.mode=Hn;break}j=n.lens[n.have-1],y=3+(3&f),f>>>=2,m-=2}else if(P===17){for(Je=w+3;m<Je;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}f>>>=w,m-=w,j=0,y=3+(7&f),f>>>=3,m-=3}else{for(Je=w+7;m<Je;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}f>>>=w,m-=w,j=0,y=11+(127&f),f>>>=7,m-=7}if(n.have+y>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Hn;break}for(;y--;)n.lens[n.have++]=j}}if(n.mode===Hn)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Hn;break}if(n.lenbits=9,le={bits:n.lenbits},J=tf(1,n.lens,0,n.nlen,n.lencode,0,n.work,le),n.lenbits=le.bits,J){e.msg="invalid literal/lengths set",n.mode=Hn;break}if(n.distbits=6,n.distcode=n.distdyn,le={bits:n.distbits},J=tf(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,le),n.distbits=le.bits,J){e.msg="invalid distances set",n.mode=Hn;break}if(n.mode=gE,t===fE)break e;case gE:n.mode=EE;case EE:if(u>=6&&h>=258){e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,n.hold=f,n.bits=m,qne(e,E),l=e.next_out,o=e.output,h=e.avail_out,c=e.next_in,i=e.input,u=e.avail_in,f=n.hold,m=n.bits,n.mode===wa&&(n.back=-1);break}for(n.back=0;re=n.lencode[f&(1<<n.lenbits)-1],w=re>>>24,D=re>>>16&255,P=65535&re,!(w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(D&&!(240&D)){for(x=w,K=D,H=P;re=n.lencode[H+((f&(1<<x+K)-1)>>x)],w=re>>>24,D=re>>>16&255,P=65535&re,!(x+w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}f>>>=x,m-=x,n.back+=x}if(f>>>=w,m-=w,n.back+=w,n.length=P,D===0){n.mode=16205;break}if(32&D){n.back=-1,n.mode=wa;break}if(64&D){e.msg="invalid literal/length code",n.mode=Hn;break}n.extra=15&D,n.mode=16201;case 16201:if(n.extra){for(Je=n.extra;m<Je;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;re=n.distcode[f&(1<<n.distbits)-1],w=re>>>24,D=re>>>16&255,P=65535&re,!(w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(!(240&D)){for(x=w,K=D,H=P;re=n.distcode[H+((f&(1<<x+K)-1)>>x)],w=re>>>24,D=re>>>16&255,P=65535&re,!(x+w<=m);){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}f>>>=x,m-=x,n.back+=x}if(f>>>=w,m-=w,n.back+=w,64&D){e.msg="invalid distance code",n.mode=Hn;break}n.offset=P,n.extra=15&D,n.mode=16203;case 16203:if(n.extra){for(Je=n.extra;m<Je;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Hn;break}n.mode=16204;case 16204:if(h===0)break e;if(y=E-h,n.offset>y){if(y=n.offset-y,y>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Hn;break}y>n.wnext?(y-=n.wnext,I=n.wsize-y):I=n.wnext-y,y>n.length&&(y=n.length),C=n.window}else C=o,I=l-n.offset,y=n.length;y>h&&(y=h),h-=y,n.length-=y;do o[l++]=C[I++];while(--y);n.length===0&&(n.mode=EE);break;case 16205:if(h===0)break e;o[l++]=n.length,h--,n.mode=EE;break;case $C:if(n.wrap){for(;m<32;){if(u===0)break e;u--,f|=i[c++]<<m,m+=8}if(E-=h,e.total_out+=E,n.total+=E,4&n.wrap&&E&&(e.adler=n.check=kr(n)?Gr(n.check,o,E,l-E):Yp(n.check,o,E,l-E)),E=h,4&n.wrap&&(kr(n)?f:tF(f))!==n.check){e.msg="incorrect data check",n.mode=Hn;break}f=0,m=0}n.mode=16207;case 16207:if(n.wrap&&kr(n)){for(;m<32;){if(u===0)break e;u--,f+=i[c++]<<m,m+=8}if(4&n.wrap&&f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Hn;break}f=0,m=0}n.mode=16208;case 16208:J=ere;break e;case Hn:J=Qj;break e;case 16210:return Zj;default:return Bs}return e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,n.hold=f,n.bits=m,(n.wsize||E!==e.avail_out&&n.mode<Hn&&(n.mode<$C||t!==$j))&&aF(e,e.output,e.next_out,E-e.avail_out),g-=e.avail_in,E-=e.avail_out,e.total_in+=g,e.total_out+=E,n.total+=E,4&n.wrap&&E&&(e.adler=n.check=kr(n)?Gr(n.check,o,E,e.next_out-E):Yp(n.check,o,E,e.next_out-E)),e.data_type=n.bits+(n.last?64:0)+(n.mode===wa?128:0)+(n.mode===gE||n.mode===JC?256:0),(g===0&&E===0||t===$j)&&J===Ul&&(J=nre),J},ba={inflateReset:rF,inflateReset2:iF,inflateResetKeep:nF,inflateInit:e=>sF(e,15),inflateInit2:sF,inflate:sre,inflateEnd:e=>{if(Vl(e))return Bs;let t=e.state;return t.window&&(t.window=null),e.state=null,Ul},inflateGetHeader:(e,t)=>{if(Vl(e))return Bs;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,Ul):Bs},inflateSetDictionary:(e,t)=>{const n=t.length;let i,o,c;return Vl(e)?Bs:(i=e.state,i.wrap!==0&&i.mode!==_E?Bs:i.mode===_E&&(o=1,o=Yp(o,t,n,0),o!==i.check)?Qj:(c=aF(e,t,n,n),c?(i.mode=16210,Zj):(i.havedict=1,Ul)))},inflateInfo:"pako inflate (from Nodeca project)"},ore=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const cF=Object.prototype.toString,{Z_NO_FLUSH:are,Z_FINISH:cre,Z_OK:nf,Z_STREAM_END:ew,Z_NEED_DICT:tw,Z_STREAM_ERROR:lre,Z_DATA_ERROR:lF,Z_MEM_ERROR:dre}=oE;function vE(e){this.options=lE.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xj,this.strm.avail_out=0;let n=ba.inflateInit2(this.strm,t.windowBits);if(n!==nf)throw new Error(kl[n]);if(this.header=new ore,ba.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=ef.string2buf(t.dictionary):cF.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=ba.inflateSetDictionary(this.strm,t.dictionary),n!==nf)))throw new Error(kl[n])}function ure(e,t){const n=new vE(t);if(n.push(e),n.err)throw n.msg||kl[n.err];return n.result}vE.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,o=this.options.dictionary;let c,l,u;if(this.ended)return!1;for(l=t===~~t?t:t===!0?cre:are,cF.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),c=ba.inflate(n,l),c===tw&&o&&(c=ba.inflateSetDictionary(n,o),c===nf?c=ba.inflate(n,l):c===lF&&(c=tw));n.avail_in>0&&c===ew&&n.state.wrap>0&&e[n.next_in]!==0;)ba.inflateReset(n),c=ba.inflate(n,l);switch(c){case lre:case lF:case tw:case dre:return this.onEnd(c),this.ended=!0,!1}if(u=n.avail_out,n.next_out&&(n.avail_out===0||c===ew))if(this.options.to==="string"){let h=ef.utf8border(n.output,n.next_out),f=n.next_out-h,m=ef.buf2string(n.output,h);n.next_out=f,n.avail_out=i-f,f&&n.output.set(n.output.subarray(h,h+f),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(c!==nf||u!==0){if(c===ew)return c=ba.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},vE.prototype.onData=function(e){this.chunks.push(e)},vE.prototype.onEnd=function(e){e===nf&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=lE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var hre={inflate:ure};const{deflate:pre}=Yne,{inflate:fre}=hre;var mre=pre,_re=fre,dF=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(dF||{});class gre{constructor(){O(this,"_sequence",0),O(this,"_startTime",Date.now()),O(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const u=new Uint8Array(4);u.set([1,0,0,0]);const h={id:0,length:4,data:u.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};n.commonPacketHeader.extension=1,n.extension=f,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;M("SHOW_DATASTREAM2_LOG")&&S.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),o=new Uint8Array(i),c=new DataView(i);let l=0;if(c.setUint16(l,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),l+=2,c.setUint32(l,n.commonPacketHeader.sequence,!0),l+=4,c.setUint16(l,n.commonStreamHeader,!0),l+=2,n.extension){const u=this.serializeExtension(n.extension);o.set(new Uint8Array(u),l),l+=u.byteLength}if(o.set(new Uint8Array(n.payload),l),l+=n.payload.byteLength,l!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const o=n.getUint16(i,!0);i+=2;const c={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let l,u;if(i+=4,M("SHOW_DATASTREAM2_LOG")&&S.debug("receive data header: ".concat(JSON.stringify(c))),n.getUint16(i,!0),i+=2,c.extension){u=this.deserializeExtension(t.slice(i)),i+=2+u.length,l=t.slice(i);let h=!1;if(u.datas.length>0){const f=u.datas.find(m=>m.id===0);f&&(h=(1&new DataView(f.data).getUint32(0,!0))==1)}l=h?this.decompress(l):l}else l=t.slice(8);return l}serializeExtension(t){const{profile:n,length:i,datas:o}=t,c=new ArrayBuffer(i+2),l=new Uint8Array(c),u=new DataView(c);let h=0;if(u.setUint8(h++,n),u.setUint8(h++,i),o.forEach(f=>{n?(u.setUint8(h++,f.id),u.setUint8(h++,f.length),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength):(u.setUint8(h++,f.id|f.length<<4),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength)}),h!==i+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(i+2));return c}deserializeExtension(t){const n=new DataView(t);let i=0;const o=n.getUint8(i);i++;const c=n.getUint8(i);i++;const l=o===dF.TWO_BYTE,u=[],h=new DataView(t,2);let f=0;for(;f<c;){let m=0,g=0,E=new ArrayBuffer(0);l?(m=h.getUint8(f),f++,g=h.getUint8(f),f++):(m=15&h.getUint8(f),g=h.getUint8(f)>>4,f++),g>0&&(E=h.buffer.slice(f+2,f+2+g),f+=E.byteLength),u.push({id:m,length:g,data:E})}if(f!==c)throw Error("parse error");return{profile:o,length:c,datas:u}}decompress(t){return _re(new Uint8Array(t))}compress(t){return mre(new Uint8Array(t))}}const Ere={name:"DataStream",create:(e,t)=>{const n=t?new bee(e):new Iee(e);return n.useDataStream(new gre),n}};class vre extends nn{constructor(t,n,i){super(),O(this,"ws",void 0),O(this,"requestId",1),O(this,"heartBeatTimer",void 0),O(this,"joinInfo",void 0),O(this,"clientId",void 0),O(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),O(this,"onClose",o=>{this.emit("close"),this.dispose()}),O(this,"onMessage",o=>{const c=JSON.parse(o.data);if(!c||c.command!=="serverResponse"||!c.requestId)return c&&c.command==="serverStatus"&&c.serverStatus&&c.serverStatus.command?(this.emit("status",c.serverStatus),void this.emit(c.serverStatus.command,c.serverStatus)):void 0;this.emit("req_".concat(c.requestId),c)}),this.joinInfo=t,this.clientId=n,this.ws=new Ap("cross-channel-".concat(this.clientId),i),this.ws.on(ze.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ze.CONNECTED,this.onOpen),this.ws.on(ze.ON_MESSAGE,this.onMessage),this.ws.on(ze.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ve((n,i)=>{const o=window.setTimeout(()=>{i(new Q(k.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,c=>{window.clearTimeout(o),c.state&&c.state!==0?i(new Q(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),i(new Q(k.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new Q(k.WS_DISCONNECT);const n=()=>new ve((l,u)=>{this.ws.once(ze.CLOSED,()=>u(new Q(k.WS_ABORT))),this.ws.once(ze.CONNECTED,l)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),o=new ve((l,u)=>{const h=()=>{u(new Q(k.WS_ABORT))};this.ws.once(ze.RECONNECTING,h),this.ws.once(ze.CLOSED,h),this.once("req_".concat(i),l),Xn(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(ze.RECONNECTING,h),this.ws.off(ze.CLOSED,h),u(new Q(k.TIMEOUT,"cross channel ws request timeout"))})}),c=await o;if(!c||c.code!==200)throw new Q(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(c)));return c}async connect(t){this.ws.removeAllListeners(ze.REQUEST_NEW_URLS),this.ws.on(ze.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class yre extends nn{set state(t){t!==this._state&&(t!==oi.RELAY_STATE_FAILURE&&(this.errorCode=fu.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,o,c){super(),O(this,"joinInfo",void 0),O(this,"sid",void 0),O(this,"clientId",void 0),O(this,"cancelToken",Yr.CancelToken.source()),O(this,"workerToken",void 0),O(this,"requestId",0),O(this,"signal",void 0),O(this,"prevChannelMediaConfig",void 0),O(this,"httpRetryConfig",void 0),O(this,"_resolution",void 0),O(this,"_state",oi.RELAY_STATE_IDLE),O(this,"errorCode",fu.RELAY_OK),O(this,"onStatus",l=>{S.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(l))),l&&l.command&&(l.command==="onAudioPacketReceived"&&this.emit("event",ya.PACKET_RECEIVED_AUDIO_FROM_SRC),l.command==="onVideoPacketReceived"&&this.emit("event",ya.PACKET_RECEIVED_VIDEO_FROM_SRC),l.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=fu.SRC_TOKEN_EXPIRED,this.state=oi.RELAY_STATE_FAILURE),l.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=fu.DEST_TOKEN_EXPIRED,this.state=oi.RELAY_STATE_FAILURE))}),O(this,"onReconnect",async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ya.NETWORK_DISCONNECTED),this.state=oi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(l=>{this.state!==oi.RELAY_STATE_IDLE&&(S.error("auto restart channel media relay failed",l.toString()),this.errorCode=fu.SERVER_CONNECTION_LOST,this.state=oi.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=vl(),this.signal=new vre(this.joinInfo,this.clientId,i),this.httpRetryConfig=o,this._resolution=c}async startChannelMediaRelay(t){if(this.state!==oi.RELAY_STATE_IDLE)throw new Q(k.INVALID_OPERATION);this.state=oi.RELAY_STATE_CONNECTING,await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new Q(k.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new Q(k.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new Q(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==oi.RELAY_STATE_RUNNING)throw new Q(k.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==oi.RELAY_STATE_RUNNING)throw new Q(k.INVALID_OPERATION);const n=this.genMessage(Wr.SetVideoProfile);await this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=oi.RELAY_STATE_IDLE,this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Yr.CancelToken.source(),this.state=oi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Dte(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",ya.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Wr.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Wr.SetSdkProfile,t);await this.signal.request(i),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(Wr.SetSourceChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ya.PACKET_JOINED_SRC_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const c=this.genMessage(Wr.SetSourceUserId,t);await this.signal.request(c),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(Wr.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ya.PACKET_JOINED_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(Wr.StartPacketTransfer,t);await this.signal.request(u),this.emit("event",ya.PACKET_SENT_TO_DEST_CHANNEL),this.state=oi.RELAY_STATE_RUNNING,S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Wr.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",ya.PACKET_UPDATE_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Wr.StopPacketTransfer);await this.signal.request(t),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],o=[],c=[];this.requestId+=1;const l={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Zi,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};l.sdkVersion==="4.24.0"&&(l.sdkVersion="0.0.1");let u=null,h=null;switch(t){case Wr.SetSdkProfile:return l.clientRequest={command:"SetSdkProfile",type:"multi_channel"},l;case Wr.SetSourceChannel:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new Q(k.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},l;case Wr.SetSourceUserId:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new Q(k.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceUserId",uid:h.uid+""},l;case Wr.SetDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new Q(k.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{i.push(f.channelName),o.push(f.uid+""),c.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"SetDestChannel",channelName:i,uid:o,token:c},l;case Wr.StartPacketTransfer:return l.clientRequest={command:"StartPacketTransfer"},l;case Wr.Reconnect:return l.clientRequest={command:"Reconnect"},l;case Wr.StopPacketTransfer:return l.clientRequest={command:"StopPacketTransfer"},l;case Wr.UpdateDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new Q(k.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{i.push(f.channelName),o.push(f.uid+""),c.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"UpdateDestChannel",channelName:i,uid:o,token:c},l;case Wr.SetVideoProfile:l.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return l}}const Sre={name:"ChannelMediaRelay",create:function(e){return new yre(e.joinInfo,e.clientId,e.websocketRetryConfig||Rn,e.httpRetryConfig||Rn,e.resolution)}};function uF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function rf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uF(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Tre extends nn{constructor(t,n,i,o){super(),O(this,"spec",void 0),O(this,"token",void 0),O(this,"websocket",void 0),O(this,"pingpongTimer",void 0),O(this,"reconnectMode","retry"),O(this,"serviceMode",void 0),O(this,"reqId",0),O(this,"commandReqId",0),O(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),O(this,"handleWebSocketMessage",c=>{if(!c.data)return;const l=JSON.parse(c.data);l.requestId?this.emit("@".concat(l.requestId,"-").concat(l.sid),l):(be.workerEvent(this.spec.sid,{actionType:"status",serverCode:l.code,workerType:this.serviceMode===va.TRANSCODE?1:2}),this.emit(ac.PUBLISH_STREAM_STATUS,l))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new Ap("live-streaming",i),this.websocket.on(ze.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ze.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ze.REQUEST_NEW_URLS,(c,l)=>{sr(this,ac.REQUEST_NEW_ADDRESS).then(c).catch(l)}),this.websocket.on(ze.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const c=this.commandReqId,l=this.reqId;if(!l||!this.websocket)throw new Q(k.UNEXPECTED_ERROR);const u=rf({command:t,sdkVersion:Zi==="4.24.0"?"0.0.1":Zi,seq:l,requestId:l,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new Q(k.WS_DISCONNECT);const h=()=>new ve((E,y)=>{this.websocket.once(ze.CLOSED,()=>y(new Q(k.WS_ABORT))),this.websocket.once(ze.CONNECTED,E)});this.websocket.state!=="connected"&&await h(),u.clientRequest&&(u.clientRequest.workerToken=this.token);const f=new ve((E,y)=>{const I=()=>{y(new Q(k.WS_ABORT))};this.websocket.once(ze.RECONNECTING,I),this.websocket.once(ze.CLOSED,I),this.once("@".concat(l,"-").concat(this.spec.sid),C=>{E(C)})});o&&be.workerEvent(this.spec.sid,rf(rf({},o),{},{requestId:c,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(u);let g=null;try{g=await f}catch(E){if(this.websocket.state==="closed")throw E;return await h(),await this.request(t,n,i)}return o&&be.workerEvent(this.spec.sid,rf(rf({},o),{},{requestId:c,actionType:"response",payload:JSON.stringify(g.serverResponse),serverCode:g.code,success:g.code===200,responseTime:Date.now()-m})),g.code!==200&&this.handleResponseError(g),g}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Zi==="4.24.0"?"0.0.1":Zi;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Nn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case Nn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Nn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Nn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Q(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Nn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Q(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Nn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Q(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Nn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new Q(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ac.WARNING,n,t.serverResponse.url)}case Nn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new Q(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ac.WARNING,n,t.serverResponse.url)}case Nn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Q(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Nn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Q(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Nn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new Q(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ac.WARNING,n,t.serverResponse.url)}case Nn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Q(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Nn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Q(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Nn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Nn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Q(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Nn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Q(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Q(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Nn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Q(k.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(ig)},6e3)}}function hF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ai(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hF(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Rre extends nn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Rn;super(),O(this,"onLiveStreamWarning",void 0),O(this,"onLiveStreamError",void 0),O(this,"spec",void 0),O(this,"retryTimeout",1e4),O(this,"connection",void 0),O(this,"httpRetryConfig",void 0),O(this,"wsRetryConfig",void 0),O(this,"streamingTasks",new Map),O(this,"isStartingStreamingTask",!1),O(this,"taskMutex",new ur("live-streaming")),O(this,"cancelToken",Yr.CancelToken.source()),O(this,"transcodingConfig",void 0),O(this,"uapResponse",void 0),O(this,"lastTaskId",1),O(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=ai(ai({},dte),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(S.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(l=>ai(ai(ai({},lte),l),{},{zOrder:l.zOrder?l.zOrder+1:1}))),function(l){on(l.width)||Dt(l.width,"config.width",0,1e4),on(l.height)||Dt(l.height,"config.height",0,1e4),on(l.videoBitrate)||Dt(l.videoBitrate,"config.videoBitrate",1,1e6),on(l.videoFrameRate)||Dt(l.videoFrameRate,"config.videoFrameRate"),on(l.lowLatency)||ao(l.lowLatency,"config.lowLatency"),on(l.audioSampleRate)||kn(l.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),on(l.audioBitrate)||Dt(l.audioBitrate,"config.audioBitrate",1,128),on(l.audioChannels)||kn(l.audioChannels,"config.audioChannels",[1,2,3,4,5]),on(l.videoGop)||Dt(l.videoGop,"config.videoGop"),on(l.videoCodecProfile)||kn(l.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),on(l.userCount)||Dt(l.userCount,"config.userCount",0,17),on(l.backgroundColor)||Dt(l.backgroundColor,"config.backgroundColor",0,16777215),on(l.userConfigExtraInfo)||qn(l.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),l.transcodingUsers&&!on(l.transcodingUsers)&&(Ea(l.transcodingUsers,"config.transcodingUsers"),l.transcodingUsers.forEach((u,h)=>{Ag(u.uid),on(u.x)||Dt(u.x,"transcodingUser[".concat(h,"].x"),0,1e4),on(u.y)||Dt(u.y,"transcodingUser[".concat(h,"].y"),0,1e4),on(u.width)||Dt(u.width,"transcodingUser[".concat(h,"].width"),0,1e4),on(u.height)||Dt(u.height,"transcodingUser[".concat(h,"].height"),0,1e4),on(u.zOrder)||Dt(u.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),on(u.alpha)||Dt(u.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),on(l.watermark)||eC(l.watermark,"watermark"),on(l.backgroundImage)||eC(l.backgroundImage,"backgroundImage"),l.images&&!on(l.images)&&(Ea(l.images,"config.images"),l.images.forEach((u,h)=>{eC(u,"images[".concat(h,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(l=>ai(ai(ai({},Z0),l),{},{zOrder:255}))),n.backgroundImage&&(i.push(ai(ai(ai({},Z0),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(ai(ai(ai({},Z0),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(l=>ai({},l)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(l=>typeof l.uid=="number"?ve.resolve(l.uid):UU(l.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ve.all(o)).forEach((l,u)=>{n.userConfigs&&n.userConfigs[u]&&(n.userConfigs[u].uid=l)}),this.transcodingConfig=n,this.connection)try{var c;const l=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ei(c=this.streamingTasks).call(c)).map(u=>u.taskId).join("#")});S.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(l.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(l){if(!l.data||!l.data.retry)throw l;l.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),l.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,l).then(()=>{S.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(h=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})})}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===va.TRANSCODE)throw new Q(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const c=await this.taskMutex.lock();if(!this.connection&&i)return void c();if(this.streamingTasks.get(t)&&!i)return c(),new Q(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(u){throw c(),u}switch(n){case va.TRANSCODE:o.transcodingConfig=ai({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const l=this.lastTaskId++;try{const u=new ve((f,m)=>{Xn(this.retryTimeout).then(()=>{if(i)return m(i);const g=this.statusError.get(t);return g?(this.statusError.delete(t),m(g)):void 0})}),h=await ve.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===va.TRANSCODE?1:2,requestByUser:!i,tid:l.toString()}),u]);this.isStartingStreamingTask=!1,S.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(h.code)),this.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:l}),c()}catch(u){if(c(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||i)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,u)):await this.startLiveStreamingTask(t,n,u)}}stopLiveStreamingTask(t){return new ve((n,i)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new Q(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const c=o.mode;o.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:c===va.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(l=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(l.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(Ei(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Yr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Q(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await sr(this,tC.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new Tre(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(ac.WARNING,(i,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,i)),this.connection.on(ac.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(ac.REQUEST_NEW_ADDRESS,(i,o)=>{if(!this.connection)return o(new Q(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));sr(this,tC.REQUEST_WORKER_MANAGER_LIST,t).then(c=>{this.uapResponse=c,i(c.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),o=t.reason;switch(t.code){case Nn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Nn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const l=new Q(k.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return S.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,l);if(!this.isStartingStreamingTask)return;this.statusError.set(n,l)}case Nn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const l=new Q(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,l)}case Nn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Nn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var c;if(!this.connection)return;this.connection.tryNextAddress();const l=Array.from(Ei(c=this.streamingTasks).call(c));for(const u of l)u.abortTask?u.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new Q(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(h=>{S.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Cre={name:"LiveStreaming",create:function(e){return new Rre(e.joinInfo,e.websocketRetryConfig||Rn,e.httpRetryConfig||Rn)}};function wre(e){let t=mF();return function(n,i){let o=n.appId;o!==void 0&&(At(i,10),$o(i,o));let c=n.cid;c!==void 0&&(At(i,16),At(i,c));let l=n.cname;l!==void 0&&(At(i,26),$o(i,l));let u=n.deviceId;u!==void 0&&(At(i,34),$o(i,u));let h=n.elapse;h!==void 0&&(At(i,40),Rc(i,h));let f=n.fileSize;f!==void 0&&(At(i,48),Rc(i,Pu(f)));let m=n.height;m!==void 0&&(At(i,56),Rc(i,Pu(m)));let g=n.jpg;g!==void 0&&(At(i,66),At(i,g.length),function(_r,ie){let he=Du(_r,ie.length);_r.bytes.set(ie,he)}(i,g));let E=n.networkType;E!==void 0&&(At(i,72),Rc(i,Pu(E)));let y=n.osType;y!==void 0&&(At(i,80),Rc(i,Pu(y)));let I=n.requestId;I!==void 0&&(At(i,90),$o(i,I));let C=n.sdkVersion;C!==void 0&&(At(i,98),$o(i,C));let w=n.sequence;w!==void 0&&(At(i,104),Rc(i,Pu(w)));let D=n.sid;D!==void 0&&(At(i,114),$o(i,D));let P=n.timestamp;P!==void 0&&(At(i,120),Rc(i,P));let x=n.uid;x!==void 0&&(At(i,128),At(i,x));let K=n.vid;K!==void 0&&(At(i,136),At(i,K));let H=n.width;H!==void 0&&(At(i,144),Rc(i,Pu(H)));let j=n.service;j!==void 0&&(At(i,152),At(i,j));let J=n.callbackData;J!==void 0&&(At(i,162),$o(i,J));let re=n.jpgEncryption;re!==void 0&&(At(i,168),At(i,re));let se=n.requestType;se!==void 0&&(At(i,176),At(i,se));let le=n.scorePorn;le!==void 0&&(At(i,185),ow(i,le));let Je=n.scoreSexy;Je!==void 0&&(At(i,193),ow(i,Je));let nt=n.scoreNeutral;nt!==void 0&&(At(i,201),ow(i,nt));let Fe=n.scene;Fe!==void 0&&(At(i,208),At(i,Fe));let Rt=n.ossFilePrefix;Rt!==void 0&&(At(i,218),$o(i,Rt));let yt=n.serviceVendor;if(yt!==void 0)for(let _r of yt){At(i,226);let ie=mF();Are(_r,ie),At(i,ie.limit),Dre(i,ie),Pre(ie)}}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function bre(e){return function(n){let i={};e:for(;!_F(n);){let o=Qo(n);switch(o>>>3){case 0:break e;case 1:i.code=Qo(n);break;case 2:i.msg=gF(n,Qo(n));break;case 3:{let c=Ore(n);i.data=Ire(n),n.limit=c;break}default:pF(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Ire(e){let t={};e:for(;!_F(e);){let n=Qo(e);switch(n>>>3){case 0:break e;case 1:t.requestId=gF(e,Qo(e));break;case 2:t.requestType=Qo(e)>>>0;break;case 3:t.scorePorn=sw(e);break;case 4:t.scoreSexy=sw(e);break;case 5:t.scoreNeutral=sw(e);break;case 6:t.requestScene=Qo(e)>>>0;break;case 7:t.scene=Qo(e)>>>0;break;default:pF(e,7&n)}}return t}function Are(e,t){let n=e.service;n!==void 0&&(At(t,8),At(t,n));let i=e.vendor;i!==void 0&&(At(t,16),At(t,i));let o=e.token;o!==void 0&&(At(t,26),$o(t,o));let c=e.callbackUrl;c!==void 0&&(At(t,34),$o(t,c))}function Ore(e){let t=Qo(e),n=e.limit;return e.limit=e.offset+t,n}function pF(e,t){switch(t){case 0:for(;128&EF(e););break;case 2:rw(e,Qo(e));break;case 5:rw(e,4);break;case 1:rw(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Nre=new Float32Array(1);new Uint8Array(Nre.buffer);let nw=new Float64Array(1),ci=new Uint8Array(nw.buffer);function Pu(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let fF=[];function mF(){const e=fF.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Pre(e){fF.push(e)}function rw(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function _F(e){return e.offset>=e.limit}function Du(e,t){let n=e.bytes,i=e.offset,o=e.limit,c=i+t;if(c>n.length){let l=new Uint8Array(2*c);l.set(n),e.bytes=l}return e.offset=c,c>o&&(e.limit=c),i}function iw(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function gF(e,t){let n=iw(e,t),i=String.fromCharCode,o=e.bytes,c="",l="";for(let u=0;u<t;u++){let h,f,m,g,E=o[u+n];128&E?(224&E)==192?u+1>=t?l+=c:(h=o[u+n+1],(192&h)!=128?l+=c:(g=(31&E)<<6|63&h,g<128?l+=c:(l+=i(g),u++))):(240&E)==224?u+2>=t?l+=c:(h=o[u+n+1],f=o[u+n+2],(49344&(h|f<<8))!=32896?l+=c:(g=(15&E)<<12|(63&h)<<6|63&f,g<2048||g>=55296&&g<=57343?l+=c:(l+=i(g),u+=2))):(248&E)==240?u+3>=t?l+=c:(h=o[u+n+1],f=o[u+n+2],m=o[u+n+3],(12632256&(h|f<<8|m<<16))!=8421504?l+=c:(g=(7&E)<<18|(63&h)<<12|(63&f)<<6|63&m,g<65536||g>1114111?l+=c:(g-=65536,l+=i(55296+(g>>10),56320+(1023&g)),u+=3))):l+=c:l+=i(E)}return l}function $o(e,t){let n=t.length,i=0;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}At(e,i);let o=Du(e,i),c=e.bytes;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?c[o++]=u:(u<2048?c[o++]=u>>6&31|192:(u<65536?c[o++]=u>>12&15|224:(c[o++]=u>>18&7|240,c[o++]=u>>12&63|128),c[o++]=u>>6&63|128),c[o++]=63&u|128)}}function Dre(e,t){let n=Du(e,t.limit),i=e.bytes,o=t.bytes;for(let c=0,l=t.limit;c<l;c++)i[c+n]=o[c]}function EF(e){return e.bytes[iw(e,1)]}function vF(e,t){let n=Du(e,1);e.bytes[n]=t}function sw(e){let t=iw(e,8),n=e.bytes;return ci[0]=n[t++],ci[1]=n[t++],ci[2]=n[t++],ci[3]=n[t++],ci[4]=n[t++],ci[5]=n[t++],ci[6]=n[t++],ci[7]=n[t++],nw[0]}function ow(e,t){let n=Du(e,8),i=e.bytes;nw[0]=t,i[n++]=ci[0],i[n++]=ci[1],i[n++]=ci[2],i[n++]=ci[3],i[n++]=ci[4],i[n++]=ci[5],i[n++]=ci[6],i[n++]=ci[7]}function Qo(e){let t,n=0,i=0;do t=EF(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function At(e,t){for(t>>>=0;t>=128;)vF(e,127&t|128),t>>>=7;vF(e,t)}function Rc(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,c=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,l=Du(e,c),u=e.bytes;switch(c){case 10:u[l+9]=o>>>7&1;case 9:u[l+8]=c!==9?128|o:127&o;case 8:u[l+7]=c!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=c!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=c!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=c!==5?128|i:127&i;case 4:u[l+3]=c!==4?n>>>21|128:n>>>21&127;case 3:u[l+2]=c!==3?n>>>14|128:n>>>14&127;case 2:u[l+1]=c!==2?n>>>7|128:n>>>7&127;case 1:u[l]=c!==1?128|n:127&n}}function yF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}const kre=new Map([["moderation",1],["supervise",2]]);class Lre extends nn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Gn.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Rs(n=t.map(i=>kre.get(i)||0)).call(n,(i,o)=>i+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),O(this,"name","AgoraRTCVideoContentInspect"),O(this,"_connectionState",Ms.CONNECTING),O(this,"_innerConnectionState",void 0),O(this,"sequence",0),O(this,"inspectStartTime",void 0),O(this,"workerManagerConnection",void 0),O(this,"workerConnection",void 0),O(this,"workerMessageLengthLimit",void 0),O(this,"inspectIntervalMinimum",void 0),O(this,"qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Yr.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"wmSequence",0),O(this,"inspectInterval",void 0),O(this,"inspectTimer",null),O(this,"ossFilePrefix",void 0),O(this,"extraInfo",void 0),O(this,"_inspectType",void 0),O(this,"_inspectMode",void 0),O(this,"_quality",1),O(this,"qualityTimer",null),O(this,"_inspectId",void 0),O(this,"_needWorkUrlOnly",!1),O(this,"inspectImage",()=>{if(this.connectionState!==Ms.CONNECTED)throw new Q(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ms.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ut(5,"inspect-"),this.workerMessageLengthLimit=M("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=M("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=M("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ap("worker-manager-"+this._inspectId,Rn),this.on(Gn.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,S.debug("[".concat(this._inspectId,"] Inspect operation :").concat(xs[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ap("worker-"+this._inspectId,Rn),this.handleWorkerEvents()}async init(t,n){this.emit(Gn.STATE_CHANGE,xs.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new ve((o,c)=>{this.on(Gn.CONNECTION_STATE_CHANGE,(l,u)=>{u===Ms.CONNECTED&&o()}),this.requestAP(t,i,n).then(l=>{this.connectWorkerManager(l)}).catch(l=>{c(l)})})}async requestAP(t,n,i){const o=M("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),c=await function(u,h,f,m){let{appId:g,areaCode:E,cname:y,sid:I,token:C,uid:w}=h;Su++;const D="image_moderation_api",P={service_name:D,json_body:JSON.stringify({appId:g,areaCode:E,cname:y,command:"allocateEdge",requestId:Su,seq:Su,sid:I,token:C,ts:Date.now(),uid:w+""})};let x,K,H=u[0];return co(async()=>{x=Date.now();const j=await fo(H,{data:P,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-x,j.code!==0){const le=new Q(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+j.code,{retry:!0,responseTime:K});throw S.error(le.toString()),le}const J=JSON.parse(j.json_body);if(J.code!==200){const le=new Q(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:K});throw S.error(le.toString()),le}if(!J.servers||!Array.isArray(J.servers)||J.servers.length===0){const le=new Q(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:J.code,responseTime:K});throw S.error(le.toString()),le}const re=M("VIDEO_INSPECT_WORKER_MANAGER_HOST"),se=M("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:J.servers.map(le=>{let{address:Je,wss:nt}=le;if(Je&&nt)return"wss://".concat(Je.replace(/\./g,"-"),".").concat(re,":").concat(se||nt)}).filter(le=>!!le),workerToken:J.workerToken,vid:J.vid,responseTime:K}},(j,J)=>(be.apworkerEvent(I,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(j.addressList),firstSuccess:J===0,responseTime:K,serverIp:u[J%u.length]}),!1),(j,J)=>(be.apworkerEvent(I,{success:!1,sc:j.data&&j.data.code||200,serviceName:D,responseTime:K,serverIp:u[J%u.length]}),!!(j.code!==k.OPERATION_ABORTED&&j.code!==k.UNEXPECTED_RESPONSE||j.data&&j.data.retry)&&(H=u[(J+1)%u.length],!0)),m)}(o,t,n,i);this.emit(Gn.STATE_CHANGE,xs.AP_CONNECTED);const{addressList:l}=c;return this.wmSequence++,l}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Gn.STATE_CHANGE,xs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ze.CONNECTED,async()=>{this.emit(Gn.STATE_CHANGE,xs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ze.CLOSED,()=>{this._innerConnectionState<xs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ze.FAILED,()=>{this._innerConnectionState<xs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ze.RECONNECTING,()=>{this._innerConnectionState<xs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ze.ON_MESSAGE,async t=>{this.emit(Gn.STATE_CHANGE,xs.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw S.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new Q(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw S.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new Q(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const o=M("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,c=n.replace(/:\d+\/?$/,":".concat(o));this.emit(Gn.STATE_CHANGE,xs.CONNECT_WORKER,c),this._needWorkUrlOnly?this.emit(Gn.REQUEST_NEW_WORKER_URL,c):await this.connectWorker(c)}}),this.workerManagerConnection.on(ze.WILL_RECONNECT,(t,n,i)=>{i(t)}),this.workerManagerConnection.on(ze.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(ze.CONNECTED,async()=>{this.emit(Gn.STATE_CHANGE,xs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ms.CONNECTED}),this.workerConnection.on(ze.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=bre(new Uint8Array(t.data));if(M("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&S.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Gn.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const o={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},c=Rs(n=Object.keys(o)).call(n,(u,h)=>o[u]>o[h]?u:h,"porn"),l=Object.keys(o).find(u=>u===c);this.emit(Gn.INSPECT_RESULT,l)}else this.emit(Gn.INSPECT_RESULT,void 0,new Q(k.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Gn.INSPECT_RESULT,void 0,new Q(k.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else S.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Gn.INSPECT_RESULT,void 0,new Q(k.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ze.CLOSED,()=>{this.connectionState=Ms.CLOSED}),this.workerConnection.on(ze.FAILED,()=>{this.connectionState=Ms.CLOSED}),this.workerConnection.on(ze.RECONNECTING,()=>{this.connectionState=this.connectionState===Ms.CONNECTED?Ms.RECONNECTING:Ms.CONNECTING}),this.workerConnection.on(ze.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(ze.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Gn.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const t=ki(this,Gn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Gn.INSPECT_RESULT,void 0,new Q(k.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Gn.INSPECT_RESULT,void 0,new Q(k.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:o,cid:c,vid:l,sid:u,uid:h}=n;const f=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),g=await ex(m,i,o),E=this.sequence+"-"+c+"-"+h+"-"+f+"-"+Ut(12,""),y={appId:i,cid:c,cname:o,deviceId:"",elapse:(I=Number(f-this.inspectStartTime),{low:I|=0,high:I>>31,unsigned:I>=0}),fileSize:g.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:g,networkType:6,osType:7,requestId:E,sdkVersion:"4.24.0",sequence:this.sequence,sid:u,timestamp:AV(f),uid:h,vid:l,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var I;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const C=wre(y);if(C.byteLength<this.workerMessageLengthLimit){if(M("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const w=function(D){for(var P=1;P<arguments.length;P++){var x=arguments[P]!=null?arguments[P]:{};P%2?yF(Object(x),!0).forEach(function(K){O(D,K,x[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(x)):yF(Object(x)).forEach(function(K){Object.defineProperty(D,K,Object.getOwnPropertyDescriptor(x,K))})}return D}({},y);delete w.jpg,S.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(w))}return C}{const w=this.quality*this.qualityRatio;return this.quality=w,await this.generateRequestData(t,{appId:i,cname:o,cid:c,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Yr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ms.CLOSED,this.emit(Gn.STATE_CHANGE,xs.CLOSED)}}const Mre={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new Q(k.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new Q(k.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(o=>{var c;if(!pe(c=["supervise","moderation"]).call(c,o))throw new Q(k.INVALID_PARAMS,"".concat(o," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new Q(k.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Lre(t)}};var SF=p(_i.Object.getOwnPropertySymbols),xre=It,Ure=_S.indexOf,Vre=Am,aw=Ue([].indexOf),TF=!!aw&&1/aw([1],1,-0)<0;xre({target:"Array",proto:!0,forced:TF||!Vre("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return TF?aw(this,e,t)||0:Ure(this,e,t)}});var jre=Ts("Array","indexOf"),Fre=B,Bre=jre,cw=Array.prototype,Wre=function(e){var t=e.indexOf;return e===cw||Fre(cw,e)&&t===cw.indexOf?Bre:t},RF=p(Wre);function Gre(e,t){if(e==null)return{};var n,i,o=function(l,u){if(l==null)return{};var h={};for(var f in l)if({}.hasOwnProperty.call(l,f)){if(RF(u).call(u,f)!==-1)continue;h[f]=l[f]}return h}(e,t);if(SF){var c=SF(e);for(i=0;i<c.length;i++)n=c[i],RF(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}let CF=class{get localCapabilities(){return $t(this._localCapabilities)}get rtpCapabilities(){return $t(this._rtpCapabilities)}get candidates(){return $t(this._candidates)}get iceParameters(){return $t(this._iceParameters)}get dtlsParameters(){return $t(this._dtlsParameters)}constructor(e){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname","o/i14u9pJrxRKAsu"),O(this,"firefoxSsrcMidMap",new Map),e=$t(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o,localCapabilities:c,direction:l,setup:u,videoCodec:h,audioCodec:f}=e;let m;this.setup=u,m=l===Br.RECEIVE_ONLY?ii(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ii(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=c;const g=l===Br.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,E=l===Br.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=l===Br.RECEIVE_ONLY?o.send.videoCodecs:Dp(Se.VIDEO,g,E,h),I=l===Br.RECEIVE_ONLY?o.send.audioCodecs:Dp(Se.AUDIO,g,E,f);for(const C of m.mediaDescriptions)C.attributes.iceUfrag=t.iceUfrag,C.attributes.icePwd=t.icePwd,C.attributes.fingerprints=n.fingerprints,C.attributes.candidates=i,C.attributes.setup=this.setup,C.media.mediaType==="application"&&(C.attributes.sctpPort="5000"),C.media.mediaType==="video"&&(C.media.fmts=y.map(w=>w.payloadType.toString(10)),C.attributes.payloads=y,C.attributes.extmaps=g.videoExtensions),C.media.mediaType==="audio"&&(C.media.fmts=I.map(w=>w.payloadType.toString(10)),C.attributes.payloads=I,C.attributes.extmaps=g.audioExtensions,yu(C));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return sc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,o){n=n.replace(/ /g,"-");const{ssrcs:c,ssrcGroups:l}=Pp(t,this.cname,M("SYNC_GROUP")?n:void 0),u=this.findPreloadMediaDesc(c);if(u){if(sn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,u.attributes.mid),o&&(o.twcc||o.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,o),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(e,c,i);let f;return h===-1?(f=this.createOrRecycleSendMedia(e,c,l,"sendonly",i,o),this.updateBundleMids()):(f=$t(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=c,f.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,o)),sn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(o=>{const c=o._mediaStreamTrack.kind,l=this.findAvailableRecvMediaIndex(c);let u,h=!1;l===-1?(h=!0,u=this.createOrRecycleRecvMedia(o,[],"recvonly",t,n),this.updateBundleMids()):(u=$t(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="recvonly"),i.push({mid:u.attributes.mid,needCreateTransceiver:h})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:o,type:c,relatedAddress:l,relatedPort:u,priority:h}=new RTCIceCandidate(e),f={foundation:t??"",componentId:"1",transport:n??"",priority:h?h+"":"",connectionAddress:i??"",port:o?o+"":"",type:c?c+"":"",relAddr:l??"",relPort:u?u+"":"",extension:{}};this.candidates.some(m=>m.priority===f.priority&&m.connectionAddress===f.connectionAddress&&m.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,o){const c=e._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=Dp(c,l,this.localCapabilities.send,c===Se.AUDIO?o:i),h=c===Se.VIDEO?l.videoExtensions:l.audioExtensions,f="".concat(++this.currentMidIndex);let m={media:{mediaType:c,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungRecvMediaDsec(m,e);const g=this.findFirstClosedMedia(c);if(g){const E=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[E]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>pe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>pe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(sn()){if(o){const c=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return o&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=$t(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,o,c){const l=this.rtpCapabilities.send,u=e===Se.VIDEO?l.videoCodecs:l.audioCodecs,h=e===Se.VIDEO?l.videoExtensions:l.audioExtensions;sn()&&(o="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:o}};f=this.mungSendMediaDesc(f,c);const m=this.findFirstClosedMedia(e);if(m){const g=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[g]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,t,n){const i=$t(e);return aC(i),vu(i,t),cC(i,t),gU(i),xg(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=$t(e);return xg(n,t,this.localCapabilities.recv),yu(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>sn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Hre=["sdp"];var Gt;function wF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Cc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wF(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let bF=(Gt=class xu extends Z2{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),O(this,"direction",void 0),O(this,"name",void 0),O(this,"store",void 0),O(this,"spec",void 0),O(this,"peerConnection",void 0),O(this,"initialOffer",void 0),O(this,"transport",void 0),O(this,"statsFilter",void 0),O(this,"localCandidateCount",0),O(this,"_isInRestartIce",!1),O(this,"mutex",void 0),O(this,"onLocalCandidate",void 0),O(this,"remoteSDP",void 0),O(this,"pendingCandidates",[]),O(this,"localCapabilities",void 0),O(this,"isReady",!1),O(this,"restartCnt",0),O(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new ur("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(xu.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Br.SEND_ONLY,this.name=this.direction===Br.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=_0(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await vU();if(this.localCapabilities=Ug(n),t){const{sdp:i}=t,o=Gre(t,Hre),c=function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},g=Np(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Us(g,m,"videoExtensions",E,y,I),Us(g,m,"videoCodecs",E,y,I),Us(g,m,"audioExtensions",E,y,I),Us(g,m,"audioCodecs",E,y,I),M("RAISE_H264_BASELINE_PRIORITY")){const C=I.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]==="42001f");if(C!==-1){const w=I.videoCodecs.findIndex(D=>D.rtpMap&&D.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(w<C){S.debug("raising H264 baseline profile priority");const D=I.videoCodecs[C];I.videoCodecs.splice(C,1),I.videoCodecs.splice(w,0,D)}w!==-1&&M("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(D=>!(D.rtpMap&&D.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&D.fmtp&&D.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:E,recv:y,sendrecv:I}}({},{},i);this.remoteSDP=new CF({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const l=await this.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const u=uc(l.sdp);await this.peerConnection.setLocalDescription(l);const h=await yU({},{},l.sdp);this.localCapabilities=Ug(h);const f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),Cc(Cc({},u),{},{sdp:l.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=uc(i.sdp);return this.initialOffer=i,Cc(Cc({},o),{},{sdp:i.sdp})}}catch(n){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:o}=t,c=await yU({},{},n);this.remoteSDP=new CF({remoteIceParameters:i,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const l=this.peerConnection.getTransceivers()[0];l!=null&&l.sender&&l.sender.transport&&this.tryBindTransportEvents(l.sender.transport)}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ne(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var o=this;return Qi(function*(){const c=yield pt(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[],u=o.remoteSDP.receive(t,n,i);t.forEach((w,D)=>{if(u[D].needCreateTransceiver){const P=o.peerConnection.addTransceiver(w._mediaStreamTrack,{direction:"sendonly"});l.push(P),w._updateRtpTransceiver(P)}else{const P=o.peerConnection.getTransceivers().find(x=>x.mid===u[D].mid);if(!P)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[D].mid));l.push(P),w._updateRtpTransceiver(P)}}),sn()&&M("SIMULCAST")===!0&&(yield pt(o.applySimulcastForFirefox(l,t)));const h=u.map(w=>w.mid),f=yield pt(o.peerConnection.createOffer()),m=o.mungSendOfferSDP(f.sdp,t,h),g=ii(m),E=h.map(w=>{const D=g.mediaDescriptions.find(P=>P.attributes.mid===w);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return fU(D,M("USE_PUB_RTX"))}),y=l.map((w,D)=>{const P=h[D];return{localSSRC:E[D],id:P}});yield pt(o.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield y}catch(w){const D=o.remoteSDP.toString();throw yield pt(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield pt(o.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield pt(o.stopSending(h,!0)),w}yield pt(o.applySimulcastEncodings(l,t)),yield pt(o.applySendEncodings(l,t));const I=o.remoteSDP.toString(),C=o.logSDPExchange(m,"offer","local","send");return C==null||C(I),yield pt(o.setRemoteDescription({type:"answer",sdp:I})),l.map((w,D)=>{const P=h[D];return{localSSRC:E[D],id:P}})}catch(l){throw l instanceof ne?l:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));o.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();l==null||l(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,n,i,o);if(l){const h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const m=await this.peerConnection.createAnswer(),g=this.mungReceiveAnswerSDP(m.sdp,c,t);f==null||f(g||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:g}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(c){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async mockReceive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,n,i,o);if(l){const u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,c,t);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(c){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===yl.Auto&&(this.store.p2pTransport=yl.SdRtn,ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xu.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xu.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=uc(n.sdp);return this.store.descriptionStart(),this.direction===Br.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Br.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=uc(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const c=this.remoteSDP.toString(),l=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),l==null||l(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?sn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:Cc(Cc({},Fo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Cc(Cc({},Fo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;pe(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o={iceServers:[]};var c;return t.iceServers?o.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(mp(t.turnServer.servers)?o.iceServers=t.turnServer.servers:(o.iceServers&&o.iceServers.push(...xu.turnServerConfigToIceServers(t.turnServer.servers,n,i)),M("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&t.turnServer.serversFromGateway&&o.iceServers.push(...xu.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),pe(c=[yl.Relay,yl.SdRtn]).call(c,n)&&(o.iceTransportPolicy="relay"),M("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(o.iceTransportPolicy="relay")}))),M("ENABLE_ENCODED_TRANSFORM")&&ft().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),S.debug("P2PConnection p2pTransport is ".concat(n)),o}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o=[],c=t.filter(u=>u.tcpport);S.debug("P2PConnection turnServers is ".concat(c,", current index is ").concat(i));const l=c.length>i?c[i]:c[0];switch(n){case yl.SdRtn:const u=t.filter(f=>{var m;return pe(m=f.username).call(m,"glb:")&&f.turnServerURL==f.turnServerURL}),h=u.length>i?u[i]:u[0];h&&(o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(lc(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(lc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case yl.Relay:l&&(o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(lc(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;default:l&&(o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(lc(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"stun:".concat(l.turnServerURL,":").concat(l.tcpport)}))}return o}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t==null?void 0:t.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:o}=n.getSelectedCandidatePair()||{};if(i&&o){const c=i.address+":"+i.port,l=o.address+":"+o.port;S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Al(c)),", remote ").concat(JSON.stringify(Al(l))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ft().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},c={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(t._encoderConfig){var l;const{bitrateMax:m,frameRate:g,scaleResolutionDownBy:E}=t._encoderConfig;m&&(c.maxBitrate=1e3*m),pe(l=t._hints).call(l,kt.LOW_STREAM)&&(g&&(c.maxFramerate=Ti(g)),E&&E>=1&&(c.scaleResolutionDownBy=E))}if(M("DSCP_TYPE")&&ga()){var u;const m=M("DSCP_TYPE");pe(u=["very-low","low","medium","high"]).call(u,m)&&(c.networkPriority=m)}const h=n.getParameters(),f=(i=h.encodings)===null||i===void 0?void 0:i[0];sn()&&!f&&(o.encodings=[c]),f&&Object.assign(f,c),Object.assign(h,o),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await n.setParameters(h)}async applySendEncodings(t,n){try{if(!ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],c=n[i];c instanceof Wt&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,o.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const o=ii(t);return n.forEach((c,l)=>{const u=i[l],h=o.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(vu(h,c),EU(h,c,this.store.codec))}),sc(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let h=0;h<t.length;h++){var i,o,c,l,u;const f=t[h],m=n[h];if(m instanceof Wt&&!pe(i=m._hints).call(i,kt.LOW_STREAM)&&(o=m._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const g={},E={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const y=f.sender.getParameters();await f.sender.setParameters(Object.assign(y,g))}}}async applySimulcastEncodings(t,n){if(!sn()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof Wt&&this.isVP8Simulcast(o)){const c=t[i],l={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=c.sender.getParameters();await c.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var n,i,o,c,l;return!!(t instanceof Wt&&M("SIMULCAST")&&this.store.codec==="vp8"&&!pe(n=t._hints).call(n,kt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(M("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",o)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const c=this.remoteSDP.toString();o==null||o(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async l=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const c=this.remoteSDP.toString();o==null||o(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var o;const c=(o=ii(n).mediaDescriptions.find(l=>l.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),pe(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const o=ii(t),c=o.mediaDescriptions.find(l=>l.attributes.mid===n);return c&&i===Se.AUDIO&&c.media.mediaType==="audio"&&yu(c),sc(o)}},Ce(Gt.prototype,"establish",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"establish"),Gt.prototype),Ce(Gt.prototype,"connect",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"connect"),Gt.prototype),Ce(Gt.prototype,"receive",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"receive"),Gt.prototype),Ce(Gt.prototype,"mockReceive",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"mockReceive"),Gt.prototype),Ce(Gt.prototype,"stopReceiving",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"stopReceiving"),Gt.prototype),Ce(Gt.prototype,"restartICE",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"restartICE"),Gt.prototype),Ce(Gt.prototype,"close",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"close"),Gt.prototype),Ce(Gt.prototype,"updateEncoderConfig",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"updateEncoderConfig"),Gt.prototype),Ce(Gt.prototype,"updateSendParameters",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"updateSendParameters"),Gt.prototype),Ce(Gt.prototype,"replaceTrack",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"replaceTrack"),Gt.prototype),Ce(Gt.prototype,"muteLocal",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"muteLocal"),Gt.prototype),Ce(Gt.prototype,"unmuteLocal",[Ws],Object.getOwnPropertyDescriptor(Gt.prototype,"unmuteLocal"),Gt.prototype),Gt);function Ws(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,c=await o.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},n}let go=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var IF,AF,OF,NF,PF,DF,kF,LF,MF,xF,UF,Qt;function VF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function yE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VF(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Kre=(IF=Eo(go.SEND_ONLY),AF=Eo(go.SEND_ONLY),OF=Eo(),NF=Eo(go.RECEIVE_ONLY),PF=Eo(go.RECEIVE_ONLY),DF=Eo(go.RECEIVE_ONLY),kF=Eo(go.RECEIVE_ONLY),LF=Eo(go.RECEIVE_ONLY),MF=Eo(go.RECEIVE_ONLY),xF=Eo(),UF=Eo(go.RECEIVE_ONLY),Qt=class extends nn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Pe.StateChange,t,this._state)}constructor(e,t){super(),O(this,"isPlanB",!1),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"sendConnection",void 0),O(this,"recvConnection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"statsCollector",void 0),O(this,"dtlsFailedCount",0),O(this,"sendMutex",void 0),O(this,"recvMutex",void 0),O(this,"_state",wt.Disconnected),O(this,"_restartStates",["disconnected","failed"]),O(this,"reconnectInterval",void 0),O(this,"uploadUnplinkStarted",!1),O(this,"uploadDownlinkStarted",!1),O(this,"uplinkStateUploadInterval",void 0),O(this,"downlinkStatsUploadInterval",void 0),O(this,"handleMuteLocalTrack",async(n,i,o)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==wt.Connected)return void o(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const h=this.filterTobeMutedTracks(n);if(h.length===0)return void i();const f=h.find(y=>y[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(h.map(y=>{let[,{id:I}]=y;return I}));let m=!1;var l,u;n.trackMediaType==="video"?m=!((l=this.localTrackMap.get(ae.LocalAudioTrack))===null||l===void 0||!l.track._muted):m=((u=this.localTrackMap.get(ae.LocalVideoTrack))===null||u===void 0?void 0:u.id)===void 0;const g=this.createMuteMessage(h);await xt(this,Pe.RequestMuteLocal,g);const E=n.trackMediaType==="video"?cc.MUTE_LOCAL_VIDEO:cc.MUTE_LOCAL_AUDIO;await xt(this,Pe.RequestP2PMuteLocal,{action:E,message:g,isMuteAll:m}),i()}catch(h){o(h)}finally{c()}}),O(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==wt.Connected)return void o(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const l=this.filterTobeUnmutedTracks(n);if(l.length===0)return void i();await this.sendConnection.unmuteLocal(l.map(f=>{let[,{id:m}]=f;return m}));const u=this.createUnmuteMessage(l),h=n.trackMediaType==="video"?cc.UNMUTE_LOCAL_VIDEO:cc.UNMUTE_LOCAL_AUDIO;await xt(this,Pe.RequestP2PMuteLocal,{action:h,message:u}),i()}catch(l){o(l)}finally{c()}}),O(this,"handleUpdateVideoEncoder",async(n,i,o,c)=>{let l;typeof c=="boolean"&&c||(l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const h=this.localTrackMap.get(ae.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==n||this.state!==wt.Connected)return void i();const{id:f,track:m}=h;f&&(await this.sendConnection.updateSendParameters(f,m),await this.sendConnection.updateEncoderConfig(f,m),this.emit(Pe.UpdateVideoEncoder,m)),i()}catch(h){o(h)}finally{var u;(u=l)===null||u===void 0||u()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,o)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const l=this.localTrackMap.get(ae.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==wt.Connected)return void i();const{id:u,track:h}=l;u&&await this.sendConnection.updateSendParameters(u,h),i()}catch(l){o(l)}finally{c()}}),O(this,"handleReplaceTrack",async(n,i,o,c)=>{let l;S.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(l=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var u;const f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:g}]=m;return n===g});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==wt.Connected)return void i();if(await((u=this.sendConnection)===null||u===void 0?void 0:u.replaceTrack(n,f[1].id)),f[0]===ae.LocalVideoTrack&&ft().supportDualStreamEncoding){const m=this.localTrackMap.get(ae.LocalVideoLowTrack);if(m){const g=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=g,m.track._originMediaStreamTrack=g,await new ve((E,y)=>{this.handleReplaceTrack(m.track,E,y,!0)})}}i()}catch(f){o(f)}finally{var h;(h=l)===null||h===void 0||h()}}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new tV(e),this.bindStatsUploaderEvents(),this.sendMutex=new ur("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new ur("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},M("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new bF(e,this.store,Br.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=wt.New,this.sendConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new bF(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=wt.Connected}async addRemoteCandidate(e,t){if(t===Br.RECEIVE_ONLY){if(!this.sendConnection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return Qi(function*(){const o=yield pt(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==wt.Connected){i.throwIfTrackTypeNotMatch(e);const f=e.filter(m=>i.pendingLocalTracks.indexOf(m)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(f))}i.store.pubId=i.store.pubId+1,mr.markPublishStart(i.store.clientId,i.store.pubId);const c=i.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield pt(i.tryToUnmuteAudio(e)));c.forEach(f=>{let{track:m,type:g}=f;const E=Date.now();i.store.publish(m.getTrackId(),g===ae.LocalAudioTrack?"audio":"video",E)}),i.bindLocalTrackEvents(c);const l=yield pt(i.sendConnection.send(c.map(f=>{let{track:m}=f;return m}),i.store.codec,i.store.audioCodec)),u=(yield pt(l.next())).value,h=i.createGatewayPublishMessage(c,u);try{yield h}catch(f){throw l.throw(f),(f==null?void 0:f.code)===k.WS_ABORT&&c.forEach(m=>{let{track:g}=m;i.pendingLocalTracks.indexOf(g)===-1&&i.pendingLocalTracks.push(g)}),i.unbindLocalTrackEvents(c),f}yield pt(l.next()),c.forEach(f=>{let{type:m}=f;i.statsCollector.addLocalStats(m)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(c,u),c.forEach(f=>{let{track:m,type:g}=f;const E=Date.now();i.store.publish(m.getTrackId(),g===ae.LocalAudioTrack?"audio":"video",void 0,E)}),i.startUploadUplinkState()}finally{o()}})()}async unpublish(e){if(!this.sendConnection||this.state!==wt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(o=>!pe(e).call(e,o)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(o=>o[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[c,{track:l}]=o;return{type:c,track:l}})),t.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===wt.Connected)return n&&n[1].track.close(),i;e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[o,{track:c,ssrcs:l}]=i;const u={stream_type:Ute(c,o),ssrcs:l};c._muted||!c._enabled?t.push(u):n.push(u)}),t.length>0&&t.forEach(i=>{xt(this,Pe.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{xt(this,Pe.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Qi(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await sr(this,Pe.RequestRePublish,this.pendingLocalTracks),this.emit(Pe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var o;if(!this.recvConnection)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;const{track:c,mid:l,transceiver:u}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===Se.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new uu(c,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new du(c,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack));const h=this.remoteUserMap.get(e);h?h.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const f=this.pendingRemoteTracks.findIndex(m=>{let{user:g,kind:E}=m;return g.uid===e.uid&&t===E});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Pe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.recvConnection||n||i.forEach(c=>{let{kind:l}=c;var u;if(l===Se.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===Se.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const o=this.filterTobeUnSubscribedTracks(e,t);o.length!==0&&(await this.recvConnection.stopReceiving(o.map(c=>{let[,{id:l}]=c;return l})),this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),o.forEach(c=>{let[l,{kind:u}]=c;var h,f;if(u===Se.VIDEO&&l._videoSSRC&&((h=this.recvConnection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===Se.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(u===Se.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),o.forEach(c=>{let[,{kind:l}]=c;xt(this,Pe.RequestP2PMuteRemote,l)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Se.VIDEO,Se.AUDIO].forEach(i=>{n.has(i)?xt(this,Pe.RequestP2PUnmuteRemote,i):xt(this,Pe.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Se.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ae.LocalAudioTrack);if((t==null?void 0:t.track)instanceof On){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==ae.LocalAudioTrack}).filter(i=>{let[o]=i;return!(e&&o===ae.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ae.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,o){if(e){const l=this.localTrackMap.get(ae.LocalAudioTrack),u=i?this.localTrackMap.get(ae.LocalVideoLowTrack):this.localTrackMap.get(ae.LocalVideoTrack);be.publish(this.store.sessionId,{eventElapse:mr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(kt.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var c;n||(n=[]);const l=n.find(h=>h instanceof dn),u=i?(c=this.localTrackMap.get(ae.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(h=>h instanceof Wt);be.publish(this.store.sessionId,{eventElapse:mr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(kt.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,i){const o=i===Se.VIDEO?n._videoSSRC:n._audioSSRC;o&&be.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Se.VIDEO,audio:i===Se.AUDIO,peerid:n.uid,subscribeRequestid:i===Se.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:mr.measureFromSubscribeStart(this.store.clientId,o)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ur("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ur("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ae.LocalAudioTrack);if((e==null?void 0:e.track)instanceof On){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=wt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ae.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ae.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Wt||t&&t.track instanceof dn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(si(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ae.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=cl(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=wt.Reconnecting,M("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ae.LocalVideoTrack:pe(t=i._hints).call(t,kt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ae.LocalAudioTrack:i instanceof On?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ae.LocalVideoLowTrack:}}),this.emit(Pe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(si(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Pe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((e instanceof mc?e.uid:e)===i.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===Br.SEND_ONLY){if(!this.sendConnection)throw new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const o=await i.restartICE(t);return i.isInRestartIce=!1,o}{const o=await i.restartICE();if(o){const c=await sr(this,Pe.RequestP2PRestartICE,{direction:Br.RECEIVE_ONLY,iceParameter:o});await i.restartICE(c),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ae.LocalVideoTrack),n=this.localTrackMap.get(ae.LocalAudioTrack),i=e.videoSend.find(y=>{var I;return y.ssrc===(t==null||(I=t.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),o=e.audioSend.find(y=>{var I;return y.ssrc===(n==null||(I=n.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!i||!o)return 1;const c=ki(this,Pe.NeedSignalRTT),l=i?i.rttMs:void 0,u=o?o.rttMs:void 0,h=l&&u?(l+u)/2:l||u,f=(h&&c?(h+c)/2:h||c)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,g=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,E=t==null?void 0:t.track;if(E&&E._encoderConfig&&E._hints.indexOf(kt.SCREEN_TRACK)===-1){const y=E._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(y&&I){const C=(1e3*y-I)/(1e3*y);return K2[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,c=i._videoSSRC,l=e.audioRecv.find(I=>I.ssrc===o),u=e.videoRecv.find(I=>I.ssrc===c);if(!l&&!u)return void(t+=1);const h=ki(this,Pe.NeedSignalRTT),f=e.rtt,m=(f&&h?(f+h)/2:f||h)||0,g=l?l.jitterMs:void 0,E=e.recvPacketLossRate;let y=.7*E*100/50+.3*m/1500;g&&(y=.6*E*100/50+.2*m/1500+.2*g/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ve((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],o=ft(),c=this.getAllTracks();e=$d(e=e.filter(h=>c.indexOf(h)===-1));let l=!1,u=!1;for(const h of e){if(h instanceof Wt&&(this.localTrackMap.has(ae.LocalVideoTrack)||l?new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:h,type:ae.LocalVideoTrack}),l=!0),t)){const f=this.getLowVideoTrack(h,n);i.push({track:f,type:ae.LocalVideoLowTrack})}if(h instanceof dn){const f=this.localTrackMap.get(ae.LocalAudioTrack);if(f){if(!(f.track instanceof On))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(u){const m=i.find(g=>{let{type:E}=g;return E===ae.LocalAudioTrack});if(!(m.track instanceof On))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(h)}else{if(!o.webAudioMediaStreamDest||h instanceof On||h._bypassWebAudio)i.push({track:h,type:ae.LocalAudioTrack});else{const m=new On;m.addAudioTrack(h),i.push({track:m,type:ae.LocalAudioTrack})}u=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=$d(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof dn){const o=this.localTrackMap.get(ae.LocalAudioTrack);if(!o)continue;o.track instanceof On?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(t.push([ae.LocalAudioTrack,o]),o.track.close())):t.push([ae.LocalAudioTrack,o])}if(i instanceof Wt){const o=this.localTrackMap.get(ae.LocalVideoTrack);if(!o)continue;t.push([ae.LocalVideoTrack,o]);const c=this.localTrackMap.get(ae.LocalVideoLowTrack);c&&t.push([ae.LocalVideoLowTrack,c])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ae.LocalVideoTrack:n.addListener(Re.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Re.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Re.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ae.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ae.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof On?e.trackList.forEach(n=>{n.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Re.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Re.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ae.LocalVideoTrack:n.off(Re.GET_STATS,this.handleGetLocalVideoStats),n.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Re.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Re.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ae.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ae.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof On?e.trackList.forEach(t=>{t.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Re.GET_STATS,this.handleGetLocalAudioStats),t.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Re.GET_STATS,this.handleGetLocalAudioStats),e.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof du&&t.addListener(Re.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof uu&&t.addListener(Re.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Re.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Se.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Se.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var o;let c,{track:l,type:u}=n;switch(u){case ae.LocalAudioTrack:c=bt.Audio;break;case ae.LocalVideoTrack:c=pe(o=l._hints).call(o,kt.SCREEN_TRACK)?bt.Screen:bt.High;break;case ae.LocalVideoLowTrack:c=bt.Low}return{kind:u===ae.LocalAudioTrack?Se.AUDIO:Se.VIDEO,stream_type:c,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:l.muted||!l.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=t;switch(o){case ae.LocalVideoTrack:i=pe(n=c._hints).call(n,kt.SCREEN_TRACK)?bt.Screen:bt.High;break;case ae.LocalAudioTrack:i=bt.Audio;break;case ae.LocalVideoLowTrack:i=bt.Low}return{stream_type:i,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:o,type:c}=n;this.localTrackMap.set(c,{track:o,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Pe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),pe(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Xn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Jt.TRACER}).onSuccess(),this.emit(Pe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(si(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(ts.FIRST_FRAME_DECODED),be.firstRemoteFrame(this.store.sessionId,Ln.FIRST_AUDIO_DECODE,Xt.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:mr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(si(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);i&&be.firstRemoteFrame(this.store.sessionId,Ln.FIRST_AUDIO_RECEIVED,Xt.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:mr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(si(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&be.firstRemoteFrame(this.store.sessionId,Ln.FIRST_VIDEO_RECEIVED,Xt.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:mr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(Pe.ConnectionTypeChange,i),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(dc(n))," -> ").concat(JSON.stringify(dc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(dc(n))," -> ").concat(JSON.stringify(dc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Pe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Br.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,S.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Br.SEND_ONLY?this.restartICE(e):sr(this,Pe.RequestP2PRestartICE,{direction:Br.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ae.LocalAudioTrack);if(e instanceof dn&&(n==null?void 0:n.track)instanceof On)return n.track.isActive||t.push([ae.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(i&&(t.push(i),i[0]===ae.LocalVideoTrack)){const o=this.localTrackMap.get(ae.LocalVideoLowTrack);o&&t.push([ae.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ae.LocalAudioTrack);if(e instanceof dn&&(n==null?void 0:n.track)instanceof On)return n.track.isActive&&t.push([ae.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(i)if(i[0]===ae.LocalVideoTrack){t.push(i);const o=this.localTrackMap.get(ae.LocalVideoLowTrack);o&&t.push([ae.LocalVideoLowTrack,o])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=t;switch(o){case ae.LocalAudioTrack:i=bt.Audio;break;case ae.LocalVideoTrack:i=pe(n=c._hints).call(n,kt.SCREEN_TRACK)?bt.Screen:bt.High;break;case ae.LocalVideoLowTrack:i=bt.Low}return{stream_type:i,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=t;switch(o){case ae.LocalAudioTrack:i=bt.Audio;break;case ae.LocalVideoTrack:i=pe(n=c._hints).call(n,kt.SCREEN_TRACK)?bt.Screen:bt.High;break;case ae.LocalVideoLowTrack:i=bt.Low}return{stream_type:i,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const o=i.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(i.entries()).forEach(o=>{let[c,l]=o;n.push([e,{kind:c,id:l}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:o,id:c}]=n;switch(o){case Se.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Se.VIDEO,ssrcId:i._videoSSRC}));case Se.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Se.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ae.LocalVideoTrack),n=this.localTrackMap.get(ae.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ve((i,o)=>{this.handleUpdateVideoEncoder(t.track,i,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ve((i,o)=>{this.handleUpdateVideoEncoder(n.track,i,o,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof dn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await xt(this,Pe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Pe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Pe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Xn(d0(this.dtlsFailedCount,Rn)),this.emit(Pe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ae.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Wt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Wt).length>1)throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof dn).length>1&&(e.some(t=>t instanceof dn&&t._bypassWebAudio)||!ft().webAudioMediaStreamDest))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Wt&&this.pendingLocalTracks.some(n=>n instanceof Wt))throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof dn&&this.pendingLocalTracks.some(n=>n instanceof dn)&&(!ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof dn&&n._bypassWebAudio)))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding,i=yE(yE({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=n?e._mediaStreamTrack.clone():bC(e,i);const c=Ut(8,"track-low-"),l=new Wt(o,yE(yE({},n&&{scaleResolutionDownBy:oC(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,c);return l.on(Sl.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,iu.LOW_STREAM)}),l._hints.push(kt.LOW_STREAM),e.addListener(Re.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var o;const c=Array.from(si(o=this.remoteUserMap).call(o)).find(l=>l._videoSSRC===e);if(c){i||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===c.uid&&h.type==="video");be.firstRemoteVideoDecode(this.store.sessionId,Ln.FIRST_VIDEO_DECODE,Xt.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:mr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const o=i.get(t);if(!o)return!1;const c=await this.recvConnection.getRemoteSSRC(o);return c!==void 0&&c!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ne(k.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ne(k.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ne(k.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ne(k.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ne(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ne(k.NOT_SUPPORTED)}async preConnect(e){throw new ne(k.NOT_SUPPORTED)}getEstablishParams(){throw new ne(k.NOT_SUPPORTED)}async reSubscribe(e){throw new ne(k.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new ne(k.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ae.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,iu.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ce(Qt.prototype,"p2pConnect",[IF],Object.getOwnPropertyDescriptor(Qt.prototype,"p2pConnect"),Qt.prototype),Ce(Qt.prototype,"unpublish",[AF],Object.getOwnPropertyDescriptor(Qt.prototype,"unpublish"),Qt.prototype),Ce(Qt.prototype,"unpublishLowStream",[OF],Object.getOwnPropertyDescriptor(Qt.prototype,"unpublishLowStream"),Qt.prototype),Ce(Qt.prototype,"subscribe",[NF],Object.getOwnPropertyDescriptor(Qt.prototype,"subscribe"),Qt.prototype),Ce(Qt.prototype,"mockSubscribe",[PF],Object.getOwnPropertyDescriptor(Qt.prototype,"mockSubscribe"),Qt.prototype),Ce(Qt.prototype,"unsubscribe",[DF],Object.getOwnPropertyDescriptor(Qt.prototype,"unsubscribe"),Qt.prototype),Ce(Qt.prototype,"muteRemote",[kF],Object.getOwnPropertyDescriptor(Qt.prototype,"muteRemote"),Qt.prototype),Ce(Qt.prototype,"unmuteRemote",[LF],Object.getOwnPropertyDescriptor(Qt.prototype,"unmuteRemote"),Qt.prototype),Ce(Qt.prototype,"hasRemoteMediaWithLock",[MF],Object.getOwnPropertyDescriptor(Qt.prototype,"hasRemoteMediaWithLock"),Qt.prototype),Ce(Qt.prototype,"disconnectForReconnect",[xF],Object.getOwnPropertyDescriptor(Qt.prototype,"disconnectForReconnect"),Qt.prototype),Ce(Qt.prototype,"remoteMediaSsrcChanged",[UF],Object.getOwnPropertyDescriptor(Qt.prototype,"remoteMediaSsrcChanged"),Qt.prototype),Qt);function Eo(e){return function(t,n,i){const o=t[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];switch(e){case go.SEND_ONLY:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,l)}finally{h()}}case go.RECEIVE_ONLY:{const h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,l)}finally{h()}}default:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(n)),f=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,l)}finally{h(),f()}}}},i}}class jl extends nn{constructor(t,n){super(),O(this,"signal",void 0),O(this,"token",void 0),O(this,"tokenTimeout",void 0),O(this,"tokenInterval",void 0),O(this,"_sequence",0),O(this,"userMap",new Map),O(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===Bt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*M("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,o,c){var l;if(this.userMap.size===0)return;const u=Array.from(Ei(l=this.userMap).call(l))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),o=o??Ut(6,""),c=c??this._sequence++;const h={_id:o,_type:t,_seq:c,_message:n,token:"".concat(this.token,"_").concat(u)};M("SHOW_P2P_LOG")&&S.debug("send message",h,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(h)).forEach(m=>{this.signal.request(je.DATA_STREAM,{payload:ic(this.encoder.encode(m))})});const f=new ve((m,g)=>{const E=window.setTimeout(()=>{this.off("res-@".concat(o,"_ack"),y),this.off("res-@".concat(o),C),this.off(_u.ABORT,I),S.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(o)),this.userMap.size===0?g(new ne(k.INVALID_REMOTE_USER)):g(new ne(k.TIMEOUT))},M("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{E&&window.clearTimeout(E),this.off(_u.ABORT,I),i&&m()},I=()=>{E&&window.clearTimeout(E),this.off("res-@".concat(o,"_ack"),y),this.off("res-@".concat(o),C),g(new ne(k.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(o)))};this.once(_u.ABORT,I),this.once("res-@".concat(o,"_ack"),y);const C=(D,P)=>{w=!0,E&&window.clearTimeout(E),this.off("res-@".concat(o,"_ack"),y),this.off(_u.ABORT,I),D==="success"?m(P):g(new ne(k.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(o)))};let w=!1;i||(this.once("res-@".concat(o),C),Xn(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{w||S.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(o,", ").concat(h))}))});try{return await f}catch(m){if(m.code===k.TIMEOUT)return await this.send(t,n,i,o,c);throw m}}onMessage(t){var n;const{_uid:i}=t;let o,c=this.userMap.get(i);if(c)o=c.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==fn.CHECK)return;const{token:f}=t;o=new Map,c={uid:i,isStart:!0,token:f,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,c),this.signal.emit(ot.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var l;const{id:f,total:m}=t,g=(l=o.get(f))!==null&&l!==void 0?l:[];if(g.push(t),o.has(f)||o.set(f,g),g.length!==m)return;{const E=cl(g).call(g,(y,I)=>y.index-I.index).map(y=>y.payload).join("");o.delete(f),(t=JSON.parse(E))._uid=i}}const{_type:u,token:h}=t;if(pe(n=[fn.ACK,fn.CHECK]).call(n,u))return u===fn.CHECK&&this.handleCheckToken(c,h),void this.receiveMessage(t);h==="".concat(c.token,"_").concat(this.token)?this.handleReceivedMessage(t):S.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(c.token,"_").concat(this.token),t)}check(){const t={_id:Ut(6,""),token:this.token,_type:fn.CHECK};M("SHOW_P2P_LOG")&&S.debug("send message",t),this.signal.request(je.DATA_STREAM,{payload:ic(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:fn.ACK,token:this.token};M("SHOW_P2P_LOG")&&S.debug("send message",n),this.signal.request(je.DATA_STREAM,{payload:ic(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(fn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(f=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:g}=f;for(;m.has(g);){const E=m.get(g);m.delete(g),this.receiveMessage(E),f.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:o}=t,c=this.userMap.get(i),{receivedMessagesMap:l,isStart:u,nextExpectedSequenceNumber:h}=c;if(o<h)return this.ack(t._id),void S.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(t._message));l.set(o,t),u&&o===h&&(this.receiveMessage(t),l.delete(h),c.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:o,_uid:c}=t;if(M("SHOW_P2P_LOG")&&S.debug("receive message",t),n){let l;switch(t._type!==fn.ACK&&(o&&(l=JSON.parse(o)),this.ack(t._id)),t._type){case fn.CANDIDATE:case fn.CONTROL:this.signal.emit(i,l,c);break;case fn.PUBLISH:case fn.UNPUBLISH:case fn.RESTART_ICE:case fn.CALL:l.uid=c,sr(this.signal,i,l).then(u=>{this.response(t._id,u)}).catch(()=>{this.response(t._id,void 0,!0)});break;case fn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case fn.RESPONSE:{const{success:u,message:h}=l;this.emit("res-@".concat(n),u?"success":"failed",h);break}}}}splitMessage(t){if(t.length<jl.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),o=Ut(6,"");let c=0,l=800;const u=Math.ceil(t.length/l);for(;t.length>0;){c++;const h={id:o,index:c,total:u,payload:t.slice(0,l),token:"".concat(this.token,"_").concat(i)};JSON.stringify(h).length>jl.MAX_MESSAGE_SIZE?l-=50:(n.push(h),t=t.slice(l))}return n.map(h=>JSON.stringify(h))}handleCheckToken(t,n){return t.token!==n?(S.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{S.debug("token timeout, ".concat(n)),this.reset(t.uid)},M("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await sr(this.signal,fn.CALL,void 0),n=await this.send(fn.CALL,t);this.signal.emit(Be.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(_u.ABORT),this.signal.emit(ot.ON_USER_OFFLINE,{uid:i.uid,reason:ute.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(S.debug("change local token from ".concat(n," to ").concat(n)),this.token=Ut(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(_u.ABORT)}}O(jl,"MAX_SIZE",1),O(jl,"MAX_MESSAGE_SIZE",1024);class zre extends nn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Bt.CONNECTED?this.emit(Be.WS_CONNECTED):t===Bt.RECONNECTING?this.emit(Be.WS_RECONNECTING,this._websocketReconnectReason):t===Bt.CLOSED&&this.emit(Be.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Bt.CLOSED),O(this,"reconnectToken",void 0),O(this,"p2pToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new pM(5)),O(this,"pingpongTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"_external_signal",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Be.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const c="res-@".concat(o._id);this.emit(c,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case ot.ON_DATA_STREAM:return void this.handleDataStream(o._message);case ot.MUTE_AUDIO:case ot.MUTE_VIDEO:case ot.ON_P2P_LOST:case ot.ON_USER_ONLINE:return;case ot.ON_USER_OFFLINE:const{uid:c}=o._message;return S.debug("[".concat(this.clientId,"] user-offline uid: ").concat(c)),void this._external_signal.reset(c)}if(this.emit(o._type,o._message),o._type===ot.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===ot.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}if(o._type===ot.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Le.ERR_LICENSE_MISSING:this.close(Ct.LICENSE_MISSING);break;case Le.ERR_LICENSE_EXPIRED:this.close(Ct.LICENSE_EXPIRED);break;case Le.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ct.LICENSE_MINUTES_EXCEEDED);break;case Le.ERR_LICENSE_PERIOD_INVALID:this.close(Ct.LICENSE_PERIOD_INVALID);break;case Le.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case Le.ERR_LICENSE_ILLEGAL:this.close(Ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new iC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,M("JOIN_GATEWAY_USE_DUAL_DOMAIN"),M("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Bt.CONNECTED&&this.reconnect("retry",ir.OFFLINE)}),this.p2pToken=Ut(6,""),this._external_signal=new jl(this,this.p2pToken)}async request(t,n,i,o){const c=Ut(6,""),l={_id:c,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new ve((I,C)=>{if(this.connectionState===Bt.CONNECTED)return I();const w=()=>{this.off(Be.WS_CLOSED,D),I()},D=()=>{this.off(Be.WS_CONNECTED,w),C(new ne(k.WS_ABORT))};this.once(Be.WS_CONNECTED,w),this.once(Be.WS_CLOSED,D)});if(this.connectionState!==Bt.CONNECTING&&this.connectionState!==Bt.RECONNECTING||t===je.JOIN||t===je.REJOIN||await h(),this.websocket.sendMessage(l,!0),o)return;const f=new ve((I,C)=>{let w=!1;const D=(x,K)=>{w=!0,I({isSuccess:x==="success",message:K||{}}),this.off(Be.WS_CLOSED,P),this.off(Be.WS_RECONNECTING,P),this.emit(Be.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),D);const P=()=>{C(new ne(k.WS_ABORT,"type: ".concat(t))),this.off(Be.WS_CLOSED,P),this.off(Be.WS_RECONNECTING,P),this.off("res-@".concat(c),D)};this.once(Be.WS_CLOSED,P),this.once(Be.WS_RECONNECTING,P),Xn(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Be.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await f}catch(I){if(this.connectionState===Bt.CLOSED||t===je.LEAVE)throw new ne(k.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():t===je.JOIN||t===je.REJOIN?null:(await h(),await this.request(t,n))}if(m.isSuccess)return m.message;const g=Number(m.message.error_code||m.message.code),E=Ip(g),y=new ne(k.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(m.message.error_str),{code:g,data:m.message,desc:E.desc});return E.action==="success"?m.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(g,", message: ").concat(E.desc,", action: ").concat(E.action)),g===Le.ERR_TOO_MANY_BROADCASTERS?((t===je.JOIN||t===je.REJOIN)&&(this.initError=y,this.close()),y.throw()):E.action==="failed"?y.throw():E.action==="quit"?(this.initError=y,this.close(),y.throw()):(g===Le.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ir.MULTI_IP)):this.reconnect(E.action,ir.SERVER_ERROR),t===je.JOIN||t===je.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ve(i=>{const o=c=>{(!n||n(c))&&(this.off(t,o),i(c))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(wp.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const c=M("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Bt.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},M("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ve((n,i)=>{this.once(Be.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Be.WS_CLOSED,()=>i(this.initError||new ne(k.WS_ABORT))),this.connectionState=Bt.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Ct.LEAVE,this.connectionState=Bt.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ut(6,""),this._external_signal.clear(),this._external_signal=new jl(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Be.ABORT_P2P_EXECUTION);const t=await sr(this,Be.REQUEST_JOIN_INFO),n=await this.request(je.JOIN,t);if(!n)return this.emit(Be.REPORT_JOIN_GATEWAY,k.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Be.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const i=El(t.payload),o=new TextDecoder().decode(i),c=JSON.parse(o);"total"in c&&"id"in c||pe(n=Object.values(fn)).call(n,c._type)?(c._uid=t.uid,this._external_signal.onMessage(c)):this.emit(ot.ON_DATA_STREAM,t)}catch{this.emit(ot.ON_DATA_STREAM,t)}}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ip(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(n.action,ir.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=M("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>M("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ir.TIMEOUT):this.request(je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),M("REPORT_STATS")&&this.send(je.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(ze.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Be.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ze.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ze.CLOSED,()=>{this.connectionState=Bt.CLOSED}),this.websocket.on(ze.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=Bt.CLOSED}),this.websocket.on(ze.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Bt.CONNECTED?this.connectionState=Bt.RECONNECTING:this.connectionState=Bt.CONNECTING}),this.websocket.on(ze.WILL_RECONNECT,(t,n,i)=>{t!=="retry"?(S.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):S.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(ze.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Be.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ne&&t.code===k.UNEXPECTED_RESPONSE&&t.data.code===Le.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ir.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ir.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ze.REQUEST_NEW_URLS,(t,n)=>{sr(this,Be.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Yre={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new Kre(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new zre(n,t)}};function jF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function FF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jF(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class qre{constructor(t){O(this,"sessionDesc",void 0),O(this,"localCapabilities",void 0),O(this,"rtpCapabilities",void 0),O(this,"candidates",void 0),O(this,"_originCandidates",void 0),O(this,"iceParameters",void 0),O(this,"dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),t=$t(t);const{iceParameters:n,dtlsParameters:i,candidates:o,rtpCapabilities:c,setup:l,localCapabilities:u,sdkCodec:h,cname:f}=t,m=ii(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=c,this.candidates=o,this._originCandidates=$t(o),this.iceParameters=n,this.dtlsParameters=i,this.setup=l,this.localCapabilities=u,this.cname=f;for(let g=0;g<m.mediaDescriptions.length;g++){const E=m.mediaDescriptions[g];if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=i.fingerprints,E.attributes.candidates=o,E.attributes.setup=l,E.media.mediaType==="video"){E.media.fmts=c.videoCodecs.map(C=>C.payloadType.toString(10));const y=c.videoCodecs.filter(C=>{var w,D;return(w=C.rtpMap)===null||w===void 0?void 0:pe(D=w.encodingName.toLowerCase()).call(D,h)}),I=c.videoCodecs.filter(C=>!pe(y).call(y,C));E.attributes.payloads=[...y,...I],E.attributes.extmaps=c.videoExtensions}E.media.mediaType==="audio"&&(E.media.fmts=c.audioCodecs.map(y=>y.payloadType.toString(10)),E.attributes.payloads=c.audioCodecs,E.attributes.extmaps=c.audioExtensions),m.mediaDescriptions[g]=this.mungMediaDesc(E)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return sc(this.sessionDesc)}send(t,n,i){const{ssrcs:o,ssrcGroups:c}=Pp(n,this.cname),l=this.sessionDesc.mediaDescriptions.find(f=>t===Se.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),u=o[0].attributes.label,h=o[0].attributes.mslabel;return l.attributes.ssrcs=l.attributes.ssrcs.concat(o),l.attributes.ssrcGroups=l.attributes.ssrcGroups.concat(c),{id:u,mslabel:h}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:o}=n;return this.send(i,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],o=[],c=[];n.attributes.ssrcs.forEach(l=>{pe(t).call(t,l.attributes.label||"")?c.push(l):i.push(l)}),n.attributes.ssrcGroups.forEach(l=>{var u;pe(u=c.map(h=>h.ssrcId)).call(u,l.ssrcIds[0])||o.push(l)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=o})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((o,c)=>{const l=o._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===l.kind),h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],o);this.sessionDesc.mediaDescriptions[u]=h})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(o=>o.transport==="udp"),i=[];if(n.forEach(o=>{i.push(FF(FF({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),n.length!==0){switch(t){case fr.TCP_RELAY:this.candidates=i;break;case fr.UDP_TCP_RELAY:case fr.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(t){t=$t(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=$t(t);return vu(i,n),cC(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const o=this.sessionDesc.mediaDescriptions.find(l=>t===Se.VIDEO?l.attributes.mid==="video":l.attributes.mid==="audio");if(o){const l=o.attributes.ssrcs.find(u=>u.attributes.label===n);var c;l&&(l.attributes.label=i,(c=l.attributes.msid)===null||c===void 0||c.replace(n,i))}}mungMediaDesc(t){const n=$t(t);return aC(n),function(i){const o=i.attributes.extmaps.find(c=>Mg(c.extensionName));o&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(o),1),i.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var Vt;function BF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function SE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BF(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Xre=(Vt=class bf extends eU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return pe(n=Object.keys(yp)).call(n,t)}))]}constructor(t,n){super(t,n),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"statsFilter",void 0),O(this,"useRTX",!1),O(this,"localCapabilities",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"establishPromise",void 0),O(this,"mutex",void 0),this.store=n,this.mutex=new ur("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(bf.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=_0(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=uc(t.sdp),i=Np(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:M("FILTER_VIDEO_FEC"),filterAudioFec:M("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,SE(SE({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new qre(SE(SE({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new ne(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return Qi(function*(){const o=yield pt(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=t.map(E=>i.peerConnection.addTrack(E._mediaStreamTrack)),l=yield pt(i.peerConnection.createOffer()),u=ii(l.sdp),h=t.map(E=>{const y=E._mediaStreamTrack,I=u.mediaDescriptions.find(C=>C.attributes.mid===y.kind);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return function(C,w,D){const P=C.attributes.ssrcs.filter(K=>K.attributes.label===w),x=C.attributes.ssrcGroups;if(P.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(x&&P.length>1){const K=x.find(H=>H.ssrcIds.indexOf(P[0].ssrcId)!==-1);return K?[{ssrcId:K.ssrcIds[0],rtx:D?K.ssrcIds[1]:void 0}]:[{ssrcId:P[0].ssrcId}]}return[{ssrcId:P[0].ssrcId}]}(I,y.id,i.useRTX)});let f;try{f=yield h}catch(E){throw c.forEach(y=>{rr()&&y.replaceTrack(null),i.peerConnection.removeTrack(y)}),E}const m=i.mungSendOfferSDP(l.sdp,t);i.remoteSDP.receive(t,n,f);const g=i.remoteSDP.toString();return yield pt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield pt(i.applySendEncodings(c,t)),yield pt(i.peerConnection.setRemoteDescription({type:"answer",sdp:g})),t.map((E,y)=>{const I=E._mediaStreamTrack.id;return{localSSRC:h[y],id:I}})}catch(c){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(c=>{var l;return t.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(c=>{rr()&&c.replaceTrack(null),this.peerConnection.removeTrack(c)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:c,mslabel:l}=this.remoteSDP.send(t,n,o),u=new ve((m,g)=>{const E=setTimeout(()=>{g(new Error("Cannot receive track, id: ".concat(c)))},1e4),y=I=>{const C=dt();if((C.name==="Safari"&&Number(C.version)===11||Sr())&&I.track.id!==c&&I.streams[0].id===l){var w;const D=I.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(t,c,I.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(E),void m(D)}if(I.track.id===c)return this.peerConnection.removeEventListener("track",y),clearTimeout(E),void m(I.track)};this.peerConnection.addEventListener("track",y)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await u,id:c}}catch(c){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var o;return t.indexOf(((o=i.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(rr()&&i.track)i.track.enabled=!1;else{const o=i.getParameters();o.encodings.forEach(c=>c.active=!1),i.setParameters(o)}})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(c=>{var l;return t.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async c=>{if(rr()&&c.track)c.track.enabled=!0;else{const l=c.getParameters();l.encodings.forEach(u=>u.active=!0),await c.setParameters(l)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Qi(function*(){const i=yield pt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=ft().supportPCSetConfiguration;if(t===fr.RELAY&&!o)return;if(o){const f=n.peerConnection.getConfiguration(),m=t===fr.RELAY?"relay":"all";f.iceTransportPolicy!==m&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(m,"]")),f.iceTransportPolicy=m,n.peerConnection.setConfiguration(f))}t!==fr.RELAY&&n.remoteSDP.updateCandidates(t);const c=yield pt(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=uc(c.sdp),{remoteIceParameters:u}=yield l.iceParameters;n.remoteSDP.restartICE(u);const h=n.remoteSDP.toString();yield pt(n.peerConnection.setLocalDescription(c)),yield pt(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(o){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const c=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(o=>{var c;return((c=o.track)===null||c===void 0?void 0:c.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(o=>{var c;return((c=o.track)===null||c===void 0?void 0:c.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new ne(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ne(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},M("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(mp(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...bf.turnServerConfigToIceServers(t.turnServer.servers)),M("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...bf.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(f=>{var m;return((m=f.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!ft().supportSetRtpSenderParameters)return S.warn("Browser not support set rtp-sender parameters");const o={},c={};if(t instanceof Wt)switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(M("DSCP_TYPE")&&ga()){var l;const f=M("DSCP_TYPE");pe(l=["very-low","low","medium","high"]).call(l,f)&&(c.networkPriority=f)}const u=n.getParameters(),h=(i=u.encodings)===null||i===void 0?void 0:i[0];h&&Object.assign(h,c),Object.assign(u,o),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(t,n){try{if(!ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const o=t[i],c=n[i];o&&c&&await this.updateRtpSenderEncodings(c,o)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=ii(t);return n.forEach((o,c)=>{const l=o._mediaStreamTrack,u=i.mediaDescriptions.find(h=>h.attributes.mid===l.kind);u&&vu(u,o)}),sc(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((c,l)=>{let{id:u,mslabel:h}=c;const{kind:f}=t[l];return new ve((m,g)=>{const E=setTimeout(()=>{g(new Error("Cannot receive track, id: ".concat(u)))},1e4),y=I=>{const C=dt();if(C.name==="Safari"&&Number(C.version)===11&&I.track.id!==u&&I.streams[0].id===h){var w;const D=I.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(f,u,I.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(E),void m({track:D,id:u})}if(I.track.id===u)return this.peerConnection.removeEventListener("track",y),clearTimeout(E),void m({track:I.track,id:u})};this.peerConnection.addEventListener("track",y)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await ve.all(n)}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(ft().supportPCSetConfiguration){const n=bf.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ce(Vt.prototype,"connect",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"connect"),Vt.prototype),Ce(Vt.prototype,"stopSending",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"stopSending"),Vt.prototype),Ce(Vt.prototype,"receive",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"receive"),Vt.prototype),Ce(Vt.prototype,"stopReceiving",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"stopReceiving"),Vt.prototype),Ce(Vt.prototype,"muteRemote",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"muteRemote"),Vt.prototype),Ce(Vt.prototype,"unmuteRemote",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteRemote"),Vt.prototype),Ce(Vt.prototype,"muteLocal",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"muteLocal"),Vt.prototype),Ce(Vt.prototype,"unmuteLocal",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteLocal"),Vt.prototype),Ce(Vt.prototype,"close",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"close"),Vt.prototype),Ce(Vt.prototype,"updateEncoderConfig",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"updateEncoderConfig"),Vt.prototype),Ce(Vt.prototype,"updateSendParameters",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"updateSendParameters"),Vt.prototype),Ce(Vt.prototype,"replaceTrack",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"replaceTrack"),Vt.prototype),Ce(Vt.prototype,"getRemoteSSRC",[as],Object.getOwnPropertyDescriptor(Vt.prototype,"getRemoteSSRC"),Vt.prototype),Vt);function as(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,c=await o.lock("Locking from P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{c()}},n}const Jre={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new Xre(n,t)}},$re={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ft().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(Eg.has(e)||!e.track)return;const n={track:e.track};if(_a()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(l){return void S.error("create audio-encoded-streams error",l&&l.message)}const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(S.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const h=t.metadata&&t.metadata();h?function(f,m){const{chunk:g,controller:E}=m,y=oc.METADATA;g.data=function(I,C,w){const D=w.byteLength,P=D+B0+U2,x=j0+F0+P,K=new ArrayBuffer(I.byteLength+x),H=new DataView(K);H.setUint8(0,x2),H.setUint16(1,P),H.setUint8(3,C),H.setUint16(4,D);for(let J=0;J<D;J++)H.setUint8(6+J,w[J]);const j=new Uint8Array(H.buffer);return j.set(new Uint8Array(I),x),j.buffer}(g.data,y,f),E.enqueue(g)}(h,{chunk:l,controller:u}):u.enqueue(l)}});o.readable.pipeThrough(c).pipeTo(o.writable)}else if(rr()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const o=gg(),c=new MessageChannel;await new ve(u=>o.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"audio-metadata-tx",port:c.port2},[c.port2]);e.transform=l,await new ve(u=>o.onmessage=h=>{h.data==="started"&&u(void 0)}),c.port1.onmessage=u=>{var h;if(u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id)S.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(u.data.getMetadata){const f=t.metadata&&t.metadata();f&&c.port1.postMessage({metadata:f})}},n.worker=o}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const o=Eg.get(e);if(o){Eg.delete(e);try{var c,l;(c=o.controller)===null||c===void 0||c.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(u){S.warning(u&&u.message)}}}Eg.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ft().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(Cg.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(_a()&&!Sr()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");JR(gt.CHROME,87,116)||(t.enableTopn=!1);let o=null;try{o=e.createEncodedStreams()}catch(l){return void S.error("create audio-encoded-streams error",l&&l.message)}const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(S.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?function(h,f,m){var g;const E=W0(new DataView(f.data));if(!E)return m.enqueue(f);const y=h.track.id;Dee.set(y,h.track);const I=(g=E.tlv.find(K=>K.tag===oc.AUDIO_LEVEL))===null||g===void 0?void 0:g.value;let C=0;typeof I=="number"&&(C=127-I);const w=Math.round(Math.pow(10,C/60)-1),{selected:D,speaker:P}=function(K,H){let j=hu.get(K);if(j||(j=function(J){const re=new j2;return hu.set(J,re),uo||(uo=new Nee(M("TOPN_SILENCE_THRESHOLD")||500),uo.on("ActiveSpeakerChanged",se=>{se!=null&&(Sg=se)})),uo.addSpeakers([re]),re}(K)),hu.size<=F2)return{selected:!0,speaker:j};if(!uo)throw new Error("no active speaker detector");return uo.levelChanged(j.id,H),wl=uo.loudest.map(J=>J.id),Sg&&!pe(wl).call(wl,Sg)&&wl.length>=F2&&wl.pop(),{selected:pe(wl).call(wl,j.id)||j.id===Sg,speaker:j}}(h,w),x=function(K,H,j){const J=ho.get(K)||new Pee(K,H);return J.score=j,ho.set(K,J),function(re){if(Tg.set(re,!0),!Rg)return void(Rg=Date.now());const se=Date.now();se-Rg>1e3&&(Tg.get(re)?Tg.set(re,!1):(B2(re),Tg.delete(re)),Rg=se)}(K),J}(y,h.track,P.energyScore);x.addSample(D),x.active&&(f.data=E.frame.buffer,m.enqueue(f))}(e,l,u):t.enableMetadata||t.enablePts?function(h,f,m,g){const E=new DataView(h.data),y=E.getUint8(0);let I;if(128&y&&y!==71){const D=function(P){if(P.byteLength<=0)return[];const x=[];let K=0;for(;K<P.byteLength;){const j=(128&P.getUint8(K))>>7,J=127&P.getUint8(K);if(!(j&&K+4<=P.byteLength)){K++;break}{const re=P.getUint32(K,!1),se=(16776192&re)>>10,le=1023&re;x.push({pt:J,ts_offset:se,length:le,data:new Uint8Array}),K+=4}}let H=P.byteLength-K;for(const j of x){if(j.length>H)return console.warn("Broken red payload"),[];j.length>0&&(j.data=new Uint8Array(P.buffer,P.byteOffset+K,j.length),K+=j.length,H-=j.length)}if(H>0){const j={pt:x.length>0?x[x.length-1].pt:0,ts_offset:0,length:H,data:new Uint8Array(P.buffer,P.byteOffset+K,H)};x.push(j)}return x}(E);if(D.length>0){const P=function(x){let K=0;for(let J=0;J<x.length;J++)K+=J<x.length-1?4:1,K+=x[J].length;const H=new Uint8Array(K);let j=0;for(let J=0;J<x.length;J++)if(J<x.length-1){const re=(2147483648|(127&x[J].pt)<<24|(262143&x[J].ts_offset)<<10|1023&x[J].length)>>>0;H[j++]=re>>24&255,H[j++]=re>>16&255,H[j++]=re>>8&255,H[j++]=255&re}else H[j++]=127&x[J].pt;for(const J of x)H.set(J.data,j),j+=J.length;return H}(D.map(x=>{const K=new Uint8Array(x.length);K.set(x.data);const H=W0(new DataView(K.buffer));return H!=null&&H.frame&&(x.data=H==null?void 0:H.frame),I=H,x}));h.data=P.buffer}}else I=W0(E),I&&(h.data=I.frame.buffer);if(f.enqueue(h),!I)return;const C=I.tlv.find(D=>D.tag===oc.METADATA);C&&m&&C.value instanceof Uint8Array&&m(C.value);const w=I.tlv.find(D=>D.tag===oc.AUDIO_64_BIT_PTS);w&&g&&w.value instanceof Uint8Array&&w.value.length==8&&g(new DataView(w.value.buffer).getBigUint64(0,!0))}(l,u,t.onMetadata,t.onPts):u.enqueue(l)}});o.readable.pipeThrough(c).pipeTo(o.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const o=gg(),c=new MessageChannel;await new ve(u=>o.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"audio-metadata-rx",port:c.port2},[c.port2]);e.transform=l,await new ve(u=>o.onmessage=h=>{h.data==="started"&&u(void 0)}),c.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id?(S.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):u.data.metadata&&n.onMetadata?n.onMetadata(u.data.metadata):u.data.pts&&n.onPts&&n.onPts(u.data.pts)},n.worker=o}function i(){e.track.removeEventListener("ended",i),function(o){const c=Cg.get(o);if(c){(function(h){const f=hu.get(h);f&&(hu.delete(h),uo&&(uo.removeSpeakers([f]),hu.size===0&&(uo.destroy(),uo=null)))})(o),B2(o.track.id),Cg.delete(o);try{var l,u;(l=c.controller)===null||l===void 0||l.terminate(),(u=c.worker)===null||u===void 0||u.terminate()}catch(h){S.warning(h&&h.message)}}}(e)}Cg.set(e,n),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!ft().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(wg.has(e)||!e.track)return;const n={track:e.track};if(_a()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(u){return void S.error("create video-encoded-streams error",u&&u.message)}const c=[];t.on("sei-to-send",u=>{c.push(u)});const l=new TransformStream({transform(u,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const f=H2(new Uint8Array(u.data)),m=c.shift();if(m){const g=function(E,y,I){switch(I){case z0:return function(C,w){const D=G2(w),P=D.length,x=Math.floor(P/255),K=P%255,H=new Uint8Array(6+x+1+P+C.byteLength);H[0]=0,H[1]=0,H[2]=0,H[3]=1,H[4]=6,H[5]=101;let j=0;for(;j<x;)H[6+j]=255,j++;return H[6+j]=K,j++,H.set(D,6+j),H.set(new Uint8Array(C),6+j+P),H.buffer}(E,y);case Y0:return function(C,w){const D=G2(w),P=D.length,x=Math.floor(P/255),K=P%255,H=new Uint8Array(7+x+1+P+1+C.byteLength);H[0]=0,H[1]=0,H[2]=0,H[3]=1,H[4]=78,H[5]=1,H[6]=101;let j=0;for(;j<x;)H[7+j]=255,j++;return H[7+j]=K,j++,H.set(D,7+j),j+=P,H[7+j]=128,j++,H.set(new Uint8Array(C),7+j),H.buffer}(E,y);default:return null}}(u.data,m,f);g&&(u.data=g)}h.enqueue(u)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else{if(!rr())return;{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const o=gg(),c=new MessageChannel;await new ve(u=>o.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"sei-tx",port:c.port2},[c.port2]);e.transform=l,await new ve(u=>o.onmessage=h=>{h.data==="started"&&u(void 0)}),t.on("sei-to-send",u=>{c.port1.postMessage({sei:u})}),c.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=o}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const o=wg.get(e);if(o){wg.delete(e);try{var c,l;(c=o.controller)===null||c===void 0||c.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(u){S.warning(u&&u.message)}}}wg.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ft().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(!e.track)return;if(Cp.has(e)){const o=Cp.get(e);return void(o&&(o.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(_a()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(l){return void S.error("create video-encoded-streams error",l&&l.message)}const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const h=function(f,m){switch(m){case z0:return function(g){const E=new DataView(g.data);let y=0;for(;y+4<g.data.byteLength;){if(E.getUint8(y+0)===0&&E.getUint8(y+1)===0&&E.getUint8(y+2)===0&&E.getUint8(y+3)===1&&E.getUint8(y+4)===6){let I=y+6,C=0,w=0;for(;(w=E.getUint8(I++))===255;)C+=255;C+=w;const D=W2(g.data,I,C);return new Uint8Array(D)}y++}return null}(f);case Y0:return function(g){const E=new DataView(g.data);let y=0;for(;y+5<g.data.byteLength;){if(E.getUint8(y+0)===0&&E.getUint8(y+1)===0&&E.getUint8(y+2)===0&&E.getUint8(y+3)===1&&E.getUint8(y+4)===78&&E.getUint8(y+5)===1&&E.getUint8(y+6)===101){let I=y+7,C=0,w=0;for(;(w=E.getUint8(I++))===255;)C+=255;C+=w;const D=W2(g.data,I,C);return new Uint8Array(D)}y++}return null}(f);default:return null}}(l,H2(new Uint8Array(l.data)));h&&n.onSei&&n.onSei(h),u.enqueue(l)}});o.readable.pipeThrough(c).pipeTo(o.writable)}else if(rr()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const o=gg(),c=new MessageChannel;await new ve(u=>o.onmessage=h=>{h.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"sei-rx",port:c.port2},[c.port2]);e.transform=l,await new ve(u=>o.onmessage=h=>{h.data==="started"&&u(void 0)}),c.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id?(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):u.data.sei&&n.onSei&&n.onSei(u.data.sei)},n.worker=o}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(o){const c=Cp.get(o);if(c){Cp.delete(o);try{var l,u;(l=c.controller)===null||l===void 0||l.terminate(),(u=c.worker)===null||u===void 0||u.terminate()}catch(h){S.warning(h&&h.message)}}})(e)}Cp.set(e,n),e.track.addEventListener("ended",i)}},Qre={name:"InterceptFrame",create:()=>$re};g0(),Ot("PROCESS_ID","process-".concat(Ut(8,""),"-").concat(Ut(4,""),"-").concat(Ut(4,""),"-").concat(Ut(4,""),"-").concat(Ut(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void S.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();S.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(qt,i)){const{value:o,expires:c}=t[i];if(c&&c<=n)return;lo[i]=o,qt[i]=o}})}catch(t){S.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(lo.AREAS)&&lo.AREAS.length>0&&hC(lo.AREAS,!0);const WF=(e,t,n)=>{S.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Ot(e,t,n)};fc(Sre,!1),fc(Cre,!1),fc(rne,!1),fc(Mre,!1),fc(Ere,!1),fc(Yre,!1),fc(Jre,!1),fc(Qre,!1);const Cn=function(e){const t=new nn,n=e,i={getListeners:t.getListeners.bind(t),on:(o,c)=>(function(l,u){l===Ho.SECURITY_POLICY_VIOLATION&&Tj(u,!0)}(o,c),t.on.bind(t)(o,c)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return Sj(Sj({},n),i)}({__TRACK_LIST__:ru,VERSION:Zi,BUILD:y0,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:WF,getParameter:M,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(i){let o;return ft().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),o=(await i.createOffer()).sdp):o=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,o}(t);if(!n)return e;t.close(),t=null,e=function(i){const o={video:[],audio:[]};return i.match(/ VP8/i)&&o.video.push("VP8"),i.match(/ VP9/i)&&o.video.push("VP9"),i.match(/ AV1/i)&&o.video.push("AV1"),i.match(/ H264/i)&&o.video.push("H264"),i.match(/ H265/i)&&o.video.push("H265"),i.match(/ opus/i)&&o.audio.push("OPUS"),i.match(/ PCMU/i)&&o.audio.push("PCMU"),i.match(/ PCMA/i)&&o.audio.push("PCMA"),i.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new Q(k.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=be.reportApiInvoke(null,{name:un.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Jt.TRACER});let t=!1;try{const c=window.RTCPeerConnection,l=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.WebSocket;t=!!(c&&l&&u),t&&n0()&&WL(75)&&new c().close()}catch(c){return S.error("check system requirement failed: ",c),!1}let n=!1;const i=dt();i.name===gt.CHROME&&Number(i.version)>=58&&(oo.engine.name!=="WebKit"||function(){const c=dt();if(eg()){if(c.os===xn.MAC_OS)return!0;if(c.os===xn.IOS){const l=oo.os.version&&oo.os.version.split(".");if(l&&Number(l[0])===14&&l[1]&&Number(l[1])>=3||l&&Number(l[0])>14)return!0}}return!1}())&&(n=!0),(i.name===gt.FIREFOX&&Number(i.version)>=56||i.name===gt.OPERA&&Number(i.version)>=45||i.name===gt.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(Sr()||Ns())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||qL()||dt().name===gt.QQ)&&(n=!0),S.debug("checkSystemRequirements, api:",t,"browser",n);const o=t&&n;return e.onSuccess(o),o},getDevices:function(e){return ji.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return ji.getRecordingDevices(e)},getCameras:function(e){return ji.getCamerasDevices(e)},getElectronScreenSources:WM,getPlaybackDevices:function(e){return ji.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Ut(5,"client-"),i=be.reportApiInvoke(null,{id:n,name:un.CREATE_CLIENT,options:[t],tag:Jt.TRACER});try{(function(o){kn(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),kn(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&kn(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&qn(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&nM(o.turnServer),o.httpRetryConfig!==void 0&&tM(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&tM(o.websocketRetryConfig)})(t)}catch(o){throw i.onError(o),o}return(KL(16,0)||ZR(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",S.debug("browser not support vp9, force use vp8")),Ot("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new ine(js(js({forceWaitGatewayResponse:!0},t),{},{role:pe(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=M("CAMERA_CAPTURE_CONFIG"),n=Ut(8,"track-cam-"),i=be.reportApiInvoke(null,{id:n,tag:Jt.TRACER,name:un.CREATE_CAM_VIDEO_TRACK,options:[Ft({},e),t]});t&&(e.encoderConfig=t);const o=mg(e);let c=null;S.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{c=(await Vi({video:o},n)).getVideoTracks()[0]||null}catch(u){throw i.onError(u),u}if(!c){const u=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(u),u.throw(S)}if(e.optimizationMode&&V0(n,c,e,ks(e.encoderConfig)),M("USE_STANDARD_BITRATE_DEFAULT")){const u=ks(e.encoderConfig);e.encoderConfig=u,delete u.bitrateMax,delete u.bitrateMin}const l=new _g(c,e,o,e.scalabiltyMode?ug(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(l.getTrackId()),S.info("create camera video success, trackId:",n),l},createCustomVideoTrack:function(e){const t=Ut(8,"track-cus-"),n=be.reportApiInvoke(null,{id:t,tag:Jt.TRACER,name:un.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});M("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const i=new Wt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?ug(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[kt.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),S.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(E){return QM(E)}(t):void 0;n&&(t="auto");const i=Ut(8,"track-scr-v-"),o=be.reportApiInvoke(null,{id:i,tag:Jt.TRACER,name:un.CREATE_SCREEN_VIDEO_TRACK,options:[Ft({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const c=function(E){const y={};E.screenSourceType&&(y.mediaSource=E.screenSourceType),E.extensionId&&_a()&&(y.extensionId=E.extensionId);const{displaySurface:I,selfBrowserSurface:C,surfaceSwitching:w,systemAudio:D,preferCurrentTab:P}=E;(qd(107)||$R(107)||e0(93))&&(I&&(kn(I,"displaySurface",["browser","window","monitor"]),y.displaySurface=I),C?(kn(C,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=C):y.selfBrowserSurface="include",w&&(kn(w,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=w)),(qd(105)||$R(105)||e0(91))&&D&&(kn(D,"systemAudio",["exclude","include"]),y.systemAudio=D),(qd(94)||$R(94)||e0(80))&&P&&(y.preferCurrentTab=!0),E.electronScreenSourceId&&(y.sourceId=E.electronScreenSourceId);const x=E.encoderConfig?b0(E.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:x?x.width:void 0,maxHeight:x?x.height:void 0},x&&(x.frameRate&&(typeof x.frameRate=="number"?(y.mandatory.maxFrameRate=x.frameRate,y.mandatory.minFrameRate=x.frameRate):(y.mandatory.maxFrameRate=x.frameRate.max||x.frameRate.ideal||x.frameRate.exact||void 0,y.mandatory.minFrameRate=x.frameRate.min||x.frameRate.ideal||x.frameRate.exact||void 0),y.frameRate=x.frameRate),x.width&&(y.width=x.width),x.height&&(y.height=x.height)),y}(e);let l=null,u=null;const h=ft();if(!h.supportShareAudio&&t==="enable"){const E=new ne(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(E),E.throw(S)}S.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const f=h.supportShareAudio&&t!=="disable";try{const E=await Vi({screen:c,screenAudio:f?n||!0:void 0},i);l=E.getVideoTracks()[0]||null,u=E.getAudioTracks()[0]||null}catch(E){throw o.onError(E),E}if(!l){const E=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(E),E.throw(S)}if(!u&&t==="enable"){l&&l.stop();const E=new ne(k.SHARE_AUDIO_NOT_ALLOWED);return o.onError(E),E.throw(S)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(V0(i,l,e,e.encoderConfig&&b0(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const m=new Wt(l,e.encoderConfig?b0(e.encoderConfig):{},e.scalabiltyMode?ug(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[kt.SCREEN_TRACK]);if(!u)return o.onSuccess(m.getTrackId()),S.info("create screen video track success","video:",m.getTrackId()),m;const g=new dn(u,void 0,Ut(8,"track-scr-a-"),!1);return o.onSuccess([m.getTrackId(),g.getTrackId()]),S.info("create screen video track success","video:",m.getTrackId(),"audio:",g.getTrackId()),[m,g]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=M("CAMERA_CAPTURE_CONFIG"),i=Ut(8,"track-mic-"),o=Ut(8,"track-cam-"),c=be.reportApiInvoke(null,{id:"".concat(i,"-").concat(o),tag:Jt.TRACER,name:un.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const l=mg(t),u=ZM(e);let h=null,f=null;S.info("start create camera video track(".concat(o,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const E=await Vi({audio:u,video:l},"".concat(i,"-").concat(o));h=E.getAudioTracks()[0],f=E.getVideoTracks()[0]}catch(E){throw c.onError(E),E}if(!h||!f){const E=new ne(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return c.onError(E),E.throw(S)}if(t.optimizationMode&&V0(o,f,t,ks(t.encoderConfig)),M("USE_STANDARD_BITRATE_DEFAULT")){const E=ks(t.encoderConfig);t.encoderConfig=E,delete E.bitrateMax,delete E.bitrateMin}const m=new Rp(h,e,u,i),g=new _g(f,t,l,t.scalabiltyMode?ug(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return c.onSuccess([m.getTrackId(),g.getTrackId()]),S.info("create camera video track(".concat(o,") and microphone audio track(").concat(i,") success")),[m,g]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Ut(8,"track-mic-"),n=be.reportApiInvoke(null,{id:t,tag:Jt.TRACER,name:un.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=ZM(e);let o=null;S.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{o=(await Vi({audio:i},t)).getAudioTracks()[0]||null}catch(l){throw n.onError(l),l}if(!o){const l=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(l),l.throw(S)}const c=new Rp(o,e,i,t);return n.onSuccess(c.getTrackId()),S.info("create microphone audio track success, trackId:",t),c},createCustomAudioTrack:function(e){const t=Ut(8,"track-cus-"),n=be.reportApiInvoke(null,{id:t,tag:Jt.TRACER,name:un.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new dn(e.mediaStreamTrack,e.encoderConfig?hg(e.encoderConfig):{},t,!1);return S.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:o}=e;const c={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":o,cacheOnlineFile:n,encoderConfig:i},l=Ut(8,"track-buf-"),u=be.reportApiInvoke(null,{id:l,tag:Jt.TRACER,name:un.CREATE_BUFFER_AUDIO_TRACK,options:[c]});if(M("DISABLE_WEBAUDIO"))throw new ne(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");S.info("start create buffer source audio track with config",JSON.stringify(c),"trackId",l);const h=o;if(!(o instanceof AudioBuffer))try{o=await async function(g,E){let y=null;if(typeof g=="string"){const C=jx.get(g);if(C)return S.debug("use cached audio resource: ",g),C;try{y=(await co(()=>Yr.get(g,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(w){throw new ne(k.FETCH_AUDIO_FILE_FAILED,w.toString())}}else y=await new ve((w,D)=>{const P=new FileReader;P.onload=x=>{x.target?w(x.target.result):D(new ne(k.READ_LOCAL_AUDIO_FILE_ERROR))},P.onerror=()=>{D(new ne(k.READ_LOCAL_AUDIO_FILE_ERROR))},P.readAsArrayBuffer(g)});const I=await function(C){const w=cu();return new ve((D,P)=>{w.decodeAudioData(C,x=>{D(x)},x=>{P(new ne(k.DECODE_AUDIO_FILE_FAILED,x.toString()))})})}(y);return typeof g=="string"&&E&&jx.set(g,I),I}(o,n)}catch(g){return u.onError(g),g.throw(S)}const f=new wee(o),m=new Cee(h,f,i?hg(i):{},l);return S.info("create buffer source audio track success, trackId:",l),u.onSuccess(m.getTrackId()),m},setAppType:function(e){if(S.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw S.debug("Invalid appType"),new Q(k.INVALID_PARAMS,"invalid app type",e);Ot("APP_TYPE",Math.floor(e))},setLogLevel:function(e){S.setLogLevel(e)},enableLogUpload:function(){M("USE_NEW_LOG")?Ot("UPLOAD_LOG",!0):S.enableLogUpload()},disableLogUpload:function(){M("USE_NEW_LOG")?Ot("UPLOAD_LOG",!1):S.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new WU},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=be.reportApiInvoke(null,{tag:Jt.TRACER,name:un.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof dn||e instanceof uu)){const h=new Q(k.INVALID_TRACK,"the parameter is not a audio track");return n.onError(h),h.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof dn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let c=o,l=o;const u=Date.now();return new ve(h=>{const f=setInterval(()=>{const m=e.getVolumeLevel();c=m>c?m:c,l=m<l?m:l;const g=c-l>1e-4,E=Date.now()-u;if(g||E>t){clearInterval(f);const y=g,I={duration:E,deviceLabel:i,maxVolumeLevel:c,result:y};S.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(I))),n.onSuccess(I),h(y)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=be.reportApiInvoke(null,{tag:Jt.TRACER,name:un.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Wt||e instanceof du)){const g=new Q(k.INVALID_TRACK,"the parameter is not a video track");return n.onError(g),g.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof Wt?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0),c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(rr()||eg())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([o]),c.play();const l=document.createElement("canvas");l.width=160,l.height=120;let u=0,h=0;try{const g=Date.now();u=await function(E,y,I,C){let w,D=0,P=null;return new ve((x,K)=>{function H(){D>C&&w&&(w(),x(D));const j=I.getContext("2d");if(!j){const se=new Q(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(se.toString()),void K(se)}j.drawImage(E,0,0,160,120);const J=j.getImageData(0,0,I.width,I.height),re=Math.floor(J.data.length/3);if(P){for(let se=0;se<re;se+=3)if(J.data[se]!==P[se])return D+=1,void(P=J.data);P=J.data}else P=J.data}setTimeout(()=>{w&&(w(),x(D))},y),w=P0(()=>{H()},30)})}(c,t,l,4),h=Date.now()-g}catch(g){throw n.onError(g),g}Hte===gt.SAFARI&&(c.pause(),c.remove()),c.srcObject=null;const f=u>4,m={duration:h,changedPicNum:u,deviceLabel:i,result:f};return S.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),f},setArea:hC,audioElementPlayCenter:qr,resumeAudioContext:function(){qr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){one.processExternalMediaAEC(e)},registerExtensions:function(e){const t=M("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!pe(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=S.extLog,i.reporter.hookApiInvoke=be.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(o=>{i.parameters[o]=M(o)})}),WF("PLUGIN_INFO",t)},ChannelMediaRelayError:fu,ChannelMediaRelayEvent:ya,ChannelMediaRelayState:oi,RemoteStreamFallbackType:gee,RemoteStreamType:_ee,ConnectionDisconnectedReason:Ct,AudienceLatencyLevelType:YZ,AREAS:Tt,preload:async function(e,t,n,i){return hV(e,t,n,i)}});return Object.defineProperties(Cn,{onAudioAutoplayFailed:{get:()=>Fi.onAudioAutoplayFailed,set:e=>{Fi.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Fi.onAutoplayFailed,set:e=>{Fi.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Cn._onSecurityPolicyViolation,set(e){Cn._onSecurityPolicyViolation=e,Tj(e)}},__CLIENT_LIST__:{get:()=>M("SHOW_GLOBAL_CLIENT_LIST")?bl:[]}}),ji.on(Tl.CAMERA_DEVICE_CHANGED,e=>{S.info("camera device changed",JSON.stringify(e)),Cn.onCameraChanged&&Cn.onCameraChanged(e),Cn.safeEmit(Ho.CAMERA_CHANGED,e)}),ji.on(Tl.RECORDING_DEVICE_CHANGED,e=>{S.info("microphone device changed",JSON.stringify(e)),Cn.onMicrophoneChanged&&Cn.onMicrophoneChanged(e),Cn.safeEmit(Ho.MICROPHONE_CHANGED,e)}),ji.on(Tl.PLAYOUT_DEVICE_CHANGED,e=>{S.debug("playout device changed",JSON.stringify(e)),Cn.onPlaybackDeviceChanged&&Cn.onPlaybackDeviceChanged(e),Cn.safeEmit(Ho.PLAYBACK_DEVICE_CHANGED,e)}),qr.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),Fi.onAudioAutoplayFailed&&Fi.onAudioAutoplayFailed()},Nt.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),Fi.onAudioAutoplayFailed&&Fi.onAudioAutoplayFailed(),Cn.safeEmit(Ho.AUTOPLAY_FAILED)}),Nt.on($n.STATE_CHANGE,(e,t)=>{S.info("audio context state changed: ".concat(t," => ").concat(e)),Cn.onAudioContextStateChanged&&Cn.onAudioContextStateChanged(e,t),Cn.safeEmit(Ho.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),gn.on(Jd.NETWORK_STATE_CHANGE,(e,t)=>{S.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Cn),Cn})})(ZW);var Fue=ZW.exports;const $w=_4(Fue);let Bue={data:""},Wue=r=>typeof window=="object"?((r?r.querySelector("#_goober"):window._goober)||Object.assign((r||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:r||Bue,Gue=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Hue=/\/\*[^]*?\*\/|  +/g,q3=/\n+/g,kc=(r,s)=>{let a="",d="",p="";for(let _ in r){let v=r[_];_[0]=="@"?_[1]=="i"?a=_+" "+v+";":d+=_[1]=="f"?kc(v,_):_+"{"+kc(v,_[1]=="k"?"":s)+"}":typeof v=="object"?d+=kc(v,s?s.replace(/([^,])+/g,T=>_.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,b=>/&/.test(b)?b.replace(/&/g,T):T?T+" "+b:b)):_):v!=null&&(_=/^--/.test(_)?_:_.replace(/[A-Z]/g,"-$&").toLowerCase(),p+=kc.p?kc.p(_,v):_+":"+v+";")}return a+(s&&p?s+"{"+p+"}":p)+d},Oa={},nG=r=>{if(typeof r=="object"){let s="";for(let a in r)s+=a+nG(r[a]);return s}return r},Kue=(r,s,a,d,p)=>{let _=nG(r),v=Oa[_]||(Oa[_]=(b=>{let N=0,L=11;for(;N<b.length;)L=101*L+b.charCodeAt(N++)>>>0;return"go"+L})(_));if(!Oa[v]){let b=_!==r?r:(N=>{let L,U,B=[{}];for(;L=Gue.exec(N.replace(Hue,""));)L[4]?B.shift():L[3]?(U=L[3].replace(q3," ").trim(),B.unshift(B[0][U]=B[0][U]||{})):B[0][L[1]]=L[2].replace(q3," ").trim();return B[0]})(r);Oa[v]=kc(p?{["@keyframes "+v]:b}:b,a?"":"."+v)}let T=a&&Oa.g?Oa.g:null;return a&&(Oa.g=Oa[v]),((b,N,L,U)=>{U?N.data=N.data.replace(U,b):N.data.indexOf(b)===-1&&(N.data=L?b+N.data:N.data+b)})(Oa[v],s,d,T),v},zue=(r,s,a)=>r.reduce((d,p,_)=>{let v=s[_];if(v&&v.call){let T=v(a),b=T&&T.props&&T.props.className||/^go/.test(T)&&T;v=b?"."+b:T&&typeof T=="object"?T.props?"":kc(T,""):T===!1?"":T}return d+p+(v??"")},"");function eS(r){let s=this||{},a=r.call?r(s.p):r;return Kue(a.unshift?a.raw?zue(a,[].slice.call(arguments,1),s.p):a.reduce((d,p)=>Object.assign(d,p&&p.call?p(s.p):p),{}):a,Wue(s.target),s.g,s.o,s.k)}let rG,_I,gI;eS.bind({g:1});let Ba=eS.bind({k:1});function Yue(r,s,a,d){kc.p=s,rG=r,_I=a,gI=d}function nl(r,s){let a=this||{};return function(){let d=arguments;function p(_,v){let T=Object.assign({},_),b=T.className||p.className;a.p=Object.assign({theme:_I&&_I()},T),a.o=/ *go\d+/.test(b),T.className=eS.apply(a,d)+(b?" "+b:"");let N=r;return r[0]&&(N=T.as||r,delete T.as),gI&&N[0]&&gI(T),rG(N,T)}return p}}var que=r=>typeof r=="function",ny=(r,s)=>que(r)?r(s):r,Xue=(()=>{let r=0;return()=>(++r).toString()})(),iG=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let s=matchMedia("(prefers-reduced-motion: reduce)");r=!s||s.matches}return r}})(),Jue=20,FA="default",sG=(r,s)=>{let{toastLimit:a}=r.settings;switch(s.type){case 0:return{...r,toasts:[s.toast,...r.toasts].slice(0,a)};case 1:return{...r,toasts:r.toasts.map(v=>v.id===s.toast.id?{...v,...s.toast}:v)};case 2:let{toast:d}=s;return sG(r,{type:r.toasts.find(v=>v.id===d.id)?1:0,toast:d});case 3:let{toastId:p}=s;return{...r,toasts:r.toasts.map(v=>v.id===p||p===void 0?{...v,dismissed:!0,visible:!1}:v)};case 4:return s.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(v=>v.id!==s.toastId)};case 5:return{...r,pausedAt:s.time};case 6:let _=s.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(v=>({...v,pauseDuration:v.pauseDuration+_}))}}},gv=[],oG={toasts:[],pausedAt:void 0,settings:{toastLimit:Jue}},oa={},aG=(r,s=FA)=>{oa[s]=sG(oa[s]||oG,r),gv.forEach(([a,d])=>{a===s&&d(oa[s])})},cG=r=>Object.keys(oa).forEach(s=>aG(r,s)),$ue=r=>Object.keys(oa).find(s=>oa[s].toasts.some(a=>a.id===r)),tS=(r=FA)=>s=>{aG(s,r)},Que={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Zue=(r={},s=FA)=>{let[a,d]=ee.useState(oa[s]||oG),p=ee.useRef(oa[s]);ee.useEffect(()=>(p.current!==oa[s]&&d(oa[s]),gv.push([s,d]),()=>{let v=gv.findIndex(([T])=>T===s);v>-1&&gv.splice(v,1)}),[s]);let _=a.toasts.map(v=>{var T,b,N;return{...r,...r[v.type],...v,removeDelay:v.removeDelay||((T=r[v.type])==null?void 0:T.removeDelay)||(r==null?void 0:r.removeDelay),duration:v.duration||((b=r[v.type])==null?void 0:b.duration)||(r==null?void 0:r.duration)||Que[v.type],style:{...r.style,...(N=r[v.type])==null?void 0:N.style,...v.style}}});return{...a,toasts:_}},ehe=(r,s="blank",a)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:s,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...a,id:(a==null?void 0:a.id)||Xue()}),Em=r=>(s,a)=>{let d=ehe(s,r,a);return tS(d.toasterId||$ue(d.id))({type:2,toast:d}),d.id},Mr=(r,s)=>Em("blank")(r,s);Mr.error=Em("error");Mr.success=Em("success");Mr.loading=Em("loading");Mr.custom=Em("custom");Mr.dismiss=(r,s)=>{let a={type:3,toastId:r};s?tS(s)(a):cG(a)};Mr.dismissAll=r=>Mr.dismiss(void 0,r);Mr.remove=(r,s)=>{let a={type:4,toastId:r};s?tS(s)(a):cG(a)};Mr.removeAll=r=>Mr.remove(void 0,r);Mr.promise=(r,s,a)=>{let d=Mr.loading(s.loading,{...a,...a==null?void 0:a.loading});return typeof r=="function"&&(r=r()),r.then(p=>{let _=s.success?ny(s.success,p):void 0;return _?Mr.success(_,{id:d,...a,...a==null?void 0:a.success}):Mr.dismiss(d),p}).catch(p=>{let _=s.error?ny(s.error,p):void 0;_?Mr.error(_,{id:d,...a,...a==null?void 0:a.error}):Mr.dismiss(d)}),r};var the=1e3,nhe=(r,s="default")=>{let{toasts:a,pausedAt:d}=Zue(r,s),p=ee.useRef(new Map).current,_=ee.useCallback((U,B=the)=>{if(p.has(U))return;let Y=setTimeout(()=>{p.delete(U),v({type:4,toastId:U})},B);p.set(U,Y)},[]);ee.useEffect(()=>{if(d)return;let U=Date.now(),B=a.map(Y=>{if(Y.duration===1/0)return;let F=(Y.duration||0)+Y.pauseDuration-(U-Y.createdAt);if(F<0){Y.visible&&Mr.dismiss(Y.id);return}return setTimeout(()=>Mr.dismiss(Y.id,s),F)});return()=>{B.forEach(Y=>Y&&clearTimeout(Y))}},[a,d,s]);let v=ee.useCallback(tS(s),[s]),T=ee.useCallback(()=>{v({type:5,time:Date.now()})},[v]),b=ee.useCallback((U,B)=>{v({type:1,toast:{id:U,height:B}})},[v]),N=ee.useCallback(()=>{d&&v({type:6,time:Date.now()})},[d,v]),L=ee.useCallback((U,B)=>{let{reverseOrder:Y=!1,gutter:F=8,defaultPosition:X}=B||{},te=a.filter(W=>(W.position||X)===(U.position||X)&&W.height),q=te.findIndex(W=>W.id===U.id),z=te.filter((W,Z)=>Z<q&&W.visible).length;return te.filter(W=>W.visible).slice(...Y?[z+1]:[0,z]).reduce((W,Z)=>W+(Z.height||0)+F,0)},[a]);return ee.useEffect(()=>{a.forEach(U=>{if(U.dismissed)_(U.id,U.removeDelay);else{let B=p.get(U.id);B&&(clearTimeout(B),p.delete(U.id))}})},[a,_]),{toasts:a,handlers:{updateHeight:b,startPause:T,endPause:N,calculateOffset:L}}},rhe=Ba`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,ihe=Ba`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,she=Ba`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ohe=nl("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${rhe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${ihe} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${she} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,ahe=Ba`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,che=nl("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${ahe} 1s linear infinite;
`,lhe=Ba`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,dhe=Ba`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,uhe=nl("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${lhe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${dhe} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,hhe=nl("div")`
  position: absolute;
`,phe=nl("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,fhe=Ba`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,mhe=nl("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${fhe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,_he=({toast:r})=>{let{icon:s,type:a,iconTheme:d}=r;return s!==void 0?typeof s=="string"?ee.createElement(mhe,null,s):s:a==="blank"?null:ee.createElement(phe,null,ee.createElement(che,{...d}),a!=="loading"&&ee.createElement(hhe,null,a==="error"?ee.createElement(ohe,{...d}):ee.createElement(uhe,{...d})))},ghe=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Ehe=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,vhe="0%{opacity:0;} 100%{opacity:1;}",yhe="0%{opacity:1;} 100%{opacity:0;}",She=nl("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,The=nl("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Rhe=(r,s)=>{let a=r.includes("top")?1:-1,[d,p]=iG()?[vhe,yhe]:[ghe(a),Ehe(a)];return{animation:s?`${Ba(d)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Ba(p)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Che=ee.memo(({toast:r,position:s,style:a,children:d})=>{let p=r.height?Rhe(r.position||s||"top-center",r.visible):{opacity:0},_=ee.createElement(_he,{toast:r}),v=ee.createElement(The,{...r.ariaProps},ny(r.message,r));return ee.createElement(She,{className:r.className,style:{...p,...a,...r.style}},typeof d=="function"?d({icon:_,message:v}):ee.createElement(ee.Fragment,null,_,v))});Yue(ee.createElement);var whe=({id:r,className:s,style:a,onHeightUpdate:d,children:p})=>{let _=ee.useCallback(v=>{if(v){let T=()=>{let b=v.getBoundingClientRect().height;d(r,b)};T(),new MutationObserver(T).observe(v,{subtree:!0,childList:!0,characterData:!0})}},[r,d]);return ee.createElement("div",{ref:_,className:s,style:a},p)},bhe=(r,s)=>{let a=r.includes("top"),d=a?{top:0}:{bottom:0},p=r.includes("center")?{justifyContent:"center"}:r.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:iG()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${s*(a?1:-1)}px)`,...d,...p}},Ihe=eS`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,YE=16,Ahe=({reverseOrder:r,position:s="top-center",toastOptions:a,gutter:d,children:p,toasterId:_,containerStyle:v,containerClassName:T})=>{let{toasts:b,handlers:N}=nhe(a,_);return ee.createElement("div",{"data-rht-toaster":_||"",style:{position:"fixed",zIndex:9999,top:YE,left:YE,right:YE,bottom:YE,pointerEvents:"none",...v},className:T,onMouseEnter:N.startPause,onMouseLeave:N.endPause},b.map(L=>{let U=L.position||s,B=N.calculateOffset(L,{reverseOrder:r,gutter:d,defaultPosition:s}),Y=bhe(U,B);return ee.createElement(whe,{id:L.id,key:L.id,onHeightUpdate:N.updateHeight,className:L.visible?Ihe:"",style:Y},L.type==="custom"?ny(L.message,L):p?p(L):ee.createElement(Che,{toast:L,position:U}))}))},Zr=Mr,$l,Da;const ra=class ra{constructor(){lw(this,$l,{localVideoTrack:null,localAudioTrack:null,remoteVideoTrack:null,remoteAudioTrack:null,rtcClient:null});if(wc(ra,Da))return wc(ra,Da);wE(ra,Da,this)}static getInstance(){return wc(ra,Da)||wE(ra,Da,new ra),wc(ra,Da)}set(s,a){if(!wc(this,$l).hasOwnProperty(s)){console.error(`Invalid key used for AgoraStore: ${s}`);return}wc(this,$l)[s]=a}get(s){return wc(this,$l)[s]}clearAll(){wE(this,$l,{localVideoTrack:null,localAudioTrack:null,remoteVideoTrack:null,remoteAudioTrack:null,rtcClient:null}),console.log("AgoraStore: All tracks and client references cleared.")}};$l=new WeakMap,Da=new WeakMap,lw(ra,Da,null);let EI=ra;const ia=EI.getInstance(),Ev=nr("agoraCall/initiate",async({participant:r,caller:s,callType:a,channelId:d,activeChat:p},{rejectWithValue:_,getState:v})=>{try{const{auth:T}=v(),b=T.user.id,N=r==null?void 0:r.id,B=(await jW({channelName:d,callerId:b,receiverId:N})).data;if(!B||!B.callerToken||!B.receiverToken)return console.error("Token generation failed or response incomplete.",B),_("Failed to receive valid tokens from server.");const Y={callerId:b,receiverId:N,chatId:p,channelName:d,callType:a,status:"calling",created_at:new Date().toISOString()},F={...Y,participant:r,token:B.callerToken},X={...Y,caller:s,token:B.receiverToken};return Cr.agoraCallRequest(X),F}catch(T){return console.error("Initiate Call Thunk Error:",T),_(T.message||"Failed to initiate call")}}),vv=nr("call/accept",async(r,{rejectWithValue:s})=>{try{return console.log("accept call callId =>",r),{callId:r,acceptedAt:new Date().toISOString()}}catch(a){return s(a.message||"Failed to accept call")}});nr("call/decline",async({rejectWithValue:r})=>{try{Rr.dispatch(dd())}catch(s){return r(s.message||"Failed to decline call")}});nr("call/end",async({rejectWithValue:r})=>{try{Rr.dispatch(dd());return}catch(s){return r(s.message||"Failed to end call")}});const lG=yh({name:"call",initialState:{activeCall:null,isCallModalOpen:!1,callStatus:"idle",callType:null,callDuration:0,callHistory:[],caller:null,participant:null,isMuted:!1,isVideoEnabled:!0,isSpeakerOn:!1,isCameraLoading:!1,cameraError:null,isMinimized:!1,showControls:!0,localStream:null,remoteStream:null,remoteStreamReady:!1,peerConnection:null,isConnected:!1,loading:!1,error:null,localVideoTrackId:null,localAudioTrackId:null,remoteVideoTrackId:null,remoteAudioTrackId:null},reducers:{openCallModal:(r,s)=>{r.isCallModalOpen=!0,r.callType=s.payload.callType,r.participant=s.payload.participant,r.callStatus="calling",r.isMinimized=!1},closeCallModal:r=>{r.isCallModalOpen=!1,r.callStatus="idle",r.activeCall=null,r.callDuration=0,r.isMinimized=!1,r.showControls=!0,r.isMuted=!1,r.isVideoEnabled=!0,r.isSpeakerOn=!1,r.cameraError=null},setCallStatus:(r,s)=>{console.log("action.payload",s.payload),r.callStatus=s.payload,s.payload==="connected"&&(r.callDuration=0)},incrementCallDuration:r=>{r.callStatus==="connected"&&(r.callDuration+=1)},toggleMute:r=>{r.isMuted=!r.isMuted},toggleVideo:r=>{r.isVideoEnabled=!r.isVideoEnabled},toggleSpeaker:r=>{r.isSpeakerOn=!r.isSpeakerOn},setCameraLoading:(r,s)=>{r.isCameraLoading=s.payload},setCameraError:(r,s)=>{r.cameraError=s.payload,r.isCameraLoading=!1},toggleMinimize:r=>{r.isMinimized=!r.isMinimized},setShowControls:(r,s)=>{r.showControls=s.payload},setLocalTracks:(r,s)=>{const{videoTrack:a,audioTrack:d}=s.payload;a?(ia.set("localVideoTrack",a),r.localVideoTrackId=a._ID):(ia.set("localVideoTrack",null),r.localVideoTrackId=null),d?(ia.set("localAudioTrack",d),console.log("audioTrack._ID",d._ID),r.localAudioTrackId=d._ID):(ia.set("localAudioTrack",null),r.localAudioTrackId=null),console.log("Local Track IDs saved in Redux:",{video:r.localVideoTrackId,audio:r.localAudioTrackId})},setRemoteTracks:(r,s)=>{const{videoTrack:a}=s.payload;a?(ia.set("remoteVideoTrack",a),r.remoteVideoTrackId=a._ID):(ia.set("remoteVideoTrack",null),r.remoteVideoTrackId=null)},receiveIncomingCall:(r,s)=>{const a=s.payload;r.activeCall=a,r.isCallModalOpen=!0,r.callStatus="ringing",r.callType=a.callType,r.participant=a.participant??"",r.isMinimized=!1},acceptCall:r=>{r.activeCall&&r.callStatus==="ringing"&&(r.callStatus="connecting",console.log("Call accepted. Status changed to connecting."))},addToCallHistory:(r,s)=>{r.callHistory.unshift(s.payload),r.callHistory.length>50&&(r.callHistory=r.callHistory.slice(0,50))},handleWebRTCOffer:(r,s)=>{r.callStatus="connecting"},handleWebRTCAnswer:(r,s)=>{r.callStatus="connected"},handleICECandidate:(r,s)=>{},clearError:r=>{r.error=null},resetCallState:r=>{r.isCallModalOpen=!1,r.activeCall=null,r.callStatus="idle",r.callDuration=0,r.caller=null,r.participant=null,r.isMuted=!1,r.isVideoEnabled=!0,r.isSpeakerOn=!1,r.cameraError=null,r.isCameraLoading=!1,r.isMinimized=!1,r.showControls=!0,r.error=null,Rr.localVideoTrackId=null,Rr.localAudioTrackId=null}},extraReducers:r=>{r.addCase(Ev.pending,s=>{s.loading=!0,s.error=null}).addCase(Ev.fulfilled,(s,a)=>{s.loading=!1,s.activeCall=a.payload,s.callStatus="calling",s.isCallModalOpen=!0,s.callType=a.payload.callType,s.participant=a.payload.participant}).addCase(Ev.rejected,(s,a)=>{s.loading=!1,s.error=a.payload,s.callStatus="failed"}).addCase(vv.pending,s=>{s.loading=!0,s.callStatus="connecting"}).addCase(vv.fulfilled,(s,a)=>{s.loading=!1,s.callStatus="connected",s.callDuration=0}).addCase(vv.rejected,(s,a)=>{s.loading=!1,s.error=a.payload,s.callStatus="failed"})}}),{setCallStatus:yv,incrementCallDuration:Ohe,toggleMute:Nhe,toggleVideo:Phe,toggleSpeaker:Dhe,toggleMinimize:khe,setShowControls:X3,setLocalTracks:dG,setRemoteTracks:Lhe,setLocalStream:Mhe,receiveIncomingCall:xhe,resetCallState:dd}=lG.actions,Uhe=lG.reducer,Vhe="http://localhost:5000",jhe="cd227da9d01d405c9d34a2cf6452c6e8";let ds=null,Hs=[],_f={};class Fhe{constructor(){this.socket=null,this.localStream=null,this.peerConnection=null,this.remoteStream=null,this.isMuted=!1}async getIceServerConfig(){try{const s=await Lde();return console.log("response comes from Xirsys",s),{iceServers:[s],iceCandidatePoolSize:0}}catch(s){return console.error("Error fetching TURN credentials from Laravel backend:",s),{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"turn:ws.chatbd.live:3478?transport=tcp",username:"testuser",credential:"testpass"}],iceTransportPolicy:"all",iceCandidatePoolSize:0}}}connect(s){this.socket=_v(Vhe,{auth:{userId:s},withCredentials:!0,transports:["websocket"]}),this.socket.on("connect",()=>{this.socket.emit("addUser",s)}),this.socket.on("onlineUsers",a=>{Rr.dispatch(zhe(a))}),this.socket.on("addContact",()=>{console.log("from chat slice receiver end"),Rr.dispatch(Uf())}),this.socket.on("private_message",(a,d)=>{d&&d(),console.log("msg",a),Rr.dispatch(Bhe(a))}),this.socket.on("messageStatus",({messageId:a,status:d})=>{console.log("message Ids, status after delivery",a,d),Rr.dispatch(yI({messageId:a,status:d}))}),this.socket.on("typing",({chatId:a,senderId:d,typing:p})=>{Rr.dispatch(Yhe({chatId:a,senderId:d,typing:p}))}),this.socket.on("incomingCall",a=>{Rr.dispatch(xhe({channelName:a.channelName,callerId:a.callerId,callerName:a.callerName,callType:a.callType,token:a.token,chatId:a.chatId,participant:a.caller,status:"Ringing"}))}),this.socket.on("callDeclinedOrEnd",a=>{Rr.dispatch(yv(status)),setTimeout(async()=>{await this.destroyAndCleanup(),Rr.dispatch(dd())},2e3)}),this.socket.on("callConnected",a=>{console.log("Call established successfully:",a),Rr.dispatch(yv("connected"))}),this.socket.on("callStatusUpdate",a=>{Rr.dispatch(yv(a.status)),a.status==="offline"&&setTimeout(async()=>{await this.destroyAndCleanup(),Rr.dispatch(dd())},2e3)})}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}sendMessage(s,a){var d;(d=this.socket)==null||d.emit("sendMessage",{chatId:s,message:a})}makeAsDelivery({chatId:s,notifySendersDeliveredMessage:a}){var d;console.log("notifySendersDeliveredMessage form socket",a),(d=this.socket)==null||d.emit("makeAsDelivered",{chatId:s,notifySendersDeliveredMessage:a})}markAsSeen(s,a,d){var p;console.log("chatId viewerId notifyReceiverIds",s,a,d),(p=this.socket)==null||p.emit("markAsSeen",{chatId:s,viewerId:a,notifyReceiverIds:d})}startTyping(s,a,d){var p;console.log("socket chatId",s),(p=this.socket)==null||p.emit("startTyping",s,a,d)}stopTyping(s,a,d){var p;(p=this.socket)==null||p.emit("stopTyping",s,a,d)}addContact(s){var a;console.log("from socket",s),(a=this.socket)==null||a.emit("addContact",{partnerId:s})}async initLocalStream(s=!0){try{return this.localStream||(this.localStream=await navigator.mediaDevices.getUserMedia({video:s,audio:!0}),Rr.dispatch(Mhe(this.localStream))),this.localStream}catch(a){console.error("Error accessing media devices",a)}}agoraCallRequest(s){this.socket?this.socket.emit("agoraCallRequest",s,a=>{a&&a.success||a&&a.error&&console.error("Server reported an error during call request:",a.error)}):console.error("Socket not connected. Cannot send call request.")}async startCallAndPublish(s,a,d,p){await this.destroyAndCleanup(),ds=$w.createClient({mode:"rtc",codec:"vp8"}),ds.on("user-published",this.handleUserPublished.bind(this)),ds.on("user-unpublished",this.handleUserUnpublished.bind(this)),ds.on("user-joined",this.handleUserJoined.bind(this)),ds.on("user-left",this.handleUserLeft.bind(this)),Hs.forEach(b=>b.close()),Hs=[];const _=[];if(_.push($w.createMicrophoneAudioTrack()),p==="video")try{const b=await $w.createCameraVideoTrack();_.push(Promise.resolve(b)),console.log("Camera video track created successfully.")}catch(b){console.error("Camera access denied or device in use. Continuing with audio only.",b)}if(Hs=(await Promise.allSettled(_)).filter(b=>b.status==="fulfilled"&&b.value).map(b=>b.value),Hs.length===0)throw await this.destroyAndCleanup(),new Error("Failed to create any local tracks. Check microphone/camera access.");const T=String(a);return await ds.join(jhe,s,d,T),console.log(`Successfully joined channel ${s} with UID ${a}`),await ds.publish(Hs),Hs}async leaveCall(){console.log("Initiating call leave sequence."),await this.destroyAndCleanup(),console.log("Call resources successfully cleaned up.")}async declineOrEndCall(s,a,d){this.socket&&this.socket.emit("callDeclinedOrEnd",{callerId:s,participantName:a,type:d}),await this.destroyAndCleanup()}async endCall(s){this.socket&&this.socket.emit("callEnd",{receiverId:s}),await this.destroyAndCleanup(),console.log("Local call media resources successfully cleaned up.")}answerCall(s,a,d){this.socket.emit("agoraCallAnswer",{callerId:s,receiverId:a,channelName:d})}async toggleAudio(){const s=Hs.find(a=>a.trackMediaType==="audio");if(!s){console.error("Local audio track not found. Cannot toggle mute.");return}try{this.isMuted=!this.isMuted,await s.setEnabled(!this.isMuted)}catch(a){console.error("Error toggling mute status:",a)}}toggleVideo(s){const a=Hs.find(d=>d.hasVideo);return a?(a.setEnabled(!s),!s):!1}async leaveCall(){ds&&(Hs.forEach(s=>s.close()),Hs=[],await ds.leave(),console.log("Successfully left the channel."))}async destroyAndCleanup(){if(ds){console.log("Cleaning up and destroying existing Agora client...");try{await ds.leave()}catch{console.log("Error during client.leave, likely already left or stuck. Proceeding with track cleanup.")}Hs.forEach(s=>s.close()),Hs=[],Object.keys(_f).forEach(s=>delete _f[s]),ds=null}}async handleUserPublished(s,a){console.log("handleUserPublished=>",s,a),await ds.subscribe(s,a),a==="video"&&(console.log(`Remote video published by ${s.uid}.`),Rr.dispatch(Lhe({videoTrack:s.videoTrack}))),a==="audio"&&(s.audioTrack.play(),console.log(`Remote audio published by ${s.uid}.`)),_f[s.uid]=s}handleUserUnpublished(s){delete _f[s.uid]}handleUserJoined(s){console.log("User joined:",s.uid)}handleUserLeft(s){console.log("User left:",s.uid),delete _f[s.uid]}}const Cr=new Fhe,Sv=nr("chat/createGroupChat",async({name:r,participantIds:s,groupImage:a},{rejectWithValue:d})=>{var p;try{const v=await Kde({group_name:r,group_avatar:a||null,all_members:s});return Cr.addContact(s),v.data}catch(_){return d(((p=_.response)==null?void 0:p.data)||"Failed to create group chat")}}),xf=nr("chat/searchUsers",async(r,{rejectWithValue:s})=>{try{return r.trim()?(await Gde(r)).data:[]}catch{return s("Failed to search users")}}),Tv=nr("chat/createChat",async({partnerId:r,type:s="direct"},{rejectWithValue:a})=>{var d;try{const p=await Hde(r);return console.log("from chat slice",r),Cr.addContact([r]),p.data}catch(p){return a(((d=p.response)==null?void 0:d.data)||"Failed to create chat")}}),J3=nr("chat/uploadFile",async({formData:r,tempId:s,chatId:a},{rejectWithValue:d,dispatch:p})=>{var _;try{return(await zde(r,{onUploadProgress:b=>{const N=Math.round(b.loaded*100/b.total);p(Whe({tempId:s,chatId:a,progress:N}))},headers:{"Content-Type":"multipart/form-data"}})).data}catch(v){return d({error:((_=v.response)==null?void 0:_.data)||"File upload failed",chatId:a,tempId:s})}}),Uf=nr("chat/fetchChats",async(r,{rejectWithValue:s})=>{try{return(await jde()).data}catch{return s("Failed to fetch chats")}}),Rv=nr("chat/fetchMessages",async({chatId:r,page:s=1},{rejectWithValue:a})=>{try{const p=(await Fde(r)).data.data||[];return{chatId:r,messages:p,hasMore:!1}}catch{return a("Failed to fetch messages")}}),Vf=nr("chat/sendMessage",async(r,{rejectWithValue:s,getState:a,dispatch:d})=>{var _;const p=r.id;try{const{auth:v}=a(),T=v.user.id,b={id:p,chatId:r.chatId,message:r.message||"",type:r.type,sender:v.user,status:"sending",created_at:new Date().toISOString(),file_path:r.file_path||null,thumbnailUrl:r.thumbnailUrl||r.file_path||null,file_name:r.file_name||null,fileSize:r.fileSize||null,fileOriginalType:r.fileOriginalType||null,reactions:[],reply_to:r.reply_to||null,replyTo:r.replyTo||null};r.file_path||d(ry({...b,currentUserId:T}));const N=await Bde(r);return d(Ghe({tempId:p,chatId:r.chatId,newMessage:N.data})),{tempId:p,message:N.data}}catch(v){return s({error:((_=v.response)==null?void 0:_.data)||"Failed to send message",chatId:r.chatId,tempId:p,fileUrl:r.file_path})}}),Bhe=nr("chat/receiveNewMessage",async(r,{dispatch:s,getState:a})=>{const d=a().auth.user.id;s(ry({...r,currentUserId:d}))}),uG=nr("chat/addReaction",async(r,{rejectWithValue:s,getState:a,dispatch:d})=>{const p=Date.now().toString(),_=r.chatId;try{const{auth:v}=a(),T={id:p,chatId:_,messageId:r.message_id,emoji:r.reaction,user:v.user.name,avatar:v.user.avatar};d(Khe(T));const b=await Wde(r);return{chatId:_,tempId:p,message:b.data}}catch{return s("Failed to add reaction")}}),hG=yh({name:"chat",initialState:{chats:[],activeChat:null,messages:{},users:[],onlineUsers:["2","3","4"],loading:!1,error:null,hasMore:{},userSearchLoading:!1,userSearchResults:[],groupCreationLoading:!1},reducers:{clearUserSearchResults:r=>{r.userSearchResults=[]},setActiveChat:(r,s)=>{r.activeChat=s.payload},updateMessageProgress:(r,s)=>{const{tempId:a,chatId:d,progress:p}=s.payload,_=r.messages[d];if(_){const v=_.findIndex(T=>T.id===a);v!==-1&&(r.messages[d][v].progress=p,p<100?r.messages[d][v].status="uploading":p===100&&(r.messages[d][v].status="sending"))}},addMessageReducer:(r,s)=>{const{chatId:a,sender:d,currentUserId:p,..._}=s.payload;r.messages[a]||(r.messages[a]=[]),r.messages[a].push(_);const v=r.chats.find(T=>T.chatId===a);v&&(v.updated_at=_.created_at,d.id!==p&&(v.unreadCount=(v.unreadCount||0)+1),v.lastMessage={id:_.id,message:_.message??_.file_name,created_at:_.created_at,status:_.status},r.chats.sort((T,b)=>{const N=new Date(T.updated_at).getTime();return new Date(b.updated_at).getTime()-N}))},updateMessageId:(r,s)=>{var v;const{chatId:a,tempId:d,newMessage:p}=s.payload,_=r.messages[a];if(_){const T=_.findIndex(b=>String(b.id)===d);if(T!==-1){_[T]=p,console.log("newMessage",p);const b=r.chats.find(N=>N.chatId===a);b&&String((v=b.lastMessage)==null?void 0:v.id)===d&&(b.lastMessage={id:p.id,message:p.message??p.file_name,created_at:p.created_at,status:p.status})}}},updateMessageStatus:(r,s)=>{var p;const{messageId:a,status:d}=s.payload;for(const _ in r.messages)if(r.messages.hasOwnProperty(_)){const v=r.messages[_],T=v.findIndex(b=>String(b.id)===String(a));if(T!==-1&&v[T].status!=="seen"){v[T].status=d;const b=r.chats.find(N=>String(N.chatId)===String(_));b&&String((p=b.lastMessage)==null?void 0:p.id)===String(a)&&(b.lastMessage.status=d);return}}},resetUnreadCount:(r,s)=>{const{chatId:a}=s.payload,d=r.chats.find(p=>p.chatId===a);d&&(d.unreadCount=0)},addMessageReaction:(r,s)=>{const{chatId:a,messageId:d}=s.payload,p=s.payload,_=r.messages[a]||[],v=_.findIndex(T=>T.id===d);v!==-1&&(_[v]={..._[v],reactions:[..._[v].reactions||[],p]})},removeMessageReaction:(r,s)=>{const{messageId:a,reactionEmoji:d,userId:p}=s.payload;Object.values(r.messages).forEach(_=>{const v=_.find(T=>T.id===a);if(v&&v.reactions){const T=v.reactions.findIndex(b=>b.emoji===d);if(T!==-1){const b=v.reactions[T];b.users=b.users.filter(N=>N!==p),b.count=b.users.length,b.count===0&&v.reactions.splice(T,1)}}})},setOnlineUsers:(r,s)=>{r.onlineUsers=s.payload},addOnlineUser:(r,s)=>{const a=s.payload;r.onlineUsers.includes(a)||r.onlineUsers.push(a)},removeOnlineUser:(r,s)=>{const a=s.payload;r.onlineUsers=r.onlineUsers.filter(d=>d!==a)},clearChatError:r=>{r.error=null},setTyping:(r,s)=>{const{chatId:a,userId:d,typing:p}=s.payload,_=r.chats.find(v=>v.chatId===a);_&&(_.typing||(_.typing=[]),p&&!_.typing.includes(d)?_.typing.push(d):p||(_.typing=_.typing.filter(v=>v!==d)))}},extraReducers:r=>{r.addCase(Uf.pending,s=>{s.loading=!0,s.error=null}).addCase(Uf.fulfilled,(s,a)=>{a.payload.forEach(d=>{d.notifySendersDeliveredMessage.sender_id&&(console.log("notifySendersDeliveredMessage form",d.notifySendersDeliveredMessage),Cr.makeAsDelivery({chatId:d.chatId,notifySendersDeliveredMessage:d.notifySendersDeliveredMessage}))}),s.loading=!1,s.chats=a.payload,s.error=null}).addCase(Uf.rejected,(s,a)=>{s.loading=!1,s.error=a.payload}).addCase(Rv.pending,s=>{s.loading=!0}).addCase(Rv.fulfilled,(s,a)=>{s.loading=!1;const{chatId:d,messages:p,hasMore:_}=a.payload;s.messages[d]=p,s.hasMore[d]=_}).addCase(Rv.rejected,(s,a)=>{s.loading=!1,s.error=a.payload}).addCase(Vf.fulfilled,(s,a)=>{const{message:d}=a.payload,p=d.chatId;s.chats.find(v=>v.chatId===p)&&s.chats.sort((v,T)=>{const b=new Date(v.updated_at).getTime();return new Date(T.updated_at).getTime()-b})}).addCase(Vf.rejected,(s,a)=>{const{chatId:d,tempId:p}=a.payload||a.meta.arg;if(s.messages[d]){const _=s.messages[d].find(v=>v.id===p);_&&(_.status="failed")}}).addCase(uG.fulfilled,(s,a)=>{const{chatId:d,tempId:p,message:_}=a.payload;a.payload;const v=s.messages[d]||[],T=v.findIndex(b=>b.id===_.message_id);T!==-1&&(v[T].reactions[p]=_)}).addCase(xf.pending,s=>{s.userSearchLoading=!0,s.userSearchResults=[]}).addCase(xf.fulfilled,(s,a)=>{s.userSearchLoading=!1,s.userSearchResults=a.payload}).addCase(xf.rejected,(s,a)=>{s.userSearchLoading=!1,s.error=a.payload,s.userSearchResults=[]}).addCase(Tv.pending,s=>{s.loading=!0,s.error=null}).addCase(Tv.fulfilled,(s,a)=>{s.loading=!1,s.chats=a.payload,s.error=null}).addCase(Tv.rejected,(s,a)=>{s.loading=!1,s.error=a.payload}).addCase(Sv.pending,s=>{s.loading=!0,s.error=null}).addCase(Sv.fulfilled,(s,a)=>{s.loading=!1,s.chats=a.payload,s.error=null}).addCase(Sv.rejected,(s,a)=>{s.loading=!1,s.error=a.payload})}}),{setActiveChat:vI,updateMessageProgress:Whe,addMessageReducer:ry,updateMessageId:Ghe,updateMessageStatus:yI,resetUnreadCount:Hhe,addMessageReaction:Khe,setOnlineUsers:zhe,setTyping:Yhe,clearUserSearchResults:qhe}=hG.actions,Xhe=hG.reducer,Jhe=yh({name:"socket",initialState:{connection:null,connected:!1,error:null},reducers:{setSocket:(r,s)=>{r.connection=s.payload,r.connected=!0,r.error=null},clearSocket:r=>{r.connection&&r.connection.disconnect(),r.connection=null,r.connected=!1,r.error=null},setSocketError:(r,s)=>{r.error=s.payload,r.connected=!1}}}),$he=Jhe.reducer,pG=yh({name:"ui",initialState:{sidebarOpen:!0,activeModal:null,theme:"dark",notifications:[]},reducers:{toggleSidebar:r=>{r.sidebarOpen=!r.sidebarOpen},setSidebarOpen:(r,s)=>{r.sidebarOpen=s.payload},setActiveModal:(r,s)=>{r.activeModal=s.payload},closeModal:r=>{r.activeModal=null},setTheme:(r,s)=>{r.theme=s.payload},addNotification:(r,s)=>{r.notifications.push({id:Date.now(),...s.payload})},removeNotification:(r,s)=>{r.notifications=r.notifications.filter(a=>a.id!==s.payload)},clearNotifications:r=>{r.notifications=[]}}}),{setSidebarOpen:jf}=pG.actions,Qhe=pG.reducer,Qw=nr("agoraCall/initiate",async({participantId:r,callType:s,channelId:a},{rejectWithValue:d,getState:p})=>{try{const{auth:_}=p(),v=_.user.id,b=await jW({channelName:a,uid:v}),N={id:a,callerId:v,participantId:r,callType:s,token:b,status:"calling",createdAt:new Date().toISOString()};return agoraService.sendCallInvitation({calleeId:r,channelId:a,token:b,callType:s}),N}catch(_){return d(_.message||"Failed to initiate call")}}),Zw=nr("call/accept",async(r,{rejectWithValue:s})=>{try{return{callId:r,acceptedAt:new Date().toISOString()}}catch(a){return s(a.message||"Failed to accept call")}}),Zhe=nr("call/decline",async(r,{rejectWithValue:s})=>{try{return{callId:r,declinedAt:new Date().toISOString()}}catch(a){return s(a.message||"Failed to decline call")}}),epe=nr("call/end",async(r,{rejectWithValue:s})=>{try{return{callId:r,endedAt:new Date().toISOString()}}catch(a){return s(a.message||"Failed to end call")}}),tpe=yh({name:"agoraCall",initialState:{activeCall:null,callHistory:[],isCallModalOpen:!1,callStatus:"idle",callType:null,callDuration:0,caller:null,participant:null,isMuted:!1,isVideoEnabled:!0,isSpeakerOn:!1,isCameraLoading:!1,cameraError:null,isMinimized:!1,showControls:!0,localStream:null,remoteStream:null,remoteStreamReady:!1,peerConnection:null,isConnected:!1,loading:!1,error:null},reducers:{openCallModal:(r,s)=>{r.isCallModalOpen=!0,r.callType=s.payload.callType,r.participant=s.payload.participant,r.callStatus="calling",r.isMinimized=!1},closeCallModal:r=>{r.isCallModalOpen=!1,r.callStatus="idle",r.activeCall=null,r.callDuration=0,r.isMinimized=!1,r.showControls=!0,r.isMuted=!1,r.isVideoEnabled=!0,r.isSpeakerOn=!1,r.cameraError=null},setCallStatus:(r,s)=>{console.log("action.payload",s.payload),r.callStatus=s.payload,s.payload==="connected"&&(r.callDuration=0)},incrementCallDuration:r=>{r.callStatus==="connected"&&(r.callDuration+=1)},toggleMute:r=>{r.isMuted=!r.isMuted},toggleVideo:r=>{r.isVideoEnabled=!r.isVideoEnabled},toggleSpeaker:r=>{r.isSpeakerOn=!r.isSpeakerOn},setCameraLoading:(r,s)=>{r.isCameraLoading=s.payload},setCameraError:(r,s)=>{r.cameraError=s.payload,r.isCameraLoading=!1},toggleMinimize:r=>{r.isMinimized=!r.isMinimized},setShowControls:(r,s)=>{r.showControls=s.payload},setLocalStream:(r,s)=>{console.log("local stream test form redux => ",s.payload),r.localStream=s.payload},setRemoteStream:(r,s)=>{r.remoteStream=s.payload},setRemoteStreamReady:(r,s)=>{r.remoteStreamReady=s.payload},setPeerConnection:(r,s)=>{r.peerConnection=s.payload},setSocketConnected:(r,s)=>{r.isConnected=s.payload},receiveIncomingCall:(r,s)=>{const a=s.payload;r.activeCall=a,r.isCallModalOpen=!0,r.callStatus="Ringing",r.callType=a.callType,r.caller=a.caller??"Dai Nai",r.isMinimized=!1},addToCallHistory:(r,s)=>{r.callHistory.unshift(s.payload),r.callHistory.length>50&&(r.callHistory=r.callHistory.slice(0,50))},clearError:r=>{r.error=null},resetCallState:r=>{r.isCallModalOpen=!1,r.activeCall=null,r.callStatus="idle",r.callDuration=0,r.caller=null,r.participant=null,r.isMuted=!1,r.isVideoEnabled=!0,r.isSpeakerOn=!1,r.cameraError=null,r.isCameraLoading=!1,r.isMinimized=!1,r.showControls=!0,r.error=null}},extraReducers:r=>{r.addCase(Qw.pending,s=>{s.loading=!0,s.error=null}).addCase(Qw.fulfilled,(s,a)=>{s.loading=!1,s.activeCall=a.payload,s.callStatus="calling",s.isCallModalOpen=!0,s.callType=a.payload.callType}).addCase(Qw.rejected,(s,a)=>{s.loading=!1,s.error=a.payload,s.callStatus="failed"}).addCase(Zw.pending,s=>{s.loading=!0,s.callStatus="connecting"}).addCase(Zw.fulfilled,(s,a)=>{s.loading=!1,s.callStatus="connected",s.callDuration=0}).addCase(Zw.rejected,(s,a)=>{s.loading=!1,s.error=a.payload,s.callStatus="failed"}).addCase(Zhe.fulfilled,(s,a)=>{s.callStatus="ended",s.isCallModalOpen=!1,s.activeCall=null}).addCase(epe.fulfilled,(s,a)=>{s.activeCall=null,s.callStatus="ended",s.isCallModalOpen=!1,s.callDuration=0,s.isMinimized=!1,s.showControls=!0,s.isMuted=!1,s.isVideoEnabled=!0,s.isSpeakerOn=!1,s.cameraError=null,s.isCameraLoading=!1})}}),npe=tpe.reducer,Rr=Wce({reducer:{auth:Vde,chat:Xhe,call:Uhe,agoraCall:npe,socket:$he,ui:Qhe},middleware:r=>r({serializableCheck:{ignoredActions:["socket/setSocket","call/setLocalTracks","call/setRemoteTracks"],ignoredPaths:["socket.connection"]}})});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var rpe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ipe=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),_t=(r,s)=>{const a=ee.forwardRef(({color:d="currentColor",size:p=24,strokeWidth:_=2,absoluteStrokeWidth:v,className:T="",children:b,...N},L)=>ee.createElement("svg",{ref:L,...rpe,width:p,height:p,stroke:d,strokeWidth:v?Number(_)*24/Number(p):_,className:["lucide",`lucide-${ipe(r)}`,T].join(" "),...N},[...s.map(([U,B])=>ee.createElement(U,B)),...Array.isArray(b)?b:[b]]));return a.displayName=`${r}`,a};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const spe=_t("Angry",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["path",{d:"M7.5 8 10 9",key:"olxxln"}],["path",{d:"m14 9 2.5-1",key:"1j6cij"}],["path",{d:"M9 10h0",key:"1vxvly"}],["path",{d:"M15 10h0",key:"1j6oav"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ope=_t("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $3=_t("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ape=_t("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cpe=_t("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lpe=_t("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dpe=_t("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const upe=_t("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fG=_t("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hpe=_t("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ppe=_t("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uu=_t("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q3=_t("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z3=_t("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fpe=_t("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mpe=_t("Laugh",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M18 13a6 6 0 0 1-6 5 6 6 0 0 1-6-5h12Z",key:"b2q4dd"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SI=_t("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _pe=_t("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mG=_t("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gpe=_t("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e4=_t("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cv=_t("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Epe=_t("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BA=_t("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t4=_t("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n4=_t("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vpe=_t("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _G=_t("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r4=_t("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iy=_t("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eb=_t("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sy=_t("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qc=_t("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i4=_t("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ype=_t("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Spe=_t("Salad",[["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 21a9 9 0 0 0 9-9H3a9 9 0 0 0 9 9Z",key:"4rw317"}],["path",{d:"M11.38 12a2.4 2.4 0 0 1-.4-4.77 2.4 2.4 0 0 1 3.2-2.77 2.4 2.4 0 0 1 3.47-.63 2.4 2.4 0 0 1 3.37 3.37 2.4 2.4 0 0 1-1.1 3.7 2.51 2.51 0 0 1 .03 1.1",key:"10xrj0"}],["path",{d:"m13 12 4-4",key:"1hckqy"}],["path",{d:"M10.9 7.25A3.99 3.99 0 0 0 4 10c0 .73.2 1.41.54 2",key:"1p4srx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WA=_t("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gG=_t("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tpe=_t("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rpe=_t("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cpe=_t("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wpe=_t("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bpe=_t("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s4=_t("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ipe=_t("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tb=_t("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oy=_t("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EG=_t("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vG=_t("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=_t("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ape=_t("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ope=_t("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Npe=({onStepChange:r})=>{const s=No(),{loading:a,error:d}=xr(L=>L.auth),[p,_]=ee.useState({email:"",password:""}),[v,T]=ee.useState(!1),b=L=>{_({...p,[L.target.name]:L.target.value}),d&&s(VW())},N=async L=>{var U;L.preventDefault();try{const B=await s(lv(p)).unwrap();if(B.needsVerification){Zr.error(B.message||"Please verify your email first"),r("verify",p.email);return}Zr.success("Login successful!")}catch(B){const Y=((U=B==null?void 0:B.response)==null?void 0:U.data)||B;if(Y!=null&&Y.needsVerification){Zr.error(Y.message||"Please verify your email first"),r("verify",p.email);return}Zr.error((Y==null?void 0:Y.message)||"Login failed")}};return A.jsxs("form",{onSubmit:N,className:"space-y-4",children:[A.jsxs("div",{className:"relative",children:[A.jsx(mG,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),A.jsx("input",{type:"email",name:"email",placeholder:"Email",value:p.email,onChange:b,className:"w-full pl-10 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none",required:!0})]}),A.jsxs("div",{className:"relative",children:[A.jsx(SI,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),A.jsx("input",{type:v?"text":"password",name:"password",placeholder:"Password",value:p.password,onChange:b,className:"w-full pl-10 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none",required:!0}),A.jsx("button",{type:"button",onClick:()=>T(!v),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:v?A.jsx(hpe,{}):A.jsx(ppe,{})})]}),A.jsx("button",{type:"submit",disabled:a,className:"w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg",children:a?"Signing In...":"Sign In"})]})},Ppe=({onStepChange:r})=>{const s=No(),{loading:a,error:d}=xr(b=>b.auth),[p,_]=ee.useState({name:"",email:"",phone:"",password:"",confirmPassword:""}),v=b=>{_({...p,[b.target.name]:b.target.value}),d&&s(VW())},T=async b=>{var L;if(b.preventDefault(),p.password!==p.confirmPassword)return Zr.error("Passwords do not match");const N={name:p.name,email:p.email,phone:p.phone,password:p.password,password_confirmation:p.confirmPassword};try{await s(dv(N)).unwrap(),Zr.success("Registration successful! Check your email for OTP."),r("verify",p.email)}catch(U){const B=((L=U==null?void 0:U.response)==null?void 0:L.data)||U;Zr.error((B==null?void 0:B.message)||"Registration failed")}};return A.jsxs("form",{onSubmit:T,className:"space-y-4",children:[A.jsxs("div",{className:"relative",children:[A.jsx(Ipe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),A.jsx("input",{type:"text",name:"name",placeholder:"Full Name",value:p.name,onChange:v,className:"w-full pl-10 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none",required:!0})]}),A.jsxs("div",{className:"relative",children:[A.jsx(mG,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),A.jsx("input",{type:"email",name:"email",placeholder:"Email",value:p.email,onChange:v,className:"w-full pl-10 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none",required:!0})]}),A.jsxs("div",{className:"relative",children:[A.jsx(sy,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),A.jsx("input",{type:"tel",name:"phone",placeholder:"Phone",value:p.phone,onChange:v,className:"w-full pl-10 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none"})]}),A.jsxs("div",{className:"relative",children:[A.jsx(SI,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),A.jsx("input",{type:"password",name:"password",placeholder:"Password",value:p.password,onChange:v,className:"w-full pl-10 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none",required:!0})]}),A.jsxs("div",{className:"relative",children:[A.jsx(SI,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),A.jsx("input",{type:"password",name:"confirmPassword",placeholder:"Confirm Password",value:p.confirmPassword,onChange:v,className:"w-full pl-10 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none",required:!0})]}),A.jsx("button",{type:"submit",disabled:a,className:"w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg",children:a?"Processing...":"Sign Up"})]})},Dpe=({email:r,onVerified:s})=>{const a=No(),{loading:d}=xr(Y=>Y.auth),[p,_]=ee.useState(new Array(6).fill("")),[v,T]=ee.useState(15),b=ee.useRef([]);ee.useEffect(()=>{let Y;return v>0&&(Y=setInterval(()=>T(F=>F-1),1e3)),()=>clearInterval(Y)},[v]);const N=(Y,F)=>{const X=Y.value.slice(-1);if(isNaN(X))return!1;let te=[...p];te[F]=X,_(te),X!==""&&F<5&&b.current[F+1].focus()},L=(Y,F)=>{Y.key==="Backspace"&&p[F]===""&&F>0&&b.current[F-1].focus()},U=async()=>{if(!(v>0))try{await a(Mde({email:r})).unwrap(),Zr.success("New OTP sent to your email"),T(15)}catch(Y){Zr.error((Y==null?void 0:Y.message)||"Failed to resend OTP")}},B=async Y=>{var X;Y.preventDefault();const F=p.join("");if(F.length<6)return Zr.error("Please enter 6 digit OTP");try{await a(uv({email:r,otp:F})).unwrap(),Zr.success("Email verified successfully!"),s()}catch(te){const q=((X=te==null?void 0:te.response)==null?void 0:X.data)||te;Zr.error((q==null?void 0:q.message)||"Invalid OTP")}};return A.jsxs("form",{onSubmit:B,className:"space-y-6",children:[A.jsx("div",{className:"flex justify-center gap-2",children:p.map((Y,F)=>A.jsx("input",{type:"text",ref:X=>b.current[F]=X,maxLength:1,value:Y,onChange:X=>N(X.target,F),onKeyDown:X=>L(X,F),className:"w-10 h-12 border-2 rounded-lg text-center text-xl font-bold focus:border-green-500 outline-none",required:!0},F))}),A.jsx("button",{type:"submit",disabled:d,className:"w-full bg-green-600 text-white py-3 rounded-lg font-semibold disabled:opacity-50",children:d?"Verifying...":"Verify & Continue"}),A.jsx("div",{className:"text-center",children:A.jsxs("p",{className:"text-sm text-gray-500",children:["Didn't receive a code?"," ",A.jsx("button",{type:"button",onClick:U,disabled:v>0,className:`font-semibold ${v>0?"text-gray-400 cursor-not-allowed":"text-green-600 hover:underline"}`,children:v>0?`Resend in ${v}s`:"Resend OTP"})]})})]})},kpe="/assets/logo-Doblp4nn.png",Lpe=()=>{const[r,s]=ee.useState("login"),[a,d]=ee.useState(""),p=(v,T="")=>{s(v),T&&d(T)},_=()=>{s("login"),d("")};return A.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-green-400 via-green-500 to-green-600",children:A.jsxs("div",{className:"bg-white p-8 max-w-md w-full rounded-2xl shadow-2xl",children:[A.jsxs("div",{className:"text-center mb-8",children:[A.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:"#00ff00"},children:A.jsx("img",{src:`${kpe}`,alt:"Bidhan Sutradahr",className:"rounded-full object-cover"})}),A.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:r==="verify"?"Verify OTP":r==="login"?"Sign In":"Create Account"}),A.jsx("p",{className:"text-gray-600 mt-1",children:r==="verify"?`Enter the code sent to ${a}`:r==="login"?"Sign in to continue":"Join the conversation"})]}),r==="login"&&A.jsx(Npe,{onStepChange:p}),r==="register"&&A.jsx(Ppe,{onStepChange:p}),r==="verify"&&A.jsx(Dpe,{email:a,onVerified:_}),r!=="verify"&&A.jsx("div",{className:"mt-4 text-center",children:r==="login"?A.jsxs("p",{children:["Don't have an account? ",A.jsx("button",{onClick:()=>s("register"),className:"text-green-600 font-semibold",children:"Sign Up"})]}):A.jsxs("p",{children:["Already have an account? ",A.jsx("button",{onClick:()=>s("login"),className:"text-green-600 font-semibold",children:"Sign In"})]})})]})})};function Wa(r){if(r===null||r===!0||r===!1)return NaN;var s=Number(r);return isNaN(s)?s:s<0?Math.ceil(s):Math.floor(s)}function pn(r,s){if(s.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+s.length+" present")}function bn(r){pn(1,arguments);var s=Object.prototype.toString.call(r);return r instanceof Date||cd(r)==="object"&&s==="[object Date]"?new Date(r.getTime()):typeof r=="number"||s==="[object Number]"?new Date(r):((typeof r=="string"||s==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Mpe(r,s){pn(2,arguments);var a=bn(r),d=Wa(s);return isNaN(d)?new Date(NaN):(d&&a.setDate(a.getDate()+d),a)}function xpe(r,s){pn(2,arguments);var a=bn(r).getTime(),d=Wa(s);return new Date(a+d)}var Upe={};function vm(){return Upe}function TI(r){var s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return s.setUTCFullYear(r.getFullYear()),r.getTime()-s.getTime()}function o4(r){pn(1,arguments);var s=bn(r);return s.setHours(0,0,0,0),s}function wv(r,s){pn(2,arguments);var a=bn(r),d=bn(s),p=a.getTime()-d.getTime();return p<0?-1:p>0?1:p}function yG(r,s){pn(2,arguments);var a=o4(r),d=o4(s);return a.getTime()===d.getTime()}function Vpe(r){return pn(1,arguments),r instanceof Date||cd(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function jpe(r){if(pn(1,arguments),!Vpe(r)&&typeof r!="number")return!1;var s=bn(r);return!isNaN(Number(s))}function Fpe(r,s){pn(2,arguments);var a=bn(r),d=bn(s),p=a.getFullYear()-d.getFullYear(),_=a.getMonth()-d.getMonth();return p*12+_}function Bpe(r,s){return pn(2,arguments),bn(r).getTime()-bn(s).getTime()}var Wpe={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(s){return s<0?Math.ceil(s):Math.floor(s)}},Gpe="trunc";function Hpe(r){return Wpe[Gpe]}function Kpe(r){pn(1,arguments);var s=bn(r);return s.setHours(23,59,59,999),s}function zpe(r){pn(1,arguments);var s=bn(r),a=s.getMonth();return s.setFullYear(s.getFullYear(),a+1,0),s.setHours(23,59,59,999),s}function Ype(r){pn(1,arguments);var s=bn(r);return Kpe(s).getTime()===zpe(s).getTime()}function qpe(r,s){pn(2,arguments);var a=bn(r),d=bn(s),p=wv(a,d),_=Math.abs(Fpe(a,d)),v;if(_<1)v=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-p*_);var T=wv(a,d)===-p;Ype(bn(r))&&_===1&&wv(r,d)===1&&(T=!1),v=p*(_-Number(T))}return v===0?0:v}function Xpe(r,s,a){pn(2,arguments);var d=Bpe(r,s)/1e3;return Hpe()(d)}function Jpe(r,s){pn(2,arguments);var a=Wa(s);return xpe(r,-a)}var $pe=864e5;function Qpe(r){pn(1,arguments);var s=bn(r),a=s.getTime();s.setUTCMonth(0,1),s.setUTCHours(0,0,0,0);var d=s.getTime(),p=a-d;return Math.floor(p/$pe)+1}function ay(r){pn(1,arguments);var s=1,a=bn(r),d=a.getUTCDay(),p=(d<s?7:0)+d-s;return a.setUTCDate(a.getUTCDate()-p),a.setUTCHours(0,0,0,0),a}function SG(r){pn(1,arguments);var s=bn(r),a=s.getUTCFullYear(),d=new Date(0);d.setUTCFullYear(a+1,0,4),d.setUTCHours(0,0,0,0);var p=ay(d),_=new Date(0);_.setUTCFullYear(a,0,4),_.setUTCHours(0,0,0,0);var v=ay(_);return s.getTime()>=p.getTime()?a+1:s.getTime()>=v.getTime()?a:a-1}function Zpe(r){pn(1,arguments);var s=SG(r),a=new Date(0);a.setUTCFullYear(s,0,4),a.setUTCHours(0,0,0,0);var d=ay(a);return d}var efe=6048e5;function tfe(r){pn(1,arguments);var s=bn(r),a=ay(s).getTime()-Zpe(s).getTime();return Math.round(a/efe)+1}function cy(r,s){var a,d,p,_,v,T,b,N;pn(1,arguments);var L=vm(),U=Wa((a=(d=(p=(_=s==null?void 0:s.weekStartsOn)!==null&&_!==void 0?_:s==null||(v=s.locale)===null||v===void 0||(T=v.options)===null||T===void 0?void 0:T.weekStartsOn)!==null&&p!==void 0?p:L.weekStartsOn)!==null&&d!==void 0?d:(b=L.locale)===null||b===void 0||(N=b.options)===null||N===void 0?void 0:N.weekStartsOn)!==null&&a!==void 0?a:0);if(!(U>=0&&U<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var B=bn(r),Y=B.getUTCDay(),F=(Y<U?7:0)+Y-U;return B.setUTCDate(B.getUTCDate()-F),B.setUTCHours(0,0,0,0),B}function TG(r,s){var a,d,p,_,v,T,b,N;pn(1,arguments);var L=bn(r),U=L.getUTCFullYear(),B=vm(),Y=Wa((a=(d=(p=(_=s==null?void 0:s.firstWeekContainsDate)!==null&&_!==void 0?_:s==null||(v=s.locale)===null||v===void 0||(T=v.options)===null||T===void 0?void 0:T.firstWeekContainsDate)!==null&&p!==void 0?p:B.firstWeekContainsDate)!==null&&d!==void 0?d:(b=B.locale)===null||b===void 0||(N=b.options)===null||N===void 0?void 0:N.firstWeekContainsDate)!==null&&a!==void 0?a:1);if(!(Y>=1&&Y<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var F=new Date(0);F.setUTCFullYear(U+1,0,Y),F.setUTCHours(0,0,0,0);var X=cy(F,s),te=new Date(0);te.setUTCFullYear(U,0,Y),te.setUTCHours(0,0,0,0);var q=cy(te,s);return L.getTime()>=X.getTime()?U+1:L.getTime()>=q.getTime()?U:U-1}function nfe(r,s){var a,d,p,_,v,T,b,N;pn(1,arguments);var L=vm(),U=Wa((a=(d=(p=(_=s==null?void 0:s.firstWeekContainsDate)!==null&&_!==void 0?_:s==null||(v=s.locale)===null||v===void 0||(T=v.options)===null||T===void 0?void 0:T.firstWeekContainsDate)!==null&&p!==void 0?p:L.firstWeekContainsDate)!==null&&d!==void 0?d:(b=L.locale)===null||b===void 0||(N=b.options)===null||N===void 0?void 0:N.firstWeekContainsDate)!==null&&a!==void 0?a:1),B=TG(r,s),Y=new Date(0);Y.setUTCFullYear(B,0,U),Y.setUTCHours(0,0,0,0);var F=cy(Y,s);return F}var rfe=6048e5;function ife(r,s){pn(1,arguments);var a=bn(r),d=cy(a,s).getTime()-nfe(a,s).getTime();return Math.round(d/rfe)+1}function yn(r,s){for(var a=r<0?"-":"",d=Math.abs(r).toString();d.length<s;)d="0"+d;return a+d}var Ic={y:function(s,a){var d=s.getUTCFullYear(),p=d>0?d:1-d;return yn(a==="yy"?p%100:p,a.length)},M:function(s,a){var d=s.getUTCMonth();return a==="M"?String(d+1):yn(d+1,2)},d:function(s,a){return yn(s.getUTCDate(),a.length)},a:function(s,a){var d=s.getUTCHours()/12>=1?"pm":"am";switch(a){case"a":case"aa":return d.toUpperCase();case"aaa":return d;case"aaaaa":return d[0];case"aaaa":default:return d==="am"?"a.m.":"p.m."}},h:function(s,a){return yn(s.getUTCHours()%12||12,a.length)},H:function(s,a){return yn(s.getUTCHours(),a.length)},m:function(s,a){return yn(s.getUTCMinutes(),a.length)},s:function(s,a){return yn(s.getUTCSeconds(),a.length)},S:function(s,a){var d=a.length,p=s.getUTCMilliseconds(),_=Math.floor(p*Math.pow(10,d-3));return yn(_,a.length)}},Mu={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},sfe={G:function(s,a,d){var p=s.getUTCFullYear()>0?1:0;switch(a){case"G":case"GG":case"GGG":return d.era(p,{width:"abbreviated"});case"GGGGG":return d.era(p,{width:"narrow"});case"GGGG":default:return d.era(p,{width:"wide"})}},y:function(s,a,d){if(a==="yo"){var p=s.getUTCFullYear(),_=p>0?p:1-p;return d.ordinalNumber(_,{unit:"year"})}return Ic.y(s,a)},Y:function(s,a,d,p){var _=TG(s,p),v=_>0?_:1-_;if(a==="YY"){var T=v%100;return yn(T,2)}return a==="Yo"?d.ordinalNumber(v,{unit:"year"}):yn(v,a.length)},R:function(s,a){var d=SG(s);return yn(d,a.length)},u:function(s,a){var d=s.getUTCFullYear();return yn(d,a.length)},Q:function(s,a,d){var p=Math.ceil((s.getUTCMonth()+1)/3);switch(a){case"Q":return String(p);case"QQ":return yn(p,2);case"Qo":return d.ordinalNumber(p,{unit:"quarter"});case"QQQ":return d.quarter(p,{width:"abbreviated",context:"formatting"});case"QQQQQ":return d.quarter(p,{width:"narrow",context:"formatting"});case"QQQQ":default:return d.quarter(p,{width:"wide",context:"formatting"})}},q:function(s,a,d){var p=Math.ceil((s.getUTCMonth()+1)/3);switch(a){case"q":return String(p);case"qq":return yn(p,2);case"qo":return d.ordinalNumber(p,{unit:"quarter"});case"qqq":return d.quarter(p,{width:"abbreviated",context:"standalone"});case"qqqqq":return d.quarter(p,{width:"narrow",context:"standalone"});case"qqqq":default:return d.quarter(p,{width:"wide",context:"standalone"})}},M:function(s,a,d){var p=s.getUTCMonth();switch(a){case"M":case"MM":return Ic.M(s,a);case"Mo":return d.ordinalNumber(p+1,{unit:"month"});case"MMM":return d.month(p,{width:"abbreviated",context:"formatting"});case"MMMMM":return d.month(p,{width:"narrow",context:"formatting"});case"MMMM":default:return d.month(p,{width:"wide",context:"formatting"})}},L:function(s,a,d){var p=s.getUTCMonth();switch(a){case"L":return String(p+1);case"LL":return yn(p+1,2);case"Lo":return d.ordinalNumber(p+1,{unit:"month"});case"LLL":return d.month(p,{width:"abbreviated",context:"standalone"});case"LLLLL":return d.month(p,{width:"narrow",context:"standalone"});case"LLLL":default:return d.month(p,{width:"wide",context:"standalone"})}},w:function(s,a,d,p){var _=ife(s,p);return a==="wo"?d.ordinalNumber(_,{unit:"week"}):yn(_,a.length)},I:function(s,a,d){var p=tfe(s);return a==="Io"?d.ordinalNumber(p,{unit:"week"}):yn(p,a.length)},d:function(s,a,d){return a==="do"?d.ordinalNumber(s.getUTCDate(),{unit:"date"}):Ic.d(s,a)},D:function(s,a,d){var p=Qpe(s);return a==="Do"?d.ordinalNumber(p,{unit:"dayOfYear"}):yn(p,a.length)},E:function(s,a,d){var p=s.getUTCDay();switch(a){case"E":case"EE":case"EEE":return d.day(p,{width:"abbreviated",context:"formatting"});case"EEEEE":return d.day(p,{width:"narrow",context:"formatting"});case"EEEEEE":return d.day(p,{width:"short",context:"formatting"});case"EEEE":default:return d.day(p,{width:"wide",context:"formatting"})}},e:function(s,a,d,p){var _=s.getUTCDay(),v=(_-p.weekStartsOn+8)%7||7;switch(a){case"e":return String(v);case"ee":return yn(v,2);case"eo":return d.ordinalNumber(v,{unit:"day"});case"eee":return d.day(_,{width:"abbreviated",context:"formatting"});case"eeeee":return d.day(_,{width:"narrow",context:"formatting"});case"eeeeee":return d.day(_,{width:"short",context:"formatting"});case"eeee":default:return d.day(_,{width:"wide",context:"formatting"})}},c:function(s,a,d,p){var _=s.getUTCDay(),v=(_-p.weekStartsOn+8)%7||7;switch(a){case"c":return String(v);case"cc":return yn(v,a.length);case"co":return d.ordinalNumber(v,{unit:"day"});case"ccc":return d.day(_,{width:"abbreviated",context:"standalone"});case"ccccc":return d.day(_,{width:"narrow",context:"standalone"});case"cccccc":return d.day(_,{width:"short",context:"standalone"});case"cccc":default:return d.day(_,{width:"wide",context:"standalone"})}},i:function(s,a,d){var p=s.getUTCDay(),_=p===0?7:p;switch(a){case"i":return String(_);case"ii":return yn(_,a.length);case"io":return d.ordinalNumber(_,{unit:"day"});case"iii":return d.day(p,{width:"abbreviated",context:"formatting"});case"iiiii":return d.day(p,{width:"narrow",context:"formatting"});case"iiiiii":return d.day(p,{width:"short",context:"formatting"});case"iiii":default:return d.day(p,{width:"wide",context:"formatting"})}},a:function(s,a,d){var p=s.getUTCHours(),_=p/12>=1?"pm":"am";switch(a){case"a":case"aa":return d.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"aaa":return d.dayPeriod(_,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return d.dayPeriod(_,{width:"narrow",context:"formatting"});case"aaaa":default:return d.dayPeriod(_,{width:"wide",context:"formatting"})}},b:function(s,a,d){var p=s.getUTCHours(),_;switch(p===12?_=Mu.noon:p===0?_=Mu.midnight:_=p/12>=1?"pm":"am",a){case"b":case"bb":return d.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"bbb":return d.dayPeriod(_,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return d.dayPeriod(_,{width:"narrow",context:"formatting"});case"bbbb":default:return d.dayPeriod(_,{width:"wide",context:"formatting"})}},B:function(s,a,d){var p=s.getUTCHours(),_;switch(p>=17?_=Mu.evening:p>=12?_=Mu.afternoon:p>=4?_=Mu.morning:_=Mu.night,a){case"B":case"BB":case"BBB":return d.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"BBBBB":return d.dayPeriod(_,{width:"narrow",context:"formatting"});case"BBBB":default:return d.dayPeriod(_,{width:"wide",context:"formatting"})}},h:function(s,a,d){if(a==="ho"){var p=s.getUTCHours()%12;return p===0&&(p=12),d.ordinalNumber(p,{unit:"hour"})}return Ic.h(s,a)},H:function(s,a,d){return a==="Ho"?d.ordinalNumber(s.getUTCHours(),{unit:"hour"}):Ic.H(s,a)},K:function(s,a,d){var p=s.getUTCHours()%12;return a==="Ko"?d.ordinalNumber(p,{unit:"hour"}):yn(p,a.length)},k:function(s,a,d){var p=s.getUTCHours();return p===0&&(p=24),a==="ko"?d.ordinalNumber(p,{unit:"hour"}):yn(p,a.length)},m:function(s,a,d){return a==="mo"?d.ordinalNumber(s.getUTCMinutes(),{unit:"minute"}):Ic.m(s,a)},s:function(s,a,d){return a==="so"?d.ordinalNumber(s.getUTCSeconds(),{unit:"second"}):Ic.s(s,a)},S:function(s,a){return Ic.S(s,a)},X:function(s,a,d,p){var _=p._originalDate||s,v=_.getTimezoneOffset();if(v===0)return"Z";switch(a){case"X":return c4(v);case"XXXX":case"XX":return zl(v);case"XXXXX":case"XXX":default:return zl(v,":")}},x:function(s,a,d,p){var _=p._originalDate||s,v=_.getTimezoneOffset();switch(a){case"x":return c4(v);case"xxxx":case"xx":return zl(v);case"xxxxx":case"xxx":default:return zl(v,":")}},O:function(s,a,d,p){var _=p._originalDate||s,v=_.getTimezoneOffset();switch(a){case"O":case"OO":case"OOO":return"GMT"+a4(v,":");case"OOOO":default:return"GMT"+zl(v,":")}},z:function(s,a,d,p){var _=p._originalDate||s,v=_.getTimezoneOffset();switch(a){case"z":case"zz":case"zzz":return"GMT"+a4(v,":");case"zzzz":default:return"GMT"+zl(v,":")}},t:function(s,a,d,p){var _=p._originalDate||s,v=Math.floor(_.getTime()/1e3);return yn(v,a.length)},T:function(s,a,d,p){var _=p._originalDate||s,v=_.getTime();return yn(v,a.length)}};function a4(r,s){var a=r>0?"-":"+",d=Math.abs(r),p=Math.floor(d/60),_=d%60;if(_===0)return a+String(p);var v=s;return a+String(p)+v+yn(_,2)}function c4(r,s){if(r%60===0){var a=r>0?"-":"+";return a+yn(Math.abs(r)/60,2)}return zl(r,s)}function zl(r,s){var a=s||"",d=r>0?"-":"+",p=Math.abs(r),_=yn(Math.floor(p/60),2),v=yn(p%60,2);return d+_+a+v}var l4=function(s,a){switch(s){case"P":return a.date({width:"short"});case"PP":return a.date({width:"medium"});case"PPP":return a.date({width:"long"});case"PPPP":default:return a.date({width:"full"})}},RG=function(s,a){switch(s){case"p":return a.time({width:"short"});case"pp":return a.time({width:"medium"});case"ppp":return a.time({width:"long"});case"pppp":default:return a.time({width:"full"})}},ofe=function(s,a){var d=s.match(/(P+)(p+)?/)||[],p=d[1],_=d[2];if(!_)return l4(s,a);var v;switch(p){case"P":v=a.dateTime({width:"short"});break;case"PP":v=a.dateTime({width:"medium"});break;case"PPP":v=a.dateTime({width:"long"});break;case"PPPP":default:v=a.dateTime({width:"full"});break}return v.replace("{{date}}",l4(p,a)).replace("{{time}}",RG(_,a))},afe={p:RG,P:ofe},cfe=["D","DD"],lfe=["YY","YYYY"];function dfe(r){return cfe.indexOf(r)!==-1}function ufe(r){return lfe.indexOf(r)!==-1}function d4(r,s,a){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(s,"`) for formatting years to the input `").concat(a,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(s,"`) for formatting years to the input `").concat(a,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(s,"`) for formatting days of the month to the input `").concat(a,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(s,"`) for formatting days of the month to the input `").concat(a,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var hfe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},pfe=function(s,a,d){var p,_=hfe[s];return typeof _=="string"?p=_:a===1?p=_.one:p=_.other.replace("{{count}}",a.toString()),d!=null&&d.addSuffix?d.comparison&&d.comparison>0?"in "+p:p+" ago":p};function nb(r){return function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=s.width?String(s.width):r.defaultWidth,d=r.formats[a]||r.formats[r.defaultWidth];return d}}var ffe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},mfe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},_fe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},gfe={date:nb({formats:ffe,defaultWidth:"full"}),time:nb({formats:mfe,defaultWidth:"full"}),dateTime:nb({formats:_fe,defaultWidth:"full"})},Efe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},vfe=function(s,a,d,p){return Efe[s]};function gf(r){return function(s,a){var d=a!=null&&a.context?String(a.context):"standalone",p;if(d==="formatting"&&r.formattingValues){var _=r.defaultFormattingWidth||r.defaultWidth,v=a!=null&&a.width?String(a.width):_;p=r.formattingValues[v]||r.formattingValues[_]}else{var T=r.defaultWidth,b=a!=null&&a.width?String(a.width):r.defaultWidth;p=r.values[b]||r.values[T]}var N=r.argumentCallback?r.argumentCallback(s):s;return p[N]}}var yfe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Sfe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Tfe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Rfe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Cfe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},wfe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},bfe=function(s,a){var d=Number(s),p=d%100;if(p>20||p<10)switch(p%10){case 1:return d+"st";case 2:return d+"nd";case 3:return d+"rd"}return d+"th"},Ife={ordinalNumber:bfe,era:gf({values:yfe,defaultWidth:"wide"}),quarter:gf({values:Sfe,defaultWidth:"wide",argumentCallback:function(s){return s-1}}),month:gf({values:Tfe,defaultWidth:"wide"}),day:gf({values:Rfe,defaultWidth:"wide"}),dayPeriod:gf({values:Cfe,defaultWidth:"wide",formattingValues:wfe,defaultFormattingWidth:"wide"})};function Ef(r){return function(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=a.width,p=d&&r.matchPatterns[d]||r.matchPatterns[r.defaultMatchWidth],_=s.match(p);if(!_)return null;var v=_[0],T=d&&r.parsePatterns[d]||r.parsePatterns[r.defaultParseWidth],b=Array.isArray(T)?Ofe(T,function(U){return U.test(v)}):Afe(T,function(U){return U.test(v)}),N;N=r.valueCallback?r.valueCallback(b):b,N=a.valueCallback?a.valueCallback(N):N;var L=s.slice(v.length);return{value:N,rest:L}}}function Afe(r,s){for(var a in r)if(r.hasOwnProperty(a)&&s(r[a]))return a}function Ofe(r,s){for(var a=0;a<r.length;a++)if(s(r[a]))return a}function Nfe(r){return function(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=s.match(r.matchPattern);if(!d)return null;var p=d[0],_=s.match(r.parsePattern);if(!_)return null;var v=r.valueCallback?r.valueCallback(_[0]):_[0];v=a.valueCallback?a.valueCallback(v):v;var T=s.slice(p.length);return{value:v,rest:T}}}var Pfe=/^(\d+)(th|st|nd|rd)?/i,Dfe=/\d+/i,kfe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Lfe={any:[/^b/i,/^(a|c)/i]},Mfe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},xfe={any:[/1/i,/2/i,/3/i,/4/i]},Ufe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Vfe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},jfe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ffe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Bfe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Wfe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Gfe={ordinalNumber:Nfe({matchPattern:Pfe,parsePattern:Dfe,valueCallback:function(s){return parseInt(s,10)}}),era:Ef({matchPatterns:kfe,defaultMatchWidth:"wide",parsePatterns:Lfe,defaultParseWidth:"any"}),quarter:Ef({matchPatterns:Mfe,defaultMatchWidth:"wide",parsePatterns:xfe,defaultParseWidth:"any",valueCallback:function(s){return s+1}}),month:Ef({matchPatterns:Ufe,defaultMatchWidth:"wide",parsePatterns:Vfe,defaultParseWidth:"any"}),day:Ef({matchPatterns:jfe,defaultMatchWidth:"wide",parsePatterns:Ffe,defaultParseWidth:"any"}),dayPeriod:Ef({matchPatterns:Bfe,defaultMatchWidth:"any",parsePatterns:Wfe,defaultParseWidth:"any"})},CG={code:"en-US",formatDistance:pfe,formatLong:gfe,formatRelative:vfe,localize:Ife,match:Gfe,options:{weekStartsOn:0,firstWeekContainsDate:1}},Hfe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Kfe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,zfe=/^'([^]*?)'?$/,Yfe=/''/g,qfe=/[a-zA-Z]/;function vf(r,s,a){var d,p,_,v,T,b,N,L,U,B,Y,F,X,te;pn(2,arguments);var q=String(s),z=vm(),W=(d=(p=void 0)!==null&&p!==void 0?p:z.locale)!==null&&d!==void 0?d:CG,Z=Wa((_=(v=(T=(b=void 0)!==null&&b!==void 0?b:void 0)!==null&&T!==void 0?T:z.firstWeekContainsDate)!==null&&v!==void 0?v:(N=z.locale)===null||N===void 0||(L=N.options)===null||L===void 0?void 0:L.firstWeekContainsDate)!==null&&_!==void 0?_:1);if(!(Z>=1&&Z<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var Ee=Wa((U=(B=(Y=(F=void 0)!==null&&F!==void 0?F:void 0)!==null&&Y!==void 0?Y:z.weekStartsOn)!==null&&B!==void 0?B:(X=z.locale)===null||X===void 0||(te=X.options)===null||te===void 0?void 0:te.weekStartsOn)!==null&&U!==void 0?U:0);if(!(Ee>=0&&Ee<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!W.localize)throw new RangeError("locale must contain localize property");if(!W.formatLong)throw new RangeError("locale must contain formatLong property");var Oe=bn(r);if(!jpe(Oe))throw new RangeError("Invalid time value");var we=TI(Oe),Ne=Jpe(Oe,we),at={firstWeekContainsDate:Z,weekStartsOn:Ee,locale:W,_originalDate:Oe},Ue=q.match(Kfe).map(function(ct){var Ze=ct[0];if(Ze==="p"||Ze==="P"){var Kt=afe[Ze];return Kt(ct,W.formatLong)}return ct}).join("").match(Hfe).map(function(ct){if(ct==="''")return"'";var Ze=ct[0];if(Ze==="'")return Xfe(ct);var Kt=sfe[Ze];if(Kt)return ufe(ct)&&d4(ct,s,String(r)),dfe(ct)&&d4(ct,s,String(r)),Kt(Ne,ct,W.localize,at);if(Ze.match(qfe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+Ze+"`");return ct}).join("");return Ue}function Xfe(r){var s=r.match(zfe);return s?s[1].replace(Yfe,"'"):r}function wG(r,s){if(r==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(r[a]=s[a]);return r}function Jfe(r){return wG({},r)}var u4=1440,$fe=2520,rb=43200,Qfe=86400;function Zfe(r,s,a){var d,p;pn(2,arguments);var _=vm(),v=(d=(p=a==null?void 0:a.locale)!==null&&p!==void 0?p:_.locale)!==null&&d!==void 0?d:CG;if(!v.formatDistance)throw new RangeError("locale must contain formatDistance property");var T=wv(r,s);if(isNaN(T))throw new RangeError("Invalid time value");var b=wG(Jfe(a),{addSuffix:!!(a!=null&&a.addSuffix),comparison:T}),N,L;T>0?(N=bn(s),L=bn(r)):(N=bn(r),L=bn(s));var U=Xpe(L,N),B=(TI(L)-TI(N))/1e3,Y=Math.round((U-B)/60),F;if(Y<2)return a!=null&&a.includeSeconds?U<5?v.formatDistance("lessThanXSeconds",5,b):U<10?v.formatDistance("lessThanXSeconds",10,b):U<20?v.formatDistance("lessThanXSeconds",20,b):U<40?v.formatDistance("halfAMinute",0,b):U<60?v.formatDistance("lessThanXMinutes",1,b):v.formatDistance("xMinutes",1,b):Y===0?v.formatDistance("lessThanXMinutes",1,b):v.formatDistance("xMinutes",Y,b);if(Y<45)return v.formatDistance("xMinutes",Y,b);if(Y<90)return v.formatDistance("aboutXHours",1,b);if(Y<u4){var X=Math.round(Y/60);return v.formatDistance("aboutXHours",X,b)}else{if(Y<$fe)return v.formatDistance("xDays",1,b);if(Y<rb){var te=Math.round(Y/u4);return v.formatDistance("xDays",te,b)}else if(Y<Qfe)return F=Math.round(Y/rb),v.formatDistance("aboutXMonths",F,b)}if(F=qpe(L,N),F<12){var q=Math.round(Y/rb);return v.formatDistance("xMonths",q,b)}else{var z=F%12,W=Math.floor(F/12);return z<3?v.formatDistance("aboutXYears",W,b):z<9?v.formatDistance("overXYears",W,b):v.formatDistance("almostXYears",W+1,b)}}function eme(r,s){return pn(1,arguments),Zfe(r,Date.now(),s)}function h4(r){return pn(1,arguments),yG(r,Date.now())}function tme(r,s){pn(2,arguments);var a=Wa(s);return Mpe(r,-a)}function p4(r){return pn(1,arguments),yG(r,tme(Date.now(),1))}const nme=({show:r,onClose:s})=>{const[a,d]=ee.useState(""),p=No(),{userSearchResults:_,userSearchLoading:v,chats:T}=xr(L=>L.chat),b=xr(L=>{var U;return(U=L.auth.user)==null?void 0:U.id});if(ee.useEffect(()=>{const L=setTimeout(()=>{a.trim()?p(xf(a)):p({type:"chat/searchUsers/fulfilled",payload:[]})},400);return()=>clearTimeout(L)},[a,p]),!r)return null;const N=async L=>{const U=T.find(B=>B.type==="direct"&&B.participants.some(Y=>Y.id===L.id));if(U){p(vI(U.chatId)),Zr.success(`Switching to chat with ${L.name}`),s();return}try{const B=await p(Tv({partnerId:L.id})).unwrap();Zr.success(`Chat created with ${L.name}!`),p(vI(B.chatId||B.id)),s()}catch(B){const Y=B.message||"Failed to create chat. Please try again.";Zr.error(Y)}};return A.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:A.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all duration-300",children:[A.jsxs("div",{className:"flex items-center justify-between p-2 pl-4 border-b",children:[A.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Start a New Chat"}),A.jsx("button",{onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 rounded-full hover:bg-gray-100",children:A.jsx(ud,{className:"w-6 h-6"})})]}),A.jsx("div",{className:"p-4 border-b",children:A.jsxs("div",{className:"relative",children:[A.jsx(WA,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),A.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:a,onChange:L=>d(L.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 outline-none transition-shadow"})]})}),A.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[v&&a.trim()&&A.jsx("div",{className:"p-4 text-center text-green-600",children:"Searching..."}),!v&&a.trim()!==""&&_.length===0&&A.jsxs("div",{className:"p-4 text-center text-gray-500",children:['No users found matching "',a,'".']}),_.filter(L=>L.id!==b).map(L=>A.jsxs("div",{onClick:()=>N(L),className:"flex items-center p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",children:[A.jsx("img",{src:L.avatar||`https://ui-avatars.com/api/?name=${L.name}&background=10b981&color=fff`,alt:L.name,className:"w-10 h-10 rounded-full object-cover mr-3 flex-shrink-0"}),A.jsxs("div",{className:"flex-1 min-w-0",children:[A.jsx("p",{className:"font-medium text-gray-800 truncate",children:L.name}),A.jsx("p",{className:"text-sm text-gray-500 truncate",children:L.email})]}),A.jsx(Cv,{className:"w-5 h-5 text-green-500 ml-4 flex-shrink-0"})]},L.id))]})]})})},rme=(r,s)=>{let a;return(...d)=>{a&&clearTimeout(a),a=setTimeout(()=>{r.apply(null,d)},s)}},ime=({show:r,onClose:s})=>{const a=No(),[d,p]=ee.useState(""),[_,v]=ee.useState(""),[T,b]=ee.useState([]),{userSearchResults:N,userSearchLoading:L,groupCreationLoading:U,error:B}=xr(W=>W.chat),Y=xr(W=>{var Z,Ee;return(Ee=(Z=W.auth)==null?void 0:Z.user)==null?void 0:Ee.id}),F=ee.useCallback(rme(W=>{W.trim().length>1&&a(xf(W))},500),[a]);ee.useEffect(()=>{F(_)},[_,F]);const X=W=>{T.some(Z=>Z.id===W.id)?b(T.filter(Z=>Z.id!==W.id)):b([...T,W])},te=W=>T.some(Z=>Z.id===W),q=()=>{p(""),v(""),b([]),a(qhe())},z=async()=>{const W=T.map(Z=>Z.id);if(W.length<2){alert("Please select at least 2 members for the group.");return}if(!d.trim()){alert("Please enter a name for the group.");return}try{const Z=await a(Sv({name:d.trim(),participantIds:W,groupImage:null})).unwrap();q(),s()}catch(Z){console.error("Failed to create group:",Z),alert(`Failed to create group: ${Z.message||"Unknown error"}`)}};return r?A.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:A.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[A.jsxs("div",{className:"flex justify-between items-center border-b pb-3",children:[A.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Create New Group"}),A.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:A.jsx(ud,{className:"w-6 h-6"})})]}),A.jsxs("div",{className:"py-6 space-y-4",children:[A.jsxs("div",{children:[A.jsx("label",{htmlFor:"groupName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Group Name (Required)"}),A.jsx("input",{id:"groupName",type:"text",value:d,onChange:W=>p(W.target.value),placeholder:"e.g., Team Alpha",className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),T.length>0&&A.jsxs("div",{className:"flex flex-wrap gap-2 min-h-[30px] border-b pb-3",children:[A.jsxs("span",{className:"text-sm font-medium text-blue-600 flex items-center",children:[A.jsx(s4,{className:"w-4 h-4 mr-1"})," Members (",T.length,")"]}),T.map(W=>A.jsxs("span",{className:"inline-flex items-center px-3 py-1 text-sm font-medium bg-blue-100 text-blue-800 rounded-full cursor-pointer",onClick:()=>X(W),children:[W.name,A.jsx(ud,{className:"w-3 h-3 ml-2 text-blue-600 hover:text-blue-900"})]},W.id))]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"userSearch",className:"block text-sm font-medium text-gray-700 mb-1",children:"Add Members (Search)"}),A.jsxs("div",{className:"relative",children:[A.jsx("input",{id:"userSearch",type:"text",value:_,onChange:W=>v(W.target.value),placeholder:"Search users by name or ID...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"}),A.jsx(WA,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"})]})]}),A.jsxs("div",{className:"h-48 overflow-y-auto border border-gray-200 rounded-lg bg-gray-50 p-2",children:[L&&A.jsx("p",{className:"text-center text-blue-500",children:"Searching..."}),!L&&_.trim().length>1&&N.length===0&&A.jsx("p",{className:"text-center text-gray-500 mt-2",children:"No users found."}),!L&&N.map(W=>W.id!==Y&&A.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer rounded-lg transition ${te(W.id)?"bg-blue-50":"hover:bg-gray-100"}`,onClick:()=>X(W),children:[A.jsxs("div",{className:"flex items-center",children:[A.jsx("img",{src:(W==null?void 0:W.avatar)||`https://ui-avatars.com/api/?name=${W==null?void 0:W.name}&background=6366f1&color=fff`,alt:W.name,className:"w-8 h-8 rounded-full mr-3 object-cover"}),A.jsx("span",{className:"font-medium text-gray-800",children:W.name})]}),te(W.id)?A.jsx(ape,{className:"w-5 h-5 text-green-500"}):A.jsx(s4,{className:"w-5 h-5 text-gray-400"})]},W.id))]}),B&&A.jsx("p",{className:"text-red-500 text-sm mt-2",children:B.message||B})]}),A.jsxs("div",{className:"flex justify-end space-x-3 border-t pt-3",children:[A.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition",disabled:U,children:"Cancel"}),A.jsx("button",{onClick:z,disabled:U||T.length<2||!d.trim(),className:`px-4 py-2 text-white rounded-lg transition ${U||T.length<2||!d.trim()?"bg-blue-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:U?"Creating Group...":"Create Group"})]})]})}):null},f4=()=>{const r=No(),{user:s}=xr(W=>W.auth),{chats:a,activeChat:d,onlineUsers:p}=xr(W=>W.chat),[_,v]=ee.useState(""),[T,b]=ee.useState(!1),[N,L]=ee.useState(!1),[U,B]=ee.useState(!1),Y=a.filter(W=>{var Z,Ee;return((Z=W.name)==null?void 0:Z.toLowerCase().includes(_.toLowerCase()))||((Ee=W.participants)==null?void 0:Ee.some(Oe=>{var we;return(we=Oe.name)==null?void 0:we.toLowerCase().includes(_.toLowerCase())}))}),F=W=>{r(vI(W)),window.innerWidth<768&&r(jf(!1))},X=async W=>{W.preventDefault();try{await r(xW()).unwrap(),Cr.disconnect(),Zr.success("Logged out successfully")}catch{Zr.error("Logout failed")}},te=W=>{if(!W.lastMessage)return"No messages yet";const{message:Z,type:Ee,sender:Oe}=W.lastMessage,Ne=(Oe==null?void 0:Oe.id)===(s==null?void 0:s.id)?"You: ":"";switch(Ee){case"image":return`${Ne} Photo`;case"file":return`${Ne} File`;case"voice":return`${Ne} Voice message`;case"video":return`${Ne} Video`;default:return`${Ne}${Z}`}},q=W=>p.includes(W),z=W=>{var Z;return W.type==="group"?null:(Z=W.participants)==null?void 0:Z.find(Ee=>Ee.id!==(s==null?void 0:s.id))};return A.jsxs("div",{className:"h-full flex flex-col bg-white",children:[A.jsxs("div",{className:"bg-green-600 text-white p-4 border-b",children:[A.jsxs("div",{className:"flex items-center justify-between mb-4",children:[A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsxs("div",{className:"relative",children:[A.jsx("img",{src:(s==null?void 0:s.avatar)||`https://ui-avatars.com/api/?name=${s==null?void 0:s.name}&background=10b981&color=fff`,alt:s==null?void 0:s.name,className:"w-10 h-10 rounded-full object-cover border-2 border-white"}),A.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-400 border-2 border-white rounded-full"})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"font-semibold text-white",children:s==null?void 0:s.name}),A.jsx("p",{className:"text-xs text-green-100",children:"Online"})]})]}),A.jsxs("div",{className:"relative",children:[A.jsx("button",{onClick:()=>b(!T),className:"p-2 text-white hover:bg-green-700 rounded-full transition-colors",children:A.jsx(_G,{className:"w-5 h-5"})}),T&&A.jsxs("div",{className:"absolute right-0 top-12 bg-white rounded-lg shadow-lg border py-2 w-48 z-10",children:[A.jsxs("button",{type:"button",className:"flex items-center px-4 py-2 hover:bg-gray-100 w-full text-left text-gray-700",children:[A.jsx(Tpe,{className:"w-4 h-4 mr-3"}),"Settings"]}),A.jsxs("button",{type:"button",onClick:X,className:"flex items-center px-4 py-2 hover:bg-gray-100 w-full text-left text-red-600",children:[A.jsx(_pe,{className:"w-4 h-4 mr-3"}),"Log out"]})]})]})]}),A.jsxs("div",{className:"relative",children:[A.jsx(WA,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),A.jsx("input",{type:"text",placeholder:"Search contacts...",value:_,onChange:W=>v(W.target.value),className:"w-full pl-10 pr-4 py-2 bg-white text-gray-800 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-transparent outline-none"})]})]}),A.jsx("div",{className:"lg:hidden bg-gray-50 px-4 py-3 border-b",children:A.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Chats"})}),A.jsx("div",{className:"hidden lg:block p-4 border-b bg-gray-50",children:A.jsxs("div",{className:"flex space-x-2",children:[A.jsxs("button",{onClick:()=>L(!0),className:"flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:[A.jsx(Cv,{className:"w-4 h-4 inline mr-2"}),"New Chat"]}),A.jsxs("button",{onClick:()=>B(!0),className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:[A.jsx(tb,{className:"w-4 h-4 inline mr-2"}),"New Group"]})]})}),A.jsx("div",{className:"flex-1 overflow-y-auto",children:Y.length===0?A.jsxs("div",{className:"p-8 text-center text-gray-500",children:[A.jsx(Cv,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),A.jsx("h3",{className:"text-lg font-medium mb-2",children:"No chats found"}),A.jsx("p",{className:"text-sm",children:"Start a new conversation to get started"})]}):Y.map(W=>{const Z=z(W),Ee=Z?q(Z.id):!1;return A.jsx("div",{onClick:()=>F(W.chatId),className:`p-4 hover:bg-gray-50 cursor-pointer border-b border-gray-100 transition-all duration-1000 ease-in-out active:bg-gray-100 ${d===W.chatId?"bg-green-50 border-green-200":""}`,children:A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsxs("div",{className:"relative flex-shrink-0",children:[W.type==="group"?A.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:A.jsx(tb,{className:"w-7 h-7 text-white"})}):A.jsx("img",{src:(Z==null?void 0:Z.avatar)||`https://ui-avatars.com/api/?name=${Z==null?void 0:Z.name}&background=6366f1&color=fff`,alt:W.name||(Z==null?void 0:Z.name),className:"w-14 h-14 rounded-full object-cover"}),W.type!=="group"&&Ee&&A.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]}),A.jsxs("div",{className:"flex-1 min-w-0",children:[A.jsxs("div",{className:"flex items-center justify-between mb-1",children:[A.jsx("h4",{className:"font-semibold text-gray-800 truncate text-lg",children:W.name||(Z==null?void 0:Z.name)||"Unknown"}),W.lastMessage&&A.jsx("span",{className:"text-xs text-gray-500",children:eme(new Date(W.lastMessage.created_at),{addSuffix:!0})})]}),A.jsxs("div",{className:"flex items-center justify-between",children:[A.jsx("p",{className:"text-sm text-gray-600 truncate",children:te(W)}),W.unreadCount>0&&A.jsx("span",{className:"bg-green-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center font-medium",children:W.unreadCount})]}),W.typing&&W.typing.length>0&&A.jsx("p",{className:"text-xs text-green-600 mt-1 font-medium",children:W.typing.length===1&&W.typing.length!==0&&W.type==="private"?W.name+" is typing...":`${W.typing.length} people typing...`})]})]})},W.chatId)})}),A.jsx("div",{className:"lg:hidden p-4 border-t bg-gray-50",children:A.jsxs("div",{className:"flex space-x-2",children:[A.jsxs("button",{onClick:()=>L(!0),className:"flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white px-4 py-3 rounded-lg text-sm font-medium transition-colors",children:[A.jsx(Cv,{className:"w-4 h-4 inline mr-2"}),"New Chat"]}),A.jsxs("button",{onClick:()=>B(!0),className:"flex-1 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white px-4 py-3 rounded-lg text-sm font-medium transition-colors",children:[A.jsx(tb,{className:"w-4 h-4 inline mr-2"}),"Group"]})]})}),A.jsx(nme,{show:N,onClose:()=>L(!1)}),A.jsx(ime,{show:U,onClose:()=>B(!1)})]})},sme=({audioUrl:r,duration:s,isOwnMessage:a,className:d=""})=>{const[p,_]=ee.useState(!1),[v,T]=ee.useState(0),[b,N]=ee.useState(0),[L,U]=ee.useState(!1),[B,Y]=ee.useState(!0),F=ee.useRef(null);ee.useEffect(()=>{const W=F.current;if(!W)return;const Z=()=>{N(W.duration),Y(!1)},Ee=()=>{T(W.currentTime)},Oe=()=>{_(!1),T(0),W.currentTime=0},we=()=>{Y(!1)},Ne=()=>{Y(!1),console.error("Audio failed to load")};return W.addEventListener("loadedmetadata",Z),W.addEventListener("timeupdate",Ee),W.addEventListener("ended",Oe),W.addEventListener("canplay",we),W.addEventListener("error",Ne),()=>{W.removeEventListener("loadedmetadata",Z),W.removeEventListener("timeupdate",Ee),W.removeEventListener("ended",Oe),W.removeEventListener("canplay",we),W.removeEventListener("error",Ne)}},[r]);const X=()=>{const W=F.current;W&&(p?(W.pause(),_(!1)):(W.play().catch(Z=>{console.error("Audio play failed:",Z)}),_(!0)))},te=()=>{const W=F.current;W&&(W.muted=!L,U(!L))},q=W=>{if(isNaN(W)||W===0)return"0:00";const Z=Math.floor(W/60),Ee=Math.floor(W%60);return`${Z}:${Ee.toString().padStart(2,"0")}`},z=b>0?v/b*100:0;return A.jsxs("div",{className:`flex items-center space-x-2 p-0 rounded-lg ${d}`,children:[A.jsx("audio",{ref:F,src:r,preload:"metadata"}),A.jsx("button",{onClick:X,disabled:B,className:`flex-shrink-0 p-2 rounded-full transition-colors ${a?"bg-white bg-opacity-20 hover:bg-opacity-30 text-white":"bg-green-500 hover:bg-green-600 text-white"} ${B?"opacity-50 cursor-not-allowed":""}`,title:p?"Pause":"Play",children:B?A.jsx("div",{className:"w-2 h-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):p?A.jsx(iy,{className:"w-3 h-3"}):A.jsx(qc,{className:"w-3 h-3"})}),A.jsxs("div",{className:"flex-1 space-y-[8px] pt-6",children:[A.jsx("div",{className:"flex items-center space-x-[2px] h-0",children:Array.from({length:30}).map((W,Z)=>{const Oe=Z/30*100<=z;return A.jsx("div",{className:`w-1 rounded-full transition-all duration-150 ${Oe?a?"bg-white":"bg-green-500":a?"bg-white bg-opacity-30":"bg-gray-300"}`,style:{height:`${10+Math.random()*10}px`,minHeight:"4px"}},Z)})}),A.jsx("div",{className:`flex justify-between text-xs ${a?"text-green-100":"text-gray-500"}`,children:A.jsx("span",{className:"text-[10px]",children:q(v)})})]}),A.jsx("button",{onClick:te,className:`flex-shrink-0 p-1 rounded-full transition-colors ${a?"hover:bg-white hover:bg-opacity-20 text-white":"hover:bg-gray-100 text-gray-600"}`,title:L?"Unmute":"Mute",children:L?A.jsx(vG,{className:"w-4 h-4"}):A.jsx(EG,{className:"w-4 h-4"})})]})},bG=ee.forwardRef(({messages:r,currentUserId:s,onReply:a,onMediaClick:d},p)=>{const _=No(),[v,T]=ee.useState(""),{activeChat:b}=xr(Ae=>Ae.chat),[N,L]=ee.useState(!1),[U,B]=ee.useState(null),[Y,F]=ee.useState(null),X=ee.useRef(null),te=ee.useRef({}),q=ee.useRef({}),z=[{emoji:"",name:"love",icon:Z3},{emoji:"",name:"like",icon:wpe},{emoji:"",name:"laugh",icon:mpe},{emoji:"",name:"sad",icon:Spe},{emoji:"",name:"angry",icon:spe}];ee.useImperativeHandle(p,()=>({scrollToBottom:(Ae=!0)=>{X.current&&X.current.scrollTo({top:X.current.scrollHeight,behavior:Ae?"smooth":"instant"})},scrollToMessage:Ae=>{const fe=q.current[Ae];if(fe&&X.current){const ce=X.current,me=fe.getBoundingClientRect(),ke=ce.getBoundingClientRect(),qe=ce.scrollTop+me.top-ke.top-ke.height/2+me.height/2;ce.scrollTo({top:qe,behavior:"smooth"}),fe.classList.add("bg-yellow-100","border-yellow-300"),setTimeout(()=>{fe.classList.remove("bg-yellow-100","border-yellow-300")},2e3)}}}));const W=Ae=>{switch(Ae){case"sent":return A.jsx(cpe,{className:"w-2 h-2 text-gray-400"});case"delivered":return A.jsx($3,{className:"w-3 h-3 text-gray-400"});case"seen":return A.jsx($3,{className:"w-3 h-3 text-green-500"});default:return A.jsx(upe,{className:"w-2 h-2 text-gray-400"})}},Z=Ae=>{const fe=new Date(Ae);return h4(fe)?vf(fe,"HH:mm"):p4(fe)?`Yesterday ${vf(fe,"HH:mm")}`:vf(fe,"MMM dd, HH:mm")},Ee=Ae=>{const fe=[];let ce=null;return Ae.forEach(me=>{const ke=vf(new Date(me.created_at),"yyyy-MM-dd");!ce||ce.date!==ke?(ce={date:ke,messages:[me]},fe.push(ce)):ce.messages.push(me)}),fe},Oe=Ae=>{const fe=new Date(Ae);return h4(fe)?"Today":p4(fe)?"Yesterday":vf(fe,"MMMM dd, yyyy")},we=Ae=>{B(Ae)},Ne=async(Ae,fe)=>{console.log("Adding reaction:",{messageId:Ae,reaction:fe});const ce={chatId:b,message_id:Ae,reaction:fe};try{await _(uG(ce)).unwrap()}catch(me){console.error("Failed to send message:",me)}F(null)},at=Ae=>{a&&a(Ae),B(null)},Ue=Ae=>{const fe=r.find(ce=>ce.id===Ae.id);if(fe&&q.current[fe.id]){const ce=q.current[fe.id],me=X.current;if(ce&&me){const ke=ce.getBoundingClientRect(),qe=me.getBoundingClientRect(),Ie=me.scrollTop+ke.top-qe.top-qe.height/2+ke.height/2;me.scrollTo({top:Ie,behavior:"smooth"}),ce.classList.add("bg-blue-50","border-blue-300","border-2"),setTimeout(()=>{ce.classList.remove("bg-blue-50","border-blue-300","border-2")},2e3)}}},ct=Ae=>{d&&d(Ae)},Ze=Ae=>{const fe=document.createElement("a");fe.href=Ae.fileUrl,fe.download=Ae.file_name||"download",fe.target="_blank",document.body.appendChild(fe),fe.click(),document.body.removeChild(fe)},Kt=(Ae,fe)=>{var ke;const ce=(ke=Ae==null?void 0:Ae.split(".").pop())==null?void 0:ke.toLowerCase(),me=fe==null?void 0:fe.toLowerCase();return ce==="pdf"||me!=null&&me.includes("pdf")?A.jsx(Uu,{className:"w-8 h-8 text-red-500"}):["doc","docx"].includes(ce)||me!=null&&me.includes("word")||me!=null&&me.includes("document")?A.jsx(Uu,{className:"w-8 h-8 text-blue-500"}):["xls","xlsx"].includes(ce)||me!=null&&me.includes("excel")||me!=null&&me.includes("spreadsheet")?A.jsx(Uu,{className:"w-8 h-8 text-green-500"}):["ppt","pptx"].includes(ce)||me!=null&&me.includes("powerpoint")||me!=null&&me.includes("presentation")?A.jsx(Uu,{className:"w-8 h-8 text-orange-500"}):["txt","rtf"].includes(ce)||me!=null&&me.includes("text")?A.jsx(Uu,{className:"w-8 h-8 text-gray-500"}):["zip","rar","7z","tar","gz"].includes(ce)||me!=null&&me.includes("zip")||me!=null&&me.includes("archive")?A.jsx(Q3,{className:"w-8 h-8 text-purple-500"}):A.jsx(Q3,{className:"w-8 h-8 text-gray-500"})},Mt=(Ae,fe)=>{var ke;const ce=(ke=Ae==null?void 0:Ae.split(".").pop())==null?void 0:ke.toLowerCase(),me=fe==null?void 0:fe.toLowerCase();return ce==="pdf"||me!=null&&me.includes("pdf")?"PDF Document":["doc","docx"].includes(ce)||me!=null&&me.includes("word")?"Word Document":["xls","xlsx"].includes(ce)||me!=null&&me.includes("excel")?"Excel Spreadsheet":["ppt","pptx"].includes(ce)||me!=null&&me.includes("powerpoint")?"PowerPoint Presentation":["txt","rtf"].includes(ce)||me!=null&&me.includes("text")?"Text Document":["zip","rar","7z","tar","gz"].includes(ce)?"Archive File":"Document"},dr=()=>{if(!X.current)return;const Ae=X.current,fe=Ae.scrollTop,ce=Ae.clientHeight;if(fe+ce>=Ae.scrollHeight-50){L(!1);return}let ke="",qe=1/0;Object.entries(te.current).forEach(([Ie,Et])=>{if(Et){const vt=Et.getBoundingClientRect(),tn=Ae.getBoundingClientRect(),zt=Math.abs(vt.top-tn.top);vt.top<=tn.top+200&&zt<qe&&(qe=zt,ke=Ie)}}),ke&&ke!==v&&T(ke)};ee.useEffect(()=>{const Ae=X.current;if(!Ae)return;Ae.scrollTop+Ae.clientHeight>=Ae.scrollHeight-100&&setTimeout(()=>{Ae.scrollTo({top:Ae.scrollHeight,behavior:"smooth"})},50)},[r]),ee.useEffect(()=>{const Ae=X.current;if(!Ae)return;let fe=!1;const ce=()=>{fe||(requestAnimationFrame(()=>{dr(),fe=!1}),fe=!0)};return Ae.addEventListener("scroll",ce,{passive:!0}),()=>Ae.removeEventListener("scroll",ce)},[v]),ee.useEffect(()=>{const Ae=fe=>{fe.target.closest(".message-actions")||(B(null),F(null))};return document.addEventListener("click",Ae),()=>document.removeEventListener("click",Ae)},[]);const en=Ee(r);return r.length===0?A.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:A.jsxs("div",{className:"text-center text-gray-500",children:[A.jsx("div",{className:"bg-gray-200 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",children:A.jsx("span",{className:"text-2xl",children:""})}),A.jsx("p",{className:"text-lg font-medium mb-2",children:"No messages yet"}),A.jsx("p",{className:"text-sm",children:"Start the conversation by sending a message"})]})}):A.jsx("div",{className:"relative h-full",children:A.jsx("div",{ref:X,className:"h-full overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent scroll-smooth",style:{paddingTop:N?"60px":"0"},children:A.jsx("div",{className:"pl-4 pr-4 pb-4 space-y-6",children:en.map((Ae,fe)=>A.jsxs("div",{className:"space-y-4",ref:ce=>{ce&&(te.current[Ae.date]=ce)},children:[A.jsx("div",{className:"flex items-center justify-center sticky top-0 z-10 py-2",children:A.jsx("div",{className:"bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium shadow-sm border border-green-200",children:Oe(Ae.date)})}),A.jsx("div",{className:"space-y-3",children:Ae.messages.map((ce,me)=>{var Xe,Fn,Ar,Ii,ua,vs,md,_d;const ke=((Xe=ce.sender)==null?void 0:Xe.id)===s,qe=["uploading","sending","failed"].includes(ce.status),Ie=ke||qe,Et=me>0?Ae.messages[me-1]:null,vt=me<Ae.messages.length-1?Ae.messages[me+1]:null,tn=!Et||((Fn=Et.sender)==null?void 0:Fn.id)!==((Ar=ce.sender)==null?void 0:Ar.id),zt=!vt||((Ii=vt.sender)==null?void 0:Ii.id)!==((ua=ce.sender)==null?void 0:ua.id);return A.jsx("div",{ref:_n=>{_n&&(q.current[ce.id]=_n)},className:`flex ${Ie?"justify-end":"justify-start"} message-enter relative group`,children:A.jsxs("div",{className:`max-w-xs lg:max-w-md xl:max-w-lg ${Ie?"order-2":"order-1"} relative`,children:[ce.replyTo&&A.jsxs("div",{onClick:()=>Ue(ce.replyTo),className:`mb-0 px-1 p-[0.5px] rounded border-l-2 cursor-pointer hover:bg-gray-50 transition-colors ${Ie?"bg-green-50 border-green-400 ml-4":"bg-gray-50 border-gray-400 mr-4"}`,children:[A.jsx("p",{className:"text-[8px] font-medium text-gray-600 mb-0",children:(vs=ce.replyTo.sender)==null?void 0:vs.name}),A.jsx("p",{className:"text-[10px] text-gray-700 truncate",children:ce.replyTo.message})]}),A.jsxs("div",{className:`rounded-2xl px-3 py-[.5px] transition-all duration-200 ${Ie?ce.type==="text"?"bg-green-200 text-black":"":ce.type==="text"?"bg-white border border-gray-200 text-gray-800 shadow-sm":""}
                          rounded
                          `,onContextMenu:_n=>{_n.preventDefault(),we(ce)},onTouchStart:_n=>{const Ha=setTimeout(()=>{we(ce)},500),Bn=()=>{clearTimeout(Ha),document.removeEventListener("touchend",Bn)};document.addEventListener("touchend",Bn)},children:[!Ie&&((md=ce.chat)==null?void 0:md.type)==="group"&&tn&&A.jsx("p",{className:"text-xs font-semibold text-blue-600 mb-1",children:(_d=ce.sender)==null?void 0:_d.name}),A.jsxs("div",{className:"space-y-2",children:[ce.type==="text"&&A.jsx("p",{className:"text-[12px] whitespace-pre-wrap break-words leading-relaxed",children:ce.message}),ce.type==="image"&&A.jsxs("div",{className:"space-y-2",children:[A.jsx("div",{className:"cursor-pointer rounded-lg overflow-hidden",onClick:()=>ct(ce),children:A.jsx("img",{src:ce.fileUrl,alt:"Shared image",className:"rounded-lg max-w-24 h-auto hover:opacity-90 transition-opacity"})}),ce.message&&A.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:ce.message})]}),ce.type==="video"&&A.jsxs("div",{className:"space-y-2",children:[A.jsxs("div",{className:"relative cursor-pointer rounded-lg overflow-hidden group",onClick:()=>ct(ce),children:[ce.thumbnailUrl?A.jsx("img",{src:ce.thumbnailUrl,alt:"Video thumbnail",className:"rounded-lg max-w-24 h-14"}):A.jsx("video",{src:ce.fileUrl,className:"rounded-lg max-w-24 h-24",poster:ce.thumbnailUrl,preload:"metadata"}),A.jsx("div",{className:"absolute inset-0 flex items-center justify-center group-hover:bg-opacity-40 transition-all",children:A.jsx("div",{className:"bg-white bg-opacity-90 rounded-full p-1",children:A.jsx(qc,{className:"w-2 h-2 text-gray-800"})})})]}),ce.message&&A.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:ce.message})]}),ce.type==="file"&&A.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg border-2 border-dashed transition-colors hover:bg-opacity-80 ${Ie?"bg-green-400 bg-opacity-20 border-green-300":"bg-gray-100 border-gray-300"}`,children:[A.jsx("div",{className:"flex-shrink-0",children:Kt(ce.file_name,ce.fileType)}),A.jsxs("div",{className:"flex-1 min-w-0",children:[A.jsx("p",{className:`text-sm font-medium truncate ${Ie?"text-white":"text-gray-800"}`,children:ce.file_name||"Unknown file"}),A.jsx("p",{className:`text-xs ${Ie?"text-green-100":"text-gray-500"}`,children:Mt(ce.file_name,ce.fileType)}),ce.fileSize&&A.jsx("p",{className:`text-xs ${Ie?"text-green-100":"text-gray-500"}`,children:ce.fileSize})]}),A.jsx("button",{onClick:()=>Ze(ce),className:`flex-shrink-0 p-2 rounded-full transition-colors ${Ie?"bg-white bg-opacity-20 hover:bg-opacity-30 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}`,title:"Download file",children:A.jsx(fG,{className:"w-4 h-4"})})]}),ce.type==="voice"&&A.jsx(sme,{audioUrl:ce.fileUrl,duration:ce.duration,isOwnMessage:Ie,className:`${Ie?"bg-green-400":"bg-gray-100"} rounded-lg`}),ce.type==="file"&&ce.message&&A.jsx("p",{className:"text-sm whitespace-pre-wrap break-words mt-2",children:ce.message})]}),A.jsxs("div",{className:`flex items-center justify-end space-x-1 ${Ie?"text-green-100":"text-gray-500"}`,children:[A.jsx("span",{className:"text-xs",children:Z(ce.created_at)}),Ie&&A.jsx("div",{className:"flex-shrink-0",children:W(ce.status)})]})]}),((U==null?void 0:U.id)===ce.id||Y===ce.id)&&A.jsxs("div",{className:`message-actions absolute top-0 ${Ie?"left-0 -translate-x-full":"right-0 translate-x-full"} flex items-center space-x-1 bg-white rounded-lg shadow-lg border p-1 z-20`,children:[A.jsx("button",{onClick:()=>at(ce),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Reply",children:A.jsx(i4,{className:"w-4 h-4 text-gray-600"})}),A.jsxs("div",{className:"relative",children:[A.jsx("button",{onClick:()=>F(Y===ce.id?null:ce.id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"React",children:A.jsx(Z3,{className:"w-4 h-4 text-gray-600"})}),Y===ce.id&&A.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-white rounded-lg shadow-lg border p-2 flex space-x-1",children:z.map(_n=>A.jsx("button",{onClick:()=>Ne(ce.id,_n.name),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors text-lg",title:_n.name,children:_n.emoji},_n.name))})]}),A.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"More",children:A.jsx(vpe,{className:"w-4 h-4 text-gray-600"})})]}),A.jsxs("div",{className:`hidden lg:flex absolute top-0 ${Ie?"left-0 -translate-x-full":"right-0 translate-x-full"} items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-white rounded-lg shadow-lg border p-1`,children:[A.jsx("button",{onClick:()=>at(ce),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Reply",children:A.jsx(i4,{className:"w-3 h-3 text-gray-600"})}),z.map(_n=>A.jsx("button",{onClick:()=>Ne(ce.id,_n.name),className:"p-1 hover:bg-gray-100 rounded transition-colors text-sm",title:_n.name,children:_n.emoji},_n.name))]}),ce.reactions&&ce.reactions.length>0&&A.jsx("div",{className:"order-1 self-end",children:ce.reactions.map((_n,Ha)=>A.jsx("div",{className:"absolute left-1 bg-white p-1 rounded-full",style:{fontSize:"12px",padding:"0px",bottom:"-12px"},children:z.find(Bn=>Bn.name===_n.emoji).emoji??_n.emoji},Ha))})]})},ce.id)})})]},Ae.date))})})})});bG.displayName="MessageList";const ome=({onEmojiSelect:r})=>{const[s,a]=ee.useState("Smileys"),d={Smileys:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Gestures:["","","","","","","","","","","","","","","","","","","","","","","","","",""],Hearts:["","","","","","","","","","","","","","","","","","",""],Animals:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Food:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Objects:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Travel:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Nature:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},p={Smileys:"",Gestures:"",Hearts:"",Animals:"",Food:"",Objects:"",Travel:"",Nature:""};return A.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-lg w-full max-w-md",children:[A.jsx("div",{className:"flex border-b border-gray-200 bg-gray-50 rounded-t-lg",children:Object.keys(d).map(_=>A.jsx("button",{onClick:()=>a(_),className:`flex-1 p-3 text-center transition-colors ${s===_?"bg-green-500 text-white":"hover:bg-gray-100 text-gray-600"} ${_==="Smileys"?"rounded-tl-lg":""} ${_==="Nature"?"rounded-tr-lg":""}`,title:_,children:A.jsx("span",{className:"text-lg",children:p[_]})},_))}),A.jsx("div",{className:"p-4 max-h-64 overflow-y-auto",children:A.jsx("div",{className:"grid grid-cols-8 gap-1",children:d[s].map(_=>A.jsx("button",{onClick:()=>r(_),className:"text-xl hover:bg-gray-100 rounded p-2 transition-colors hover:scale-110 transform duration-150",title:_,children:_},_))})}),A.jsx("div",{className:"px-4 pb-2",children:A.jsx("p",{className:"text-sm font-medium text-gray-600 text-center",children:s})})]})},ame=({isOpen:r,onClose:s,onFileSelect:a,position:d})=>{const[p,_]=ee.useState(!1),v=ee.useRef(null),T=ee.useRef(null),b=ee.useRef(null);if(!r)return null;const N=F=>{F.preventDefault(),_(!0)},L=F=>{F.preventDefault(),_(!1)},U=F=>{F.preventDefault(),_(!1);const X=Array.from(F.dataTransfer.files);X.length>0&&a(X)},B=(F,X)=>{if(F&&F.length>0){const te=Array.from(F);console.log("File input triggered:",te,X),a(te,X)}},Y=[{id:"photos",title:"Photos",icon:fpe,color:"bg-blue-500 hover:bg-blue-600",accept:"image/*",multiple:!0,ref:v,description:"Upload images (JPG, PNG, GIF)"},{id:"videos",title:"Videos",icon:oy,color:"bg-purple-500 hover:bg-purple-600",accept:"video/*",multiple:!0,ref:T,description:"Upload videos (MP4, MOV, AVI)"},{id:"documents",title:"Documents",icon:Uu,color:"bg-green-500 hover:bg-green-600",accept:".pdf,.doc,.docx,.txt,.xls,.xlsx,.ppt,.pptx,.rtf,.odt,.ods,.odp",multiple:!0,ref:b,description:"Upload documents (PDF, DOC, XLS, PPT, etc.)"}];return A.jsxs(A.Fragment,{children:[A.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),A.jsxs("div",{className:"file-upload-modal fixed z-50 bg-white rounded-lg shadow-xl border max-w-sm w-full",style:{bottom:d.bottom+10,left:Math.max(10,Math.min(d.left-200,window.innerWidth-410)),transform:"translateX(0)"},children:[A.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[A.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Share Files"}),A.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:A.jsx(ud,{className:"w-5 h-5 text-gray-500"})})]}),A.jsx("div",{className:"p-4 space-y-3",children:Y.map(F=>{const X=F.icon;return A.jsxs("div",{children:[A.jsx("input",{ref:F.ref,type:"file",accept:F.accept,multiple:F.multiple,onChange:te=>{console.log("Input change event:",te.target.files),B(te.target.files,F.id)},className:"hidden"}),A.jsxs("button",{onClick:te=>{var q;te.preventDefault(),te.stopPropagation(),console.log("Button clicked for:",F.id),(q=F.ref.current)==null||q.click()},className:`w-full flex items-center space-x-3 p-3 rounded-lg text-white transition-colors ${F.color}`,children:[A.jsx("div",{className:"flex-shrink-0",children:A.jsx(X,{className:"w-6 h-6"})}),A.jsxs("div",{className:"flex-1 text-left",children:[A.jsx("p",{className:"font-medium",children:F.title}),A.jsx("p",{className:"text-sm opacity-90",children:F.description})]})]})]},F.id)})}),A.jsxs("div",{className:`m-4 mt-0 border-2 border-dashed rounded-lg p-6 text-center transition-colors ${p?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:N,onDragLeave:L,onDrop:U,children:[A.jsx(bpe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),A.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Or drag and drop files here"}),A.jsx("p",{className:"text-xs text-gray-500",children:"Multiple files supported"})]})]})]})},cme=({isOpen:r,onClose:s,files:a,initialIndex:d=0})=>{var tn,zt;const[p,_]=ee.useState(d),[v,T]=ee.useState(1),[b,N]=ee.useState(0),[L,U]=ee.useState(!1),[B,Y]=ee.useState(!1),[F,X]=ee.useState(0),[te,q]=ee.useState(0),[z,W]=ee.useState(!0),[Z,Ee]=ee.useState(!1),[Oe,we]=ee.useState(null),Ne=a[p],at=(tn=Ne==null?void 0:Ne.type)==null?void 0:tn.startsWith("image/"),Ue=(zt=Ne==null?void 0:Ne.type)==null?void 0:zt.startsWith("video/");if(ee.useEffect(()=>{_(d)},[d]),ee.useEffect(()=>{T(1),N(0),U(!1),W(!0),clearTimeout(Oe)},[p]),ee.useEffect(()=>{const Xe=Fn=>{if(r)switch(Fn.key){case"Escape":Z?ce():s();break;case"ArrowLeft":ct();break;case"ArrowRight":Ze();break;case" ":Ue&&(Fn.preventDefault(),en());break;case"f":case"F":Ue&&(Fn.preventDefault(),fe());break;case"m":case"M":Ue&&(Fn.preventDefault(),Ae());break}};return document.addEventListener("keydown",Xe),()=>document.removeEventListener("keydown",Xe)},[r,p,Ue,L,Z]),ee.useEffect(()=>{const Xe=()=>{Ee(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",Xe),()=>document.removeEventListener("fullscreenchange",Xe)},[]),ee.useEffect(()=>{if(Ue&&z&&L){const Xe=setTimeout(()=>{W(!1)},3e3);return we(Xe),()=>clearTimeout(Xe)}},[Ue,z,L]),!r||!a||a.length===0)return null;const ct=()=>{_(Xe=>Xe>0?Xe-1:a.length-1)},Ze=()=>{_(Xe=>Xe<a.length-1?Xe+1:0)},Kt=()=>{T(Xe=>Math.min(Xe+.25,3))},Mt=()=>{T(Xe=>Math.max(Xe-.25,.25))},dr=()=>{N(Xe=>(Xe+90)%360)},en=()=>{const Xe=document.getElementById("media-video");Xe&&(L?Xe.pause():Xe.play(),U(!L))},Ae=()=>{const Xe=document.getElementById("media-video");Xe&&(Xe.muted=!B,Y(!B))},fe=async()=>{try{if(Z)document.exitFullscreen&&await document.exitFullscreen();else{const Xe=document.querySelector(".media-viewer-container");Xe&&Xe.requestFullscreen&&await Xe.requestFullscreen()}}catch(Xe){console.error("Fullscreen toggle failed:",Xe)}},ce=async()=>{try{document.exitFullscreen&&await document.exitFullscreen()}catch(Xe){console.error("Exit fullscreen failed:",Xe)}},me=Xe=>{X(Xe.target.currentTime)},ke=Xe=>{q(Xe.target.duration)},qe=Xe=>{const Fn=document.getElementById("media-video"),Ar=Xe.currentTarget.getBoundingClientRect(),ua=(Xe.clientX-Ar.left)/Ar.width*te;Fn&&(Fn.currentTime=ua,X(ua))},Ie=()=>{Ue&&(W(!0),clearTimeout(Oe))},Et=Xe=>{const Fn=Math.floor(Xe/60),Ar=Math.floor(Xe%60);return`${Fn}:${Ar.toString().padStart(2,"0")}`},vt=()=>{const Xe=document.createElement("a");Xe.href=Ne.url,Xe.download=Ne.name,Xe.click()};return A.jsxs("div",{className:`media-viewer-container fixed inset-0 bg-black z-50 flex items-center justify-center ${Z?"bg-opacity-100":"bg-opacity-95"}`,onMouseMove:Ie,children:[(!Z||z)&&A.jsx("div",{className:`absolute top-0 left-0 right-0 bg-black bg-opacity-50 text-white p-4 z-10 transition-opacity duration-300 ${Ue&&!z?"opacity-0 pointer-events-none":"opacity-100"}`,children:A.jsxs("div",{className:"flex items-center justify-between",children:[A.jsxs("div",{className:"flex items-center space-x-4",children:[A.jsx("h3",{className:"text-lg font-medium truncate max-w-md",children:Ne.name}),A.jsxs("span",{className:"text-sm text-gray-300",children:[p+1," of ",a.length]})]}),A.jsxs("div",{className:"flex items-center space-x-2",children:[at&&A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:Mt,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Zoom Out",children:A.jsx(Ope,{className:"w-5 h-5"})}),A.jsx("button",{onClick:Kt,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Zoom In",children:A.jsx(Ape,{className:"w-5 h-5"})}),A.jsx("button",{onClick:dr,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Rotate",children:A.jsx(ype,{className:"w-5 h-5"})})]}),Ue&&A.jsx("button",{onClick:fe,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:Z?"Exit Fullscreen (Esc)":"Fullscreen (F)",children:Z?A.jsx(n4,{className:"w-5 h-5"}):A.jsx(e4,{className:"w-5 h-5"})}),A.jsx("button",{onClick:vt,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Download",children:A.jsx(fG,{className:"w-5 h-5"})}),A.jsx("button",{onClick:Z?ce:s,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:Z?"Exit Fullscreen":"Close",children:A.jsx(ud,{className:"w-5 h-5"})})]})]})}),a.length>1&&(!Z||z)&&A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:ct,className:`absolute left-4 top-1/2 transform -translate-y-1/2 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-all z-10 ${Ue&&!z?"opacity-0 pointer-events-none":"opacity-100"}`,title:"Previous",children:A.jsx(lpe,{className:"w-6 h-6"})}),A.jsx("button",{onClick:Ze,className:`absolute right-4 top-1/2 transform -translate-y-1/2 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-all z-10 ${Ue&&!z?"opacity-0 pointer-events-none":"opacity-100"}`,title:"Next",children:A.jsx(dpe,{className:"w-6 h-6"})})]}),A.jsxs("div",{className:"flex items-center justify-center w-full h-full p-4",children:[at&&A.jsx("img",{src:Ne.url,alt:Ne.name,className:"max-w-full max-h-full object-contain transition-transform duration-200",style:{transform:`scale(${v}) rotate(${b}deg)`},draggable:!1}),Ue&&A.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[A.jsx("video",{id:"media-video",src:Ne.url,className:"max-w-full max-h-full object-contain",controls:!1,onTimeUpdate:me,onLoadedMetadata:ke,onPlay:()=>U(!0),onPause:()=>U(!1),onClick:en}),A.jsx("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/80 to-transparent transition-all duration-300 ${z?"opacity-100 translate-y-0":"opacity-0 translate-y-full pointer-events-none"}`,children:A.jsxs("div",{className:"p-4 space-y-3",children:[A.jsx("div",{className:"w-full",children:A.jsx("div",{className:"bg-white bg-opacity-30 rounded-full h-2 cursor-pointer hover:h-3 transition-all duration-200",onClick:qe,children:A.jsx("div",{className:"bg-white rounded-full h-full transition-all duration-100 relative",style:{width:`${F/te*100}%`},children:A.jsx("div",{className:"absolute right-0 top-1/2 transform translate-x-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full opacity-0 hover:opacity-100 transition-opacity"})})})}),A.jsxs("div",{className:"flex items-center justify-between text-white",children:[A.jsxs("div",{className:"flex items-center space-x-4",children:[A.jsx("button",{onClick:en,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:L?"Pause (Space)":"Play (Space)",children:L?A.jsx(iy,{className:"w-6 h-6"}):A.jsx(qc,{className:"w-6 h-6"})}),A.jsx("button",{onClick:Ae,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:B?"Unmute (M)":"Mute (M)",children:B?A.jsx(vG,{className:"w-5 h-5"}):A.jsx(EG,{className:"w-5 h-5"})}),A.jsxs("span",{className:"text-sm font-mono",children:[Et(F)," / ",Et(te)]})]}),A.jsx("div",{className:"flex items-center space-x-2",children:A.jsx("button",{onClick:fe,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:Z?"Exit Fullscreen (Esc)":"Fullscreen (F)",children:Z?A.jsx(n4,{className:"w-5 h-5"}):A.jsx(e4,{className:"w-5 h-5"})})})]})]})}),!L&&A.jsx("button",{onClick:en,className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 hover:bg-opacity-40 transition-all",children:A.jsx("div",{className:"bg-white bg-opacity-90 rounded-full p-4 hover:bg-opacity-100 transition-all",children:A.jsx(qc,{className:"w-12 h-12 text-gray-800"})})})]})]}),a.length>1&&(!Z||z)&&A.jsx("div",{className:`absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 bg-black bg-opacity-50 rounded-lg p-2 transition-all duration-300 ${Ue&&!z?"opacity-0 pointer-events-none":"opacity-100"}`,children:a.map((Xe,Fn)=>{var Ar,Ii;return A.jsx("button",{onClick:()=>_(Fn),className:`w-12 h-12 rounded overflow-hidden border-2 transition-colors ${Fn===p?"border-white":"border-transparent"}`,children:(Ar=Xe.type)!=null&&Ar.startsWith("image/")?A.jsx("img",{src:Xe.url,alt:Xe.name,className:"w-full h-full object-cover"}):(Ii=Xe.type)!=null&&Ii.startsWith("video/")?A.jsxs("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center relative",children:[A.jsx("video",{src:Xe.url,className:"w-full h-full object-cover",muted:!0,preload:"metadata"}),A.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:A.jsx(qc,{className:"w-3 h-3 text-white"})})]}):A.jsx("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center",children:A.jsx("span",{className:"text-white text-xs",children:"FILE"})})},Fn)})}),Z&&Ue&&z&&A.jsx("div",{className:"absolute top-20 right-4 bg-black bg-opacity-70 text-white text-xs p-3 rounded-lg",children:A.jsxs("div",{className:"space-y-1",children:[A.jsxs("div",{children:[A.jsx("kbd",{className:"bg-gray-600 px-1 rounded",children:"Space"})," Play/Pause"]}),A.jsxs("div",{children:[A.jsx("kbd",{className:"bg-gray-600 px-1 rounded",children:"F"})," Fullscreen"]}),A.jsxs("div",{children:[A.jsx("kbd",{className:"bg-gray-600 px-1 rounded",children:"M"})," Mute"]}),A.jsxs("div",{children:[A.jsx("kbd",{className:"bg-gray-600 px-1 rounded",children:"Esc"})," Exit"]}),A.jsxs("div",{children:[A.jsx("kbd",{className:"bg-gray-600 px-1 rounded",children:""})," Navigate"]})]})})]})},lme=({isOpen:r,onClose:s,onSend:a})=>{const[d,p]=ee.useState(!1),[_,v]=ee.useState(!1),[T,b]=ee.useState(0),[N,L]=ee.useState(null),[U,B]=ee.useState(null),[Y,F]=ee.useState(!1),[X,te]=ee.useState(0),[q,z]=ee.useState(0),W=ee.useRef(null),Z=ee.useRef(null),Ee=ee.useRef([]),Oe=ee.useRef(null),we=ee.useRef(null);ee.useEffect(()=>{if(!r)return;let ke=setTimeout(()=>at(),10);return()=>{clearTimeout(ke),Ne()}},[r]),ee.useEffect(()=>(d&&!_?Oe.current=setInterval(()=>{b(ke=>ke+1)},1e3):clearInterval(Oe.current),()=>clearInterval(Oe.current)),[d,_]);const Ne=()=>{L(null),W.current&&W.current.state!=="inactive"&&W.current.stop(),we.current&&we.current.getTracks().forEach(ke=>ke.stop()),U&&URL.revokeObjectURL(U),clearInterval(Oe.current),p(!1),v(!1),b(0),B(null),F(!1),te(0),z(0),Ee.current=[]},at=async()=>{try{const ke=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});we.current=ke;let qe="";MediaRecorder.isTypeSupported("audio/webm")?qe="audio/webm":MediaRecorder.isTypeSupported("audio/mp4")?qe="audio/mp4":qe="";const Ie=new MediaRecorder(ke,{mimeType:qe});W.current=Ie,Ee.current=[],Ie.onerror=vt=>{console.error("Recorder error: ",vt.error),alert("Recording failed. Please try again."),Ne()},Ie.ondataavailable=vt=>{vt.data.size>0&&Ee.current.push(vt.data)},Ie.onstop=()=>{const vt=Ie.mimeType||"audio/webm",tn=new Blob(Ee.current,{type:vt});if(!tn||tn.size===0){console.warn("Empty blob, retrying..."),alert("No audio captured. Please re-record.");return}L(tn);const zt=URL.createObjectURL(tn);B(zt);const Xe=new Audio(zt);Xe.addEventListener("loadedmetadata",()=>{z(Xe.duration)})};const Et=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);Ie.start(Et?void 0:100),p(!0),b(0)}catch(ke){console.error("Error starting recording:",ke),alert("Could not access microphone. Please check permissions."),s()}},Ue=()=>{W.current&&W.current.state==="recording"&&(W.current.pause(),v(!0))},ct=()=>{W.current&&W.current.state==="paused"&&(W.current.resume(),v(!1))},Ze=()=>{if(!Ee.current.length){console.warn("No audio captured"),alert("No audio recorded. Please try again."),Ne();return}W.current&&W.current.state!=="inactive"&&(W.current.requestData(),W.current.stop()),we.current&&we.current.getTracks().forEach(ke=>ke.stop()),p(!1),v(!1)},Kt=()=>{Z.current&&(Z.current.play(),F(!0))},Mt=()=>{Z.current&&(Z.current.pause(),F(!1))},dr=()=>{Z.current&&te(Z.current.currentTime)},en=()=>{F(!1),te(0),Z.current&&(Z.current.currentTime=0)},Ae=ke=>{if(Z.current&&q>0){const qe=ke.currentTarget.getBoundingClientRect(),Et=(ke.clientX-qe.left)/qe.width*q;Z.current.currentTime=Et,te(Et)}},fe=ke=>{const qe=Math.floor(ke/60),Ie=Math.floor(ke%60);return`${qe}:${Ie.toString().padStart(2,"0")}`},ce=()=>{if(N&&U){const ke={type:"voice",audioBlob:N,audioUrl:U,duration:fe(q),size:N.size};a(ke),s()}},me=()=>{Ze(),Ne(),s()};return r?A.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:A.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md",children:[A.jsx("div",{className:"flex items-center justify-between p-2 pl-4 border-b",children:A.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:d?"Recording Voice Message":"Voice Message"})}),A.jsxs("div",{className:"p-4 space-y-4",children:[A.jsx("div",{className:"flex items-center justify-center h-10 bg-gray-50 rounded-lg",children:A.jsx("div",{className:"flex items-end space-x-1 h-8",children:Array.from({length:40}).map((ke,qe)=>A.jsx("div",{className:`w-1 bg-green-500 rounded-full transition-all duration-300 ${d&&!_?"animate-pulse":""}`,style:{height:`${Math.random()*80}%`,minHeight:"4px",opacity:d&&!_?1:.3}},qe))})}),A.jsxs("div",{className:"text-center",children:[A.jsx("div",{className:"text-3xl font-mono font-bold text-gray-800",children:fe(T)}),A.jsx("p",{className:"text-sm text-gray-500 mt-0",children:d?_?"Recording paused":"Recording...":N?"Recording complete":"Tap to start recording"})]}),N&&U&&A.jsxs("div",{className:"space-y-2",children:[A.jsx("audio",{ref:Z,src:U,onTimeUpdate:dr,onEnded:en,onLoadedMetadata:()=>{Z.current&&z(Z.current.duration)}}),A.jsxs("div",{className:"space-y-2",children:[A.jsx("div",{className:"bg-gray-200 rounded-full h-2 cursor-pointer",onClick:Ae,children:A.jsx("div",{className:"bg-green-500 rounded-full h-2 transition-all duration-100",style:{width:`${q>0?X/q*100:0}%`}})}),A.jsx("div",{className:"flex justify-between text-xs text-gray-500",children:A.jsx("span",{children:fe(X)})})]}),A.jsx("div",{className:"flex justify-center",children:A.jsx("button",{onClick:Y?Mt:Kt,className:"p-2 bg-green-500 hover:bg-green-600 text-white rounded-full transition-colors",children:Y?A.jsx(iy,{className:"w-6 h-6"}):A.jsx(qc,{className:"w-6 h-6"})})})]}),A.jsx("div",{className:"flex items-center justify-center space-x-2 m-0",children:d?A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:_?ct:Ue,className:"p-4 bg-yellow-500 hover:bg-yellow-600 text-white rounded-full transition-colors",title:_?"Resume":"Pause",children:_?A.jsx(qc,{className:"w-6 h-6"}):A.jsx(iy,{className:"w-6 h-6"})}),A.jsx("button",{onClick:Ze,className:"p-4 bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors",title:"Stop Recording",children:A.jsx(Cpe,{className:"w-6 h-6"})})]}):N?null:A.jsx("button",{onClick:at,className:"p-6 bg-green-500 hover:bg-green-600 text-white rounded-full transition-colors animate-pulse",title:"Start Recording",children:A.jsx(BA,{className:"w-8 h-8"})})})]}),N&&A.jsxs("div",{className:"flex items-center justify-between p-2 border-t bg-gray-50 rounded-b-2xl",children:[A.jsx("button",{onClick:me,className:"px-6 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsx("button",{onClick:()=>{Ne(),at()},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors",children:"Re-record"}),A.jsxs("button",{onClick:ce,className:"px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors flex items-center space-x-2",children:[A.jsx(gG,{className:"w-4 h-4"}),A.jsx("span",{children:"Send"})]})]})]})]})}):null},dme=(r,s)=>{const a=[r,s].sort();return`chat_channel_${a[0]}_${a[1]}`},m4=()=>{var Oh,Nh,Ph,Do,Dh,Cm;const r=No(),{user:s}=xr(Ve=>Ve.auth),{activeChat:a,chats:d,messages:p,onlineUsers:_}=xr(Ve=>Ve.chat),[v,T]=ee.useState(""),[b,N]=ee.useState(!1),[L,U]=ee.useState(!1),[B,Y]=ee.useState(!1),[F,X]=ee.useState(null),[te,q]=ee.useState(!1),[z,W]=ee.useState({bottom:0,left:0}),[Z,Ee]=ee.useState([]),[Oe,we]=ee.useState(!1),[Ne,at]=ee.useState([]),[Ue,ct]=ee.useState(0),[Ze,Kt]=ee.useState({}),[Mt,dr]=ee.useState(!1),[en,Ae]=ee.useState(!1),fe=ee.useRef(null),ce=ee.useRef(null);ee.useRef(null);const me=ee.useRef(null),ke=ee.useRef(null),qe=ee.useRef(null),Ie=d.find(Ve=>Ve.chatId===a),Et=p[a]||[],vt=(Ie==null?void 0:Ie.type)!=="group"?(Oh=Ie==null?void 0:Ie.participants)==null?void 0:Oh.find(Ve=>Ve.id!==(s==null?void 0:s.id)):null,tn=vt?_.includes(vt.id):!1,{activeCall:zt,callStatus:Xe,loading:Fn}=xr(Ve=>Ve.call),Ar=vt==null?void 0:vt.id,Ii=s==null?void 0:s.id,ua=(Ve,et)=>new Promise(Qe=>{const tt=document.createElement("video"),St=document.createElement("canvas"),ni=St.getContext("2d");tt.addEventListener("loadedmetadata",()=>{St.width=tt.videoWidth,St.height=tt.videoHeight;const Ai=Math.min(1,tt.duration*.1);tt.currentTime=Ai}),tt.addEventListener("seeked",()=>{ni.drawImage(tt,0,0,St.width,St.height),St.toBlob(Ai=>{if(Ai){const ys=URL.createObjectURL(Ai);Qe(ys)}else Qe(null)},"image/jpeg",.8)}),tt.addEventListener("error",()=>{Qe(null)}),tt.src=et,tt.load()});ee.useEffect(()=>{if(console.log("currentChat",Ie),a&&Ie&&Ie.unreadCount>0){r(Hhe({chatId:a}));const Ve=Ie.participants?Ie.participants.filter(et=>et.id!==s.id).map(et=>et.id):[];Cr.markAsSeen(a,s.id,Ve)}},[a,Ie==null?void 0:Ie.unreadCount,r,Ie==null?void 0:Ie.participants,s.id,en]),ee.useEffect(()=>{(async()=>{var Qe;const et={};for(const tt of Z)if((Qe=tt.type)!=null&&Qe.startsWith("video/")&&!Ze[tt.id])try{const St=await ua(tt,tt.url);St&&(et[tt.id]=St)}catch(St){console.error("Failed to generate thumbnail for video:",St)}Object.keys(et).length>0&&Kt(tt=>({...tt,...et}))})()},[Z]),ee.useEffect(()=>{var Ve;(Ve=fe.current)!=null&&Ve.scrollToBottom&&fe.current.scrollToBottom()},[Et]),ee.useEffect(()=>()=>{Object.values(Ze).forEach(Ve=>{Ve&&Ve.startsWith("blob:")&&URL.revokeObjectURL(Ve)})},[]),ee.useEffect(()=>{if(a&&qe.current!==a)return qe.current=a,r(Rv({chatId:a})),()=>{}},[a,r]),ee.useEffect(()=>{F&&me.current&&me.current.focus()},[F]),ee.useEffect(()=>{const Ve=et=>{te&&!et.target.closest(".file-upload-modal")&&!et.target.closest("[data-paperclip-button]")&&q(!1),B&&!et.target.closest(".chat-menu")&&Y(!1)};return document.addEventListener("click",Ve),()=>document.removeEventListener("click",Ve)},[te,B]);const vs=()=>{r(jf(!0))},md=Ve=>fetch(Ve).then(et=>et.blob()),_d=async Ve=>{if(Ve.preventDefault(),!v.trim()&&Z.length===0)return;const et=Date.now().toString();if(Z.length>0){for(const Qe of Z){const tt=Qe.type||"",St={id:et,chatId:a,message:v.trim()||"",type:tt.startsWith("image/")?"image":tt.startsWith("video/")?"video":"file",sender:s,status:"uploading",created_at:new Date().toISOString(),fileUrl:Qe.url,file_name:Qe.name,fileSize:bh(Qe.size),fileOriginalType:Qe.type,thumbnailUrl:tt.startsWith("video/")?Ze[Qe.id]:null,reply_to:F?F.id:null,replyTo:F?{}:null};r(ry({...St,currentUserId:s.id}));try{const ni=new FormData;if(ni.append("file",Qe.originalFile,Qe.name),ni.append("chatId",a),tt.startsWith("video/")&&St.thumbnailUrl){const rS=await md(St.thumbnailUrl);ni.append("thumbnail",rS,`thumbnail_${Qe.name}.jpg`)}const Ai=await r(J3({formData:ni,tempId:et,chatId:a})).unwrap(),ys=Ai.file_path,gd=Ai.thumbnail_path||St.thumbnailUrl,Ka=Ai.file_name??"",nS={...St,file_path:ys,fileUrl:ys,thumbnail_url:gd,file_name:Ka,status:"sending"};await r(Vf(nS)).unwrap()}catch(ni){console.error("Failed to upload or send file message:",ni),r(yI({tempId:et,status:"failed",chatId:a}))}}Ee([]),Object.values(Ze).forEach(Qe=>{Qe&&Qe.startsWith("blob:")&&URL.revokeObjectURL(Qe)}),Kt({})}else{const Qe={id:et,chatId:a,message:v.trim(),type:"text",file_path:null,reply_to:F?F.id:null,replyTo:F?{id:F.id,message:F.message,type:F.type,file_path:F.file_path,sender:F.sender?{id:F.sender.id,name:F.sender.name,avatar:F.sender.avatar}:null}:null};try{await r(Vf(Qe)).unwrap()}catch(tt){console.error("Failed to send message:",tt)}}T(""),X(null),Ha(),setTimeout(()=>{var Qe;(Qe=fe.current)!=null&&Qe.scrollToBottom&&fe.current.scrollToBottom()},100)},_n=Ve=>{if(T(Ve.target.value),!L){const et=s.id,Qe=Ie.participants.filter(tt=>tt.id!==s.id).map(tt=>tt.id);U(!0),Cr.startTyping(a,et,Qe)}ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{Ha()},3e3)},Ha=()=>{if(L){U(!1);const Ve=s.id,et=Ie.participants.filter(Qe=>Qe.id!==s.id).map(Qe=>Qe.id);Cr.stopTyping(a,Ve,et)}ce.current&&(clearTimeout(ce.current),ce.current=null)},Bn=Ve=>{T(et=>et+Ve),N(!1),me.current&&me.current.focus()},_i=Ve=>{if(Ve.preventDefault(),Ve.stopPropagation(),console.log("Paperclip clicked!"),ke.current){const et=ke.current.getBoundingClientRect();console.log("Button rect:",et),W({bottom:window.innerHeight-et.top,left:et.left+et.width/2})}q(!0),N(!1)},Ch=(Ve,et)=>{console.log("Files selected:",Ve,et);const Qe=Ve.map(tt=>({...tt,originalFile:tt,url:URL.createObjectURL(tt),id:Date.now()+Math.random(),type:tt.type}));Ee(tt=>[...tt,...Qe]),q(!1)},wh=Ve=>{Ee(et=>{const Qe=et.find(tt=>tt.id===Ve);return Qe&&Qe.url&&URL.revokeObjectURL(Qe.url),et.filter(tt=>tt.id!==Ve)}),Ze[Ve]&&(URL.revokeObjectURL(Ze[Ve]),Kt(et=>{const Qe={...et};return delete Qe[Ve],Qe}))},ym=(Ve,et=0)=>{at(Ve),ct(et),we(!0)},Sm=(Ve,et)=>{const Qe=Z.filter(St=>{const ni=St.type||"";return ni.startsWith("image/")||ni.startsWith("video/")}).map(St=>({url:St.url,name:St.name,type:St.type})),tt=Qe.findIndex(St=>St.url===Ve.url);tt!==-1&&ym(Qe,tt)},Or=Ve=>{const et=Et.filter(St=>St.type==="image"||St.type==="video"),Qe=et.map(St=>({url:St.fileUrl,name:St.file_name||"Media file",type:St.fileType||(St.type==="image"?"image/jpeg":"video/mp4")})),tt=et.findIndex(St=>St.id===Ve.id);ym(Qe,tt)},bh=Ve=>{if(Ve===0)return"0 Bytes";const et=1024,Qe=["Bytes","KB","MB","GB"],tt=Math.floor(Math.log(Ve)/Math.log(et));return parseFloat((Ve/Math.pow(et,tt)).toFixed(2))+" "+Qe[tt]},Tm=Ve=>{X(Ve),N(!1)},Zs=()=>{X(null)},Ih=ee.useCallback(async Ve=>{var tt;if(!Ar||Fn)return;const et=dme(Ii,Ar),Qe=(Ie==null?void 0:Ie.type)!=="group"?(tt=Ie==null?void 0:Ie.participants)==null?void 0:tt.find(St=>St.id===(s==null?void 0:s.id)):null;await r(Ev({participant:vt,caller:Qe,callType:Ve,channelId:et,activeChat:a}))},[r,Ar,Ii,Fn]);ee.useEffect(()=>{let Ve=!1;return zt&&zt.callerId===Ii&&Xe==="calling"&&zt.token&&(async()=>{try{const Qe=ia.get("rtcClient");if(Qe){console.warn("Stale RTC Client found in store. Forcing cleanup before re-join.");try{await Qe.leave()}catch{console.log("Existing client leave failed (expected if already disconnected).")}ia.clearAll()}const tt=await Cr.startCallAndPublish(zt.channelName,Ii,zt.token,zt.callType),St=tt[0],ni=zt.callType==="video"?tt[1]:null;r(dG({videoTrack:ni,audioTrack:St}))}catch(Qe){if(Ve)return;console.error("Agora Join Failed:",Qe),Cr.leaveCall(),r(yv("failed")),setTimeout(()=>r(dd()),3e3)}})(),()=>{Ve=!0}},[zt,Xe,Ii,r]);const Ah=()=>{dr(!0),N(!1)},Rm=async Ve=>{try{const et=new File([Ve.audioBlob],`voice_${Date.now()}.webm`,{type:Ve.audioBlob.type}),Qe=Date.now().toString(),tt={id:Qe,chatId:a,message:"",type:"voice",sender:s,status:"uploading",created_at:new Date().toISOString(),file_path:Ve.audioUrl,file_name:et.name,fileSize:bh(Ve.audioBlob.size),fileType:Ve.audioBlob.type,duration:Ve.duration,reply_to:F?F.id:null,replyTo:F?{id:F.id,message:F.message,type:F.type,file_path:F.file_path,sender:F.sender?{id:F.sender.id,name:F.sender.name,avatar:F.sender.avatar}:null}:null};r(ry({...tt,currentUserId:s.id})),X(null);const St=new FormData;St.append("file",et,et.name),St.append("chatId",a),St.append("duration",Ve.duration);const Ai=(await r(J3({formData:St,tempId:Qe,chatId:a})).unwrap()).file_path,ys={...tt,file_path:Ai,fileUrl:Ai,status:"sending"};await r(Vf(ys)).unwrap(),URL.revokeObjectURL(Ve.audioUrl),setTimeout(()=>{var gd;(gd=fe.current)!=null&&gd.scrollToBottom&&fe.current.scrollToBottom()},100)}catch(et){console.error("Failed to send voice message:",et),r(yI({tempId,status:"failed",chatId:a}))}};return Ie?A.jsx(A.Fragment,{children:A.jsxs("div",{className:"flex flex-col h-full bg-white",children:[A.jsxs("div",{className:"bg-green-600 text-white p-4 border-b flex items-center justify-between",children:[A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsx("button",{onClick:vs,className:"lg:hidden p-2 text-white hover:bg-green-700 rounded-full transition-colors",children:A.jsx(ope,{className:"w-5 h-5"})}),A.jsxs("div",{className:"relative",children:[Ie.type==="group"?A.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:A.jsx("span",{className:"text-white font-semibold",children:(Ph=(Nh=Ie.name)==null?void 0:Nh.charAt(0))==null?void 0:Ph.toUpperCase()})}):A.jsx("img",{src:(vt==null?void 0:vt.avatar)||`https://ui-avatars.com/api/?name=${vt==null?void 0:vt.name}&background=6366f1&color=fff`,alt:Ie.name||(vt==null?void 0:vt.name),className:"w-10 h-10 rounded-full object-cover border-2 border-white"}),Ie.type!=="group"&&tn&&A.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-400 border-2 border-white rounded-full"})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"font-semibold text-white",children:Ie.name||(vt==null?void 0:vt.name)||"Unknown"}),A.jsx("p",{className:"text-xs text-green-100",children:Ie.type==="group"?`${(Do=Ie.participants)==null?void 0:Do.length} members`:tn?"Online":"Offline"})]})]}),A.jsxs("div",{className:"flex items-center space-x-2",children:[Ie.type!=="group"&&A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:()=>Ih("voice"),className:"p-2 text-white hover:bg-green-700 rounded-full transition-colors",children:A.jsx(sy,{className:"w-5 h-5"})}),A.jsx("button",{onClick:()=>Ih("video"),className:"p-2 text-white hover:bg-green-700 rounded-full transition-colors",children:A.jsx(oy,{className:"w-5 h-5"})})]}),A.jsxs("div",{className:"relative chat-menu",children:[A.jsx("button",{onClick:()=>Y(!B),className:"p-2 text-white hover:bg-green-700 rounded-full transition-colors",children:A.jsx(_G,{className:"w-5 h-5"})}),B&&A.jsxs("div",{className:"absolute right-0 top-12 bg-white rounded-lg shadow-lg border py-2 w-48 z-10",children:[A.jsx("button",{className:"flex items-center px-4 py-2 hover:bg-gray-100 w-full text-left text-gray-700",children:"View Info"}),A.jsx("button",{className:"flex items-center px-4 py-2 hover:bg-gray-100 w-full text-left text-gray-700",children:"Clear Messages"}),A.jsx("button",{className:"flex items-center px-4 py-2 hover:bg-gray-100 w-full text-left text-red-600",children:"Delete Chat"})]})]})]})]}),A.jsx("div",{className:"flex-1 overflow-hidden bg-gray-50",children:Et.length>0?A.jsx(bG,{ref:fe,messages:Et,currentUserId:s==null?void 0:s.id,onReply:Tm,onMediaClick:Or}):null}),Z.length>0&&A.jsxs("div",{className:"bg-gray-100 border-t border-gray-200 p-3",children:[A.jsx("div",{className:"flex items-center space-x-2 mb-2",children:A.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[Z.length," file",Z.length>1?"s":""," selected"]})}),A.jsx("div",{className:"flex flex-wrap gap-2",children:Z.map((Ve,et)=>{const Qe=Ve.type||"",tt=Ze[Ve.id];return A.jsxs("div",{className:"relative group",children:[A.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg overflow-hidden border cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{(Qe.startsWith("image/")||Qe.startsWith("video/"))&&Sm(Ve)},children:Qe.startsWith("image/")?A.jsx("img",{src:Ve.url,alt:Ve.name,className:"w-full h-full object-cover",onError:St=>{console.error("Image failed to load:",Ve.url),St.target.style.display="none"}}):Qe.startsWith("video/")?A.jsxs("div",{className:"w-full h-full bg-gray-300 flex items-center justify-center relative",children:[tt?A.jsx("img",{src:tt,alt:Ve.name,className:"w-full h-full object-cover"}):A.jsx("video",{src:Ve.url,className:"w-full h-full object-cover",muted:!0,preload:"metadata"}),A.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center",children:A.jsx("div",{className:"bg-white bg-opacity-90 rounded-full p-1",children:A.jsx(qc,{className:"w-4 h-4 text-gray-800"})})})]}):A.jsx("div",{className:"w-full h-full bg-gray-300 flex items-center justify-center",children:A.jsx(r4,{className:"w-6 h-6 text-gray-600"})})}),A.jsx("button",{onClick:()=>wh(Ve.id),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:A.jsx(ud,{className:"w-3 h-3"})})]},Ve.id)})})]}),F&&A.jsx("div",{className:"bg-gray-100 border-t border-gray-200 p-3",children:A.jsxs("div",{className:"flex items-start justify-between",children:[A.jsx("div",{className:"flex-1",children:A.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[A.jsx("div",{className:"w-1 h-8 bg-green-500 rounded-full"}),A.jsxs("div",{children:[A.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Replying to ",(Dh=F.sender)==null?void 0:Dh.name]}),A.jsx("p",{className:"text-sm text-gray-600 truncate max-w-xs",children:F.message})]})]})}),A.jsx("button",{onClick:Zs,className:"p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition-colors",children:A.jsx(ud,{className:"w-4 h-4"})})]})}),A.jsxs("div",{className:"bg-white p-4 border-t",children:[b&&A.jsx("div",{className:"mb-4",children:A.jsx(ome,{onEmojiSelect:Bn})}),A.jsxs("form",{onSubmit:_d,className:"flex items-center space-x-2",children:[A.jsxs("div",{className:"flex items-center space-x-2",children:[A.jsx("button",{type:"button",onClick:()=>N(!b),className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-full transition-colors",children:A.jsx(Rpe,{className:"w-5 h-5"})}),A.jsx("button",{ref:ke,type:"button",onClick:_i,"data-paperclip-button":"true",className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-full transition-colors",children:A.jsx(r4,{className:"w-5 h-5"})})]}),A.jsx("div",{className:"flex-1 relative",children:A.jsx("input",{ref:me,type:"text",value:v,onChange:_n,onFocus:()=>Ae(!0),onBlur:()=>Ae(!1),placeholder:Z.length>0?"Add a caption...":F?`Reply to ${(Cm=F.sender)==null?void 0:Cm.name}...`:"Type a message...",className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none text-base"})}),v.trim()||Z.length>0?A.jsx("button",{type:"submit",className:"p-3 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white rounded-full transition-colors",children:A.jsx(gG,{className:"w-5 h-5"})}):A.jsx("button",{type:"button",onClick:Ah,className:"p-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-full transition-colors",title:"Record voice message",children:A.jsx(BA,{className:"w-5 h-5"})})]})]}),A.jsx(ame,{isOpen:te,onClose:()=>q(!1),onFileSelect:Ch,position:z}),A.jsx(cme,{isOpen:Oe,onClose:()=>we(!1),files:Ne,initialIndex:Ue}),A.jsx(lme,{isOpen:Mt,onClose:()=>dr(!1),onSend:Rm})]})}):null},ume=ee.forwardRef(({isOpen:r,activeCall:s,callType:a="voice",participant:d,callStatus:p="calling",duration:_=0,onAccept:v,onDecline:T,onClose:b,onToggleMute:N,onToggleVideo:L,onToggleSpeaker:U,onToggleMinimize:B,isMuted:Y=!1,isVideoEnabled:F=!0,isSpeakerOn:X=!1,isMinimized:te=!1,cameraError:q,isCameraLoading:z,isRemoteStreamReady:W=!1,localStream:Z,localVideoTrackId:Ee,remoteVideoTrackId:Oe},we)=>{var fe,ce;const Ne=No(),[at,Ue]=ee.useState(!0),[ct,Ze]=ee.useState(null),Kt=ee.useRef(null),Mt=ee.useRef(null);ee.useEffect(()=>{if(a!=="video")return;const me=ia.get("localVideoTrack");return me&&Kt.current&&me.play(Kt.current),()=>{me&&me.stop()}},[p,a,Ee]),ee.useEffect(()=>{if(a!=="video")return;const me=ia.get("remoteVideoTrack");return console.log("remoteTrack remoteTrack",me),me&&Mt.current&&me.play(Mt.current),()=>{me&&me.stop()}},[p,a,Oe]);const dr=me=>{const ke=Math.floor(me/60),qe=me%60;return`${ke.toString().padStart(2,"0")}:${qe.toString().padStart(2,"0")}`};ee.useEffect(()=>{if(a==="video"&&p==="connected"&&at){const me=setTimeout(()=>{Ue(!1),Ne(X3(!1))},3e3);return Ze(me),()=>clearTimeout(me)}p!=="connected"&&ct&&(clearTimeout(ct),Ze(null),Ue(!0))},[a,p,at,Ne]);const en=()=>{a==="video"&&p==="connected"&&(Ue(!0),Ne(X3(!0)),ct&&(clearTimeout(ct),Ze(null)))},Ae=me=>{if(!me||typeof me!="string"||me.length===0)return"";const ke=me.toLowerCase();return ke.charAt(0).toUpperCase()+ke.slice(1)};return r?te?A.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:A.jsxs("div",{className:"bg-gray-900 text-white rounded-lg shadow-2xl p-3 flex items-center space-x-3 min-w-[200px]",children:[A.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[A.jsxs("div",{className:"relative",children:[A.jsx("img",{src:(d==null?void 0:d.avatar)||`https://ui-avatars.com/api/?name=${d==null?void 0:d.name}&background=6366f1&color=fff`,alt:d==null?void 0:d.name,className:"w-8 h-8 rounded-full object-cover"}),p==="connected"&&A.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-gray-900 rounded-full"})]}),A.jsxs("div",{className:"flex-1 min-w-0",children:[A.jsx("p",{className:"text-sm font-medium truncate",children:d==null?void 0:d.name}),A.jsx("p",{className:"text-xs text-gray-300",children:p==="connected"?dr(_):Ae(p)})]})]}),A.jsxs("div",{className:"flex items-center space-x-1",children:[A.jsx("button",{onClick:B,className:"p-1 hover:bg-gray-700 rounded transition-colors",title:"Expand",children:A.jsx(gpe,{className:"w-4 h-4"})}),A.jsx("button",{onClick:b,className:"p-1 bg-red-500 hover:bg-red-600 rounded transition-colors",title:"End call",children:A.jsx(eb,{className:"w-4 h-4"})})]})]})}):A.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center",onMouseMove:en,children:[A.jsxs("div",{className:"relative w-full h-full max-w-6xl mx-auto",children:[a==="video"?A.jsxs("div",{className:"relative w-full h-full bg-gray-900",children:[A.jsxs("div",{className:"absolute inset-0",children:[A.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-900 to-purple-900 flex items-center justify-center",children:A.jsx("video",{ref:Mt,className:"w-full h-full object-cover"})}),(p==="connected"||!W)&&A.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center",children:A.jsxs("div",{className:"text-center text-white",children:[A.jsx("img",{src:(d==null?void 0:d.avatar)||`https://ui-avatars.com/api/?name=${d==null?void 0:d.name}&background=6366f1&color=fff`,alt:d==null?void 0:d.name,className:"w-40 h-40 rounded-full mx-auto mb-6 border-4 border-white shadow-lg"}),A.jsx("h2",{className:"text-2xl font-semibold mb-2",children:d==null?void 0:d.name}),A.jsx("p",{className:"text-lg text-gray-300 capitalize",children:Ae(p)}),p==="calling"&&A.jsx("div",{className:"flex justify-center mt-6",children:A.jsxs("div",{className:"animate-pulse flex space-x-2",children:[A.jsx("div",{className:"w-3 h-3 bg-white rounded-full"}),A.jsx("div",{className:"w-3 h-3 bg-white rounded-full animation-delay-200"}),A.jsx("div",{className:"w-3 h-3 bg-white rounded-full animation-delay-400"})]})})]})})]}),F&&A.jsx("div",{className:"absolute top-4 right-4 w-48 h-36 bg-gray-800 rounded-lg overflow-hidden border-2 border-white shadow-lg",children:z?A.jsx("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center",children:A.jsxs("div",{className:"text-white text-center",children:[A.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),A.jsx("p",{className:"text-xs",children:"Starting camera..."})]})}):q?A.jsx("div",{className:"absolute inset-0 bg-red-900 flex items-center justify-center",children:A.jsxs("div",{className:"text-white text-center p-2",children:[A.jsx("div",{className:"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-2",children:A.jsx(oy,{className:"w-4 h-4"})}),A.jsx("p",{className:"text-xs",children:"Camera unavailable"})]})}):Ee?A.jsx("video",{ref:Kt,className:"w-full h-full object-cover transform scale-x-[-1]"}):A.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-600 to-blue-600 flex items-center justify-center",children:A.jsxs("div",{className:"text-white text-center",children:[A.jsx("div",{className:"w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-2",children:A.jsx(oy,{className:"w-8 h-8"})}),A.jsx("p",{className:"text-xs",children:"You"})]})})}),p==="connected"&&A.jsx("div",{className:"absolute top-0 left-0 right-0 bg-gradient-to-b from-black via-black/50 to-transparent p-6",children:A.jsxs("div",{className:"flex items-center justify-between text-white",children:[A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsx("img",{src:(d==null?void 0:d.avatar)||`https://ui-avatars.com/api/?name=${d==null?void 0:d.name}&background=6366f1&color=fff`,alt:d==null?void 0:d.name,className:"w-12 h-12 rounded-full object-cover border-2 border-white"}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-lg font-semibold",children:d==null?void 0:d.name}),A.jsx("p",{className:"text-sm text-gray-300",children:p==="connected"?dr(_):`${Ae(p)}`})]})]}),A.jsx("div",{className:"flex items-center space-x-2",children:A.jsx("button",{onClick:B,className:"p-2 bg-black bg-opacity-50 hover:bg-opacity-70 rounded-full transition-colors",title:"Minimize",children:A.jsx(t4,{className:"w-5 h-5"})})})]})})]}):A.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-green-600 via-blue-600 to-purple-700 flex items-center justify-center",children:[A.jsxs("div",{className:"text-center text-white max-w-md mx-auto px-6",children:[A.jsxs("div",{className:"relative mb-8",children:[A.jsx("div",{className:`absolute inset-0 rounded-full ${p==="connected"?"animate-ping bg-white opacity-20":""}`}),A.jsx("img",{src:(d==null?void 0:d.avatar)||`https://ui-avatars.com/api/?name=${d==null?void 0:d.name}&background=6366f1&color=fff`,alt:d==null?void 0:d.name,className:"relative w-48 h-48 rounded-full mx-auto border-8 border-white shadow-2xl"}),p==="connected"&&A.jsx("div",{className:"absolute -bottom-2 -right-2 w-12 h-12 bg-green-500 border-4 border-white rounded-full flex items-center justify-center",children:A.jsx(sy,{className:"w-6 h-6 text-white"})})]}),A.jsx("h2",{className:"text-3xl font-bold mb-2",children:d==null?void 0:d.name}),A.jsx("p",{className:"text-xl text-white/80 mb-2",children:p==="connected"?dr(_):`${Ae(p)}`}),p==="connected"&&A.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-8",children:[A.jsxs("div",{className:"flex space-x-1",children:[A.jsx("div",{className:"w-1 h-4 bg-white rounded-full"}),A.jsx("div",{className:"w-1 h-6 bg-white rounded-full"}),A.jsx("div",{className:"w-1 h-5 bg-white rounded-full"}),A.jsx("div",{className:"w-1 h-7 bg-white rounded-full"})]}),A.jsx("span",{className:"text-sm text-white/70",children:"HD Audio"})]}),p==="calling"&&A.jsx("div",{className:"flex justify-center mb-8",children:A.jsxs("div",{className:"animate-pulse flex space-x-3",children:[A.jsx("div",{className:"w-4 h-4 bg-white rounded-full"}),A.jsx("div",{className:"w-4 h-4 bg-white rounded-full animation-delay-200"}),A.jsx("div",{className:"w-4 h-4 bg-white rounded-full animation-delay-400"})]})})]}),A.jsx("button",{onClick:B,className:"absolute top-6 right-6 p-3 bg-black bg-opacity-30 hover:bg-opacity-50 text-white rounded-full transition-colors",title:"Minimize",children:A.jsx(t4,{className:"w-6 h-6"})})]}),A.jsx("div",{className:`absolute bottom-0 left-0 right-0 transition-all duration-300 ${a==="video"&&p==="connected"&&!at?"opacity-0 translate-y-full pointer-events-none":"opacity-100 translate-y-0"}`,children:A.jsxs("div",{className:"bg-gradient-to-t from-black via-black/80 to-transparent p-8",children:[A.jsx("div",{className:"flex items-center justify-center space-x-6",children:(s==null?void 0:s.callerId)!==((fe=Rr.getState().auth.user)==null?void 0:fe.id)&&p==="ringing"?A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:T,className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all transform hover:scale-110 shadow-lg",title:"Decline",children:A.jsx(eb,{className:"w-8 h-8"})}),A.jsx("button",{onClick:v,className:"w-16 h-16 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all transform hover:scale-110 shadow-lg animate-pulse",title:"Accept",children:A.jsx(sy,{className:"w-8 h-8"})})]}):A.jsxs(A.Fragment,{children:[A.jsx("button",{onClick:N,className:`w-14 h-14 rounded-full flex items-center justify-center transition-all transform hover:scale-110 shadow-lg ${Y?"bg-red-500 hover:bg-red-600 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,title:Y?"Unmute":"Mute",children:Y?A.jsx(Epe,{className:"w-6 h-6"}):A.jsx(BA,{className:"w-6 h-6"})}),A.jsx("button",{onClick:b,className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all transform hover:scale-110 shadow-lg",title:"End call",children:A.jsx(eb,{className:"w-8 h-8"})})]})}),A.jsx("div",{className:"text-center mt-4",children:A.jsxs("p",{className:"text-white text-sm opacity-75",children:[(s==null?void 0:s.callerId)!==((ce=Rr.getState().auth.user)==null?void 0:ce.id)&&p==="ringing"&&"Incoming call",p==="calling"&&"Connecting...",p==="connected"&&`${a==="video"?"Video":"Voice"} call active`]})})]})})]}),p==="connected"&&A.jsx("div",{className:"absolute top-4 left-4 bg-black bg-opacity-50 text-white text-xs p-3 rounded-lg",children:A.jsxs("div",{className:"space-y-1",children:[A.jsxs("div",{children:[A.jsx("kbd",{className:"bg-gray-600 px-1 rounded",children:"M"})," Mute/Unmute"]}),a==="video"&&A.jsxs("div",{children:[A.jsx("kbd",{className:"bg-gray-600 px-1 rounded",children:"V"})," Video On/Off"]}),A.jsxs("div",{children:[A.jsx("kbd",{className:"bg-gray-600 px-1 rounded",children:"Esc"})," End Call"]}),q&&A.jsx("div",{className:"mt-2 text-red-300",children:A.jsxs("div",{className:"text-xs",children:["Camera: ",q]})})]})})]}):null}),hme="/assets/callbusy-BZarluHz.mp3",pme="/assets/callringing-Dk_hZT9k.mp3",fme=()=>{const r=No(),{sidebarOpen:s}=xr(Ie=>Ie.ui),{activeChat:a}=xr(Ie=>Ie.chat),d=ee.useRef(null),p=ee.useRef(null),_=ee.useRef(!1),v=ee.useRef(null),T=ee.useRef(null),b=xr(Ie=>{var Et,vt,tn;return((vt=(Et=Ie.auth)==null?void 0:Et.user)==null?void 0:vt.id)||((tn=Ie.auth)==null?void 0:tn.userId)||null}),{user:N}=xr(Ie=>Ie.auth),{activeCall:L,isCallModalOpen:U,callStatus:B,callType:Y,callDuration:F,isMuted:X,isVideoEnabled:te,isSpeakerOn:q,isMinimized:z,showControls:W,cameraError:Z,isCameraLoading:Ee,remoteStreamReady:Oe,localStream:we,loading:Ne,participant:at,localVideoTrackId:Ue,remoteVideoTrackId:ct}=xr(Ie=>Ie.call);ee.useEffect(()=>{_.current||(r(Uf()),_.current=!0)},[r]),ee.useEffect(()=>(v.current=new Audio(pme),v.current.loop=!0,T.current=new Audio(hme),T.current.loop=!1,()=>{v.current=null,T.current=null}),[]),ee.useEffect(()=>{const Ie=()=>{window.innerWidth<768?r(jf(!a)):r(jf(!0))};return Ie(),window.addEventListener("resize",Ie),()=>window.removeEventListener("resize",Ie)},[r,a]),ee.useEffect(()=>{const Ie=()=>{var zt;(zt=v.current)==null||zt.play().catch(()=>{})},Et=()=>{v.current&&(v.current.pause(),v.current.currentTime=0)},vt=()=>{var zt;(zt=T.current)==null||zt.play().catch(()=>{})},tn=()=>{T.current&&(T.current.pause(),T.current.currentTime=0)};return B==="ringing"?(Ie(),tn()):B==="declined"||B==="offline"?(Et(),vt()):(Et(),tn()),B==="connected"?dr():(B==="idle"||B==="ended"||B==="declined")&&en(),()=>{p.current&&(clearInterval(p.current),p.current=null),Et(),tn()}},[B]);const Ze=async()=>{if(L){r(vv(L.callerId)),Cr.answerCall(L.callerId,b,L.channelName);try{const Ie=await Cr.startCallAndPublish(L.channelName,b,L.token,L.callType),Et=Ie[0],vt=L.callType==="video"?Ie[1]:null;r(dG({videoTrack:vt,audioTrack:Et}))}catch(Ie){console.error("Failed to join Agora as Receiver:",Ie),Cr.leaveCall()}}},Kt=async()=>{try{r(dd()),Cr.declineOrEndCall(L.callerId,N.name,"declined")}catch(Ie){console.error("Failed to accept call:",Ie)}},Mt=async()=>{console.log("active call handleEndCall",L);try{r(dd()),Cr.declineOrEndCall(L.participant.id,N.name,"ended")}catch(Ie){console.error("Failed to call end:",Ie),Cr.destroyAndCleanup()}},dr=()=>{p.current=setInterval(()=>{r(Ohe())},1e3)},en=()=>{p.current&&(clearInterval(p.current),p.current=null)},Ae=()=>{r(Nhe()),Cr.toggleAudio()},fe=()=>{r(Phe())},ce=()=>{r(Dhe())},me=()=>{r(khe())},ke=window.innerWidth<768,qe=()=>A.jsx(ume,{ref:d,isOpen:U,activeCall:L,callType:Y,participant:at,callStatus:B,duration:F,onAccept:Ze,onDecline:Kt,onClose:Mt,onToggleMute:Ae,onToggleVideo:fe,onToggleSpeaker:ce,onToggleMinimize:me,isMuted:X,isVideoEnabled:te,isSpeakerOn:q,isMinimized:z,cameraError:Z,isCameraLoading:Ee,isRemoteStreamReady:Oe,localStream:we,localVideoTrackId:Ue,remoteVideoTrackId:ct});return ke?A.jsxs("div",{className:"h-screen bg-gray-100 flex overflow-hidden",children:[!a||s?A.jsx("div",{className:"w-full",children:A.jsx(f4,{})}):A.jsx("div",{className:"w-full",children:A.jsx(m4,{})}),qe()]}):A.jsxs("div",{className:"h-screen bg-gray-100 flex overflow-hidden",children:[A.jsx("div",{className:`${s?"translate-x-0":"-translate-x-full"} fixed inset-y-0 left-0 z-50 w-80 bg-white shadow-lg transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0`,children:A.jsx(f4,{})}),s&&A.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>r(jf(!1))}),A.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:a?A.jsx(m4,{}):A.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:A.jsxs("div",{className:"text-center",children:[A.jsx("div",{className:"bg-green-100 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6",children:A.jsx("span",{className:"text-green-600 text-4xl font-bold",children:"W"})}),A.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-2",children:"Welcome to WhatsApp Web"}),A.jsx("p",{className:"text-gray-600 max-w-md",children:"Send and receive messages without keeping your phone online. Use WhatsApp on up to 4 linked devices and 1 phone at the same time."})]})})}),qe()]})};function mme(){const r=No(),{user:s,isAuthenticated:a,loading:d}=xr(_=>_.auth),p=ee.useRef(!1);return ee.useEffect(()=>{(async()=>{const v=localStorage.getItem("token");if(v&&!s&&!p.current){p.current=!0;try{const T=await Ade(v);r(xde(T.data))}catch(T){console.error("Failed to initialize auth:",T),r(Ude()),localStorage.removeItem("token"),p.current=!1}}})()},[r,s]),ee.useEffect(()=>{const _=localStorage.getItem("token");return _&&s&&a&&(Cr.socket||Cr.connect(s.id,_)),()=>{_||Cr.disconnect()}},[s,a]),A.jsxs(gae,{children:[A.jsx($b,{path:"/",element:a?A.jsx(s3,{to:"/chat"}):A.jsx(Lpe,{})}),A.jsx($b,{path:"/chat",element:a?A.jsx(fme,{}):A.jsx(s3,{to:"/"})})]})}function _me(){return A.jsx(cce,{store:Rr,children:A.jsxs(yae,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[A.jsx(Ahe,{position:"top-right",toastOptions:{style:{zIndex:99999}}}),A.jsx(mme,{})]})})}N6(document.getElementById("root")).render(A.jsx(ee.StrictMode,{children:A.jsx(_me,{})}));
